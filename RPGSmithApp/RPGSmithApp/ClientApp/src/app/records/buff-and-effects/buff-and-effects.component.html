<div class="page-inventory">
  <!-- Toolbar -->
  <div class="page-toolbar">
    <div class="container">
      <div class="page-toolbar-wrapper">
        <div class="page-toolbar-title">
          <a [routerLink]="backURL" class="icon icon-back">
            <h1 class="d-none d-md-inline-block"> Back</h1>
          </a>
          <h1 class="d-md-none">Buff & Effects</h1>
        </div>
        <div class="page-toolbar-wrapper initial show recordes-menu">
          <!-- Toolbar links -->
          <!--if !GM-->
          <ul class="page-toolbar-links" *ngIf="!isLoading && !IsGm">
            <li *ngIf="rulesetModel" class="hidden-tab">
              <a *ngIf="!IsGm" [routerLink]="['/ruleset/dashboard/', ruleSetId]" class="btn btn-link-primary nav-redirection">Layouts</a>
              <a *ngIf="IsGm" [routerLink]="['/ruleset/campaign-dashboard/', ruleSetId]" class="btn btn-link-primary nav-redirection">Layouts</a>
            </li>
            <li *ngIf="rulesetModel?.isItemEnabled" class="hidden-tab">
              <a [routerLink]="['/ruleset/item-master/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-Items"> <span>Item Templates</span></a>
            </li>
            <li *ngIf="rulesetModel?.isSpellEnabled" class="hidden-tab">
              <a [routerLink]="['/ruleset/spell/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Rec-Magical"> <span>Spells</span></a>
            </li>
            <li *ngIf="rulesetModel?.isBuffAndEffectEnabled" class="hidden-tab">
              <a [routerLink]="['/ruleset/buff-effect/', ruleSetId]" class="btn btn-link-primary nav-redirection selected icon-BnE"> <span>Buff & Effects</span></a>
            </li>
            <!--<li *ngIf="rulesetModel" class="hidden-tab">
              <a [routerLink]="['/ruleset/character-stats/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-CharStat"> <span>Character Stats</span></a>
            </li>-->
            <li class="visible-tab">
              <div class="dropdown dropdown-buttons" [ngClass]="{'show': isDropdownOpen}">
                <button type="button" data-toggle="dropdown" aria-expanded="false" class="btn btn-primary dropdown-toggle is-show">Records</button>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger" *ngIf="isDropdownOpen">
                  <ul class="dropdown-menu-list" *ngIf="!isLoading">
                    <li *ngIf="rulesetModel?.isItemEnabled" class="dropdown-menu-item">
                      <a *ngIf="!IsGm" [routerLink]="['/ruleset/dashboard/', ruleSetId]" class="btn btn-link-primary nav-redirection">Layouts</a>
                      <a *ngIf="IsGm" [routerLink]="['/ruleset/campaign-dashboard/', ruleSetId]" class="btn btn-link-primary nav-redirection">Layouts</a>
                    </li>
                    <li *ngIf="rulesetModel?.isItemEnabled" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/item-master/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-Items"> Item Templates</a>
                    </li>
                    <li *ngIf="rulesetModel?.isSpellEnabled" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/spell/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Rec-Magical"> Spells</a>
                    </li>
                    <li *ngIf="rulesetModel?.isBuffAndEffectEnabled" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/buff-effect/', ruleSetId]" class="btn btn-link-primary nav-redirection selected icon-BnE"> <span>Buff & Effects</span></a>
                    </li>
                    <!--<li *ngIf="rulesetModel" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/character-stats/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-CharStat"> Character Stats</a>
                    </li>-->
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <!--<div class="dropdown dropdown-buttons">
                <button type="button" (click)="createBuffAndEffect()" data-toggle="dropdown" aria-expanded="false" class="btn icon icon-with-text icon-plus btn-primary btn-block"> <span> CREATE BUFF/EFFECT</span></button>
              </div>-->
              <div class="dropdown dropdown-buttons" [ngClass]="{'show': isDropdownOpen}">
                <button type="button" data-toggle="dropdown" aria-expanded="false" class="action-btn-font-size btn icon icon-with-text btn-primary dropdown-toggle is-show">A<span class="text-hide-tab  is-show">ACTIONS</span></button>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger" *ngIf="isDropdownOpen">
                  <ul class="dropdown-menu-list">
                    <li class="dropdown-menu-item">
                      <button type="button" (click)="createBuffAndEffect()" class="btn btn-accent icon icon-with-text icon-plus">CREATE BUFF/EFFECT</button>
                    </li>
                    <li class="dropdown-menu-item">
                      <button type="button" (click)="DeleteRecords()" class="btn btn-accent icon icon-with-text icon-Gen-Trash"> Delete Buffs & Effects</button>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>

          <!--if GM-->
          <ul class="page-toolbar-links" *ngIf="!isLoading && IsGm">
            <li *ngIf="rulesetModel" class="hidden-tab show-first-child">
              <a [routerLink]="['/ruleset/monster/', ruleSetId]" class="btn btn-link-primary nav-redirection icon icon-Monster"> <span>Monsters</span></a>
            </li>
            <li *ngIf="rulesetModel?.isSpellEnabled" class="hidden-tab">
              <a [routerLink]="['/ruleset/spell/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Rec-Magical"> <span>Spells</span></a>
            </li>
            <li *ngIf="rulesetModel?.isAbilityEnabled" class="hidden-tab">
              <a [routerLink]="['/ruleset/ability/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-Ability"> <span>Abilities</span></a>
            </li>
            <li *ngIf="rulesetModel?.isBuffAndEffectEnabled" class="hidden-tab">
              <a [routerLink]="['/ruleset/buff-effect/', ruleSetId]" class="btn btn-link-primary nav-redirection selected icon-BnE"> <span>Buffs/Effects</span></a>
            </li>
            <li *ngIf="rulesetModel" class="hidden-tab">
              <a [routerLink]="['/ruleset/loot/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-Pouch"> <span>Loot</span></a>
            </li>
            <li class="visible-tab">
              <div class="dropdown dropdown-buttons" [ngClass]="{'show': isDropdownOpen}">
                <button type="button" data-toggle="dropdown" aria-expanded="false" class="btn btn-primary dropdown-toggle is-show">Records</button>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger" *ngIf="isDropdownOpen">
                  <ul class="dropdown-menu-list" *ngIf="!isLoading">
                    <li *ngIf="rulesetModel" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/monster/', ruleSetId]" class="btn btn-link-primary nav-redirection icon icon-Monster"> <span>Monsters</span></a>
                    </li>
                    <li *ngIf="rulesetModel?.isSpellEnabled" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/spell/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Rec-Magical"> Spells</a>
                    </li>
                    <li *ngIf="rulesetModel?.isAbilityEnabled" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/ability/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-Ability"> <span>Abilities</span></a>
                    </li>
                    <li *ngIf="rulesetModel?.isBuffAndEffectEnabled" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/buff-effect/', ruleSetId]" class="btn btn-link-primary nav-redirection selected icon-BnE"> <span>Buffs/Effects</span></a>
                    </li>
                    <li *ngIf="rulesetModel" class="dropdown-menu-item">
                      <a [routerLink]="['/ruleset/loot/', ruleSetId]" class="btn btn-link-primary nav-redirection icon-Gen-Pouch"> <span>Loot</span></a>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <!--<div class="dropdown dropdown-buttons">
                <button type="button" (click)="createBuffAndEffect()" data-toggle="dropdown" aria-expanded="false" class="btn icon icon-with-text icon-plus btn-primary btn-block"> <span> CREATE BUFF/EFFECT</span></button>
              </div>-->
              <div class="dropdown dropdown-buttons" [ngClass]="{'show': isDropdownOpen}">
                <button type="button" data-toggle="dropdown" aria-expanded="false" class="action-btn-font-size btn icon icon-with-text btn-primary dropdown-toggle is-show">A<span class="text-hide-tab  is-show">ACTIONS</span></button>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger" *ngIf="isDropdownOpen">
                  <ul class="dropdown-menu-list">
                    <li class="dropdown-menu-item">
                      <button type="button" (click)="createBuffAndEffect()" class="btn btn-accent icon icon-with-text icon-plus">CREATE BUFF/EFFECT</button>
                    </li>
                    <li class="dropdown-menu-item">
                      <button type="button" (click)="DeleteRecords()" class="btn btn-accent icon icon-with-text icon-Gen-Trash"> Delete Buffs & Effects</button>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>
          <!-- End of toolbar links -->
        </div>
        <ul class="page-toolbar-actions" *ngIf="!isLoading">
          <li class="view-switch">
            <div class="btn-group" role="group">
              <!--<button type="button" id="gridViewTrigger" class="btn icon icon-grid btn-primary" [ngClass]="{'selected':!isListView}" (click)="showListView(false)"></button>
              <button type="button" id="listViewTrigger" class="btn icon icon-list btn-primary" [ngClass]="{'selected':isListView}" (click)="showListView(true)"></button>-->
              <div class="dropdown">
                <button class="btn dropdown-toggle filter-toggle-btn-light" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i [ngClass]="isDenseView ? 'icon-Rec-Dense': '' "></i>
                  <i [ngClass]="!isListView && !isDenseView ? 'icon icon-grid' :''"></i>
                  <i [ngClass]="isListView && !isDenseView ? 'icon icon-list' :''"></i>
                </button>
                <div class="dropdown-menu filter-toggle-btn-menu" aria-labelledby="dropdownMenuButton">
                  <button type="button" id="gridViewTrigger" class="btn icon icon-list" [ngClass]="isListView && !isDenseView ? 'selected' :''" (click)="showListView(true)"> List</button>
                  <button type="button" id="listViewTrigger" class="btn icon icon-grid" [ngClass]="!isListView && !isDenseView ? 'selected' :''" (click)="showListView(false)"> Grid </button>
                  <button type="button" id="denseViewTrigger" class="btn icon icon-Rec-Dense" [ngClass]="isDenseView ? 'selected': '' " (click)="showDenseview(true)"> Dense</button>
                </div>
              </div>
            </div>
          </li>
          <li>
            <!--<div class="dropdown dropdown-buttons">
              <button type="button" (click)="createBuffAndEffect()" data-toggle="dropdown" aria-expanded="false" class="btn icon icon-with-text icon-plus btn-primary btn-block"><span class="text-hide-tab  is-show"> CREATE BUFF/EFFECT</span></button>
            </div>-->
            <div class="dropdown dropdown-buttons" [ngClass]="{'show': isDropdownOpen}">
              <button type="button" data-toggle="dropdown" aria-expanded="false" class="btn icon icon-with-text btn-primary dropdown-toggle is-show">
                <span class="text-hide-tab  is-show">ACTIONS</span>
              </button>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger" *ngIf="isDropdownOpen">
                <ul class="dropdown-menu-list">
                  <li class="dropdown-menu-item">
                    <button type="button" (click)="createBuffAndEffect()" class="btn btn-accent icon icon-with-text icon-plus">CREATE BUFF/EFFECT</button>
                  </li>
                  <li class="dropdown-menu-item">
                    <button type="button" (click)="DeleteRecords()" class="btn btn-accent icon icon-with-text icon-Gen-Trash"> Delete Buffs & Effects</button>
                  </li>
                </ul>
              </div>
            </div>
          </li>
          <li>
            <button type="button" *ngIf="IsGm && !isLoading" (click)="openDiceRollModal()" class="btn icon icon-with-text icon-dice icon-rsi btn-primary">Dice</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <!-- End of toolbar -->
  <!-- Inventory cards -->
  <div class="cards cards-inventory cards-buff form-row" *ngIf="!isLoading" infiniteScroll (scrolled)="onScroll()" [infiniteScrollDistance]="1"
       [infiniteScrollThrottle]="300" [scrollWindow]="true">
    <div class="container">
      <div class="card-list justify-content-center justify-content-lg-start" [ngClass]="{'view-list':isListView, 'dense-list': isDenseView}">
        <p class="text-center py-5 w-100 d-block" *ngIf="noRecordFound">No Buffs & Effects have been added to this ruleset. Click "+ BUFF/EFFECT" to add some.</p>
        <ng-container *ngFor="let buffAndEffect of buffAndEffectsList">
          <div class="card-wrapper" (mousedown)="editRecord(buffAndEffect)" (mouseup)="clickAndHold(buffAndEffect)" (mouseleave)="clickAndHold(buffAndEffect)">
            <div class="card" [ngClass]="{'card-equip':buffAndEffect.isAssignedToAnyCharacter}">
              <div class="card-image" [ngClass]="{'thumbnail':!isListView, 'thumbnail-list':isListView}">

                <img class="card-img-top portrait" [src]="buffAndEffect.imageUrl" [alt]="buffAndEffect.imageUrl"
                     onerror="this.src='https://rpgsmithsa.blob.core.windows.net/stock-defimg-rulesets/RS.png';" [routerLink]="['/ruleset/buff-effect-details', buffAndEffect.buffAndEffectId]">

                <div class="card-actions show" *ngIf="buffAndEffect.showIcon && !isListView">
                  <button type="button" (click)="editBuffAndEffect(buffAndEffect)" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary"></button>
                  <button type="button" (click)="duplicateBuffAndEffect(buffAndEffect)" title="Duplicate" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary"></button>
                  <button type="button" (click)="deleteBuffAndEffect(buffAndEffect)" title="Delete" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary"></button>
                  <button type="button" (click)="manageIcon(false)" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button>
                </div>
              </div>
              <div class="card-body" (click)="!isDenseView && openBuffDetail(buffAndEffect.buffAndEffectId)">
                <h4 class="card-title" popover="{{buffAndEffect.name}}" triggers="hover" (click)="isDenseView && openBuffDetail(buffAndEffect.buffAndEffectId)">{{buffAndEffect.name}}</h4>


                <ul class="item-properties" *ngIf="!buffAndEffect?.description">
                  <li class="item-property item-property-text value" title="Value" style="visibility:hidden"><small>12</small></li>
                </ul>

                <div class="item-stats pl-0" *ngIf="buffAndEffect?.description" [froalaView]="buffAndEffect?.description"></div>
                <div class="item-actions" *ngIf="isDenseView">
                  <button type="button" (click)="Assign(buffAndEffect)" class="btn btn-accent icon-Assign icon-with-text assign-button">
                    ASSIGN
                  </button>
                </div>
              </div>
              <div class="card-actions-trigger" *ngIf="!buffAndEffect.showIcon">
                <button type="button" (click)="manageIcon(buffAndEffect.buffAndEffectId)" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary"></button>
              </div>
              <div class="card-actions show" *ngIf="buffAndEffect.showIcon && isListView">
                <button type="button" (click)="editBuffAndEffect(buffAndEffect)" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary"></button>
                <button type="button" (click)="duplicateBuffAndEffect(buffAndEffect)" title="Duplicate" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary"></button>
                <button type="button" (click)="deleteBuffAndEffect(buffAndEffect)" title="Delete" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary"></button>
                <button type="button" (click)="manageIcon(false)" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button>
              </div>
              <div class="item-actions" *ngIf="!isDenseView">
                <button type="button" (click)="Assign(buffAndEffect)" class="btn btn-accent icon-Assign icon-with-text assign-button">
                  ASSIGN
                </button>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
  <!-- End of inventory cards -->

  <app-loader [isLoading]="isLoading"></app-loader>
  <div class="spinner" *ngIf="scrollLoading">
    <img src="../../../../assets/images/PageLoader.gif" />
  </div>

</div>

