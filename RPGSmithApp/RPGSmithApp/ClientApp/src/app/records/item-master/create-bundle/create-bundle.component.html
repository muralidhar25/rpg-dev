<form name="itemMasterForm" #f="ngForm" (ngSubmit)="f.form.valid && submitForm(itemMasterFormModal)">
  <div class="modal-header">
    <h5 class="modal-title" id="createItemPopupTitle">{{title}}</h5>
    <button type="button" (click)="close()" class="btn icon icon-cross btn-simple-primary close"></button>
  </div>
  <div class="modal-body" *ngIf="!isLoading">

    <div class="form-row">
      <div class="col-12 col-md-12">
        <div class="form-group">
          <label for="newItemName">Name</label>
          <input *ngIf="itemMasterFormModal.view != 'edit'" type="text" id="newItemName" name="newItemName" class="form-control" placeholder="Item Template Name" [ngStyle]="{'border-color': f.submitted && !newItemName.valid ? 'red' : '#d3cfce'}" [autofocus] [(ngModel)]="itemMasterFormModal.itemName" #newItemName="ngModel" required>
          <input *ngIf="itemMasterFormModal.view == 'edit'" type="text" id="newItemName" name="newItemName" class="form-control" placeholder="Item Template Name" [ngStyle]="{'border-color': f.submitted && !newItemName.valid ? 'red' : '#d3cfce'}" [(ngModel)]="itemMasterFormModal.itemName" #newItemName="ngModel" required>
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="newItemValue">Value {{itemMasterFormModal.currencyLabel}}</label>
          <input type="number" id="newItemValue" name="newItemValue" class="form-control" placeholder="Value"
                 [(ngModel)]="itemMasterFormModal.value" #newItemValue="ngModel" [pattern]="numberRegex" />
          <small style="color:#a94442;" [hidden]="newItemValue.valid || (newItemValue.pristine && !f.submitted)">
            Only valid numbers are allowed.
          </small>
        </div>
        <div class="form-group">
          <!--<label for="newItemWeight">Weight {{itemMasterFormModal.weightLabel}}</label>-->
          <label for="newItemWeight">Total Weight</label>
          <input type="number" id="newItemWeight" name="newItemWeight" class="form-control" placeholder="Weight"
                 [(ngModel)]="itemMasterFormModal.weight" #newItemWeight="ngModel" [pattern]="numberRegex" />
          <small style="color:#a94442;" [hidden]="newItemWeight.valid || (newItemWeight.pristine && !f.submitted)">
            Only valid numbers are allowed.
          </small>
        </div>
        <div class="form-group">
          <label>Volume {{itemMasterFormModal.volumeLabel}}</label>
          <div class="form-row">
            <div class="col">
              <input type="number" id="newItemVolume" name="newItemVolume" class="form-control" placeholder="Volume"
                     [(ngModel)]="itemMasterFormModal.volume" #newItemVolume="ngModel" [pattern]="numberRegex" />
              <small style="color:#a94442;" [hidden]="newItemVolume.valid || (newItemVolume.pristine && !f.submitted)">
                Only valid numbers are allowed.
              </small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <!-- Image file -->
        <div class="form-group input-image input-image-alt">
          <label for="newItemImageFile">Image (optional)</label>
          <div class="input-image-control input-image-note input-image-trigger" (click)="cropImage(null,true,'VIEW.ADD')"
               *ngIf="((itemMasterFormModal.itemMasterId === undefined || itemMasterFormModal.itemMasterId === 0)
                        && !showWebButtons && itemMasterFormModal.itemImage === undefined)
                        || (!showWebButtons && (itemMasterFormModal.itemImage === undefined || itemMasterFormModal.itemImage === null))">
            <div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div>
          </div>
          <div class="form-group input-image-note input-image-trigger" (click)="cropImage(itemMasterFormModal.itemImage,true,'VIEW.EDIT')"
               *ngIf="(!showWebButtons && itemMasterFormModal.itemImage !== undefined && itemMasterFormModal.itemImage !== null)">
            <img class="item-master-img" [src]="itemMasterFormModal.itemImage"
                 onerror="this.src='../assets/images/DefaultImages/stock-defimg-items/Backpack.jpg';" />
          </div>
          <!--<div class="input-image-control input-image-note input-image-buttons show" *ngIf="showWebButtons"
          [ngStyle]="{'background-image': 'url('+itemMasterFormModal.itemImage+')','background-position':'center center', 'background-repeat':'no-repeat'}">-->
          <div class="input-image-control input-image-note input-image-buttons show" *ngIf="showWebButtons">
            <img [src]="itemMasterFormModal.itemImage" class="bg-image" />
          </div>
          <input type="file" id="newItemImagePortrait" class="form-control-file">
        </div>
        <!-- End of image file -->
      </div>
    </div>

    <div class="form-row">
      <div class="col-12">
        <div class="form-group">
          <label for="newItemDescription">Description</label>
          <div [froalaEditor]="options('Description')" [(ngModel)]="itemMasterFormModal.itemVisibleDesc" name="itemVisibleDesc"></div>
          <!--<textarea id="newItemDescription" name="newItemDescription" class="form-control" placeholder="Description" rows="5"
          [(ngModel)]="itemMasterFormModal.itemVisibleDesc" #newItemDescription="ngModel"></textarea>-->
        </div>
      </div>
    </div>


    <div class="form-separator"></div>

    <div class="form-row">
      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="newItemTags">Tags</label>
          <tag-input name="metatags" [(ngModel)]='metatags' separatorKeyCodes="[9]" editable="true" placeholder="Input Tags, Separate with [Tab]" secondaryPlaceholder="Input Tags, Separate with [Tab]"
                     inputId="metatags" inputClass="form-control metatags-field" class="form-control">
            <ng-template let-item="item" let-index="index">
              <delete-icon class="tagdeleteicon" (click)="removeTag(metatags,item,index)"></delete-icon>
              <span *ngIf="item.value;else other"> {{item.value}} </span>
              <ng-template #other> {{item}} </ng-template>
            </ng-template>
          </tag-input>
          <!--<rl-tag-input name="metatags" class="form-control" [(ngModel)]="metatags" placeholder="Metadata tags"></rl-tag-input>-->
        </div>
      </div>
      <div class="col-12 col-md-6">
        <fieldset class="form-group input-switch input-switch-vertical">
          <legend>Rarity</legend>
          <ul class="input-switch-items">
            <li class="form-check">
              <label class="form-check-label">
                <input class="form-check-input" type="radio" name="newItemRarity1" [checked]="itemMasterFormModal.rarity == 'Common'"
                       (click)="itemRarity('Common')">
                <span>Common</span>
              </label>
            </li>
            <li class="form-check">
              <label class="form-check-label">
                <input class="form-check-input" type="radio" name="newItemRarity2" [checked]="itemMasterFormModal.rarity == 'Uncommon'"
                       (click)="itemRarity('Uncommon')">
                <span>Uncommon</span>
              </label>
            </li>
            <li class="form-check">
              <label class="form-check-label">
                <input class="form-check-input" type="radio" name="newItemRarity3" [checked]="itemMasterFormModal.rarity == 'Rare'"
                       (click)="itemRarity('Rare')">
                <span>Rare</span>
              </label>
            </li>
            <li class="form-check">
              <label class="form-check-label">
                <input class="form-check-input" type="radio" name="newItemRarity4" [checked]="itemMasterFormModal.rarity == 'Unique'"
                       (click)="itemRarity('Unique')">
                <span>Unique</span>
              </label>
            </li>
          </ul>
        </fieldset>
      </div>
    </div>

    

    <div class="form-row">

      <div class="col-12 col-md-12">
        <div class="form-group">

          <label for="contains">Contains</label>
          <div class="form-group form-group-unlabelled">
            <span class="input-group-btn">
              <button type="button" title="Select Item" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"
                      (click)="addContainerItem(itemMasterFormModal)"></button>
            </span>
            <!---THIS TAG INPUT IS USED FOR CONTAINS ITEMS SELECTED FROM POPUP-->
            <tag-input name="contains" [(ngModel)]='itemMasterFormModal.contains' theme='dark' inputId="contains" inputClass="form-control metatags-field" class="form-control"
                       disable="true" [identifyBy]="'value'" [displayBy]="'text'" placeholder="" secondaryPlaceholder="Select Item"></tag-input>
          </div>

        </div>
      </div>

    </div>
  </div>


  <app-loader [isLoading]="isLoading"></app-loader>
  <div class="modal-footer pt-1">
    <button type="button" (click)="close()" class="btn btn-simple-accent">Cancel</button>
    <button type="submit" [disabled]="isLoading" class="btn btn-accent">{{button}}</button>
  </div>
</form>

