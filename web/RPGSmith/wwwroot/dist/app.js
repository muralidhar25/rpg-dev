(function () {
    'use strict';

    // https://tc39.github.io/ecma262/#sec-array.prototype.findIndex
    if (!Array.prototype.findIndex) {
        Object.defineProperty(Array.prototype, 'findIndex', {
            value: function (predicate) {
                // 1. Let O be ? ToObject(this value).
                if (this == null) {
                    throw new TypeError('"this" is null or not defined');
                }

                var o = Object(this);

                // 2. Let len be ? ToLength(? Get(O, "length")).
                var len = o.length >>> 0;

                // 3. If IsCallable(predicate) is false, throw a TypeError exception.
                if (typeof predicate !== 'function') {
                    throw new TypeError('predicate must be a function');
                }

                // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
                var thisArg = arguments[1];

                // 5. Let k be 0.
                var k = 0;

                // 6. Repeat, while k < len
                while (k < len) {
                    // a. Let Pk be ! ToString(k).
                    // b. Let kValue be ? Get(O, Pk).
                    // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).
                    // d. If testResult is true, return k.
                    var kValue = o[k];
                    if (predicate.call(thisArg, kValue, k, o)) {
                        return k;
                    }
                    // e. Increase k by 1.
                    k++;
                }

                // 7. Return -1.
                return -1;
            }
        });
    }
})();
(function (r) {
    'use strict';

    GridStackUI.Utils.getNode = function (el) {
        return el.data('_gridstack_node');
    };

    GridStackUI.Utils.getNodeData = function (el) {
        return el.data('_item_data');
    };

    Math.clamp = function (num, min, max) {
        if (num <= min) return min;
        if (max <= num) return max;
        return num;
    };

    Math.randomInteger = function (min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    };

    r.obj2Styles = function(obj) {

        if (obj) {

            var str = '';

            for (var p in obj) {
                if (obj.hasOwnProperty(p)) {
                    str += '; '
                    str += p;
                    str += ': ';
                    str += obj[p]
                }
            }

            if (str.length > 1)
                return str.substring(2);
        }

        return '';
    };

    r.styles2Obj = function(str) {

        var regex = /([\w-]*)\s*:\s*([^;]*)/g;
        var match, obj = {};

        while (match = regex.exec(str))
            obj[match[1]] = match[2].trim();

        return obj;
    };

    r.isNullOrWhiteSpace = function (v) {
        return v == null || (/^\s*$/).test(v);
    }

    r.tileTypes = {
        note: { id: 1, name: "Note" },
        counter: { id: 2, name: "Counter" },
        attribute: { id: 3, name: "Attribute" },
        command: { id: 3, name: "Command" },
        inventory: { id: 4, name: "Inventory" },
        equipment: { id: 5, name: "Equipment" }
    };

    //r.isUndefinedOrNull = function (val) {
    //    return angular.isUndefined(val) || val === null;
    //};

    r.isEmpty = function (value) {
        // The == is by design.
        return (value == null) || value.length === 0;
    };

    r.fillArray = function (src, dest, converter) {

        if (typeof converter !== 'function')
            converter = function (item) { return item; }

        if (dest) {
            dest.length = 0;
            if (src)
                src.forEach(function (item) { dest.push(converter(item)); });
        }
    };

})(window.rpgsmith = window.rpgsmith || {});
(function () {
    'use strict';



    angular.module('rpgsmith-dialogs', [
        'ui.bootstrap', 'dialogs.main'
    ]);

    angular.module('rpgsmith-services', [
        'ngStorage'
    ]);

    angular.module('rpgsmith-filters', [
        'rpgsmith-services'
    ]);

    angular.module('rpgsmith-directives', []);
    angular.module('rpgsmith-controllers', [
        'rpgsmith-directives',
        'rpgsmith-services'
    ]);
    angular.module('rpgsmith-templates', []);

    var app = angular.module('rpgsmith', [
        'dialogs.main', 'ngMessages',
        'angularSpectrumColorpicker',
        'ngAnimate', 'ngTouch', 'ngSanitize', 'ngStorage', 'ngImgCrop', 'ngFileUpload',
        'pageslide-directive',
        'rpgsmith-directives', 'rpgsmith-dialogs', 'rpgsmith-filters',
        'rpgsmith-controllers', 'rpgsmith-services', 'rpgsmith-templates',
        'toaster',
        'ui.router', 'ui.sortable', 'ui.tab.scroll', 'ui.select', 'ui.tinymce', 'colorpicker','ngStorage'
    ]);


    app.filter('trusted', ['$sce', function ($sce) {
        return function (text) {
            return $sce.trustAsHtml(text);
        }
    }]);

    app.config(['uiSelectConfig', function (uiSelectConfig) {
        uiSelectConfig.theme = 'bootstrap';
        uiSelectConfig.searchEnabled = false;
        uiSelectConfig.skipFocusser = true;
    }]);

    app.config(['$animateProvider', function ($animateProvider) {
        $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);
    }]);

    app.config(['$localStorageProvider', function ($localStorageProvider) {
        $localStorageProvider.setKeyPrefix('RPGSmith');
    }]);

    app.config(['$stateProvider', '$urlRouterProvider', '$locationProvider', '$httpProvider',
        function ($stateProvider, $urlRouterProvider, $locationProvider, $httpProvider) {
            $httpProvider.interceptors.push('authInterceptor');
            $locationProvider.html5Mode(true).hashPrefix('!');
            //  $locationProvider.hashPrefix('');
            $urlRouterProvider.otherwise("/characters");
            $stateProvider
                .state('login', {
                    url: '/login',
                    cache: false,
                    authenticate: false,
                    templateUrl: '/views/home/login.html',
                    controller: 'loginController',
                    resolve: {
                        previousState: ['$state', function ($state) {
                            var current = {
                                name: $state.current.name,
                                params: $state.params,
                                url: $state.href($state.current.name, $state.params)
                            }
                            return current;
                        }]
                    }
                })
                .state('profile', {
                    abstract: true,
                    authenticate: false,
                    template: '<div ui-view="topNav"></div><div ui-view="main"></div>'
                })
                .state('profile.characters', {
                    authenticate: true,
                    url: '/characters',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/characters.html',
                            controller: 'charactersPageController'
                        }
                    },
                    params: {
                        menuSelected: 'Characters'
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.addnewcharacterdialog', {
                    authenticate: true,
                    url: '/characters/addnewcharacterdialog',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/dialogs/edit-character.html',
                            controller: 'charactersPageController'
                        }
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.addnewcorestatdialog', {
                    authenticate: true,
                    url: '/RuleSet/addnewcorestatdialog',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/dialogs/addnewcorestat.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.addnewcharacter', {
                    authenticate: true,
                    url: '/addnewcharacter',
                    views: {
                        'main@profile': {
                            templateUrl: '/views/home/character-addnew.html',
                            controller: 'charactersPageController'
                        }
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.character', {
                    abstract: true,
                    authenticate: true,
                    url: '^/characterlayout'
                })
                .state('profile.character.notes', {
                    authenticate: true,
                    url: '/notes',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-notes.html',
                            controller: 'notesPageController',
                        }
                    }
                })
                .state('profile.AddNewRuleSet', {
                    authenticate: true,
                    url: '/RuleSets',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/RuleSet.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        menuSelected: 'Rulesets',
                        action: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.NewRuleSet', {
                    authenticate: true,
                    url: '/RuleSet?RuleSetId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav_addnewruleset.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/ruleset-addnew.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 2,
                        isNew: 0,
                        // RuleSetId: 0,
                        CopyOrUpdate: 0,
                        IsAddRuleSet: 0
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.ExistingRuleSet', {
                    authenticate: true,
                    url: '/characters/ExistingRuleSet',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/dialogs/ExistingRuleset.html',
                            controller: 'charactersPageController'
                        }
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.character.counters', {
                    authenticate: true,
                    url: '/counters',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-counters.html',
                            controller: 'countersPageController',
                        }
                    }
                })
                .state('profile.character.attributes', {
                    authenticate: true,
                    url: '/stats',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-attributes.html',
                            controller: 'attributesPageController',
                        }
                    }
                })
                .state('profile.character.links', {
                    authenticate: true,
                    url: '/links',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-links.html',
                            controller: 'linksPageController',
                        }
                    }
                })
                .state('profile.character.executes', {
                    authenticate: true,
                    url: '/executes',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-executes.html',
                            controller: 'executesPageController',
                        }
                    }
                })
                .state('profile.character.commands', {
                    authenticate: true,
                    url: '/commands',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-commands.html',
                            controller: 'commandsPageController',
                        }
                    }
                })
                .state('profile.character.layouts', {
                    authenticate: true,
                    url: '/layouts',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-layouts.html',
                            controller: 'layoutsPageController',
                        }
                    }
                })
                .state('profile.character.layout', {
                    authenticate: true,
                    url: '?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/character-layout.html',
                            controller: 'layoutPageController'
                        }
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }],
                    params: {
                        //characterId:-1,
                        action: 1,
                        isNew: 1
                    }
                })
                .state('profile.EditProfile', {
                    authenticate: true,
                    url: '/Editprofile',
                    //  url: '/Editprofile/',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav_addnewruleset.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/editprofile.html',
                            controller: 'topNavController'
                        }
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                    //params: {
                    //    userid: {
                    //        dynamic: true
                    //    }

                    //},

                   
                })
                .state('profile.ResetPassword', {
                    authenticate: false,
                    url: '/ResetPassword',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav_addnewruleset.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/resetpassword.html',
                            controller: 'topNavController'
                        }
                    },
                    //params: {
                    //    userid: {
                    //        dynamic: true
                    //    }

                    //},
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.Items', {
                    authenticate: true,
                    url: '/Items?RuleSetId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/ruleset_itemproperties.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 4,
                        // RuleSetId: 0,
                        ContentId: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.Spells', {
                    authenticate: true,
                    url: '/Spells?RuleSetId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/ruleset-spells.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 4,
                        // RuleSetId: 0,
                        ContentId: 2
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.Abilities', {
                    authenticate: true,
                    url: '/Abilities?RuleSetId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/ruleset-abilities.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 4,
                        //  RuleSetId: 0,
                        ContentId: 3
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.Corestats', {
                    authenticate: true,
                    url: '/Corestats?RuleSetId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/ruleset-corestats.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 3,

                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.RulesetItemDetails', {
                    authenticate: true,
                    url: '/RulesetItemDetails',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/rulesetitemcontent.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 5,
                        RuleSetId:0,
                        contentType: 1,
                        index: -1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.RulesetSpellDetails', {
                    authenticate: true,
                    url: '/RulesetSpellDetails',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/rulesetspellcontent.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 5,
                        RuleSetId: 0,
                        contentType: 2,
                        index: -1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.RulesetAbilityDetails', {
                    authenticate: true,
                    url: '/RulesetAbilityDetails',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/rulesetabilitycontent.html',
                            controller: 'ruleSetPageController'
                        }
                    },
                    params: {
                        action: 5,
                        RuleSetId: 0,
                        contentType: 3,
                        index: -1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.ItemInventory', {
                    authenticate: true,
                    url: '/ItemInventory?characterId&contentType',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/iteminventory.html',
                            controller: 'layoutPageController'
                        }
                    },
                    params: {
                        // characterId:-1,
                        action: 2,
                        isNew: 0,
                       // contentType: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.SpellInventory', {
                    authenticate: true,
                    url: '/SpellInventory?characterId&contentType',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/spellinventory.html',
                            controller: 'layoutPageController'
                        }
                    },
                    params: {
                        //  characterId: -1,
                        action: 2,
                        //contentType: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.AbilityInventory', {
                    authenticate: true,
                    url: '/AbilityInventory?characterId&contentType',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/attributeinventory.html',
                            controller: 'layoutPageController'
                        }
                    },
                    params: {
                        // characterId: -1,
                        action: 2,
                       // contentType: 3
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.CharacterRulesetItems', {
                    authenticate: true,
                    url: '/CharacterRulesetItems?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/CharacterRulesetItems.html',
                            controller: 'layoutPageController'
                        }
                    },
                    params: {
                        // characterId: -1,
                        action: 3,
                        isNew: 0,
                        contentType: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.CharacterRulesetSpells', {
                    authenticate: true,
                    url: '/CharacterRulesetSpells?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/CharacterRulesetSpells.html',
                            controller: 'layoutPageController'
                        }
                    },
                    params: {
                        //characterId: -1,
                        action: 3,
                        contentType: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.CharacterRulesetAbilities', {
                    authenticate: true,
                    url: '/CharacterRulesetAbilities?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/CharacterRulesetAbilities.html',
                            controller: 'layoutPageController'
                        }
                    },
                    params: {
                        // characterId: -1,
                        action: 3,
                        isNew: 0,
                        contentType: 1
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.CharacterItemsDetails', {
                    authenticate: true,
                    url: '/CharacterItemsDetails?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/characteritemcontent.html',
                            controller: 'layoutPageController'
                        }

                    },
                    params: {
                        // characterId: -1,
                        action: 4,
                        contentType: 1,
                        index: -1,

                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.CharacterSpellDetails', {
                    authenticate: true,
                    url: '/CharacterSpellDetails?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/characterspellcontent.html',
                            controller: 'layoutPageController'
                        }

                    },
                    params: {
                        //characterId: -1,
                        action: 4,
                        contentType: 2,
                        index: -1,
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.CharacterAbilityDetails', {
                    authenticate: true,
                    url: '/CharacterAbilityDetails?characterId',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/home/characterabilitycontent.html',
                            controller: 'layoutPageController'
                        }

                    },
                    params: {
                        // characterId: -1,
                        action: 4,
                        contentType: 3,
                        index: -1,
                    },
                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                })
                .state('profile.AccountSettings', {
                    url: '/AccountSettings',
                    views: {
                        'topNav@profile': {
                            templateUrl: '/views/shared/home-topNav.html',
                            controller: 'topNavController'
                        },
                        'main@profile': {
                            templateUrl: '/views/shared/AccountSettings.html',
                            controller: 'topNavController',
                        }
                    },
                    params: {
                        menuSelected: 'AccountSettings',
                    }
				})
				.state('RegisterSuccess', {
					authenticate: false,
					url: '/RegisterSuccess',
					views: {
						
						'main@profile': {
							templateUrl: '/views/EmailTemplates/RegisterSuccess.html',
							controller: 'registerController'
						}
					}
				})
                .state('RegisterConfirmationEmailMessage', {
                    authenticate: true,
                    url: '/RegisterConfirmationEmail',
                    //  url: '/Editprofile/',
                    views: {
                        'main@profile': {
                            templateUrl: '/views/EmailTemplates/RegisterEmailConfirmation.html',
                            controller: 'topNavController'
                        }
                    },
                    //params: {
                    //    userid: {
                    //        dynamic: true
                    //    }

                    //},

                    onEnter: ['navService', function (navService) {
                        navService.setHeader(null);
                    }]
                });
        }]);

    app.config(['$qProvider', function ($qProvider) {
        $qProvider.errorOnUnhandledRejections(false);
    }]);

    
    //app.run(function ($rootScope, $route, $location) {
    //    //Bind the `$locationChangeSuccess` event on the rootScope, so that we dont need to 
    //    //bind in induvidual controllers.
    //    debugger;
    //    $rootScope.$on('$locationChangeSuccess', function () {
    //        $rootScope.actualLocation = $location.path();
    //    });

    //    $rootScope.$watch(function () { return $location.path() }, function (newLocation, oldLocation) {
    //        if ($rootScope.actualLocation === newLocation) {
    //            alert('Why did you use history back?');
    //        }
    //    });
    //});

    app.run(['$rootScope', '$http', '$state', 'authService', 'navService',
        function ($rootScope, $http, $state, authService, navService) {
            authService.init();
            $rootScope.$on('httpUnauthorized', function () {
                $state.transitionTo('login');
            });
            $http.defaults.headers.common['X-XSRF-TOKEN'] = angular.element('input[name="__RequestVerificationToken"]').attr('value');
        }]);

    app.run(['$transitions', 'authService', '$state', function ($transitions, authService, $state) {

        $transitions.onBefore({}, function (transition) {
            transition.addResolvable({
                token: '$transition',
                resolveFn: function () {
                    return transition;
                }
            })
        });

        $transitions.onStart({}, function (transition) {
            if (!authService.authentication.authenticated) {
                $state.go("login");
            }

        });
    }]);

    app.run(['$templateCache', '$interpolate', function ($templateCache, $interpolate) {
        var startSym = $interpolate.startSymbol();
        var endSym = $interpolate.endSymbol();
        $templateCache.put('/dialogs/error.html', '<div class="modal-header dialog-header-error"><h4 class="modal-title text-danger"><span class="' + startSym + 'icon' + endSym + '"></span> <span ng-bind-html="header"></span></h4></div><div class="modal-body text-danger" ng-bind-html="msg"></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="close()">' + startSym + '"DIALOGS_CLOSE" | translate' + endSym + '</button></div>');
        $templateCache.put('/dialogs/wait.html', '<div class="modal-header dialog-header-wait"><h4 class="modal-title"><span class="' + startSym + 'icon' + endSym + '"></span> ' + startSym + 'header' + endSym + '</h4></div><div class="modal-body"><p ng-bind-html="msg"></p><div class="progress progress-striped active"><div class="progress-bar progress-bar-info" ng-style="getProgress()"></div><span class="sr-only">' + startSym + 'progress' + endSym + '' + startSym + '"DIALOGS_PERCENT_COMPLETE" | translate' + endSym + '</span></div></div>');
        $templateCache.put('/dialogs/notify.html', '<div class="modal-header dialog-header-notify"><h4 class="modal-title text-info"><span class="' + startSym + 'icon' + endSym + '"></span> ' + startSym + 'header' + endSym + '</h4></div><div class="modal-body text-info" ng-bind-html="msg"></div><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="close()">' + startSym + '"DIALOGS_OK" | translate' + endSym + '</button></div>');
        $templateCache.put('/dialogs/confirm.html', '<div class="modal-header dialog-header-confirm"><h4 class="modal-title"><span class="' + startSym + 'icon' + endSym + '"></span> ' + startSym + 'header' + endSym + '</h4></div><div class="modal-body" ng-bind-html="msg"></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="yes()">' + startSym + '"DIALOGS_YES" | translate' + endSym + '</button><button type="button" class="btn btn-primary" ng-click="no()">' + startSym + '"DIALOGS_NO" | translate' + endSym + '</button></div>');
    }]);
})();


function InitialiseFacebook(appId) {

    window.fbAsyncInit = function () {
        FB.init({
            appId: appId,
            status: true,
            cookie: true,
            xfbml: true
        });

        FB.Event.subscribe('auth.login', function (response) {
            
            var credentials = { uid: response.authResponse.userID, accessToken: response.authResponse.accessToken };
            SubmitLogin(credentials);
        });

        //FB.getLoginStatus(function (response) {
        //    
        //    if (response.status === 'connected') {
        //        alert("user is logged into fb");
        //    }
        //    else if (response.status === 'not_authorized') { alert("user is not authorised"); }
        //    else { alert("user is not conntected to facebook"); }

        //});

        function SubmitLogin(credentials) {
            
            $.ajax({
                url: "/account/facebooklogin",
                type: "POST",
                data: credentials,
                error: function () {
                    alert("error logging in to your facebook account.");
                },
                success: function () {
                    angular.element('#profileImage').scope().gotoHomepage();
                }
            });
        }

    };

    (function (d) {
        var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement('script');
        js.id = id;
        js.async = true;
        js.src = "//connect.facebook.net/en_US/all.js";
        ref.parentNode.insertBefore(js, ref);
    }(document));

}
function googleSignIn() {
    
    gapi.load('auth2,signin2', function () {
        var auth2 = gapi.auth2.init();
        auth2.then(function () {
            // Current values
            var isSignedIn = auth2.isSignedIn.get();
            var currentUser = auth2.currentUser.get();

            if (!isSignedIn) {
                // Rendering g-signin2 button.
                gapi.signin2.render('signInGoogle', {
                    'onsuccess': 'onSignIn'
                });
            }
            else {
                if (confirm("Continue with Goole Account") == true) {
                    gapi.signin2.render('signInGoogle', {
                        'onsuccess': 'onSignIn'
                    });
                } else {
                    signOut();

                }
            }
        });
    });
}



function onSignIn(googleUser) {
    
    var profile = googleUser.getBasicProfile();
    console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
    console.log('Name: ' + profile.getName());
    console.log('Image URL: ' + profile.getImageUrl());
    console.log('Email: ' + profile.getEmail()); // This is null if
    console.log('Access' + googleUser.getAuthResponse().id_token);
    isUserRegistered(profile.getEmail(), profile.getId(), googleUser.getAuthResponse().id_token);
}

function onSignInFailure() {
    // Handle sign-in errors
    alert('failure');
}

function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
        gapi.signin2.render('signInGoogle', {
            'onsuccess': 'onSignIn'
        });
    });
}

function isUserRegistered(Email, Id, accessToken) {
    $.ajax({
        url: '/Account/GoogleLogin',
        method: 'GET',
        data: {
            Email: Email,
            AccesKey: Id,
            AccountType: 'Google'
        },
        success: function (response) {
            if (response != null) {
                angular.element('#profileImage').scope().gotoHomepage();
            }
            else {
                window.location.href = "/views/home/login.html"
            }
        }
    });
}


(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('loginController', ['$scope', '$window', '$log', '$state', 'authService', 'navService', 'previousState', '$rootScope', 'toaster', 'dialogs', 'rulesetDataShareService', '$localStorage',
        function ($scope, $window, $log, $state, authService, navService, previousState, $rootScope, toaster, dialogs, rulesetDataShareService, $localStorage) {

            $scope.profileimagesrc = "http://www.advacto.com/images/user.jpg";

            $scope.mode = 1;

			$scope.registersuccess = false;
			$scope.useremail = "";
			$scope.name = "";
			angular.element(document).ready(function () {
				angular.element(window).keydown(function () {
					if (event.keyCode == 13) {
						event.preventDefault();
						return false;
					}
				});
			});
            var LoginData = rulesetDataShareService.getloginData();
            if (!authService.authentication.authenticated) {
				debugger;
				
                $scope.data = {};
                if (LoginData.rememberMe == true) {
                    $scope.data.username = LoginData.username;
                    $scope.data.password = LoginData.password;
                    $scope.data.rememberMe = LoginData.rememberMe;
                }
                var LocalStorageLoginData = JSON.parse(localStorage.getItem("LoginData"));
                if (LocalStorageLoginData != null) {
                    if (LocalStorageLoginData.rememberMe) {
                        $scope.data.username = LocalStorageLoginData.username;
                        $scope.data.password = LocalStorageLoginData.password;
                        $scope.data.rememberMe = LocalStorageLoginData.rememberMe;
                    }
                    else {
                        localStorage.setItem("LoginData", JSON.stringify(LoginData));
                        $scope.data.username == "";
                        $scope.data.password == "";
                    }
                }
            }
            else {
                var LocalStorageLoginData = JSON.parse(localStorage.getItem("LoginData"));
                if (LocalStorageLoginData != null) {
                    $scope.data = {};
                    if (LocalStorageLoginData.rememberMe) {
                        $scope.data.username = LocalStorageLoginData.username;
                        $scope.data.password = LocalStorageLoginData.password;
                        $scope.data.rememberMe = LocalStorageLoginData.rememberMe;
                    }
                    else {
                        localStorage.setItem("LoginData", JSON.stringify(LoginData));
                        $scope.data.username == "";
                        $scope.data.password == "";
                    }
                }
			}

            $scope.passwordKeyPress = function ($event) {
                if ($scope.mode === 1 && $event.which === 13)
                    $scope.action();
            };

            $scope.rememberKeyPress = function ($event) {
                $scope.data.rememberMe = !$scope.data.rememberMe;
            };

			$scope.showTerms = function () {
				var newCharacterData = {
					id: 0,
					name: "",
					file: null,
					RulesetID: 0
				}
				var dlg = dialogs.create('/views/dialogs/termsAndServices.html', 'dialogAddNewCharacter',
					{ mode: 1, characterData: newCharacterData  }
				);

				dlg.result.then(function (res) {
					if (res != 'cancel') {
						
						//toaster.pop('success', 'Character Created Successfully');
					}
				});
			};

            $scope.setMode = function (mode) {
                $scope.mode = mode;
            };

            $scope.profileImageUpload = function (input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#profileImage')
                            .attr('src', e.target.result)
                            .width(120)
                            .height(120);
                        $scope.data.profileimage = e.target.result;
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            $scope.gotoLoginPage = function () {

                navService.gotoLogin(true);
            }
            $scope.Cancel = function () {
                $scope.mode = 1;
            }
            $scope.isUserRegistered = function (Email, Id, accessToken) {
                $.ajax({
                    url: 'api/Account/GoogleLogin',
                    method: 'GET',
                    data: {
                        Email: Email,
                        AccesKey: Id,
                        AccountType: 'Google'
                    },
                    success: function (data) {
                        if (data.StatusCode == 200) {
                            $scope.logindata = data.PayLoad;
                            authService.Exlogin();
                            $localStorage.firstLoginController = $scope.logindata; 
                            navService.gotoCharacters(true);
                        }
                        else {
                            if (data.StatusCode == 400)
                            {
                                window.location.href = "/views/home/login.html";
                            }
                        }
                    },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }
                });
            }

            $scope.isFBUserRegistered = function (credentials) {
                $.ajax({
                    url: "api/account/facebooklogin",
                    type: "POST",
                    data: credentials,
                    success: function (data) {
                        if (data.StatusCode == 200) {
                            $rootScope.logindata = data.PayLoad;
                            authService.Exlogin();
                            navService.gotoCharacters(true);
                        }
                        else {
                            if (data.StatusCode == 400) {
                                window.location.href = "/views/home/login.html";
                            }
                        }
                 
                    },
                    error: function (request, status, error) {
                        console.log(request.responseText);
                    }
                });
            }

           

            $scope.action = function () {
				$("#loading").css("display", "block");
				switch ($scope.mode) {
                    case 1:
						if ( (!$scope.data.email || $scope.data.email == "") && $scope.data.password == "") {
                            toaster.pop('error', "Please enter Email And Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if (($scope.data.email != "") && ($scope.data.password == "" || $scope.data.password == null)) {
							toaster.pop('error', "Please enter Email And Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if (($scope.data.email == "" || $scope.data.email == null) && ($scope.data.password != "")) {
                            toaster.pop('error', "Please enter Email");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        authService
                            .login($scope.data.email, $scope.data.password, $scope.data.rememberMe)
                            .then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.logindata = data.data.PayLoad;
                                    $scope.logindata.rememberMe = $scope.data.rememberMe;
                                    navService.gotoCharacters(true);
                                    $localStorage.firstLoginController = $scope.logindata; 
                                    rulesetDataShareService.setloginData($scope.data);
                                    localStorage.setItem("LoginData", JSON.stringify($scope.data));
                                    //rulesetDataShareService.setImageandName($scope.logindata);
                                }
                                else {
                                    if (data.data.StatusCode == 400) {
                                        if (data.data.PayLoad == "Invalid Email /password") {
                                            toaster.pop('error', data.data.PayLoad);
                                            $("#loading").fadeOut("slow");
                                        }
                                        else
                                        {
                                            toaster.pop('error', "Please Enter valid UserId and password");
                                            $("#loading").fadeOut("slow");
                                        }
                                    }
                                }
                            })
                            .catch(function () {
                                alert('TODO: login failed');
                            });
                        break;
                    case 2:
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "" || $scope.data.email == undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }

                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if ($scope.data.username == null || $scope.data.username == "") {
                            toaster.pop('error', "Please Fill User Name");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if ($scope.data.email == null || $scope.data.email == "") {
                            toaster.pop('error', "Please Fill Email Address");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else {
                            var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
                            if (reg.test($scope.data.email) == false) {
                                toaster.pop('error', "Please Enter Valid Email Address");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if ($scope.data.password == null || $scope.data.password == "")
                        {
                            toaster.pop('error', "Please Fill Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else {
							var regex = new RegExp("^(?=.{8,})");
                            if (!regex.test($scope.data.password)) {
                                toaster.pop('error', "Password should be atleast 8 characters");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "") {
                            toaster.pop('error', "Please Fill Confirm Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if ($scope.data.password != $scope.data.confirmPassword) {
                            toaster.pop('error', "Confirm Password Should Be same As Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if ($scope.data.password === $scope.data.confirmPassword) {
                            authService
                                .register($scope.data.username, $scope.data.email, $scope.data.password, $scope.data.confirmPassword, $scope.data.profileimage)
                                .then(
                                function (data) {
									if (data.data.StatusCode == 200) {
										$scope.useremail = $scope.data.email;
										$scope.name = $scope.data.username;
                                        toaster.pop('success', "Registered Successfully.Activation link has been sent to the registered email.");
                                        $scope.data.username = "";
                                        $scope.data.email = "";
                                        $scope.data.password = "";
                                        $scope.data.confirmPassword = "";
                                        $scope.data.profileimage = "";
                                        $scope.data.profileimagesrc = "";
                                        $rootScope.logindata = data.data.PayLoad;
										$("#loading").fadeOut("slow");
										$scope.registersuccess = true;
                                    }
                                    else {
                                        if (data.data.StatusCode == 400) {
                                            $scope.error = data.data.ErrorMessage;
                                            toaster.pop('error', $scope.error);
                                            $("#loading").fadeOut("slow");
                                            //alert($scope.error);
                                        }
                                    }
                                });
                        }
                        else {
                            toaster.pop('error', "Passwords do not match");
                            $("#loading").fadeOut("slow");
                        }
                        break;
                    case 3:
                        var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
                        if (reg.test($scope.data.email) == false) {
                            toaster.pop('error', "Please enter valid Email Address.");
                            $("#loading").fadeOut("slow");
                        }
                        else
                        {
                            authService.ForgotPassword($scope.data.email);
                            toaster.pop('success', "We have sent a  link to your " + $scope.data.email + ". Please Reset your Password.");
                            $scope.data.email = "";
                            $("#loading").fadeOut("slow");

                        }
                        break;
                    case 6:
                        navService.gotoCharacters(true);
                        break;
                }
            }
        }
    ]);


})();


 
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('registerController', ['$scope',
        function ($scope) {

           
		}
    ]);


})();


 
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('resetpwdController', ['$scope', '$window', '$log', '$state', 'authService', 'navService', 'previousState', '$rootScope', 'toaster', 'rulesetDataShareService', '$localStorage',
        function ($scope, $window, $log, $state, authService, navService, previousState, $rootScope, toaster, rulesetDataShareService, $localStorage) {

            $scope.profileimagesrc = "http://www.advacto.com/images/user.jpg";

            $scope.mode = 1;

            

            var LoginData = rulesetDataShareService.getloginData();
            if (!authService.authentication.authenticated) {
				debugger;
				
                $scope.data = {};
                if (LoginData.rememberMe == true) {
                    $scope.data.username = LoginData.username;
                    $scope.data.password = LoginData.password;
                    $scope.data.rememberMe = LoginData.rememberMe;
                }
                var LocalStorageLoginData = JSON.parse(localStorage.getItem("LoginData"));
                if (LocalStorageLoginData != null) {
                    if (LocalStorageLoginData.rememberMe) {
                        $scope.data.username = LocalStorageLoginData.username;
                        $scope.data.password = LocalStorageLoginData.password;
                        $scope.data.rememberMe = LocalStorageLoginData.rememberMe;
                    }
                    else {
                        localStorage.setItem("LoginData", JSON.stringify(LoginData));
                        $scope.data.username == "";
                        $scope.data.password == "";
                    }
                }
            }
            else {
                var LocalStorageLoginData = JSON.parse(localStorage.getItem("LoginData"));
                if (LocalStorageLoginData != null) {
                    $scope.data = {};
                    if (LocalStorageLoginData.rememberMe) {
                        $scope.data.username = LocalStorageLoginData.username;
                        $scope.data.password = LocalStorageLoginData.password;
                        $scope.data.rememberMe = LocalStorageLoginData.rememberMe;
                    }
                    else {
                        localStorage.setItem("LoginData", JSON.stringify(LoginData));
                        $scope.data.username == "";
                        $scope.data.password == "";
                    }
                }
			}

            $scope.passwordKeyPress = function ($event) {
                if ($scope.mode === 1 && $event.which === 13)
                    $scope.action();
            };

            $scope.rememberKeyPress = function ($event) {
                $scope.data.rememberMe = !$scope.data.rememberMe;
            };

            $scope.setMode = function (mode) {
                $scope.mode = mode;
            };

            $scope.profileImageUpload = function (input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#profileImage')
                            .attr('src', e.target.result)
                            .width(120)
                            .height(120);
                        $scope.data.profileimage = e.target.result;
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            $scope.gotoLoginPage = function () {

                navService.gotoLogin(true);
            }
            $scope.Cancel = function () {
                $scope.mode = 1;
            }
            $scope.isUserRegistered = function (Email, Id, accessToken) {
                $.ajax({
                    url: 'api/Account/GoogleLogin',
                    method: 'GET',
                    data: {
                        Email: Email,
                        AccesKey: Id,
                        AccountType: 'Google'
                    },
                    success: function (data) {
                        if (data.StatusCode == 200) {
                            $scope.logindata = data.PayLoad;
                            authService.Exlogin();
                            $localStorage.firstLoginController = $scope.logindata; 
                            navService.gotoCharacters(true);
                        }
                        else {
                            if (data.StatusCode == 400)
                            {
                                window.location.href = "/views/home/login.html";
                            }
                        }
                    },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }
                });
            }

            $scope.isFBUserRegistered = function (credentials) {
                $.ajax({
                    url: "api/account/facebooklogin",
                    type: "POST",
                    data: credentials,
                    success: function (data) {
                        if (data.StatusCode == 200) {
                            $rootScope.logindata = data.PayLoad;
                            authService.Exlogin();
                            navService.gotoCharacters(true);
                        }
                        else {
                            if (data.StatusCode == 400) {
                                window.location.href = "/views/home/login.html";
                            }
                        }
                 
                    },
                    error: function (request, status, error) {
                        alert(request.responseText);
                    }
                });
            }

           

            $scope.action = function () {
                $("#loading").css("display", "block");
                switch ($scope.mode) {
                    case 1:
                        if ($scope.data.username == "" && $scope.data.password == "") {
                            toaster.pop('error', "Please Enter UserId And Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if (($scope.data.username != "") && ($scope.data.password == "" || $scope.data.password == null)) {
                            toaster.pop('error', "Please Enter Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if (($scope.data.username == "" || $scope.data.username == null) && ($scope.data.password != "")) {
                            toaster.pop('error', "Please Enter UserId");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        authService
                            .login($scope.data.username, $scope.data.password, $scope.data.rememberMe)
                            .then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.logindata = data.data.PayLoad;
                                    $scope.logindata.rememberMe = $scope.data.rememberMe;
                                    navService.gotoCharacters(true);
                                    $localStorage.firstLoginController = $scope.logindata; 
                                    rulesetDataShareService.setloginData($scope.data);
                                    localStorage.setItem("LoginData", JSON.stringify($scope.data));
                                    //rulesetDataShareService.setImageandName($scope.logindata);
                                }
                                else {
                                    if (data.data.StatusCode == 400) {
                                        if (data.data.PayLoad == "Invalid Email /password") {
                                            toaster.pop('error', data.data.PayLoad);
                                            $("#loading").fadeOut("slow");
                                        }
                                        else
                                        {
                                            toaster.pop('error', "Please Enter valid UserId and password");
                                            $("#loading").fadeOut("slow");
                                        }
                                    }
                                }
                            })
                            .catch(function () {
                                alert('TODO: login failed');
                            });
                        break;
                    case 2:
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "" || $scope.data.email == undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }

                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword != null || $scope.data.confirmPassword != "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password != null || $scope.data.password != "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if (($scope.data.username == null || $scope.data.username == "") && ($scope.data.email != null || $scope.data.email != "" || $scope.data.email != undefined) && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if (($scope.data.username != null || $scope.data.username != "") && ($scope.data.email == null || $scope.data.email == "") && ($scope.data.password == null || $scope.data.password == "") && ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "")) {
                            if ($scope.data.email == undefined) {

                            }
                            else {
                                toaster.pop('error', "Please Fill All (*) Fields in Register Page");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if ($scope.data.username == null || $scope.data.username == "") {
                            toaster.pop('error', "Please Fill User Name");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        if ($scope.data.email == null || $scope.data.email == "") {
                            toaster.pop('error', "Please Fill Email Address");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else {
                            var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
                            if (reg.test($scope.data.email) == false) {
                                toaster.pop('error', "Please Enter Valid Email Address");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if ($scope.data.password == null || $scope.data.password == "")
                        {
                            toaster.pop('error', "Please Fill Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else {
                            var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#$@!%&*?])[A-Za-z\d#$@!%&*?]{8,12}$/;
                            if (!regex.test($scope.data.password)) {
                                toaster.pop('error', "Password Should Be Atleast 8 characters And 1 Uppercase,1 SpecialChar,1 Lowercase,1 Number");
                                $("#loading").fadeOut("slow");
                                break;
                            }
                        }
                        if ($scope.data.confirmPassword == null || $scope.data.confirmPassword == "") {
                            toaster.pop('error', "Please Fill Confirm Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if ($scope.data.password != $scope.data.confirmPassword) {
                            toaster.pop('error', "Confirm Password Should Be same As Password");
                            $("#loading").fadeOut("slow");
                            break;
                        }
                        else if ($scope.data.password === $scope.data.confirmPassword) {
                            authService
                                .register($scope.data.username, $scope.data.email, $scope.data.password, $scope.data.confirmPassword, $scope.data.profileimage)
                                .then(
                                function (data) {
                                    if (data.data.StatusCode == 200) {
                                        toaster.pop('success', "Registered Successfully.Activation link has been sent to Registered Email.");
                                        $scope.data.username = "";
                                        $scope.data.email = "";
                                        $scope.data.password = "";
                                        $scope.data.confirmPassword = "";
                                        $scope.data.profileimage = "";
                                        $scope.data.profileimagesrc = "";
                                        $rootScope.logindata = data.data.PayLoad;
                                        $("#loading").fadeOut("slow");
                                       /// $state.go('login');
                                        //navService.gotoCharacters(true);
                                    }
                                    else {
                                        if (data.data.StatusCode == 400) {
                                            $scope.error = data.data.ErrorMessage;
                                            toaster.pop('error', $scope.error);
                                            $("#loading").fadeOut("slow");
                                            //alert($scope.error);
                                        }
                                    }
                                });
                        }
                        else {
                            toaster.pop('error', "Passwords do not match");
                            $("#loading").fadeOut("slow");
                        }
                        break;
                    case 3:
                        var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
                        if (reg.test($scope.data.email) == false) {
                            toaster.pop('error', "Please enter valid Email Address.");
                            $("#loading").fadeOut("slow");
                        }
                        else
                        {
                            authService.ForgotPassword($scope.data.email);
                            toaster.pop('success', "We have sent a  link to your " + $scope.data.email + ". Please Reset your Password.");
                            $scope.data.email = "";
                            $("#loading").fadeOut("slow");

                        }
                        break;
                    case 6:
                        navService.gotoCharacters(true);
                        break;
                }
            }
        }
    ]);


})();


 
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('topNavController', ['$scope','$location', 'navService', '$rootScope', '$state', 'authService', 'rulesetDataShareService', 'toaster', 'characterService', '$browser', 'rulesetService', '$localStorage','$window',
        function ($scope,$location, navService, $rootScope, $state, authService, rulesetDataShareService, toaster, characterService, $browser, rulesetService, $localStorage, $window) {
            debugger;
            var menuItems = ['Characters', 'Rulesets', 'AccountSettings'];

            var menuItemIndex = menuItems.indexOf($state.params.menuSelected);
			$scope.resetModel = {};
            if (menuItemIndex > -1) {
                $scope.activeMenu = menuItems[menuItemIndex];
            }
            //$scope.data = $rootScope.logindata;
            $scope.navService = navService;
            $scope.data = $localStorage.firstLoginController;
            $("#loading").fadeOut("slow");

            //$scope.data = rulesetDataShareService.getImageandName();
			
            $scope.noop = function () {
                angular.noop();
            };
            $scope.gohome = function () {
                return navService.gotoCharacters();
            }
            $scope.hasNav = function (name) {
                return navService.hasNav(name);
            }
            $scope.toggleNav = function (name) {
                navService.toggleNav(name);
            };

            $scope.newstyles = function (data) {
                if (data.ProfileImage) {
                    return {
                        'background-size': '100% 100%',
                        'background-repeat': 'no-repeat',
                        'width': '120px',
                        'height': '120px'
                    }
                }
                return {
                    'background-color': 'transparent'
                }

            };

            $scope.getThumbNail = function () {
                if ($scope.data.ProfileImage)
                    return $scope.data.ProfileImage;
                return null;
            }
            $scope.CharacterRulesetCount = function ()
            {
                characterService.GetHeaderContentsCounts().then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.HeaderContents = data.data.PayLoad;
                        rulesetDataShareService.SetDisplayCharacterRulesetCount($scope.HeaderContents);
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }
                });
            }
            $scope.ProfileImageUpload = function (input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#profileImage')
                            .attr('src', e.target.result)
                            .width(120)
                            .height(120);
                        $scope.data.ProfileImage = e.target.result;
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            $scope.AccountSettings = function () {
                  $("#loading").css("display", "block");
                $scope.resetModel = {};
                $scope.resetModel.newpassword = "";
                $scope.resetModel.confirmpassword = "";
                $scope.resetModel.oldpassword = "";
                $state.go("profile.AccountSettings");
                $("#loading").fadeOut("slow");
            }

			$scope.loadResetPage = function () {
				console.log("Search Params: ",$location.search().userid);
				$("#loading").css("display", "block");
				$scope.resetModel = {};
				$scope.resetModel.newpassword = "";
				$scope.resetModel.confirmpassword = "";
				authService.authentication.authenticated = true;;
				$("#loading").fadeOut("slow");
			}


            $scope.Cancel = function () {
                //$("#loading").css("display", "block");
                $window.history.back();
              //  $state.go("profile.characters");
                //$("#loading").fadeOut("slow");
            }

            $scope.Update = function () {
                var profile =
                    {
                        username: $scope.data.Name,
                        Email: $scope.data.Email,
                        ProfileImage: $scope.data.ProfileImage
                    };
                var data = authService.updateprofile(profile);
                data.then(function (data) {
                    if (data.data.StatusCode == 200) {
                        toaster.pop('success', "Details Updated Successfully");
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop('success', data.data.ErrorMessage);
                            }
                        }
                    }
                });
            }
            $scope.cancel = function () {
               // $("#loading").css("display", "block");
                $state.go("profile.AccountSettings");
               // $("#loading").fadeOut("slow");
            }

            $scope.ReSetPassword = function () {
                $state.go("profile.ResetPassword");
            }
            $scope.EditData = function () {
                $state.go("profile.EditProfile");
            }
            $scope.onloadFun = function () {
                $("#loading").fadeOut("slow");
            }
            $scope.ResetProfilePassword = function (resetModel) {
                //$("#loading").css("display", "block");
				console.log("ResetModel:", resetModel);
				console.log("PasswordHash:", $scope.data.PasswordHash);
				
				//var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#$@!%&*?])[A-Za-z\d#$@!%&*?]{8,12}$/;
				//CHanged requirements to any 8 characters
				var regex = new RegExp("^(?=.{8,})");
                if (resetModel.oldpassword == "" ||resetModel.oldpassword == null || angular.isUndefined(resetModel.oldpassword) == true)
                {
                    toaster.pop('Warning', "Please Enter Old Password");
                    $("#loading").fadeOut("slow");
                }
               else if (resetModel.oldpassword != $scope.data.PasswordHash) {
                    toaster.pop('Warning', "Old Password is not same.");
                    $("#loading").fadeOut("slow");
                }
                else if (resetModel.newpassword == $scope.data.PasswordHash) {
                    toaster.pop('Warning', "New Password Should not Be Same as Old Password");
                    $("#loading").fadeOut("slow");
                }
                else if (resetModel.oldpassword != "" && resetModel.newpassword == undefined && resetModel.confirmpassword == undefined) {
                    toaster.pop('Warning', "Please Enter New Password");
                    $("#loading").fadeOut("slow");
                }
                else if (!regex.test(resetModel.newpassword)) {
                    toaster.pop('Warning', "New Password should be atleast 8 characters long");
                    $("#loading").fadeOut("slowest");
                }
                else if (resetModel.newpassword != resetModel.confirmpassword) {
                    toaster.pop('Warning', "Confirm Password Should Be same As Password");
                    $("#loading").fadeOut("slower");
                }
                else {

                    var resetpass = {
                        Password: resetModel.newpassword,
						ConfirmPassword: resetModel.confirmpassword,
						UserId: $location.search().userid
                    };
                    var pass = authService.Resetpassword(resetpass)
                    pass.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            toaster.pop('success', "Password Updated Successfully");
                            $scope.resetModel = {}
                            $scope.resetModel.newpassword = "";
                            $scope.resetModel.confirmpassword = "";
                            $scope.resetModel.oldpassword = "";
                            $("#loading").fadeOut("slow");
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    alert(data.data.ErrorMessage);
                                    $("#loading").fadeOut("slow");
                                }
                            }
                        }
                    });
                }
			}

			$scope.signoutGoogle = function () {
				if (gapi == null || gapi.auth2 == null || gapi.auth2.getAuthInstance() == null)
					return;
				
				gapi.auth2.getAuthInstance().disconnect();
				
				googleUser = null;

			}

			
            $scope.signout = function () {
				$("#loading").css("display", "block");
				//Clear any google logins
				$scope.signoutGoogle();
                var logout = authService.logout();
                logout.then(function (data) {
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        var savedData = {};
                        var savedspell = {};
                        var savedability = {};
                        var savedcorestat = {};
                        rulesetDataShareService.setRulesetItems(savedData)
                        rulesetDataShareService.setRulesetSpells(savedspell)
                        rulesetDataShareService.setRulesetAbilities(savedability)
                        rulesetDataShareService.setcorestat(savedcorestat)
                        localStorage.clear();
                        authService.authentication.authenticated = false;
                        $state.go('login');
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                                $("#loading").fadeOut("slow");
                            }
                        }
                    }
                })
            }
        }]);
})();
"use strict";

var customarray = [];

var diceinitializer;

function dicenotationvalidator(commandStr) {
    debugger;
    var known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];
    var validationresult;
    var no = commandStr.split('@');
    var dr0 = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
    var dr1 = /(\b)*(\d+)(\b)*/gi;
    var ret = { set: [], constant: 0, result: [], error: false }, res;
    while (res = dr0.exec(no[0])) {
        var command = res[2];
        if (command != 'd') { ret.error = true; continue; }
        var count = parseInt(res[1]);
        if (res[1] == '') count = 1;
        var type = 'd' + res[3];
        if (known_types.indexOf(type) == -1) { ret.error = true; continue; }
        while (count--) ret.set.push(type);
        if (res[5]) ret.constant += parseInt(res[5]);
    }
    while (res = dr1.exec(no[1])) {
        ret.result.push(parseInt(res[2]));
    }

    if (ret == undefined || ret == null) {
        validationresult = false;
    }
    else {
        if (ret.set.length != 0) {
            validationresult = true;
        }

    }

    return validationresult;
}



function dicerollwithcommand(command) {

    debugger;

    //if (!dicenotationvalidator(command)) {
    //    alert("Invalid Command");
    //}

    $('#canvas').children().remove();
    $('#canvas').append('<canvas width="1365" height="345"></canvas>');

    $t.id('set').value = command


    var da = $t.id('diceareaforroll');

    //dice_initialize(da);   //mode=1 is the select mode.

    //var savedattackoptions = $t.id('savedattackoptions');
    //savedattackoptions.style.display = 'block';

    var roll = $t.id('diceRollTrigger');
    roll.style.display = 'inline-block';

    var addmod = $t.id('addmod');
    addmod.style.display = 'inline-block';

    var diceareaforselection = $t.id('diceareaforselection');
    diceareaforselection.style.display = 'none';

    var showdicerollresult = $t.id('showdicerollresult');
    showdicerollresult.style.display = 'none';

    var diceareaforroll = $t.id('diceareaforroll');
    diceareaforroll.style.display = 'block';

    var defaultDiceSelect = $t.id('defaultDiceSelect');
    defaultDiceSelect.style.display = 'none';

    if (diceinitializer == undefined || diceinitializer == null) {
        diceinitializer = new dice_initialize(da);
        diceinitializer.rolediceagain();
    }
    else {
        diceinitializer = new dice_initialize(da);
        diceinitializer.rolediceagain();
    }
    //box.start_throw(notation_getter,before_roll,after_roll);  // Need to check the code for the roll.

}

function diceselectcommandtrace_temp() {
    debugger;
    var localvar = "";
    customarray = [];
    var finalvar = "";
    var dicecommandaftertrace = [];
    var dicecommandaftertracestr = "";

    var dice = $("#customset").val();

    for (var i = 0; i < dice.length; i++) {
        if (dice[i] != "+" && dice[i] != "/" && dice[i] != "-" && dice[i] != "*") {
            localvar = localvar + dice[i];
            if (i == dice.length - 1) {
                customarray.push(localvar);
            }
        }
        else if (dice[i] == "+" || dice[i] == "/" || dice[i] == "-" && dice[i] != "*") {
            customarray.push(localvar);
            customarray.push(dice[i]);
            localvar = "";
        }
    }

    for (var j = 0; j < customarray.length; j++) {
        var dice1 = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
        var dice2 = /(\b)*(\d+)(\b)*/gi;

        if (dice1.test(customarray[j]) == true && dice2.test(customarray[j]) == true) {
            dicecommandaftertrace.push(customarray[j]);
            dicecommandaftertrace.push("+");
            dicecommandaftertracestr = dicecommandaftertracestr + customarray[j];
            dicecommandaftertracestr = dicecommandaftertracestr + "+";
        }
    }

    return dicecommandaftertracestr;

}

function diceselectcommandtrace() {
    debugger;
    var localvar = "";
    customarray = [];
    var customdicearray = [];
    var finalvar = "";
    var dicecommandaftertrace = [];
    var dicecommandaftertracestr = "";
    var known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];

    var customset = $t.id('customset');

    var customdiceset = customset.value;

    var paranthesisCommand = 1;

    var tempcustomdicearray = [];

    for (var i = 0; i < customdiceset.length; i++) {

        if (customdiceset[i] == "(") {
            paranthesisCommand = 2;
            continue;
        }

        if (customdiceset[i] == ")") {
            tempcustomdicearray.push(localvar);
            paranthesisCommand = 3;
        }

        if (paranthesisCommand == 1) {
            if (customdiceset[i] != "+" && customdiceset[i] != "/" && customdiceset[i] != "-" && customdiceset[i] != "*") {
                localvar = localvar + customdiceset[i];
                if (i == customdiceset.length - 1) {
                    customdicearray.push(localvar);
                }
            }
            else if (customdiceset[i] == "+" || customdiceset[i] == "/" || customdiceset[i] == "-" || customdiceset[i] == "*") {
                customdicearray.push(localvar);
                customdicearray.push(customdiceset[i]);
                localvar = "";
            }
        }
        else if (paranthesisCommand == 2) {
            if (customdiceset[i] != "+" && customdiceset[i] != "/" && customdiceset[i] != "-" && customdiceset[i] != "*") {
                localvar = localvar + customdiceset[i];
                if (i == customdiceset.length - 1) {
                    tempcustomdicearray.push(localvar);
                }
            }
            else if (customdiceset[i] == "+" || customdiceset[i] == "/" || customdiceset[i] == "-" || customdiceset[i] == "*") {
                tempcustomdicearray.push(localvar);
                tempcustomdicearray.push(customdiceset[i]);
                localvar = "";
            }
        }
        else if (paranthesisCommand == 3) {
            if (tempcustomdicearray.length > 1) {
                customdicearray.push("(");
                for (var j = 0; j < tempcustomdicearray.length; j++) {
                    customdicearray.push(tempcustomdicearray[j]);
                }
                customdicearray.push(")");
            }
            else {
                customdicearray.push("(" + tempcustomdicearray[0] + ")");
            }
            paranthesisCommand = 1;
        }
    }

    var currentselecteddiceadded = false;

    for (var j = 0; j < customdicearray.length; j++) {
        var customarraynotation = customdicearray[j].trim();
        var customarrayno = customarraynotation.split('@');
        var customarraydicecommand = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
        var customarraycount = 0;
        var customarraytype = "";
        var newcustomarrayvalue = "";

        var res = [];
        if (!customarrayno[0].includes(' ')) {
            res = customarraydicecommand.exec(customarrayno[0]);
        }

        var customarraynowithfunc = [];

        var iscommandvalid = true;

        var command = '';

        var commandtype = '';

        var customarraynowithfuncavail = false;

        if (res == null || res == "" || res == undefined) {
            customarraynowithfuncavail = false;
            customarraynowithfunc = customarrayno[0].split(' ');
            if (customarraynowithfunc.length == 2) {
                res = customarraydicecommand.exec(customarraynowithfunc[0]);
                if (customarraynowithfunc[1] == "RD" || customarraynowithfunc[1] == "RU") {
                    iscommandvalid = true;
                }
                else if (customarraynowithfunc[1].startsWith("KL") || customarraynowithfunc[1].startsWith("KH") || customarraynowithfunc[1].startsWith("DL") || customarraynowithfunc[1].startsWith("DH")) {
                    var commandcheck = customarraynowithfunc[1]
                    diceSpecialOperatorStr = commandcheck.trim();
                    diceSpecialOperatorCmd = diceSpecialOperatorStr.substring(0, 2);
                    diceSpecialOperatorValue = diceSpecialOperatorStr.charAt(2);
                    if (isNumeric(diceSpecialOperatorValue)) {
                        diceSpecialOperatorValue = parseInt(diceSpecialOperatorValue);
                        iscommandvalid = true;
                    }
                    else {
                        iscommandvalid = false;
                    }
                }
            }
        }

        if (res != null && res != undefined) {
            if (res.length > 0) {
                command = res[2];
                commandtype = res[2] + res[3];
            }
        }

        if (command == 'd' && known_types.indexOf(commandtype) > -1 && iscommandvalid == true) {
            if (res[1] == '') {
                customarraycount = 1;
            }
            else {
                customarraycount = parseInt(res[1]);
            }
            dicecommandaftertrace.push(customarraycount + command + res[3]);
        }

    }

    customarray = customdicearray;

    for (var j = 0; j < dicecommandaftertrace.length; j++) {
        dicecommandaftertracestr = dicecommandaftertracestr + dicecommandaftertrace[j];
        dicecommandaftertracestr = dicecommandaftertracestr + "+";
    }
    debugger;
    return dicecommandaftertracestr;

}

function diceresultafterroll(notation, result, totalresult) {

    var known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];

    for (i = 0; i < known_types.length; i++) {
        var diceNotationIndex = -1;
        var diceType = known_types[i]
        var diceResult = $t.id('showdicerollresult_' + diceType);

        var eachDiceResultSum = 0;

        for (j = 0; j < notation.set.length; j++) {
            if (diceType == notation.set[j]) {
                diceNotationIndex = j;
            }
            else {
                diceNotationIndex = -1;
            }
            if (diceNotationIndex > -1) {
                eachDiceResultSum = eachDiceResultSum + result[diceNotationIndex];
            }
        }

        if (diceResult.innerHTML != null && diceResult.innerHTML != undefined && diceResult.innerHTML != "") {
            diceResult.innerHTML = eachDiceResultSum;
        }

    }

    var diceSumResult = $t.id('showdicerollresult_Sum');
    diceSumResult.innerHTML = totalresult;

    var showdicerollResult = $t.id('canvas');
    showdicerollResult.style.display = 'none';

    var showdicerollResult = $t.id('showdicerollresult');
    showdicerollResult.style.display = 'block';

}




function diceafterrolltrace(notation, result) {
    debugger;

    var known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];
    var fresult = 0;
    var diceCurrentIndex = 0;
    var resultwithdiceroll = [];

    var dicerollresultbytype = {};

    customdicearray = customarray;

    if (result.length <= 0) {
        alert('error in result');
        return;
    }

    for (var i = 0; i < notation.set.length; i++) {
        var dicetype = notation.set[i];

        if (dicerollresultbytype[dicetype] == undefined) {
            dicerollresultbytype[dicetype] = [];
        }

        dicerollresultbytype[dicetype].push(result[i]);
    }


    for (var j = 0; j < customdicearray.length; j++) {

        var customarraynotation = customdicearray[j].trim();
        var customarrayno = customarraynotation.split('@');
        var customarraydicecommand = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
        var customarraycount = 0;
        var customarraytype = "";
        var newcustomarrayvalue = "";

        var diceSpecialOperatorStr = "";
        var diceSpecialOperatorCmd = "";
        var diceSpecialOperatorValue = 0;

        var res = [];
        if (!customarrayno[0].includes(' ')) {
            res = customarraydicecommand.exec(customarrayno[0]);
        }

        var customarraynowithfunc = [];

        var iscommandvalid = true;

        var command = '';

        var commandtype = '';

        if (res == null || res == "" || res == undefined) {
            customarraynowithfuncavail = false;
            customarraynowithfunc = customarrayno[0].split(' ');
            if (customarraynowithfunc.length == 2) {
                res = customarraydicecommand.exec(customarraynowithfunc[0]);
                //command = res[2];
                if (customarraynowithfunc[1] == "RD" || customarraynowithfunc[1] == "RU") {
                    iscommandvalid = true;
                }
                else if (customarraynowithfunc[1].startsWith("KL") || customarraynowithfunc[1].startsWith("KH") || customarraynowithfunc[1].startsWith("DL") || customarraynowithfunc[1].startsWith("DH")) {
                    var commandcheck = customarraynowithfunc[1]
                    diceSpecialOperatorStr = commandcheck.trim();
                    diceSpecialOperatorCmd = diceSpecialOperatorStr.substring(0, 2);
                    diceSpecialOperatorValue = diceSpecialOperatorStr.charAt(2);
                    if (isNumeric(diceSpecialOperatorValue)) {
                        diceSpecialOperatorValue = parseInt(diceSpecialOperatorValue);
                        iscommandvalid = true;
                    }
                    else {
                        iscommandvalid = false;
                    }
                }
            }
        }

        if (res != null && res != undefined) {
            if (res.length > 0) {
                command = res[2];
                commandtype = res[2] + res[3];
            }
        }

        if (command == 'd' && known_types.indexOf(commandtype) > -1 && iscommandvalid == true) {

            var dicefinalresultwithcommand = 0;

            if (res[1] == '') {
                customarraycount = 1;
            }
            else {
                customarraycount = parseInt(res[1]);
            }
            customarraytype = 'd' + res[3];

            var diceresultarraywithcommand = dicerollresultbytype[customarraytype]

            if (customarraynowithfunc.length == 0) {
                for (var k = 0; k < customarraycount; k++) {
                    dicefinalresultwithcommand = dicefinalresultwithcommand + dicerollresultbytype[customarraytype].pop();
                }
            }
            else if (customarraynowithfunc.length == 2) {
                if (customarraynowithfunc[1].includes("KL") || customarraynowithfunc[1].includes("KH") || customarraynowithfunc[1].includes("DL") || customarraynowithfunc[1].includes("DH")) {
                    var tempdicerollresultbytype = [];
                    for (var k = 0; k < customarraycount; k++) {
                        tempdicerollresultbytype.push(dicerollresultbytype[customarraytype].pop());
                    }
                    tempdicerollresultbytype.sort();
                    for (var k = 0; k < customarraycount; k++) {
                        debugger;
                        if (diceSpecialOperatorCmd == "KL") {
                            if (k < diceSpecialOperatorValue) {
                                dicefinalresultwithcommand = dicefinalresultwithcommand + tempdicerollresultbytype.pop();
                            }
                            else {
                                tempdicerollresultbytype.pop();
                            }
                        }
                        else if (diceSpecialOperatorCmd == "KH") {
                            if (k >= tempdicerollresultbytype.length - diceSpecialOperatorValue) {
                                dicefinalresultwithcommand = dicefinalresultwithcommand + tempdicerollresultbytype.pop();
                            }
                            else {
                                tempdicerollresultbytype.pop();
                            }
                        }
                        else if (diceSpecialOperatorCmd == "DL") {
                            if (k >= tempdicerollresultbytype.length - diceSpecialOperatorValue) {
                                tempdicerollresultbytype.pop();
                            }
                            else {
                                dicefinalresultwithcommand = dicefinalresultwithcommand + tempdicerollresultbytype.pop();
                            }
                        }
                        else if (diceSpecialOperatorCmd == "DH") {
                            if (k >= tempdicerollresultbytype.length - diceSpecialOperatorValue) {
                                dicefinalresultwithcommand = dicefinalresultwithcommand + tempdicerollresultbytype.pop();
                            }
                            else {
                                tempdicerollresultbytype.pop();
                            }
                        }
                    }
                }
                else if (customarraynowithfunc[1] == "RD" || customarraynowithfunc[1] == "RU") {
                    for (var k = 0; k < customarraycount; k++) {
                        dicefinalresultwithcommand = dicefinalresultwithcommand + dicerollresultbytype[customarraytype].pop();
                    }
                    dicefinalresultwithcommand = dicefinalresultwithcommand + ' ' + customarraynowithfunc[1];
                }
            }

            resultwithdiceroll.push(dicefinalresultwithcommand);
        }
        else {
            resultwithdiceroll.push(customarraynotation);
        }

    }


   
    debugger;
    var resultAfterDiceRoll = calculateDiceCommandResult(resultwithdiceroll);
    //localStorage.setItem("resultAfterDiceRoll", resultAfterDiceRoll);

    diceresultafterroll(notation, result, resultAfterDiceRoll);

    return resultAfterDiceRoll;
}

function calculateDiceCommandResult(resultwithdiceroll) {

    var fresult = 0;

    var tempresultwithdicerollwithparanthesis = [];

    var tempresultwithdicerollinsideparanthesis = [];

    var paranthesisCommand = 1;

    var paranthesisStartIndex = -1;

    var tempresultaftercalculation = 0;

    var tempresultaftercalculationinsideparanthesis = 0;

    for (var i = 0; i < resultwithdiceroll.length; i++) {
        if (resultwithdiceroll[i] == "(") {
            paranthesisCommand = 2;
            paranthesisStartIndex = i;
            continue;
        }
        else if (resultwithdiceroll[i] == ")" && i == resultwithdiceroll.length - 1) {
            tempresultaftercalculationinsideparanthesis = calculateCommandResult(tempresultwithdicerollinsideparanthesis);
            tempresultwithdicerollwithparanthesis.push(tempresultaftercalculationinsideparanthesis);
            paranthesisCommand = 1;
        }
        else if (resultwithdiceroll[i] == ")") {
            paranthesisCommand = 3;
            paranthesisStartIndex = i;
        }
        else {
            if (paranthesisCommand == 1) {
                tempresultwithdicerollwithparanthesis.push(resultwithdiceroll[i]);
            }
            else if (paranthesisCommand == 2) {
                tempresultwithdicerollinsideparanthesis.push(resultwithdiceroll[i]);
            }
            else if (paranthesisCommand == 3) {
                tempresultaftercalculationinsideparanthesis = calculateCommandResult(tempresultwithdicerollinsideparanthesis);
                tempresultwithdicerollwithparanthesis.push(tempresultaftercalculationinsideparanthesis);
                paranthesisCommand = 1;
            }
        }
    }

    fresult = calculateCommandResult(tempresultwithdicerollwithparanthesis);

    return fresult;
}

function calculateCommandResult(resultwithdiceroll) {
    debugger;

    var resultwithdicerollAfterMultiply = [];
    var operand1 = "";
    var operand2 = "";
    var operator = "";

    var fresult = 0;

    if (resultwithdiceroll.length == 1) {
        fresult = resultwithdiceroll[0];
    }
    else {
        //Caculating the array for multipliction.
        var resultAfterEachOperator = [];
        var resultBeforeEachOperator = resultwithdiceroll;
        for (var operatorCount = 1; operatorCount <= 4; operatorCount++) {

            operand1 = "";
            operator = "";
            operand2 = "";

            for (var i = 0; i < resultBeforeEachOperator.length; i++) {

                var resultBeforeEachOperatorAsChar = resultBeforeEachOperator[i];

                if (!isNumeric(resultBeforeEachOperatorAsChar)) {
                    resultBeforeEachOperatorAsChar = resultBeforeEachOperatorAsChar.trim();
                }

                if (isNumeric(resultBeforeEachOperatorAsChar)) {
                    resultBeforeEachOperatorAsChar = parseInt(resultBeforeEachOperatorAsChar);
                }

                if (operand1 == "" && resultBeforeEachOperatorAsChar != '+' && resultBeforeEachOperatorAsChar != '-' && resultBeforeEachOperatorAsChar != '*' && resultBeforeEachOperatorAsChar != '/') {
                    operand1 = resultBeforeEachOperatorAsChar;
                    continue;
                }
                else if (operator == "" && resultBeforeEachOperatorAsChar.length == 1) {
                    operator = resultBeforeEachOperatorAsChar;
                    continue;
                }
                else if (operand2 == "") {
                    operand2 = resultBeforeEachOperatorAsChar;
                }

                if (operator != "" && operand1 != "" && operand2 != "") {
                    if (operator == "*" && operatorCount == 1) {
                        var tempresult = operand1 * operand2;
                        resultAfterEachOperator.pop();
                        resultAfterEachOperator.push(tempresult);
                    }
                    else if (operator == "/" && operatorCount == 2) {
                        var operand2Array = operand2.split(' ');
                        var operand2Num = 0;
                        var operand2Func = null;
                        if (operand2Array.length > 1) {
                            operand2Num = operand2Array[0];
                            operand2Func = operand2Array[1];
                        }
                        else {
                            operand2Num = operand2Array[0];
                        }
                        var tempresult = operand1 / operand2Num;
                        if (operand2Func == "RD") {
                            resultAfterEachOperator.pop();
                            resultAfterEachOperator.push(Math.floor(tempresult));
                        }
                        else if (operand2Func == "RU") {
                            resultAfterEachOperator.pop();
                            resultAfterEachOperator.push(Math.ceil(tempresult));
                        }
                        else {
                            resultAfterEachOperator.push(tempresult);
                            operand1 = tempresult;

                        }
                    }
                    else if (operator == "-" && operatorCount == 3) {
                        var tempresult = operand1 - operand2;
                        resultAfterEachOperator.pop();
                        resultAfterEachOperator.push(tempresult);
                        operand1 = tempresult;

                    }
                    else if (operator == "+" && operatorCount == 4) {
                        var tempresult = 0;
                        if (isNumeric(operand1) && isNumeric(operand2)) {
                            tempresult = operand1 + operand2;
                        }
                        else {
                            tempresult = operand1 + operand2;
                        }
                        resultAfterEachOperator.pop();
                        resultAfterEachOperator.push(tempresult);
                        operand1 = tempresult;
                    }
                    else {
                        if (resultAfterEachOperator.length > 0) {
                            resultAfterEachOperator.push(operator);
                            resultAfterEachOperator.push(operand2);
                        }
                        else {
                            resultAfterEachOperator.push(operand1);
                            resultAfterEachOperator.push(operator);
                            resultAfterEachOperator.push(operand2);
                        }
                        operand1 = operand2;
                    }
                    operator = "";
                    operand2 = "";
                }
            }
            resultBeforeEachOperator = resultAfterEachOperator;
            resultAfterEachOperator = [];
            if (resultBeforeEachOperator.length == 1) {
                break;
            }
        }
        if (resultBeforeEachOperator.length == 1) {
            fresult = resultBeforeEachOperator[0];
        }
    }

    return fresult;
}

function isNumeric(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
}

//This function is used to select the dice command and also roll the dice.
function dicerollwithoutcommand() {

    debugger;

    var defaultDiceSelect = $t.id('defaultDiceSelect');
    defaultDiceSelect.style.display = 'none';

    var roll = $t.id('diceRollTrigger');
    roll.style.display = 'block';

    var addmod = $t.id('addmod');
    addmod.style.display = 'block';

}

function DiceCommandRoll() {
    debugger;
    $('#canvas').children().remove();
    $('#canvas').append('<canvas width="1365" height="345"></canvas>');

    var showdicerollResult = $t.id('canvas');
    showdicerollResult.style.display = 'block';

    var diceareaforselection = $t.id('diceareaforselection');
    diceareaforselection.style.display = 'none';

    var showdicerollresult = $t.id('showdicerollresult');
    showdicerollresult.style.display = 'none';

    var defaultDiceSelect = $t.id('defaultDiceSelect');
    defaultDiceSelect.style.display = 'none';

    var diceareaforroll = $t.id('diceareaforroll');
    diceareaforroll.style.display = 'block';

    var savedattackoptions = $t.id('savedattackoptions');
    savedattackoptions.style.display = 'block';

    var addmod = $t.id('addmod');
    addmod.style.display = 'block';

    var lastDiceRollResult = $t.id('lastDiceRollResult');
    lastDiceRollResult.style.display = 'block';

    var customset = $t.id('customset');

    var customsetatroll = $t.id('customsetatroll');
    customsetatroll.value = customset.value;

    var da = $t.id('diceareaforroll');
   
    diceinitializer = new dice_initialize(da);
    diceinitializer.rolediceagain();
}

//This function is used to clear the select dice command.
function diceCommandClear() {
    debugger;
    var customset = $t.id('customset');
    customset.value = "";
}

//This function is used to select the dice command only
function diceselectcommand() {
    debugger;

    var selectedCommand = "";

    //Here hide the dice roll screen.

    var savedattackoptions = $t.id('savedattackoptions');
    savedattackoptions.style.display = 'none';

    var addmod = $t.id('addmod');
    addmod.style.display = 'none';

    var diceRollTrigger = $t.id('diceRollTrigger');
    diceRollTrigger.style.display = 'none';

    var dicesavecommand = $t.id('dicesavecommand');
    dicesavecommand.style.display = 'none';

    var lastDiceRollResult = $t.id('lastDiceRollResult');
    lastDiceRollResult.style.display = 'none';

    var defaultDiceSelect = $t.id('defaultDiceSelect');
    defaultDiceSelect.style.display = 'block';

    return selectedCommand;

}

function parsecustomdice_notation(notation) {
    debugger;
    var known_types = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd100'];

    var no = notation.split('@');
    var dr0 = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
    var dr1 = /(\b)*(\d+)(\b)*/gi;
    var ret = { set: [], constant: 0, result: [], error: false }, res;
    while (res = dr0.exec(no[0])) {
        var command = res[2];
        if (command != 'd') { ret.error = true; continue; }
        var count = parseInt(res[1]);
        if (res[1] == '') count = 1;
        var type = 'd' + res[3];
        if (known_types.indexOf(type) == -1) { ret.error = true; continue; }
        while (count--) ret.set.push(type);
        if (res[5]) ret.constant += parseInt(res[5]);
    }
    while (res = dr1.exec(no[1])) {
        ret.result.push(parseInt(res[2]));
    }
    return ret;
}

//Used to get the dice command in select mode.
function dicecommandsearch(dicename) {
    debugger;
    if (dicename == undefined) {
        return;
    }

    var localvar = "";

    var dicecommandaftertracestr = "";

    var customset = $t.id('customset');

    var customdiceset = customset.value;

    var customdicearray = [];

    var currentselecteddicenotation = dicename;
    var currentselecteddiceno = currentselecteddicenotation.split('@');
    var dicecommandexpression = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
    var dicecommandsplitresult = dicecommandexpression.exec(currentselecteddiceno[0]);
    var currentselecteddicecommand = dicecommandsplitresult[2];
    var currentselecteddicecount = 0;
    var currentselecteddicetype = "";

    if (currentselecteddicecommand == 'd') {
        if (dicecommandsplitresult[1] == '') {
            currentselecteddicecount = 1;
        }
        else {
            currentselecteddicecount = parseInt(dicecommandsplitresult[1]);
        }
        currentselecteddicetype = 'd' + dicecommandsplitresult[3];
    }

    for (var i = 0; i < customdiceset.length; i++) {
        if (customdiceset[i] != "+" && customdiceset[i] != "/" && customdiceset[i] != "-" && customdiceset[i] != "*") {
            localvar = localvar + customdiceset[i];
            if (i == customdiceset.length - 1) {
                customdicearray.push(localvar);
            }
        }
        else if (customdiceset[i] == "+" || customdiceset[i] == "/" || customdiceset[i] == "-" || customdiceset[i] != "*") {
            customdicearray.push(localvar);
            customdicearray.push(customdiceset[i]);
            localvar = "";
        }
    }

    var currentselecteddiceadded = false;

    for (var j = 0; j < customdicearray.length; j++) {
        var customarraynotation = customdicearray[j].trim();
        var customarrayno = customarraynotation.split('@');
        var customarraydicecommand = /\s*(\d*)([a-z]+)(\d+)(\s*\+\s*(\d+)){0,1}\s*(\+|$)/gi;
        var customarraycount = 0;
        var customarraytype = "";
        var newcustomarrayvalue = "";

        var res = [];
        if (!customarrayno[0].includes(' ')) {
            res = customarraydicecommand.exec(customarrayno[0]);
        }

        var customarraynowithfunc = [];

        var customarraynowithfuncavail = false;

        if (res == null || res == "" || res == undefined) {
            customarraynowithfunc = customarrayno[0].split(' ');
            if (customarraynowithfunc.length == 2) {
                res = customarraydicecommand.exec(customarraynowithfunc[0]);
                customarraynowithfuncavail = true;
            }
            else {
                continue;
            }
        }

        var command = res[2];
        if (command == 'd') {
            if (res[1] == '') {
                customarraycount = 1;
            }
            else {
                customarraycount = parseInt(res[1]);
            }
            customarraytype = 'd' + res[3];
        }

        if (customarraytype == currentselecteddicetype) {

            customarraycount = customarraycount + 1;
            newcustomarrayvalue = customarraycount + customarraytype;
            if (customarraynowithfuncavail == true) {
                customdicearray[j] = newcustomarrayvalue + ' ' + customarraynowithfunc[1];
            }
            else {
                customdicearray[j] = newcustomarrayvalue
            }

            currentselecteddiceadded = true;
        }
    }

    if (currentselecteddiceadded == false) {
        if (customdicearray.length > 0) {
            customdicearray.push('+');
            customdicearray.push(dicename);
        }
        else {
            customdicearray.push(dicename);
        }
    }

    if (customdicearray.length > 0) {
        for (var j = 0; j < customdicearray.length; j++) {
            dicecommandaftertracestr = dicecommandaftertracestr.trim() + ' ' + customdicearray[j].trim();
        }
    }

    customset.value = dicecommandaftertracestr.trim();

}

function stringifycustomdice_notation(nn) {
    var dict = {}, notation = '';
    for (var i in nn.set)
        if (!dict[nn.set[i]]) dict[nn.set[i]] = 1; else ++dict[nn.set[i]];
    for (var i in dict) {
        if (notation.length) notation += ' + ';
        notation += (dict[i] > 1 ? dict[i] : '') + i;
    }
    if (nn.constant) notation += ' + ' + nn.constant;
    return notation;
}

function customrolediceagain() {
    debugger;

    var showdicerollResult = $t.id('canvas');
    showdicerollResult.style.display = 'block';

    var showdicerollResult = $t.id('showdicerollresult');
    showdicerollResult.style.display = 'none';

    diceinitializer.rolediceagain();
}

function dicerollcomplete() {
    debugger;
    var diceareaforroll = $t.id('diceareaforroll');
    diceareaforroll.style.display = 'none';
    var diceareaforselection = $t.id('diceareaforselection');
    diceareaforselection.style.display = 'block';
}
"use strict";

function dice_initialize(container) {
    debugger;
    //$t.remove($t.id('loading_text'));
    var modaPOPUP = $t.id('myModal');
    var canvas = $t.id('canvas');
    // canvas.style.width = window.innerWidth - 1 + 'px';
    // canvas.style.height = window.innerHeight - 1 + 'px';
    // canvas.style.width	 = modaPOPUP.innerWidth - 1 + 'px';
    // canvas.style.height = modaPOPUP.innerHeight - 1 + 'px';
    canvas.style.width = 570 - 1 + 'px';
    canvas.style.height = 500 - 1 + 'px';
    //var label = $t.id('label');
    var rollresult = $t.id('rollresult');
    var set = $t.id('set');
    var customset = $t.id('customset');
    //var selector_div = $t.id('selector_div');
    //var info_div = $t.id('info_div');
    var result_div = $t.id('sethelp');    //[Customr Code]  RavTeja.

    var lastrunresult = $t.id('lastrunresult');

    on_set_change();


    $t.dice.use_true_random = false;

    function on_set_change(ev) { set.style.width = set.value.length + 3 + 'ex'; }
    //$t.bind(set, 'keyup', on_set_change);
    //$t.bind(set, 'mousedown', function (ev) { ev.stopPropagation(); });
    //$t.bind(set, 'mouseup', function (ev) { ev.stopPropagation(); });
    //$t.bind(set, 'focus', function (ev) { $t.set(container, { class: '' }); });
    //$t.bind(set, 'blur', function (ev) { $t.set(container, { class: 'noselect' }); });

    //$t.bind($t.id('clear'), ['mouseup', 'touchend'], function (ev) {
    //    ev.stopPropagation();
    //    set.value = '0';
    //    on_set_change();

    //    //[Customer Code]  RavTeja.
    //    result_div.innerHTML = 'choose your dice set by clicking the dices or by direct input of notation,<br/>tap and drag on free space of screen or hit throw button to roll';
    //});

    var box = new $t.dice.dice_box(canvas, { w: 500, h: 300 });
    box.animate_selector = false;

    $t.bind(window, 'resize', function () {
        canvas.style.width = modaPOPUP.innerWidth - 1 + 'px';
        canvas.style.height = modaPOPUP.innerHeight - 1 + 'px';
        //canvas.style.width = window.innerWidth - 1 + 'px';
        //canvas.style.height = window.innerHeight - 1 + 'px';
        box.reinit(canvas, { w: 500, h: 300 });
    });

    function show_selector() {
        //info_div.style.display = 'none';
        //selector_div.style.display = 'block';
        box.draw_selector();
    }


    function before_roll(vectors, notation, callback) {
        debugger;
        //info_div.style.display = 'block';
        //selector_div.style.display = 'none';
        // do here rpc call or whatever to get your own result of throw.
        // then callback with array of your result, example:
        // callback([2, 2, 2, 2]); // for 4d6 where all dice values are 2.
        callback();
    }

    function notation_getter() {
        set.value = diceselectcommandtrace();    //[Customr Code]  RavTeja.
        return $t.dice.parse_notation(set.value);
    }

    function after_roll(notation, result) {
        var res = result.join(' ');
        if (notation.constant) res += ' +' + notation.constant;
        if (result.length > 1) res += ' = ' +
            (result.reduce(function (s, a) { return s + a; }) + notation.constant);


        res = diceafterrolltrace(notation, result);

        debugger;

        rollresult.value = res;
        localStorage.setItem("rollresult", rollresult.value);
        //info_div.style.display = 'inline-block';
        lastrunresult.value = res;
        //result_div.innerHTML = res;    //[Customr Code]  RavTeja.
    }

    box.bind_mouse(container, notation_getter, before_roll, after_roll);

    //box.bind_throw($t.id('throw'), notation_getter, before_roll, after_roll);



    //$t.bind(container, ['mouseup'], function (ev) {
    //    debugger;
    //    ev.stopPropagation();
    //    if (selector_div.style.display == 'none') {
    //        if (!box.rolling) show_selector();
    //        box.rolling = false;
    //        return;
    //    }
    //    var name = box.search_dice_by_mouse(ev);
    //    if (name != undefined) {      //[Customr Code]  RavTeja.
    //        customset.value = customset.value + ' + ' + name
    //    }
    //    if (name != undefined) {
    //        var notation = $t.dice.parse_notation(set.value);
    //        notation.set.push(name);
    //        //set.value = $t.dice.stringify_notation(notation);     //[Customr Code]  RavTeja.
    //        on_set_change();
    //    }
    //});

    var params = $t.get_url_params();
    if (params.notation) {
        set.value = params.notation;
    }
    if (params.roll) {
        $t.raise_event($t.id('throw'), 'mouseup');
    }
    else {
        show_selector();
    }


   // box.bind_customthrow(notation_getter, before_roll, after_roll);

    this.rolediceagain = function () {
        box.bind_customthrow(notation_getter, before_roll, after_roll);
    }
}

(function () {
    'use strict';
    
    var app = angular.module('rpgsmith-directives');

    app.directive('droppable', ['$compile', function ($compile) {
        return {
            restrict: 'A',
            scope: {
                onDroppableDrop: '&',
                onDroppableOver: '&',
                onDroppableOut: '&'
            },
            link: function (scope, element, attrs, controller, ngModel) {
                element.droppable({
                    //accept: '*',
                    //greedy: true,
                    tolerance: 'pointer',
                    over: function (event, ui) {
                        scope.onDroppableOver({ event: event, ui: ui });
                    },
                    out: function (event, ui) {
                        scope.onDroppableOut({ event: event });
                    },
                    drop: function (event, ui) {
                        scope.onDroppableDrop({ event: event, ui: ui });
                    }
                });
            }
        };
    }]);

    app.directive('rpgsmithBody', [function () {
        return {
            restrict: 'A',
            link: function (scope, element, attrs, controller, ngModel) {
                scope.$root.$on('rpgsmithSetBodyClass', function (event, data) {
                    if (data.remove)
                        element.removeClass(data.remove);
                    if (data.add)
                        element.addClass(data.add);
                });
            }
        }
    }]);

})();
(function() {
    'use strict';

    var app = angular.module('rpgsmith-directives');


    app.directive('fileModel', ['$parse', function($parse) {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
                var model = $parse(attrs.fileModel);
                var modelSetter = model.assign;

                element.bind('change', function() {
                    scope.$apply(function() {
                        debugger;
                        modelSetter(scope, element[0].files[0]);
                        debugger;
                        evt.target.value = "";
                        //evt.target.value = element[0].files[0];
                    });
                });
            }
        };
    }]);



})();
(function () {
    'use strict';
    
    var app = angular.module('rpgsmith-directives');
    
    app.controller('GridstackController', ['$scope', function ($scope) {

        var gridstack = null;

        this.init = function (element, options) {
            gridstack = element.gridstack(options).data('gridstack');
            return gridstack;
        };

        this.verticalMargin = function (value, noUpdate) {
            if (gridstack) {
                gridstack.verticalMargin(value, noUpdate);
            }
        };

        this.enableMove = function (enable) {
            if (gridstack)
                gridstack.enableMove(enable, true);
        };

        this.enableResize = function (enable) {
            if (gridstack)
                gridstack.enableResize(enable, true);
        };

        this.removeItem = function (element) {
            if (gridstack)
                return gridstack.removeWidget(element, false);
            return null;
        };

        this.addItem = function (element) {
            if (gridstack) {

                var el = gridstack.makeWidget(element);
                el.attr('data-gs-auto-position', false);

                return element;
            }
            return null;
        };

    }]);

    app.directive('gridstack', ['$timeout', '$window', function ($timeout, $window) {

        return {
            restrict: 'A',
            controller: 'GridstackController',
            scope: {
                options: '=',
                onChange: '&',
                onDragStart: '&',
                onDragStop: '&',
                onResizeStart: '&',
                onResizeStop: '&',
                gridstackHandler: '=?',
                gsLockTiles: '=?'
            },
            link: function (scope, element, attrs, controller, ngModel) {

                var gridstack = controller.init(element, scope.options);

                scope.gridstackHandler = gridstack;
                scope.options.api = gridstack;

                angular.element($window).bind('resize', _.debounce(function () {

                    var width = element.innerWidth();
                    var cellWidth = gridstack.cellWidth();

                    if (cellWidth > 0) {

                        var columns = Math.floor(width / cellWidth);

                        if (columns !== scope.options.width) {

                            scope.$evalAsync(function () {
                                console.log(columns);
                                //scope.options.width = columns;
                                gridstack.setGridWidth(columns, false);
                            });
                        }
                    }

                }, 500));
                
				element.on('change', function (e, items) {
					console.log("Change: ",e,items);
                    
                });

                element.on('dragstart', function (e, ui) {
                    scope.onDragStart({ event: e, ui: ui });
                });

                element.on('dragstop', function (e, ui) {
                    scope.onDragStop({ event: e, ui: ui });
                });

                element.on('resizestart', function (e, ui) {
                    scope.onResizeStart({ event: e, ui: ui });
                });

                element.on('resizestop', function (e, ui) {
                    scope.onResizeStop({ event: e, ui: ui });
                });

                scope.$watch('gsLockTiles', function () {
                    controller.enableMove(!scope.gsLockTiles);
                    controller.enableResize(!scope.gsLockTiles);
                });
            }
        };

    }]);

    app.directive('gridstackItem', ['$timeout', function ($timeout) {

        return {
            restrict: 'A',
            controller: 'GridstackController',
            require: '^gridstack',
            scope: {

                gsItem: '=?',
                gridstackItem: '=',
                
                gsItemId: '=?',
                gsItemX: '=?',
                gsItemY: '=?',
                gsItemWidth: '=?',
                gsItemHeight: '=?',

                gsItemAutoPosition: '=?',

                gsItemMinHeight: '=?',
                gsItemMaxHeight: '=?',
                gsItemMinWidth: '=?',
                gsItemMaxWidth: '=?'
            },
            link: function (scope, element, attrs, controller) {

                var el = $(element);

                element.data('_item_data', scope.gsItem);
                
                el.attr('data-gs-id', scope.gsItemId);

                if (!scope.gsItemAutoPosition) {
                    el.attr('data-gs-x', scope.gsItemX);
                    el.attr('data-gs-y', scope.gsItemY);
                }

                el.attr('data-gs-width', scope.gsItemWidth);
                el.attr('data-gs-height', scope.gsItemHeight);
                
                el.attr('data-gs-min-width', scope.gsItemMinWidth);
                el.attr('data-gs-min-height', scope.gsItemMinHeight);
                el.attr('data-gs-max-width', scope.gsItemMaxWidth);
                el.attr('data-gs-max-height', scope.gsItemMaxHeight);

                el.attr('data-gs-auto-position', scope.gsItemAutoPosition);
                
                var widget = controller.addItem(element);
                var item = element.data('_gridstack_node');

                // TODO
                // https://github.com/kdietrich/gridstack-angular/pull/21
                scope.$watch(function () { return el.attr('data-gs-id'); }, function (val) {
                    scope.gsItemId = val;
                });
                
                scope.$watch(function () { return el.attr('data-gs-x'); }, function (val) {
                    scope.gsItemX = Number(val);
                });

                scope.$watch(function () { return el.attr('data-gs-y'); }, function (val) {
                    scope.gsItemY = Number(val);
                });

                scope.$watch(function () { return el.attr('data-gs-width'); }, function (val) {
                    scope.gsItemWidth = Number(val);
                });

                scope.$watch(function () { return el.attr('data-gs-height'); }, function (val) {
                    scope.gsItemHeight = Number(val);
                });

                element.bind('$destroy', function () {
                    var item = element.data('_gridstack_node');
                    controller.removeItem(element);
                });
            }

        };

    }]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-directives');

    app.directive('rpgsmithnotetype', ['$compile', 'dialogs', 'tileService', '$state', 'toaster', 'rulesetDataShareService', function ($compile, dialogs, tileService, $state, toaster, rulesetDataShareService) {
		var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-4"><div class="form-group"><label for="newNoteTitle">Title</label><input type= "text" id="newNoteTitle" class="form-control" placeholder= "Enter note title" ng-model="info.Value.Note.Name" ></div><div class="form-group"> <ul class="input-color-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor" checked="checked"><i class="icon input-color-2"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-4"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-6"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-8"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-10"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-12"></i></label></li><li class="form-check"><label class="form-check-label"><i class="icon input-color-custom" role="button" data-dismiss="modal" data-toggle="modal" data-target="#colorSelectionPopup"></i></label></li></ul></div></div></div> <div class="form-row"><div class="col"><div class="form-group"><label for="newNoteContents">Contents*</label><textarea id="newNoteContents" class="form-control" placeholder="Enter note contents" rows="8" ng-model="info.Value.Note.Text"></textarea></div></div></div></form > ';

		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}};height: 50px;"><span class="text_design" ng-click="EditNoteTile()" > <p style="color:{{info.Styles.titletextcolor}};height: 50px;">{{ info.Value.Note.Name }}</p></span ></div ><div style="color:{{info.Styles.bodytextcolor}};height: 80%" ng-bind-html="info.Value.Note.Text" ng-click="ShowContent()"></div>';


        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            //var items = angular.copy(scope.info);
            //var item = angular.copy(scope.fullscope);
            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);
            scope.EditNoteTile = function () {
                var dlg = dialogs.create('/views/dialogs/tile-editor-1.html', 'NoteTile',
                    { scope: scope.info, Tablist: scope.fullscope }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        res.IsSync = false;
                        res.UpdateDate = Date.now();
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        //rulesetDataShareService.setTileStyles(res);
                        //var index = -1;
                        //if (angular.isUndefined(scope.fullscope) == false) {
                        //    for (var i = 0; i < scope.fullscope.length; i++) {
                        //        if (scope.fullscope[i].TileId == res.TileId) {
                        //            scope.fullscope.splice(i, 1);
                        //            scope.fullscope.push(res);
                        //        }
                        //    }
                        //}
                        //res.Mode = "Use";
                        //element.html(getTemplate(scope.useoredit));
                        scope.info = res;

                        scope.fromDirectiveFn(scope.info);
                    }
                });
            }

            scope.ShowContent = function () {
                var dlg = dialogs.create('/views/dialogs/notetilecontent.html', 'ShowAllTileContent',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        scope.info = res;
                    }
                });
            }

            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Note.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                //  scope.info = null;
                                //  scope.info.splice(scope.info.TileId);
                                $state.go('profile.character.layout');
                                // $transition.router.stateService.go('profile.character.layout', { characterId: scope.info.Value.Note.CharacterProfileId, layoutId: 123 });
                                toaster.pop('success', "Tile deleted Successfully.");
                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }

        }


        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                //info: '&',
                //info: false,
                //fullscope: '=',
                useoredit: '=',
                fromDirectiveFn: '=method'
            }
        };

    }]);

    app.directive('rpgsmithcountertype', ['$compile', 'dialogs', 'tileService', 'toaster', 'rulesetDataShareService', function ($compile, dialogs, tileService, toaster, rulesetDataShareService) {
        //var templateUrlEdit = '<div class="row"><div class ="form-group col-md-6"><label class="control-label col-md-4">Default Value</label><div class="col-md-8"><input type="number" placeholder="Default Value" class="form-control col-md-8" ng-model="info.Value.Counter.DefaultValue" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="0" ></div></div><div class="form-group col-md-6"><label class="control-label col-md-4">Mask</label><div class="col-md-8"><input type="text" placeholder="Text" class="form-control col-md-8" ng-model="info.Value.Counter.Mask" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="" ></div></div>' +
        //    '<div class="form-group col-md-6"><label class="control-label col-md-4">Max</label><div class="col-md-8"><input type="number" placeholder="Max Value" class="form-control col-md-8" ng-model="info.Value.Counter.Max" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="" ></div></div><div class="form-group col-md-6"><label class="control-label col-md-4">Min</label><div class="col-md-8"><input type="number" placeholder="Min Value" class="form-control col-md-8" ng-model="info.Value.Counter.Min" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="" ></div></div><div class="form-group col-md-6"><label class="control-label col-md-4">Name</label><div class="col-md-8"><input type="text" placeholder="Name" class="form-control col-md-8" ng-model="info.Value.Counter.Name" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="" ></div></div>' +
        //    '<div class="form-group col-md-6"><label class="control-label col-md-4">Step</label><div class="col-md-8"><input type="number" placeholder="Step" class="form-control col-md-8" ng-model="info.Value.Counter.Step" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="" ></div></div><div class="form-group col-md-6"><label class="control-label col-md-4">Value</label><div class="col-md-8"><input type="number" placeholder="Value" class="form-control col-md-8" ng-model="info.Value.Counter.Value" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value="" ></div></div></div>';
		var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="newCounterTitle">Title</label><input type="text" id="newCounterTitle" class="form-control" ng-model="info.Value.Counter.Name" placeholder="Enter counter title"></div></div><div class="col-12 col-md-6"><div class="form-group"><label for="newCounterDefaultValue">Default Value*</label><input type="number" id="newCounterDefaultValue" class="form-control" placeholder="Enter reset value" ng-model="info.Value.Counter.Value"></div></div></div><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="newCounterMinimumValue">Minimum</label><input type="number" id="newCounterMinimumValue" class="form-control" placeholder="Enter minimum value" ng-model="info.Value.Counter.Min"></div></div><div class="col-12 col-md-6"><div class="form-group"><label for="newCounterMaximumValue">Maximum</label><input type="number" id="newCounterMaximumValue" class="form-control" placeholder="Enter maximum value" ng-model="info.Value.Counter.Max"></div></div></div><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="newCounterStep">Step</label><input type="number" id="newCounterStep" class="form-control" placeholder="Enter step" ng-model="info.Value.Counter.Step"></div><div class="form-group"><label for="colorList">Color*</label><ul id="colorList" class="input-color-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor" checked="checked"><i class="icon input-color-2"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-4"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-6"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-8"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-10"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-12"></i></label></li><li class="form-check"><label class="form-check-label"><i class="icon input-color-custom" role="button" data-dismiss="modal" data-toggle="modal" data-target="#colorSelectionPopup"></i></label></li></ul></div></div></div></form>';


		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}}"><span  ng-click="EditCounterTile()" class="text_design"><p style="color:{{info.Styles.titletextcolor}};height:50px">{{info.Value.Counter.Name}}</p></span></div> <div class="text_align" style="font-size: larger;vertical-align: middle;background-color: {{info.Styles.bodybackgroundColor}};width: 100%;height:90%"><p ng-click="ShowCounterValue()" style="color:{{info.Styles.bodytextcolor}};">{{ info.Value.Counter.Value }}</p> </div>';

        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            //var items = angular.copy(scope.info);

            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);

            scope.EditCounterTile = function () {
                var dlg = dialogs.create('/views/dialogs/tile-editor-2.html', 'NoteTile',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    //res.UpdateDate = Date.now();
                    if (res != "cancel") {
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        scope.info = res;

                    }
                });
            }
            var setValue = function (val) {
                scope.info.IsSync = false;
                //scope.info.UpdateDate = Date.now();
                scope.info.Value.Counter.Value = parseInt(val);
            }
            setValue(scope.info.Value.Counter.Value);
            scope.ShowCounterValue = function () {
                var dlg = dialogs.create('/views/dialogs/countertilecontent.html', 'ShowAllTileContent',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        scope.info = res;
                    }
                });
            }
            scope.Increment = function () {
                var min = angular.isUndefined(scope.info.Value.Counter.Min) ? null : parseInt(scope.info.Value.Counter.Min);
                var max = angular.isUndefined(scope.info.Value.Counter.Max) ? null : parseInt(scope.info.Value.Counter.Max);
                var step = angular.isUndefined(scope.info.Value.Counter.Step) ? 0 : parseInt(scope.info.Value.Counter.Step);
                if (max && (scope.info.Value.Counter.Value >= max || scope.info.Value.Counter.Value + step >= max)) {
                    setValue(max);
                    return false;
                }
                else if (step == 0) {
                    scope.info.Value.Counter.Value = min;
                    return false;
                }
                setValue(scope.info.Value.Counter.Value + step);
            }
            scope.Decrement = function () {
                var min = angular.isUndefined(scope.info.Value.Counter.Min) ? null : parseInt(scope.info.Value.Counter.Min);
                var max = angular.isUndefined(scope.info.Value.Counter.Max) ? null : parseInt(scope.info.Value.Counter.Max);
                var step = angular.isUndefined(scope.info.Value.Counter.Step) ? 0 : parseInt(scope.info.Value.Counter.Step);
                if (min && (scope.info.Value.Counter.Value <= min || scope.info.Value.Counter.Value - step <= min) || min === 0 && scope.info.Value.Counter.Value < 1) {
                    setValue(min);
                    return false;
                }
                setValue(scope.info.Value.Counter.Value - step);
            };
            scope.Reset = function () {
                var min = angular.isUndefined(scope.info.Value.Counter.Min) ? null : parseInt(scope.info.Value.Counter.Min);
                var max = angular.isUndefined(scope.info.Value.Counter.Max) ? null : parseInt(scope.info.Value.Counter.Max);
                var step = angular.isUndefined(scope.info.Value.Counter.Step) ? 0 : parseInt(scope.info.Value.Counter.Step);
                var dlg = dialogs.confirm(
                    'Confirm Reset',
                    'Are you sure you want to reset "' + scope.info.Value.Counter.Name + '" to "' + scope.info.Value.Counter.DefaultValue + '"?',
                    { size: 'md' }
                );

                dlg.result.then(
                    function () {
                        scope.info.IsSync = false;
                        scope.info.UpdateDate = Date.now();
                        scope.info.Value.Counter.Value = scope.info.Value.Counter.DefaultValue;
                    });
            }
            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Counter.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                //  scope.info.splice(scope.info.TileId);
                                toaster.pop('success', "Tile deleted Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }

        };
        //scope.changed = function () {
        //    // If the user decides to delete the number, we will set it to 0.
        //    if (!scope.info.Value.Counter.Value) setValue(0);

        //    // Check if what's typed is numeric or if it has any letters.
        //    if (/[0-9]/.test(scope.info.Value.Counter.Value)) {
        //        setValue(scope.info.Value.Counter.Value);
        //    }
        //    else {
        //        setValue(scope.min);
        //    }

        //    // If a minimum is set, let's make sure we're within the limit.
        //    if (min && (scope.info.Value.Counter.Value <= min || scope.info.Value.Counter.Value - step <= min)) {
        //        setValue(min);
        //        return false;
        //    }

        //    // If a maximum is set, let's make sure we're within the limit.
        //    if (max && (scope.info.Value.Counter.Value >= max || scope.info.Value.Counter.Value + step >= max)) {
        //        setValue(max);
        //        return false;
        //    }

        //    // Re-set the value as an integer.
        //    setValue(scope.info.Value.Counter.Value);
        //};
        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                useoredit: '='
            }
        }

    }]);

    app.directive('rpgsmithattributetype', ['$compile', 'dialogs', 'rulesetDataShareService', function ($compile, dialogs, rulesetDataShareService) {
        //var templateUrlEdit = '<div class="row"><div class ="form-group col-md-6"><label class="control-label col-md-4">Title</label><div class="col-md-8"><input type="text" class="form-control col-md-8" ng-model="info.Value.Attribute.Title" value=""/></div></div><div class ="form-group col-md-6"><label class="control-label col-md-4">Corestat Value</label><div class="col-md-6"><select class="form-control " ng-options=" item.Name as item.Name for item in info.CorestatValues" ng-model="info.Value.Attribute.CorestatValue" >' +
        //    //var templateUrlEdit = '<div class="row"><div class ="form-group col-md-6"><label class="control-label col-md-4">Title</label><div class="col-md-8"><input type="text" class="form-control col-md-8" ng-model="info.Value.Attribute.Title" value=""/></div></div><div class ="form-group col-md-6"><label class="control-label col-md-4">Corestat Value</label><div class="col-md-6"><select class="form-control " ng-options="item for item in corestatnames" ng-model="info.Value.Attribute.CorestatValue" >' +
        //    '<option value="">--Select--</option></select></div></div></div>';

		var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="colorList">Color*</label><ul id="colorList" class="input-color-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor" checked="checked"><i class="icon input-color-2"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-4"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-6"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-8"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-10"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-12"></i></label></li><li class="form-check"><label class="form-check-label"><i class="icon input-color-custom" role="button" data-dismiss="modal" data-toggle="modal" data-target="#colorSelectionPopup"></i></label></li></ul></div><fieldset class="form-group input-switch input-switch-dual"><legend></legend><ul class="input-switch-items"><li class="form-check"><label class="control-label col-md-4">Title</label></li><li class="form-check"><input type="text" class="form-control col-md-8" ng-model="info.Value.Attribute.Title" value="" /></li></ul></fieldset></div></div><div class="form-row"><div class="col"><fieldset class="form-group input-list input-list-wrap core-stats"><legend>Core Stats*</legend><ul class="input-list-items" ng-if="info.CorestatValues != null"><li class="form-check" ng-repeat="coreStatValue in info.CorestatValues"><label class="form-check-label"><input class="form-check-input" type="radio" name="newAttributeCoreStats" value="{{coreStatValue.Name}}" ng-model="$parent.info.Value.Attribute.CorestatValue"><span><em>{{ coreStatValue.Name }}</em><i class="icon"></i></span></label></li></ul><p class="text-center" ng-if="info.CorestatValues == null">No Corestats Available</p></fieldset></div></div></form>';
        //var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><fieldset class="form-group input-switch input-switch-dual"><legend></legend><ul class="input-switch-items"><li class="form-check"><label class="control-label col-md-4">Title</label></li><li class="form-check"><input type="text" class="form-control col-md-8" ng-model="info.Value.Attribute.Title" value="" /></li></ul></fieldset></div></div><div class="form-row"><div class="col"><fieldset class="form-group input-list input-list-wrap core-stats"><legend>Core Stats*</legend><ul class="input-list-items"><li class="form-check" ng-repeat="coreStatValue in info.CorestatValues"><label class="form-check-label"><input class="form-check-input" type="radio" name="newAttributeCoreStats" value="{{coreStatValue.Name}}" ng-model="info.Value.Attribute.SelectedCorestatValue"><span><em>{{ coreStatValue.Name }}</em><i class="icon"></i></span></label></li></ul></fieldset></div></div></form>';

		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}}"><span ng-click="EditAttributeTile()" class="text_design"><p style="color:{{info.Styles.titletextcolor}};">{{info.Value.Attribute.Title}}</p></span></div><div class="text_align"><p ng-click="ShowAttributeContent()" style="color:{{info.Styles.bodytextcolor}};">{{info.Value.Attribute.Name}}</p></div>';

        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            debugger;
            var items = angular.copy(scope.info);
            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);

            if (scope.useoredit == 0) {
                if (items.Value.Attribute.AttributeContent == null || items.Value.Attribute.AttributeContent == "" || angular.isUndefined(items.Value.Attribute.AttributeContent) == true) {
                    var CoreStatValues = rulesetDataShareService.getLayoutData();
                    for (var i = 0; i < CoreStatValues.CorestatValues.length; i++) {
                        var data = CoreStatValues.CorestatValues[i];
                        if (scope.info.Value.Attribute.TypeId == data.TypeId) {
                            items.Value.Attribute.AttributeContent = data;
                        }
                    }
                }
                if (items.Value.Attribute.AttributeContent.TypeId == 1) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Text != null) {
                        scope.info.Value.Attribute.CorestatValues = "Text:" + items.Value.Attribute.AttributeContent.Value.Text.value;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 2) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    //scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Choices != null) {
                        scope.info.Value.Attribute.CorestatValues = "Choices:" + items.Value.Attribute.AttributeContent.Value.Choices;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent.AttributeValue = "Choices:" + items.Value.Attribute.AttributeContent.Value.Choices;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 3) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.YesOrNo != null) {
                        scope.info.Value.Attribute.CorestatValues = "On/Off:" + items.Value.Attribute.AttributeContent.Value.YesOrNo.value;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 4) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.OnOrOff != null) {
                        scope.info.Value.Attribute.CorestatValues = "Yes/No:" + items.Value.Attribute.AttributeContent.Value.OnOrOff.value;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 5) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.ValueAndSubValue != null) {
                        scope.info.Value.Attribute.CorestatValues = "Value:" + items.Value.Attribute.AttributeContent.Value.ValueAndSubValue.value + " " + "Sub Value:" + items.Value.Attribute.AttributeContent.Value.ValueAndSubValue.subvalue;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 6) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue != null) {
                        scope.info.Value.Attribute.CorestatValues = "Current Value:" + items.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.CurrentValue + " " + "Max Value:" + items.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.MaxValue;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 7) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Weight != null) {
                        scope.info.Value.Attribute.CorestatValues = "Weight:" + items.Value.Attribute.AttributeContent.Value.Weight.value + items.Value.Attribute.AttributeContent.Weight.units.selectedUnit;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 8) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Image != null) {
                        scope.info.Value.Attribute.CorestatValues = items.Value.Attribute.AttributeContent.Value.Image.image;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 12) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Height != null) {
                        scope.info.Value.Attribute.CorestatValues = "Height:" + items.Value.Attribute.AttributeContent.Value.Height.value + items.Value.Attribute.AttributeContent.Height.units.selectedUnit;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 13) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Volume != null) {
                        scope.info.Value.Attribute.CorestatValues = "Volume:" + items.Value.Attribute.AttributeContent.Value.Volume.value + "  " + items.Value.Attribute.AttributeContent.Volume.units.selectedUnit;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 14) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.Number != null) {
                        scope.info.Value.Attribute.CorestatValues = "Number:" + items.Value.Attribute.AttributeContent.Value.Number.value;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 15) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.DefaultDice != null) {
                        scope.info.Value.Attribute.CorestatValues = "Dice:" + items.Value.Attribute.AttributeContent.Value.DefaultDice.value;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent = items.Value.Attribute.AttributeContent;
                }
                else if (items.Value.Attribute.AttributeContent.TypeId == 19) {
                    scope.info.Value.Attribute.CoreStatValue = items.Value.Attribute.AttributeContent.Value;
                    scope.info.Value.Attribute.TypeId = items.Value.Attribute.AttributeContent.TypeId;
                    if (items.Value.Attribute.AttributeContent.Value.TextArea != null) {
                        scope.info.Value.Attribute.CorestatValues = items.Value.Attribute.AttributeContent.Value.TextArea.value;
                    }
                    else {
                        scope.info.Value.Attribute.CorestatValues = "";
                    }
                    scope.info.Value.Attribute.AttributeContent.AttributeValue = items.Value.Attribute.AttributeContent.Value.TextArea.value;
                }
            }

            scope.ShowAttributeContent = function () {
                var dlg = dialogs.create('/views/dialogs/attributetilecontent.html', 'ShowAllTileContent',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        scope.info = res;
                    }
                });
            }

            scope.EditAttributeTile = function () {
            
                var layoutdata = rulesetDataShareService.getLayoutData();
                var corestatvalues = layoutdata.CorestatValues;
                scope.info.CorestatValues = angular.isUndefined(corestatvalues) == false ? corestatvalues : [];
                for (var i = 0; i < scope.info.CorestatValues.length; i++) {
                    if (scope.info.CorestatValues[i].Name != null) {
                        if (scope.info.Value.Attribute.Name == scope.info.CorestatValues[i].Name) {
                            scope.info.Value.Attribute.SelectedCorestatValue = scope.info.CorestatValues[i].Name;
                       }
                    }
                }
                var dlg = dialogs.create('/views/dialogs/tile-editor-3.html', 'NoteTile',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        scope.info = res;
                    }
                });
            }

            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Attribute.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                //  scope.info.splice(scope.info.TileId);
                                toaster.pop('success', "Tile deleted Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }
        };

        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                useoredit: '='
            }
        }

    }]);

    app.directive('rpgsmithlinktype', ['$compile', 'dialogs', 'rulesetDataShareService', function ($compile, dialogs, rulesetDataShareService) {
		var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="colorList">Color*</label><ul id="colorList" class="input-color-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor" checked="checked"><i class="icon input-color-2"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-4"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-6"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-8"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-10"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-12"></i></label></li><li class="form-check"><label class="form-check-label"><i class="icon input-color-custom" role="button" data-dismiss="modal" data-toggle="modal" data-target="#colorSelectionPopup"></i></label></li></ul></div><fieldset class="form-group input-switch input-switch-dual"><legend></legend><ul class="input-switch-items"><li class="form-check"><label class="form-check-label">Title</label></li><li class="form-check"><input type="text" class="form-control col-md-8" ng-model="info.Value.Link.Title" value="" /></li></ul></fieldset></div></div><div class="form-row"><div class="col"><!-- Link property switch --><fieldset class="form-group input-switch"><legend>Property*</legend><ul class="input-switch-items"><li class="form-check" ><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperty" ng-click="ShowItemsDropdown()" value="Items" ng-model="info.Value.Link.SelectedPropertyValue"><span>Items</span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperty" ng-click="ShowSpellsDropdown()" value="Spells" ng-model="info.Value.Link.SelectedPropertyValue"><span>Spells</span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperty" ng-click="ShowAbilitiesDropdown()" value="Abilities" ng-model="info.Value.Link.SelectedPropertyValue"><span>Abilities</span></label></li></ul></fieldset><fieldset class="form-group input-list input-list-wrap properties"><ul class="input-list-items"><li class="form-check" ng-show="IsItemVisible" ng-repeat="item in LinkTileItems"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperties" value="{{item.ItemProperties[0].Value.Text.value}}" ng-model="$parent.info.Value.Link.SelectedProperty" ng-click="SetContentType(1)"><span><em>{{ item.ItemProperties[0].Value.Text.value }}</em><i class="icon"></i></span></label></li><li class="form-check" ng-show="IsSpellVisible" ng-repeat="spell in LinkTileSpells"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperties" value="{{spell.SpellProperties[0].Value.Text.value}}"  ng-model="$parent.info.Value.Link.SelectedProperty"><span><img ng-src="{{info.Value.Link.SelectedPropertyValueImage}}" alt=""><em>{{spell.SpellProperties[0].Value.Text.value}}</em><i class="icon"></i></span></label></li><li class="form-check" ng-show="IsAbilityVisible" ng-repeat="ability in LinkTileAbilities"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperties" value="{{ability.AbilityProperties[0].Value.Text.value}}" ng-model="$parent.info.Value.Link.SelectedProperty"><span><img ng-src="{{info.Value.Link.SelectedPropertyValueImage}}" alt=""><em>{{ability.AbilityProperties[0].Value.Text.value}}</em><i class="icon"></i></span></label></li></ul><p style="text-align:center;" ng-show="ShowContent">Content Not Available</p></fieldset></div></div></form>';
		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}};height: 50px;"> <span ng-click="EditLinkTile()" style="color:{{info.Styles.titletextcolor}};">{{info.Value.Link.Title}}</span></div><div class="text_align" style="text-align:center;width:100%;height:90%;background-size: 100% 100%;background-image: url(&#34;{{info.Value.Link.SelectedPropertyValueImage}}&#34;)"> </div>';

        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            var items = angular.copy(scope.info);

            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);
            scope.IsItemVisible = true;
            scope.IsSpellVisible = false;
            scope.IsAbilityVisible = false;
            scope.LinkTileItems = [];
            scope.LinkTileSpells = [];
            scope.LinkTileAbilities = [];
            //if (angular.equals({}, rulesetDataShareService.getRulesetData()) == false) {
            //    scope.ContentfullScope = getRulesetData
            //}
            if (angular.isUndefined(scope.fullscope) == false) {
                if (scope.fullscope.Items != null) {
                    for (var i = 0; i < scope.fullscope.Items.length; i++) {
                        scope.LinkTileItems.push(scope.fullscope.Items[i]);
                    }
                }
                if (scope.fullscope.Spells != null) {
                    for (var i = 0; i < scope.fullscope.Spells.length; i++) {
                        scope.LinkTileSpells.push(scope.fullscope.Spells[i]);
                    }
                }
                if (scope.fullscope.Abilities != null) {
                    for (var i = 0; i < scope.fullscope.Abilities.length; i++) {
                        scope.LinkTileAbilities.push(scope.fullscope.Abilities[i]);
                    }
                }
            }
            //else {
            //    if (scope.ContentfullScope.Items != null) {
            //        for (var i = 0; i < scope.ContentfullScope.Items.length; i++) {
            //            scope.LinkTileItems.push(scope.ContentfullScope.Items[i]);
            //        }
            //    }
            //    if (scope.ContentfullScope.Spells != null) {
            //        for (var i = 0; i < scope.ContentfullScope.Spells.length; i++) {
            //            scope.LinkTileSpells.push(scope.ContentfullScope.Spells[i]);
            //        }
            //    }
            //    if (scope.ContentfullScope.Abilities != null) {
            //        for (var i = 0; i < scope.ContentfullScope.Abilities.length; i++) {
            //            scope.LinkTileAbilities.push(scope.ContentfullScope.Abilities[i]);
            //        }
            //    }
            //}
            //if (items.Mode == "Edit") {
                if (items.Value.Link.SelectedPropertyValue == "Items") {
                    scope.IsItemVisible = true;
                    scope.IsSpellVisible = false;
                    scope.IsAbilityVisible = false;
                }
                if (items.Value.Link.SelectedPropertyValue == "Spells") {
                    scope.IsItemVisible = false;
                    scope.IsSpellVisible = true;
                    scope.IsAbilityVisible = false;
                }
                if (items.Value.Link.SelectedPropertyValue == "Abilities") {
                    scope.IsItemVisible = false;
                    scope.IsSpellVisible = false;
                    scope.IsAbilityVisible = true;
                }
            //}
            scope.SetContentType = function (contentType) {
                if (contentType == 1) {
                    scope.info.Value.Link.SelectedPropertyValue = "Items";
                } else if (contentType == 2) {
                    scope.info.Value.Link.SelectedPropertyValue = "Spells";
                }
                else if (contentType == 3) {
                    scope.info.Value.Link.SelectedPropertyValue = "Abilities";
                }
            }
            scope.ShowItemsDropdown = function () {
                scope.IsItemVisible = true;
                scope.IsSpellVisible = false;
                scope.IsAbilityVisible = false;
                if (scope.LinkTileItems.length <= 0)
                {
                    scope.ShowContent = true;
                }
            }
            scope.ShowSpellsDropdown = function () {
                scope.IsItemVisible = false;
                scope.IsSpellVisible = true;
                scope.IsAbilityVisible = false;
                if (scope.LinkTileSpells.length <= 0) {
                    scope.ShowContent = true;
                }
            }
            scope.ShowAbilitiesDropdown = function () {
                scope.IsItemVisible = false;
                scope.IsSpellVisible = false;
                scope.IsAbilityVisible = true;
                if (scope.LinkTileAbilities.length <= 0) {
                    scope.ShowContent = true;
                }
            }
            scope.newstyles = function () {

                return {
                    'background-size': '100% 100%',
                    'background-repeat': 'no-repeat',
                    'width': '100%',
                    'height': '100%'
                }

                //return {
                //    'background-color': 'transparent'
                //}

            };
            //scope.Items = [];
            //scope.spells = [];
            //scope.Abilities = [];
            //for (var i = 0; i < items.LinkTileProperties.Items.length; i++) {
            //    scope.Items.push(items.LinkTileProperties.Items[i].ItemProperties[0].Value.Text.value)
            //}
            //for (var i = 0; i < items.LinkTileProperties.Spells.length; i++) {
            //    scope.spells.push(items.LinkTileProperties.Spells[i].SpellProperties[0].Value.Text.value)
            //}
            //for (var i = 0; i < items.LinkTileProperties.Abilities.length; i++) {
            //    scope.Abilities.push(items.LinkTileProperties.Abilities[i].AbilityProperties[0].Value.Text.value)
            //}


            scope.ShowAllContent = function () {
                var IsItem = false; var IsSpell = false; var IsAbility = false;
                if (scope.info.Value.Link.SelectedPropertyValue == "Items") {
                    for (var i = 0; i < scope.LinkTileItems.length; i++) {
                        var data = scope.LinkTileItems[i];
                        if (scope.info.Value.Link.SelectedProperty == data.ItemProperties[0].Value.Text.value) {
                            IsItem = true;
                        }
                    }
                }
                else if (scope.info.Value.Link.SelectedPropertyValue == "Spells") {
                    for (var i = 0; i < scope.LinkTileSpells.length; i++) {
                        var data = scope.LinkTileSpells[i];
                        if (scope.info.Value.Link.SelectedProperty == data.SpellProperties[0].Value.Text.value) {
                            IsSpell = true;
                        }
                    }
                }
                else if (scope.info.Value.Link.SelectedPropertyValue == "Abilities") {
                    for (var i = 0; i < scope.LinkTileAbilities.length; i++) {
                        var data = scope.LinkTileAbilities[i];
                        if (scope.info.Value.Link.SelectedProperty == data.AbilityProperties[0].Value.Text.value) {
                            IsAbility = true;
                        }
                    }
                }
                if (IsItem == true) {
                    var ItemProperties = angular.isUndefined(scope.info.Value.Link.Content) == false ? scope.info.Value.Link.Content : data;
                    var dlg = dialogs.create('/views/dialogs/allitemcontent.html', 'ShowItems',
                        { scope: ItemProperties }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //scope.info = res;
                        }
                    });
                }
                else if (IsSpell == true) {
                    var SpellProperties = angular.isUndefined(scope.info.Value.Link.Content) == false ? scope.info.Value.Link.Content : data;
                    var dlg = dialogs.create('/views/dialogs/allspellcontent.html', 'ShowItems',
                        { scope: SpellProperties }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //scope.info = res;
                        }
                    });
                }
                else if (IsAbility == true) {
                    var AbilityProperties = angular.isUndefined(scope.info.Value.Link.Content) == false ? scope.info.Value.Link.Content : data;
                    var dlg = dialogs.create('/views/dialogs/allabilitycontent.html', 'ShowItems',
                        { scope: AbilityProperties }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //scope.info = res;
                        }
                    });
                }
            }
            scope.EditLinkTile = function () {
                var dlg = dialogs.create('/views/dialogs/tile-editor-4.html', 'NoteTile',
                    { scope: scope.info, fullscope: scope.fullscope }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        scope.info = res;

                    }
                });
            }
            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Link.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                // scope.info.splice(scope.info.TileId);
                                toaster.pop('success', "Tile deleted Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }
        };

        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                useoredit: '=',
                fullscope:'='
            }
        }

    }]);

    app.directive('rpgsmithexecutetype', ['$compile', 'dialogs', 'rulesetDataShareService', function ($compile, dialogs, rulesetDataShareService) {

        var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><fieldset class="form-group input-switch input-switch-dual"><legend></legend><ul class="input-switch-items"><li class="form-check"><label class="form-check-label">Title</label></li><li class="form-check"><input type="text" class="form-control col-md-8" ng-model="info.Value.Execute.Title" value="" /></li></ul></fieldset></div></div><div class="form-row"><div class="col"><!-- Link property switch --><fieldset class="form-group input-switch"><legend>Property*</legend><ul class="input-switch-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperty" ng-click="ShowItemsDropdown()" value="Items" ng-model="info.Value.Execute.SelectedPropertyValue"><span>Items</span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperty" ng-click="ShowSpellsDropdown()" value="Spells" ng-model="info.Value.Execute.SelectedPropertyValue"><span>Spells</span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperty" ng-click="ShowAbilitiesDropdown()" value="Abilities" ng-model="info.Value.Execute.SelectedPropertyValue"><span>Abilities</span></label></li></ul></fieldset><fieldset class="form-group input-list input-list-wrap properties"><ul class="input-list-items"><li class="form-check" ng-show="IsItemVisible" ng-repeat="item in ExecuteTileItems"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperties" value="{{item.ItemProperties[0].Value.Text.value}}" ng-model="$parent.info.Value.Execute.SelectedProperty" ng-click="SetContentType(1)"><span><em>{{ item.ItemProperties[0].Value.Text.value }}</em><i class="icon"></i></span></label></li><li class="form-check" ng-show="IsSpellVisible" ng-repeat="spell in ExecuteTileSpells"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperties" value="{{spell.SpellProperties[0].Value.Text.value}}" ng-model="$parent.info.Value.Execute.SelectedProperty"><span><img ng-src="{{info.Value.Link.SelectedPropertyValueImage}}" alt=""><em>{{ spell.SpellProperties[0].Value.Text.value }}</em><i class="icon"></i></span></label></li><li class="form-check" ng-show="IsAbilityVisible" ng-repeat="ability in ExecuteTileAbilities"><label class="form-check-label"><input class="form-check-input" type="radio" name="newLinkProperties" value="{{ability.AbilityProperties[0].Value.Text.value}}" ng-model="$parent.info.Value.Execute.SelectedProperty"><span><img ng-src="{{info.Value.Link.SelectedPropertyValueImage}}" alt=""><em>{{ ability.AbilityProperties[0].Value.Text.value }}</em><i class="icon"></i></span></label></li></ul><p style="text-align:center;" ng-show="ShowContent">Content Not Available</p></fieldset></div></div></form>';
		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}};height: 50px"><span ng-click="EditExecuteTile()" class="text_design"><p style="color:{{info.Styles.titletextcolor}};">{{info.Value.Execute.Name}}</p></span></div><div class="text_align" style="text-align:center"> <img src="{{info.Value.Execute.SelectedPropertyValueImage}}" ng-style="newstyles()" class="img-resposive ng-pristine ng-untouched ng-valid ng-empty" ng-click="ShowAllContent()"></div>';

        //var templateUrlEdit = '<div class="row label-text-left"><div class="col-md-offset-2 col-md-8"><div class="form-group col-md-12"><label class="control-label col-md-4">Title</label><div class="col-md-8"><input type="text" class="form-control col-md-8" ng-model="info.Value.Execute.Title" value="" /></div></div><div class="form-group col-md-12"><label class="control-label col-md-4">Select Property</label><div class="col-md-8"><label class="radio-inline"><input type="radio" name="item" ng-model="info.Value.Execute.SelectedProperty" value="Items"  ng-click="ShowItemsDropdown()" />Items</label><label class="radio-inline"><input type="radio" name="item" ng-model="info.Value.Execute.SelectedProperty" value="Spells" ng-click="ShowSpellsDropdown()" />Spells</label><label class="radio-inline"><input type="radio" name="item" ng-model="info.Value.Execute.SelectedProperty" value="Abilities" ng-click="ShowAbilitiesDropdown()" />Abilities</label></div></div>' +
        //    '<div class="form-group col-md-12"><label class="control-label col-md-4">Select Property Value</label><div ng-show="IsItemVisible" class="col-md-8"><select class="form-control col-md-8" ng-options="item for item in Items" ng-model="info.Value.Execute.SelectedPropertyValue"><option value="">--Select Items--</option></select></div><div ng-show="IsSpellVisible" class="col-md-8"><select class="form-control col-md-5" ng-options="spell for spell in spells" ng-model="info.Value.Execute.SelectedPropertyValue"><option value="">--Select Spells--</option></select></div><div ng-show="IsAbilityVisible" class="col-md-8"><select class="form-control col-md-5" ng-options="ability for ability in Abilities" ng-model="info.Value.Execute.SelectedPropertyValue"><option value="">--Select Abilities--</option></select></div></div></div></div></div>';
        //var templateUrlUse = '<div class="NoteTile"> <span ng-click="EditExecuteTile()"><i class="fa fa-edit"></i></span><span class="text_design"><p>{{info.Value.Execute.Title}}</p></span></div><div class="text_align" style="text-align:center"> <img ng-src="{{info.Value.Execute.SelectedPropertyValue}}" ng-style="newstyles()" class="img-resposive ng-pristine ng-untouched ng-valid ng-empty" ng-click="ShowAllContent()"></div>';

        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            var items = angular.copy(scope.info);

            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);
            scope.IsItemVisible = true;
            scope.IsSpellVisible = false;
            scope.IsAbilityVisible = false;
            scope.ExecuteTileItems = [];
            scope.ExecuteTileSpells = [];
            scope.ExecuteTileAbilities = [];
            // scope.fullscope = rulesetDataShareService.getRulesetData();
            //if (angular.equals({}, rulesetDataShareService.getRulesetData()) == false) {
            //    scope.ContentfullScope = rulesetDataShareService.getRulesetData();
            //}
            if (angular.isUndefined(scope.fullscope) == false) {
                if (scope.fullscope.Items != null) {
                    for (var i = 0; i < scope.fullscope.Items.length; i++) {
                        scope.ExecuteTileItems.push(scope.fullscope.Items[i]);
                    }
                }
                if (scope.fullscope.Spells != null) {
                    for (var i = 0; i < scope.fullscope.Spells.length; i++) {
                        scope.ExecuteTileSpells.push(scope.fullscope.Spells[i]);
                    }
                }
                if (scope.fullscope.Abilities != null) {
                    for (var i = 0; i < scope.fullscope.Abilities.length; i++) {
                        scope.ExecuteTileAbilities.push(scope.fullscope.Abilities[i]);
                    }
                }
            }
            //else {
            //    if (scope.ContentfullScope.Items != null) {
            //        for (var i = 0; i < scope.ContentfullScope.Items.length; i++) {
            //            scope.ExecuteTileItems.push(scope.ContentfullScope.Items[i]);
            //        }
            //    }
            //    if (scope.ContentfullScope.Spells != null) {
            //        for (var i = 0; i < scope.ContentfullScope.Spells.length; i++) {
            //            scope.ExecuteTileSpells.push(scope.ContentfullScope.Spells[i]);
            //        }
            //    }
            //    if (scope.ContentfullScope.Abilities != null) {
            //        for (var i = 0; i < scope.ContentfullScope.Abilities.length; i++) {
            //            scope.ExecuteTileAbilities.push(scope.ContentfullScope.Abilities[i]);
            //        }
            //    }
            //}
            //if (items.Mode == "Edit") {
                if (items.Value.Execute.SelectedPropertyValue == "Items") {
                    scope.IsItemVisible = true;
                    scope.IsSpellVisible = false;
                    scope.IsAbilityVisible = false;
                }
                if (items.Value.Execute.SelectedPropertyValue == "Spells") {
                    scope.IsItemVisible = false;
                    scope.IsSpellVisible = true;
                    scope.IsAbilityVisible = false;
                }
                if (items.Value.Execute.SelectedPropertyValue == "Abilities") {
                    scope.IsItemVisible = false;
                    scope.IsSpellVisible = false;
                    scope.IsAbilityVisible = true;
                }
            //}
                scope.ShowItemsDropdown = function () {
                    scope.IsItemVisible = true;
                    scope.IsSpellVisible = false;
                    scope.IsAbilityVisible = false;
                    if (scope.LinkTileItems.length <= 0) {
                        scope.ShowContent = true;
                    }
                }
                scope.ShowSpellsDropdown = function () {
                    scope.IsItemVisible = false;
                    scope.IsSpellVisible = true;
                    scope.IsAbilityVisible = false;
                    if (scope.LinkTileSpells.length <= 0) {
                        scope.ShowContent = true;
                    }
                }
                scope.ShowAbilitiesDropdown = function () {
                    scope.IsItemVisible = false;
                    scope.IsSpellVisible = false;
                    scope.IsAbilityVisible = true;
                    if (scope.LinkTileAbilities.length <= 0) {
                        scope.ShowContent = true;
                    }
                }
            scope.newstyles = function () {

                return {
                    'background-size': '100% 100%',
                    'background-repeat': 'no-repeat',
                    'width': '120px',
                    'height': '120px'
                }

                //return {
                //    'background-color': 'transparent'
                //}

            };
            //scope.Items = [];
            //scope.spells = [];
            //scope.Abilities = [];
            //for (var i = 0; i < items.ExecuteTileProperties.Items.length; i++) {
            //    scope.Items.push(items.ExecuteTileProperties.Items[i].ItemProperties[0].Value.Text.value)
            //}
            //for (var i = 0; i < items.ExecuteTileProperties.Spells.length; i++) {
            //    scope.spells.push(items.ExecuteTileProperties.Spells[i].SpellProperties[0].Value.Text.value)
            //}
            //for (var i = 0; i < items.ExecuteTileProperties.Abilities.length; i++) {
            //    scope.Abilities.push(items.ExecuteTileProperties.Abilities[i].AbilityProperties[0].Value.Text.value)
            //}
            scope.ShowAllContent = function () {
                var IsItem = false; var IsSpell = false; var IsAbility = false;
                if (scope.info.Value.Execute.SelectedPropertyValue == "Items") {
                    for (var i = 0; i < scope.ExecuteTileItems.length; i++) {
                        var data = scope.ExecuteTileItems[i];
                        if (scope.info.Value.Execute.SelectedProperty == data.ItemProperties[0].Value.Text.value) {
                            IsItem = true;
                        }
                    }
                }
                else if (scope.info.Value.Execute.SelectedPropertyValue == "Spells") {
                    for (var i = 0; i < scope.ExecuteTileSpells.length; i++) {
                        var data = scope.ExecuteTileSpells[i];
                        if (scope.info.Value.Execute.SelectedProperty == data.SpellProperties[0].Value.Text.value) {
                            IsSpell = true;
                        }
                    }
                }
                else if (scope.info.Value.Execute.SelectedPropertyValue == "Abilities") {
                    for (var i = 0; i < scope.ExecuteTileAbilities.length; i++) {
                        var data = scope.ExecuteTileAbilities[i];
                        if (scope.info.Value.Execute.SelectedProperty == data.AbilityProperties[0].Value.Text.value) {
                            IsAbility = true;
                        }
                    }
                }
                if (IsItem == true) {
                    var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                        { scope: scope.info.Value.Execute.Content, mode: 2 }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //scope.info = res;
                        }
                    });
                }
                else if (IsSpell == true) {
                    var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                        { scope: scope.info.Value.Execute.Content, mode: 2 }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //scope.info = res;
                        }
                    });
                }
                else if (IsAbility == true) {
                    var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                        { scope: scope.info.Value.Execute.Content, mode: 2 }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //scope.info = res;
                        }
                    });
                }
            }
            scope.EditExecuteTile = function () {
                //scope.info.Mode = "Edit";
                //scope.FullScope = scope.fullscope;
                //scope.info.Value.Execute.SelectedPropertyValue = scope.info.Value.Execute.SelectedPropertyValue;
                var dlg = dialogs.create('/views/dialogs/tile-editor-5.html', 'NoteTile',
                    { scope: scope.info, fullscope: scope.fullscope }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        scope.info = res;
                    }
                });
            }
            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Execute.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                // scope.info.splice(scope.info.TileId);
                                toaster.pop('success', "Tile deleted Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }
        };

        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                fullscope: '=',
                useoredit: '='
            }
        }

    }]);

    app.directive('rpgsmithcommandtype', ['$compile', 'dialogs', 'rulesetDataShareService', function ($compile, dialogs, rulesetDataShareService) {
		var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="newCommandTitle">Title</label><input type="text" id="newCommandTitle" class="form-control" placeholder="Enter command title" ng-model="info.Value.Command.Name"></div><div class="form-group"><label for="newCommandCmd">Command</label><span class="input-group-btn"><button type="button" title="Show Dice" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary" ng-click="defaultDiceSelect()" ng-model="info.Value.Command.command"/></button></span><input type="text" id="newCommandCmd" ng-model="info.Value.Command.command" class="form-control" placeholder="Enter the command"></div><div class="form-group"><label for="colorList">Color*</label><ul id="colorList" class="input-color-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor" checked="checked"><i class="icon input-color-2"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-4"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-6"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-8"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-10"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-12"></i></label></li><li class="form-check"><label class="form-check-label"><i class="icon input-color-custom" role="button" data-dismiss="modal" data-toggle="modal" data-target="#colorSelectionPopup"></i></label></li></ul></div></div><div class="col-12 col-md-6"><div class="form-group input-image"><label for="newCommandImage">Image</label><div class="input-image-control-wrapper"><div class="form-group input-image"><label for="newImageFile"></label><div class="input-image-control-wrapper"><div class="input-image-note icon icon-upload"><span ng-model="info.Value.Command.ImagePath">Click here to upload.</span><small>(320 x 320 px)</small></div><input type="file"  class="form-control-file"  onchange="angular.element(this).scope().CommandImageUpload(this)" accept="x-png,gif,jpeg"></div></div></form>';

		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}};height: 50px"><span ng-click="EditCommandTile()" class="text_design"><p style="color:{{info.Styles.titletextcolor}};">{{info.Value.Command.Name}}</p></span></div><div class="text_align"><img src="{{info.Value.Command.ImagePath}}" ng-style="newstyles()" class="img-resposive ng-pristine ng-untouched ng-valid ng-empty" ng-click="CommandRun()"></div>';
        
        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            var items = angular.copy(scope.info);

            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);
            //scope.ValidateCommand = function ()
            //{
            //    debugger;
            //    var command = scope.info.Value.Command.Command;
            //    if (!dicenotationvalidator(command))
            //    {
            //        toaster.pop('Warning', "Invalid Command");
            //    }


            //}
            scope.CommandImageUpload = function (input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#commandImage')
                            .attr("Src", e.target.result)
                            .width(120)
                            .height(120);
                        scope.info.Value.Command.ImagePath = e.target.result;
                    };

                    reader.readAsDataURL(input.files[0]);
                }

            }
            scope.defaultDiceSelect = function () {
                var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                    { "mode": 1, scope: scope.info.Value.Command.command }
                );
                dlg.result.then(function (res) {
                    //    scope.dice = res;
                    scope.info.Value.Command.command = res;
                });
            };
            scope.newstyles = function () {

                return {
                    'background-size': '100% 100%',
                    'background-repeat': 'no-repeat',
                    'width': '120px',
                    'height': '120px'
                }

                //return {
                //    'background-color': 'transparent'
                //}

            };
            scope.CommandRun = function () {
                var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                    { scope: scope.info, mode: 2 }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        //  scope.info = res;
                    }
                });

            }
            scope.EditCommandTile = function () {
                var dlg = dialogs.create('/views/dialogs/tile-editor-6.html', 'NoteTile',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        scope.info = res;
                    }
                });
            }
            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Command.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                toaster.pop('success', "Tile deleted Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }
        };

        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                useoredit: '='
            }
        }

    }]);

    app.directive('rpgsmithimagetype', ['$compile', 'dialogs', 'rulesetDataShareService', function ($compile, dialogs, rulesetDataShareService) {
        //var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="newImageTitle">Title</label><input type="text" id="newImageTitle" class="form-control" placeholder="Enter image title" ng-model="info.Value.Imagetile.Name"></div><div class="form-group"><label for="newImageDescription">Description</label><input type="text" id="newImageDescription" class="form-control" placeholder="Enter image description"></div></div><div class="col-12 col-md-6"><div class="form-group input-image"><label for="newCommandImage">Image</label><div class="input-image-control-wrapper"><div class="form-group input-image"><label for="newImageFile"></label><div class="input-image-control-wrapper"><div class="input-image-note icon icon-upload"><span ng-model="info.Value.Imagetile.Imagepath">Click here to upload.</span><small>(320 x 320 px)</small></div><input type="file"  class="form-control-file"  onchange="angular.element(this).scope().CommandImageUpload(this)" accept="x-png,gif,jpeg"></div></div></form>'
		var templateUrlEdit = '<form><div class="form-row"><div class="col-12 col-md-6"><div class="form-group"><label for="newImageTitle">Title</label><input type="text" id="newImageTitle" class="form-control" placeholder="Enter image title" ng-model="info.Value.Imagetile.Name"></div><div class="form-group"><label for="newImageDescription">Description</label><textarea class="form-control" rows="10" ng-model = "info.Value.Imagetile.Description" id="newImageDescription" class="form-control" placeholder="Enter image description"></textarea></div><div class="form-group"><label for="colorList">Color*</label><ul id="colorList" class="input-color-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor" checked="checked"><i class="icon input-color-2"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-4"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-6"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-8"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-10"></i></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" name="newNoteTileColor"><i class="icon input-color-12"></i></label></li><li class="form-check"><label class="form-check-label"><i class="icon input-color-custom" role="button" data-dismiss="modal" data-toggle="modal" data-target="#colorSelectionPopup"></i></label></li></ul></div></div><div class="col-12 col-md-6"><div class="form-group input-image"><label for="newCommandImage">Image</label><div class="input-image-control-wrapper"><div class="form-group input-image"><label for="newImageFile"></label><div class="input-image-control-wrapper"><div class="input-image-note icon icon-upload"><span ng-model="info.Value.Imagetile.Imagepath">Click here to upload.</span><small>(320 x 320 px)</small></div><input type="file"  class="form-control-file"  onchange="angular.element(this).scope().CommandImageUpload(this)" accept="x-png,gif,jpeg"></div></div></form>'
		var templateUrlUse = '<div class="NoteTile" style="background-color: {{info.Styles.titlebackgroundcolor}}height: 50px;"><span ng-click="EditImageTile()" class="text_design"><p style="color:{{info.Styles.titletextcolor}};">{{info.Value.Imagetile.Name}}</p></span></div><div class="text_align"><img ng-src="{{info.Value.Imagetile.Imagepath}}" class="img-resposive img_center" width="120" height="120" ng-click="showImage()" /></div>';

        var getTemplate = function (useoredit) {
            var template = '';

            switch (useoredit) {
                case 1:
                    template = templateUrlEdit;
                    break;
                case 0:
                    template = templateUrlUse;
                    break;
            }

            return template;
        };

        var linker = function (scope, element, attrs) {
            var items = angular.copy(scope.info);

            element.html(getTemplate(scope.useoredit));

            $compile(element.contents())(scope);
            scope.getThumbNail = function () {
                if (scope.file)
                    return $scope.file;

                var c = scope.item;
                if (c.id && c.portrait)
                    return '/characterdata/' + c.id + '/' + c.portrait;

                return null;
            }
            scope.CommandImageUpload = function (input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#commandImage')
                            .attr("Src", e.target.result)
                            .width(120)
                            .height(120);
                        scope.info.Value.Imagetile.Imagepath = e.target.result;
                    };

                    reader.readAsDataURL(input.files[0]);
                }

            }
            scope.showImage = function () {
                var dlg = dialogs.create('/views/dialogs/Imagetilecontent.html', 'ShowAllTileContent',
                    { scope: scope.info }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        scope.info = res;
                    }
                });
            }
            scope.EditImageTile = function () {
                var dlg = dialogs.create('/views/dialogs/tile-editor-7.html', 'NoteTile',
                    { scope: scope.info, Tablist: scope.fullscope }
                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (res.Styles != null) {
                            res.Styles.backgroundColor = $("#bckcolor").val();
                        }
                        rulesetDataShareService.setTilelst(res);
                        var index = -1;
                        if (angular.isUndefined(scope.fullscope) == false) {
                            for (var i = 0; i < scope.fullscope.length; i++) {
                                if (scope.fullscope[i].TileId == res.TileId) {
                                    scope.fullscope.splice(i, 1);
                                    scope.fullscope.push(res);
                                }
                            }
                        }
                        scope.info = res;
                    }
                });
            }
            scope.RemoveTile = function () {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    "Are you sure you want to delete " + scope.info.Value.Command.Name,
                    { size: 'sm' }
                );

                dlg.result.then(
                    function (btn) {
                        tileService.deleteTile(scope.info.TileId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                toaster.pop('success', "Tile deleted Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                );
            }
        };

        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '=',
                fullscope: '=',
                useoredit: '='
            }
        }

    }]);

})();












    
(function () {
    'use strict';

    var app = angular.module('rpgsmith-directives');

    app.directive('pageslideMenu', [function () {
        return {
            restrict: 'E',
            templateUrl: '/views/shared/pageslide-menu.html',
            scope: {
                menuClick: '&?',
                menus: '='
            },
            link: function (scope, element, attrs, controller, ngModel) {
                debugger;
              
                scope.hasMenus = function (menu) {
                    return menu && angular.isArray(menu.menus);
                };

                scope.onItemClick = function (menu) {

                    if (menu.disabled)
                        return;

                    scope.menuClick()(menu);

                    if (typeof menu.action === 'function') {
                        menu.action(menu);
                    }
                };
            }
        }
    }]);


})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-directives');

    app.directive('rulesetproperty', [function ($compile) {
            return {
                restrict: 'E',
                templateUrl: '/views/shared/rulesetproperty.html',
                scope: {
                    info: '=' 
                }
        }
    }]);


})();


(function () {
    'use strict';

    var app = angular.module('rpgsmith-directives');

    app.directive('ngBindHtmlCompile', ['$timeout', '$sce', '$compile', '$interpolate', function($timeout, $sce, $compile, $interpolate) {
        return {
            restrict: 'A',
            link: function(scope, element, attr) {
                scope.$watch($sce.parseAsHtml(attr.ngBindHtmlCompile), function(value) {
                    element.html(value);
                    $compile(element.contents())(scope);
                });
            }
        };
    }]);

    app.directive('tileRender1', [function () {
        return {
            restrict: 'A',
            controller: 'tileRenderController1',
            templateUrl: '/views/tiles/tile-template-1.html',
            scope: {
                tile: '=tileRender1'
            }
        }
    }]);

    app.directive('tileRender2', [function () {
        return {
            restrict: 'A',
            controller: 'tileRenderController2',
            templateUrl: '/views/tiles/tile-template-2.html',
            scope: {
                tile: '=tileRender2'
            }
        }
    }]);

    app.directive('tileRender3', [function () {
        return {
            restrict: 'A',
            controller: 'tileRenderController3',
            templateUrl: '/views/tiles/tile-template-3.html',
            scope: {
                tile: '=tileRender2'
            }
        }
    }]);


})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-directives');


    app.directive('tilePicker', ['$document', '$timeout', '$q',
        function ($document, $timeout, $q) {
            return {
                restrict: 'A',
                scope: {
                    api: '=tilePicker'
                },
                link: function (scope, element, attrs, controller, ngModel) {

                    var _callback = null;
                    var _bodyClickCount = 0;

                    function handleKeyDown(e) {
                        var ESC_KEY = 27;
                        var key = e.keyCode || e.which;
                        if (key === ESC_KEY)
                            cleanup();
                    };

                    function handleBodyClick(e) {
                        cleanup();
                    };

                    function cleanup() {
                        if (scope.api.selecting) {

                            _callback = null;

                            $document.on('keydown', handleKeyDown);
                            $document.on('touchend click', handleBodyClick);

                            $timeout(function () {
                                scope.api.selecting = false;
                                if (typeof scope.api.onClose === 'function')
                                    scope.api.onClose();
                            });
                        }
                    };

                    scope.$on('$destroy', function () {
                        cleanup();
                    });

                    scope.api.selecting = false;

                    scope.api.beginSelect = function (callback) {

                        _callback = callback;

                        $timeout(function () {

                            if (typeof scope.api.beforeSelect === 'function')
                                scope.api.beforeSelect();

                            scope.api.selecting = true;

                            $document.on('keydown', handleKeyDown);
                            $document.on('click', handleBodyClick);
                        });
                    };

                    scope.api.endSelect = function (data) {
                        if (typeof _callback === 'function')
                            _callback(data);
                        scope.api.selecting = false;
                        if (typeof scope.api.onClose === 'function')
                            scope.api.onClose();
                    };
                }
            }
        }
    ]);

})();
(function(r) {
    'use strict';

    var module = angular.module('rpgsmith-filters');

    module.filter('counter', ['$sce', 'dataContext', function($sce, dataContext) {

        var filter = function(key) {

            var counter = (dataContext.character.counters || []).find(function(c) { return key === c.name });
            if (counter)
                return counter.displayValue;
            return '';
        }

        filter.$stateful = true;
        return filter;

    }]);

    module.filter('corestat', ['$sce', 'dataContext', function ($sce, dataContext) {

        var filter = function (key) {

            var counter = (dataContext.character.coreStats || []).find(function (c) { return key === c.code });
            if (counter)
                return counter.name;
            return '';
        }

        filter.$stateful = true;
        return filter;

    }]);

})();

(function (r) {
    'use strict';

    var module = angular.module('rpgsmith-services');

    module.factory('characterCoreStatFactory', ['dataContext', function (dataContext) {

        var CoreStat = function CoreStat() {
        };
        
        CoreStat.prototype.onPropertyChanged = function (args) {
            //if (args.propertyName === 'value' || args.propertyName === 'mask')
            //    this.displayValue = formatValue(this.mask, this.value);
        };

        //CoreStat.prototype.formatValue = function(mask, value) {
        //    return formatValue(mask, value);
        //};

        CoreStat.typeInitializer = function (tile) {
            //tile.displayValue = formatValue(tile.mask, tile.value);
        };

        var service = {
            CoreStat: CoreStat
        };

        return service;

    }]);

})();

(function (r) {
    'use strict';

    var module = angular.module('rpgsmith-services');

    module.factory('counterFactory', ['dataContext', function (dataContext) {

        var Counter = function Counter() {
        };

        var formatValue = function(mask, value) {
            return format(mask, value);
        };

        var updateValue = function (counter, value) {

            if (counter.min != null && value < counter.min)
                value = counter.min;
            if (counter.max != null && value > counter.max)
                value = counter.max;

            if (value !== counter.value) {
                counter.value = value;
                return true;
            }

            return false;
        };

        Counter.prototype.onPropertyChanged = function (args) {
            if (args.propertyName === 'value' || args.propertyName === 'mask')
                this.displayValue = formatValue(this.mask, this.value);
        };

        Counter.prototype.increment = function () {
            return updateValue(this, this.value + this.step);
        };

        Counter.prototype.decrement = function () {
            return updateValue(this, this.value - this.step);
        };

        Counter.prototype.reset = function () {
            return updateValue(this, this.defaultValue || 0);
        };

        Counter.prototype.formatValue = function(mask, value) {
            return formatValue(mask, value);
        };

        Counter.typeInitializer = function (tile) {
            tile.displayValue = formatValue(tile.mask, tile.value);
        };

        var service = {
            Counter: Counter
        };

        return service;

    }]);

})();

(function(r) {
    'use strict';

    var tileTypes = window.rpgsmith.tileTypes;
    var module = angular.module('rpgsmith-services');

    module.factory('tileFactory', ['dataContext', function(dataContext) {
        
        var Tile = function Tile() {

            function trimProblems(obj) {
                for (var p in obj) {
                    if (obj.hasOwnProperty(p)) {
                        var v = obj[p];
                        if (rpgsmith.isEmpty(v) || v === 'inherit' || v === 'initial' || v === 'transparent')
                            delete obj[p];
                    }
                }
                return obj;
            }

            this.parseStyle = function() {

                if (this.__styleComputed === null) {

                    var tmp = angular.fromJson(this.style) || {};

                    tmp = angular.extend({
                        'tile': { 'classes': null, 'styles': {} },
                        'content': { 'classes': null, 'styles': {} }
                    }, tmp);

                    trimProblems(tmp.tile.styles);
                    trimProblems(tmp.content.styles);

                    this.__styleComputed = tmp;
                }

                return this.__styleComputed;
            };

            this.updateStyle = function(value) {

                trimProblems(value.tile.styles);
                trimProblems(value.content.styles);

                this.__styleComputed = value;
                this.style = value && Object.keys(value).length ? angular.toJson(value) : null;
            };

        };

        var getEntity = function (tile) {

            if (dataContext.character) {
                switch (tile.typeId) {
                    case tileTypes.note.id:
                        return dataContext.character.notes.find(function (c) { return c.id === tile.entityId });
                    case tileTypes.counter.id:
                        return dataContext.character.counters.find(function (c) { return c.id === tile.entityId });
                }
            }

            return null;
        };

        Tile.typeInitializer = function (tile) {
            tile.__entity = null;
            tile.__styleComputed = null;
            tile.__randomShake = 'disable-rpgsmith-shake-' + Math.randomInteger(1, 10);
        };

        Tile.prototype.onPropertyChanged = function (args) {
            if (args.propertyName === 'entityId' || args.propertyName === 'typeId')
                this.__entity = getEntity(this);
        };

        Object.defineProperty(Tile.prototype, 'entity', {
            enumerable: false,
            configurable: false,
            get: function() {
                if (this.__entity == null)
                    this.__entity = getEntity(this);
                return this.__entity;
            }
        });

        var service = {
            Tile: Tile
        };

        return service;

    }]);

})();
(function () {
    'use strict';

    var module = angular.module('rpgsmith-services');

    module.factory('authInterceptor', ['$rootScope', function ($rootScope) {
        var service = {};

        service.responseError = function (response) {
            if (response.status === 401)
                $rootScope.$broadcast('httpUnauthorized');
            return response;
        };

        return service;
    }]);

    module.factory('authService', ['$http', '$q', '$state', '$localStorage',
        function ($http, $q, $state, $localStorage) {


            var authentication =
                {
                authenticated: false
                };

            var resetAuthentication = function ()
            {
                delete $localStorage.authorizationData;
                authentication.authenticated = false;
                authentication.username = null;
            }
            var service = {};
            service.authentication = authentication;
            service.init = function ()
            {
                var data = $localStorage.authorizationData;
                if (data)
                {
                    authentication.authenticated = true;
                }
            }
            service.ExternalGoogle = function ()
            {
                var data =
                    {
                    provider: 'Google',
                    returnUrl: null
                };
                $http
                    .post('/api/Account/ExternalLogin', data)
                    .then(
                    function (result) {
                        window.location.href = result.data;
                    },
                    function (err, status) {
                        resetAuthentication();
                        deferred.reject(err);
                    });

            }
            service.GetServiceUrl = function ()
            {
                var LocationUrl = '';
                $http
                    .get('http://localhost:61492/api/Account/ExternalLogins?returnUrl=%2F&generateState=true')
                    .then(
                    function (result) {
                        LocationUrl = result.ExternalLoginViewModel.Url;
                        return LocationUrl;
                    });


                $http({
                    url: "http://localhost:61492/api/Account/ExternalLogins?returnUrl=%2F&generateState=true",
                    method: "GET",
                    contentType: "application/xml",
                }).then(function (response, status) {
                    var result123 = response;
                });


                $(document).ready(function () {

                    $.ajax({
                        type: "GET",
                        url: "http://localhost:61492/api/Account/ExternalLogins?returnUrl=%2F&generateState=true",
                        dataType: "xml",
                        success: function (xml) {
                            var data123 = xml;
                        },
                        error: function (err) {
                            alert("An error occurred while processing XML file.");
                        }
                    });
                });

            }

            service.logout = function () {
                return $http.post("/api/Account/LogOff");

            }

            service.login = function (username, password, remember)
            {
                var data = {
                    Email: username,
                    Password: password,
                    RememberMe: remember
                };

                var deferred = $q.defer();
                $http
                    .post('/api/Account/Login', data)
                    .then(
                    function (result) {

                        resetAuthentication();

                        $localStorage.authorizationData = {
                        };

                        authentication.authenticated = true;
                        deferred.resolve(result);
                    },
                    function (err, status) {
                        resetAuthentication();
                        deferred.reject(err);
                    });

                return deferred.promise;
            };


            service.Exlogin = function () {
                var deferred = $q.defer();
                resetAuthentication();
                $localStorage.authorizationData = {
                };
                authentication.authenticated = true;
            };


            service.register = function (username, email, password, confirmPassword, profileimage) {

                var data = {
                    username: username,
                    Email: email,
                    Password: password,
                    ConfirmPassword: confirmPassword,
                    ProfileImage: profileimage
                };

                var deferred = $q.defer();

                $http
                    .post('/api/Account/Register', data)
                    .then(
                    function (result) {

                        resetAuthentication();

                        $localStorage.authorizationData = {
                        };

                        authentication.authenticated = true;
                        deferred.resolve(result);
                    },
                    function (err, status) {
                        resetAuthentication();
                        deferred.reject(err);
                    });

                return deferred.promise;
            }
            service.updateprofile = function (profile) {
                return $http.post("/api/Profile/UpdateProfile", profile);
            }
            service.Resetpassword = function (resetpass) {
                return $http.post("/api/Profile/ResetPassword", resetpass);
            }
            service.ForgotPassword = function (email) {
                var data = {
					Email: email,
               };
                return $http.post("/api/Account/ForgotPassword", data);
            }
            

            return service;

        }]);

})();
(function () {

    'use strict';

    var module = angular.module('rpgsmith-services');

    module.factory('characterService', ['$http',

        function ($http) {

            var _controller = "/api/Character";

            function Service() {
            };

            var service = new Service();

            service.GetCharacters = function () {
                return $http.get(_controller + "/Get");
            }
            service.GetHeaderContentsCounts = function () {
                return $http.get(_controller + "/GetHeaderContentsCounts");
            }
            
            service.saveCharacter = function (character) {
                return $http.post(_controller + "/Create", character);
            }
            service.CopyCharacter = function (character) {
                return $http.post(_controller + "/Copy", character);
            }
            service.EditCharacter = function (character) {
                return $http.post(_controller + "/Edit", character);
            }
            service.Deletecharacter = function (UserID) {
                return $http.post(_controller + "/DeleteCharacter/?UserID=" + UserID);
            }
            service.GetCorestats = function (CharacterId) {
                return $http.post(_controller + "/GetCorestatsByCharacter/?CharacterId=" + CharacterId);
            }
            service.AddCorestatValues = function (corestatvalues) {
                var _characterViewModel = JSON.stringify(corestatvalues);
                return $http.post(_controller + "/CreateCorestatsValues", _characterViewModel);
            }
            service.GetLayouts = function (CharacterId) {
                return $http.get("/api/Layout/Get/?CharacterProfileId=" + CharacterId);
            }
            service.GetNewCharacterInventory = function () {
                return $http.get(_controller + "/GetNewCharacterInventory");
            }
            service.CreateCharacterInventoryItems = function (_characterInventoryItems) {
                return $http.post(_controller + "/CreateCharacterInventoryItems", _characterInventoryItems);
            }
            service.CreateCharacterInventorySpells = function (_characterInventorySpells) {
                return $http.post(_controller + "/CreateCharacterInventorySpells", _characterInventorySpells);
            }
            service.CreateCharacterInventoryAbility = function (_characterInventoryAbility) {
                return $http.post(_controller + "/CreateCharacterInventoryAbility", _characterInventoryAbility);
            }
            service.GetCharacterContent = function (CharacterId) {
                return $http.get(_controller + "/GetCharacterInventoryByCharacterProfileId/?CharacterProfileId=" + CharacterId);
            }
            service.EditCharacterContent = function (charactercontentvalues) {
                return $http.post(_controller + "/EditCharacterContentValues", charactercontentvalues);
            }
            service.CopyCharacterContent = function (_characterContent) {
                return $http.post(_controller + "/CopyCharacterContentValues", _characterContent);
            }
            service.DeleteCharacterContent = function (CharacterItemId) {
                return $http.post(_controller + "/DeleteCharacterContentValues/?CharacterItemId=" + CharacterItemId);
            }
            service.DeleteCharacterSpellContent = function (CharacterSpellId) {
                return $http.post(_controller + "/DeleteCharacterSpellContentValues/?CharacterSpellId=" + CharacterSpellId);
            }
            service.DeleteCharacterAbilityContent = function (CharacterAbilityId) {
                return $http.post(_controller + "/DeleteCharacterAbilityContentValues/?CharacterAbilityId=" + CharacterAbilityId);
            }
            service.UpdateItemEquipContent = function (CharacterItemsValues) {
                return $http.post(_controller + "/UpdateItemEquipContent", CharacterItemsValues);
            }
            service.UpdateSpellMemorizeContent = function (CharacterSpellValues) {
                return $http.post(_controller + "/UpdateSpellMemorizeContent", CharacterSpellValues);
            }
            service.UpdateAbilityEnabledContent = function (_CharacterabilityValues) {
                return $http.post(_controller + "/UpdateAbilityEnabledContent", _CharacterabilityValues);
            }
            service.GetCharacterItemContent = function (CharacterId) {
                return $http.get(_controller + "/GetCharacterItemInventoryByCharacterProfileId/?CharacterProfileId=" + CharacterId);
            }
            service.GetCharacterSpellContent = function (CharacterId) {
                return $http.get(_controller + "/GetCharacterSpellInventoryByCharacterProfileId/?CharacterProfileId=" + CharacterId);
            }
            service.GetCharacterAbilityContent = function (CharacterId) {
                return $http.get(_controller + "/GetCharacterAbilityInventoryByCharacterProfileId/?CharacterProfileId=" + CharacterId);
            }
            service.CreateItemInventorytile = function (charactercontentvalues) {
                return $http.post(_controller + "/CreateCharacterInventoryItemTiles", charactercontentvalues);
            }
            service.CreateSpellInventorytile = function (charactercontentvalues) {
                return $http.post(_controller + "/CreateCharacterInventorySpellTiles", charactercontentvalues);
            }
            service.CreateAbilityInventorytile = function (charactercontentvalues) {
                return $http.post(_controller + "/CreateCharacterInventoryAbilityTiles", charactercontentvalues);
            }

            service.uploadFileToUrl = function(characterProfileId, file, fileName) {
                var fd = new FormData();
                fd.append('filedata', file);
                fd.append('characterProfileId', characterProfileId);
                fd.append('filename', fileName);

                return $http.post('/api/CharecterRuleSetImportExport/Import', fd, {
                    transformRequest: angular.identity,
                    headers: { 'Content-Type': undefined }
                });

            }


            return service;
        }
    ]);

})();
(function () {
    'use strict';

    var module = angular.module('rpgsmith-services');
    
    module.factory('dataContext', [function () {

        var service = {
            profile: null,
            character: null,
            layout: null
        };

        return service;

    }]);

})();
(function () {

    'use strict';

    var module = angular.module('rpgsmith-services');


    //module.factory("user", function () {
    //    return {};
    //});

    module.factory('rulesetDataShareService', [
        function () {
            var loginData = {}
            var rulesetData = {}

            var characterlayoutsData = {}

            var layoutData = {}

            var layoutItemInventoryData = {}

            var layoutSpellInventoryData = {}

            var layoutAbilityInventoryData = {}
                
            var layoutRuleSetItemInventoryData = {}

            var layoutRuleSetSpellInventoryData = {}

            var layoutRuleSetAbilityInventoryData = {}


            var rulesetItems = {}
            var rulesetSpells = {}
            var rulesetAbilities = {}
            var savedruleset = {}
            var savedcorestat = {}
            var savedlayout = {}
            var newtile = {}
            var layoutRuleSetCorestats = {}
            var characteritems = {}
            var selectedrulesetitems = {}
            var Inventorymetadata = {}
            var ItemProperties = {}
            var TileStyles = {}
            var Tilelst = []
            var Rulesetcontent = {}
            var Rulesetspellcontent = {};
            var ItemInventoryMetadata = {};
            var SpellInventoryMetadata = {};
            var AbilityInventoryMetadata = {};
            var rulesetsdata = {};
            var rpgtypes = {};
            var CharacterRulesetCount = {};
            var ImageDataandName = {};
            var LinkTiledata = {};
            function setloginData(data) {
                loginData = data;
            }
            function getloginData() {
                return loginData;
            }
            function setRulesetData(data)
            {
                rulesetData = data;
            }
            function getRulesetData()
            {
                return rulesetData;
            }

            function setCharacterLayoutsData(data)
            {
                characterlayoutsData = data;
            }

            function getCharacterLayoutsData() {
                return characterlayoutsData;
            }

            function setLayoutData(data) {
                layoutData = data;
            }

            function getLayoutData() {
                return layoutData;
            }

            function setLayoutItemInventoryData(data) {
                layoutItemInventoryData = data;
            }

            function getLayoutItemInventoryData(data) {
                return layoutItemInventoryData;
            }

            function setLayoutSpellInventoryData(data) {
                layoutSpellInventoryData = data;
            }

            function getLayoutSpellInventoryData(data) {
                return layoutSpellInventoryData;
            }

            function setLayoutAbilityInventoryData(data) {
                layoutAbilityInventoryData = data;
            }

            function getLayoutAbilityInventoryData(data) {
                return layoutAbilityInventoryData;
            }

            //

            function setLayoutRulesetItemInventoryData(data) {
                layoutRuleSetItemInventoryData = data;
            }

            function getLayoutRulesetItemInventoryData(data) {
                return layoutRuleSetItemInventoryData;
            }

            function setLayoutRulesetSpellInventoryData(data) {
                layoutRuleSetSpellInventoryData = data;
            }

            function getLayoutRulesetSpellInventoryData(data) {
                return layoutRuleSetSpellInventoryData;
            }

            function setLayoutRulesetAbilityInventoryData(data) {
                layoutRuleSetAbilityInventoryData = data;
            }

            function getLayoutRulesetAbilityInventoryData(data) {
                return layoutRuleSetAbilityInventoryData;
            }
            function setLayoutItemInventoryMetaData(data) {
                ItemInventoryMetadata = data;
            }

            function getLayoutItemInventoryMetaData(data) {
                return ItemInventoryMetadata;
            } 

            function setLayoutSpellInventoryMetaData(data) {
                SpellInventoryMetadata = data;
            }

            function getLayoutSpellInventoryMetaData(data) {
                return SpellInventoryMetadata;
            }

            function setLayoutAbilityInventoryMetaData(data) {
                AbilityInventoryMetadata = data;
            }

            function getLayoutAbilityInventoryMetaData(data) {
                return AbilityInventoryMetadata;
            }
            function setLinkTileData(data) {
                LinkTiledata = data;
            }

            function getLinkTileData(data) {
                return LinkTiledata;
            }
            function setRulesetsData(data) {
                rulesetsdata = data;
            }

            function getRulesetsData(data) {
                return rulesetsdata;
            }
            function setRpgtypeData(data) {
                rpgtypes = data;
            }

            function getRpgtypeData(data) {
                return rpgtypes;
            }
            //

            function setTilelst(data) {
                Tilelst.push(data);
                localStorage.setItem("Tilelst", JSON.stringify(Tilelst));
            }

            function getTilelst() {
                return Tilelst;
            }

            function setTileStyles(data) {
                TileStyles = data;
            }
            function getTileStyles() {
                return TileStyles;
            }
            function setRulesetItems(data) {
                rulesetItems = data;
            }
            function getRulesetItems() {
                return rulesetItems;
            }
            function setRulesetSpells(data) {
                rulesetSpells = data;
            }
            function getRulesetSpells() {
                return rulesetSpells;
            }
            function setRulesetAbilities(data) {
                rulesetAbilities = data;
            }
            function getRulesetAbilities() {
                return rulesetAbilities;
            }
            function setruleset(data) {
                savedruleset = data;
            }
            function getruleset() {
                return savedruleset;
            }
            function setcorestat(data) {
                savedcorestat = data;
            }
            function getcorestat() {
                return savedcorestat;
            }
            function setcorestatvalue(data) {
                layoutRuleSetCorestats = data;
            }
            function getcorestatvalue() {
                return layoutRuleSetCorestats;
            }

            function setlayoutmetadata(data) {
                savedlayout = data;
            }
            function getlayoutmetadata() {
                return savedlayout;
            }

            function setnewlayout(data) {
                newtile = data;
            }
            function getnewlayout() {
                return newtile;
            }
            function setcharacterRulesetitems(data) {
                characteritems = data;
            }
            function getcharacterRulesetitems() {
                return characteritems;
            }
            function setSelectedRulesetitems(data) {
                selectedrulesetitems = data;
            }
            function getSelectedRulesetitems() {
                return selectedrulesetitems;
            }
            function setInventory(data) {
                Inventorymetadata = data;
            }
            function getInventory() {
                return Inventorymetadata;
            }
            function setItemProperties(data) {
                ItemProperties = data;
            }
            function getItemProperties() {
                return ItemProperties;
            }
            function setRulesetcontent(data) {
                Rulesetcontent = data;
            }
            function getRulesetcontent() {
                return Rulesetcontent;
            }
            function setRulesetspellcontent(data) {
                Rulesetspellcontent = data;
            }
            function getRulesetspellcontent()
            {
                return Rulesetspellcontent;
            }
            function SetDisplayCharacterRulesetCount(data)
            {
                CharacterRulesetCount = data;
            }

            function getDisplayCharacterRulesetCount()
            {
                return CharacterRulesetCount;
            }

            function setImageandName(data)
            {
                ImageDataandName = data; 
            }

            function getImageandName()
            {
                return ImageDataandName;
            }

            return {
                setRulesetData: setRulesetData,
                getRulesetData: getRulesetData,

                setLayoutData: setLayoutData,
                getLayoutData: getLayoutData,
                setloginData: setloginData,
                getloginData: getloginData,
                setCharacterLayoutsData: setCharacterLayoutsData,
                getCharacterLayoutsData: getCharacterLayoutsData,

                setLayoutItemInventoryData: setLayoutItemInventoryData,
                getLayoutItemInventoryData: getLayoutItemInventoryData,

                setLayoutSpellInventoryData: setLayoutSpellInventoryData,
                getLayoutSpellInventoryData: getLayoutSpellInventoryData,

                setLayoutAbilityInventoryData: setLayoutAbilityInventoryData,
                getLayoutAbilityInventoryData: getLayoutAbilityInventoryData,

                setLayoutRulesetItemInventoryData: setLayoutRulesetItemInventoryData,
                getLayoutRulesetItemInventoryData: getLayoutRulesetItemInventoryData,

                setLayoutRulesetSpellInventoryData: setLayoutRulesetSpellInventoryData,
                getLayoutRulesetSpellInventoryData: getLayoutRulesetSpellInventoryData,

                setLayoutRulesetAbilityInventoryData: setLayoutRulesetAbilityInventoryData,
                getLayoutRulesetAbilityInventoryData: getLayoutRulesetAbilityInventoryData,

                setLayoutItemInventoryMetaData: setLayoutItemInventoryMetaData,
                getLayoutItemInventoryMetaData: getLayoutItemInventoryMetaData,

                setLayoutSpellInventoryMetaData: setLayoutSpellInventoryMetaData,
                getLayoutSpellInventoryMetaData: getLayoutSpellInventoryMetaData,

                setLayoutAbilityInventoryMetaData: setLayoutAbilityInventoryMetaData,
                getLayoutAbilityInventoryMetaData: getLayoutAbilityInventoryMetaData,

                setTilelst: setTilelst,
                getTilelst: getTilelst,
                setTileStyles: setTileStyles,
                getTileStyles: getTileStyles,
                setRulesetItems: setRulesetItems,
                getRulesetItems: getRulesetItems,
                setRulesetSpells: setRulesetSpells,
                getRulesetSpells: getRulesetSpells,
                setRulesetAbilities: setRulesetAbilities, 
                getRulesetAbilities: getRulesetAbilities,
                setruleset: setruleset,
                getruleset: getruleset,
                setcorestat: setcorestat,
                getcorestat: getcorestat,
                setcorestatvalue: setcorestatvalue,
                getcorestatvalue: getcorestatvalue,
                setlayoutmetadata: setlayoutmetadata,
                getlayoutmetadata: getlayoutmetadata,
                setnewlayout: setnewlayout,
                getnewlayout: getnewlayout,
                setcharacterRulesetitems: setcharacterRulesetitems,
                getcharacterRulesetitems: getcharacterRulesetitems,
                setSelectedRulesetitems: setSelectedRulesetitems,
                getSelectedRulesetitems: getSelectedRulesetitems,
                setInventory: setInventory,
                getInventory: getInventory,
                setItemProperties: setItemProperties,
                getItemProperties: getItemProperties,
                setRulesetcontent: setRulesetcontent,
                getRulesetcontent: getRulesetcontent,
                setRulesetspellcontent: setRulesetspellcontent,
                getRulesetspellcontent: getRulesetspellcontent,
                setLinkTileData: setLinkTileData,
                getLinkTileData: getLinkTileData,
                setRulesetsData: setRulesetsData,
                getRulesetsData: getRulesetsData,
                setRpgtypeData: setRpgtypeData,
                getRpgtypeData: getRpgtypeData,
                SetDisplayCharacterRulesetCount: SetDisplayCharacterRulesetCount,
                getDisplayCharacterRulesetCount: getDisplayCharacterRulesetCount,
                setImageandName: setImageandName,
                getImageandName: getImageandName
            }
          
        }
    ]);

})();


(function () {
    'use strict';

    var app = angular.module('rpgsmith-services');

    app.factory('layoutService', ['$http','$rootScope', '$state', '$localStorage', 'authService',
        function ($http,$rootScope, $state, $localStorage, authService) {

        var navs = {};
        var service = {};
        //var _controller = "/Layout";
        var _controller = "/api/Layout";
        service.topNav = {};

        service.create = function (LayoutViewModel) {
            return $http.post(_controller + "/Create", LayoutViewModel);
        }
        service.update = function (LayoutViewModel) {
            return $http.post(_controller + "/Update", LayoutViewModel);
        }
        service.copyLayout = function (LayoutViewModel) {
            return $http.post(_controller + "/Copy", LayoutViewModel);
        }
        
        service.GetNewLayout = function () {
            return $http.get(_controller + "/GetNewLayout");
        }
        service.loadLayout = function (ID) {
            var LayoutId = { 'LayoutId': ID };
            return $http.post(_controller + "/GetLayouByLayoutId", LayoutId);
        }
        service.GetDice = function (characterId) {
            return $http.get(_controller + "/GetDiceList/?characterProfileId=" + characterId);
        }
        service.SaveDice = function (DiceModel) {
            return $http.post(_controller + "/SaveVirtualDice", DiceModel);
        }
        service.deleteLayout = function (deleteLayout) {
            //var LayoutId = { 'LayoutId': ID };
            return $http.post(_controller + "/DeleteLayout", deleteLayout);
        }
        service.GetDefaultDice = function(characterId) {
            return $http.get(_controller + "/GetDefaultDiceByCharacter/?CharacterProfileID=" + characterId);
        }
        service.GetCharacterLayouts = function (CharacterId) {
            return $http.get("/api/Layout/Get/?CharacterProfileId=" + CharacterId);
        }
        //service.InsertNewTab = function (TabViewModel) {
        //    return $http.post('/Tab/MarketExpenseTypeInsert', TabViewModel);
        //}

        return service;
    }]);    

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-services');

    app.factory('navService', ['$rootScope', '$state', '$localStorage', 'authService', 'rulesetDataShareService',
        function ($rootScope, $state, $localStorage, authService, rulesetDataShareService) {

        var navs = {};
        var service = {};

        service.topNav = {};

        var getNavKey = function (id) {
            return $state.current.url + '/' + id;
        };

        service.setLastCharacterId = function (characterId) {
            $localStorage.lastCharacterId = characterId;
        };

        service.setLastLayoutId = function (characterId, layoutId) {

            var layoutsAll = $localStorage.lastLayouts || {};
            var layouts = layoutsAll[characterId] || [];

            var layout = layouts.find(function (c) { return c.layoutId === layoutId });
            if (layout) {
                layout.dt = Date.now();
            }
            else {
                layouts.push({
                    layoutId: layoutId,
                    pageId: null
                });
            }

            layoutsAll[characterId] = layouts;
            $localStorage.lastLayouts = layoutsAll;
        };

        service.setLastTabId = function (characterId, layoutId, pageId) {

            var layoutsAll = $localStorage.lastLayouts || {};
            var layouts = layoutsAll[characterId] || [];

            var layout = layouts.find(function (c) { return c.layoutId === layoutId });

            if (layout) {
                layout.dt = Date.now();
                layout.pageId = pageId;
            }
            else {
                layouts.push({
                    dt: Date.now(),
                    layoutId: layoutId,
                    pageId: pageId
                });
            }

            layoutsAll[characterId] = layouts;
            $localStorage.lastLayouts = layoutsAll;
        };

        service.getLastCharacterId = function () {
            return $localStorage.lastCharacterId;
        };

        service.getLastLayoutId = function (character) {
            var layout = service.getLastLayout(character);
            if (layout)
                return layout.layoutId;
            return null;
        };

        service.getLastPageId = function (character, layout) {

            if ($localStorage.lastLayouts) {

                if (layout.tabs && layout.tabs.length) {

                    var lastLayouts = ($localStorage.lastLayouts[character.id] || []);
                    var lastLayout = lastLayouts.find(function (c) { return c.layoutId === layout.id });

                    if (lastLayout) {
                        // Ensure this is a valid id
                        var tab = layout.tabs.find(function (c) { return c.id === lastLayout.pageId; });
                        if (tab)
                            return tab.id;
                    }

                    // We didn't find any (or any valid), so return the first one
                    return layout.tabs[0].id;
                }
            }

            return null;
        };

        service.getLastLayout = function (character) {

            if ($localStorage.lastLayouts) {

                var lastLayouts = ($localStorage.lastLayouts[character.id] || []);

                if (lastLayouts.length) {

                    if (character.layouts && character.layouts.length) {

                        var sorted = lastLayouts.sort(function (a, b) { return b.dt - a.dt });
                        var found = null;

                        while (sorted.length) {

                            var layout = character.layouts.find(function (c) { return c.id === sorted[0].layoutId; });
                            if (layout) {
                                found = sorted[0];
                                break;
                            }

                            sorted.shift();
                        }

                        $localStorage.lastLayouts[character.id] = sorted;
                        return found;

                    }
                    else {
                        // We don't have any layouts, clean house
                        $localStorage.lastLayouts[character.id] = [];
                    }
                }
            }

            return null;
        };
		service.gotoRegisterSuccess = function (replace) {
			return $state.go('RegisterSuccess',
				null,
				{ location: 'replace' }
			);
		};
        service.gotoCharacters = function (replace) {
            return $state.go('profile.characters',
                null,
                { location: 'replace' }
            );
        };
        service.NewRuleSet = function () {
            return $state.go('profile.NewRuleSet',
             
                { location: 'replace' }
            );
        };
        service.ExistingRuleSet = function () {
            return $state.go('profile.ExistingRuleSet',

                { location: 'replace' }
            );
        };

        service.gotoLayouts = function (characterId, replace) {
            return $state.go('profile.character.layouts',
                { characterId: characterId },
                { location: 'replace' }
            );
        };

        service.gotoLayout = function (characterId, layoutId, pageId, replace) {
            return $state.go('profile.character.layout',
                { characterId: characterId, layoutId: layoutId, pageId: pageId },
                { location: 'replace' }
            );
        };

        service.setHeader = function (value) {
            service.topNav.header = value;
        }

        service.updateBody = function (nav1, nav2) {
            var add = null, remove = null;

            if (nav2) {
                add = 'navbar-2';
                remove = 'navbar-1';
            }
            else if (nav1) {
                add = 'navbar-1';
                remove = 'navbar-2';
            }
            else {
                remove = 'navbar-1 navbar2';
            }

            $rootScope.$emit('rpgsmithSetBodyClass', { add: add, remove: remove });
        }

        service.logout = function () {
            authService.logout();
        }
        
        service.registerNav = function (id, config) {
            navs[getNavKey(id)] = config;
        };

        service.hasNav = function (id) {
           return navs.hasOwnProperty(getNavKey(id));
        };

        service.toggleNav = function (id) {
            var config = navs[getNavKey(id)];
            if (config)
                config.opened = !config.opened;
        };

        service.getCommonHamburger = function (more) {
            var common = [
                {
                    id: 'nav.profile',
                    name: 'Profile',
                    icon: 'fa-fw fa-user',
                    action: function () {
                        $state.go("profile.characters");
                    }
                },
                {
                    id: 'nav.signout',
                    name: 'Sign out',
                    icon: 'fa-fw fa-sign-out',
                    action: function () {
                        var logout = authService.logout();
                        logout.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                var savedData = {};
                                var savedspell = {};
                                var savedability = {};
                                var savedcorestat = {};
                                rulesetDataShareService.set(savedData)
                                rulesetDataShareService.setspell(savedspell)
                                rulesetDataShareService.setability(savedability)
                                rulesetDataShareService.setcorestat(savedcorestat)
                                localStorage.clear();
                                $state.go('login');
                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        alert(data.data.ErrorMessage);
                                    }
                                }
                            }
                        })
                       // service.logout();
                    }
                }
            ];
            return common.concat(more || []);
        }

        service.getCommonCharacterNav = function (more) {
            var common = [
                {
                    id: 'nav.notes',
                    name: 'Notes',
                    icon: 'fa-fw fa-sticky-note-o',
                    action: function () {
                        $state.go('profile.character.notes', { characterId: $state.params.characterId });
                    }
                },
                {
                    id: 'nav.counters',
                    name: 'Counters',
                    icon: 'fa-fw fa-percent',
                    action: function () {
                        $state.go('profile.character.counters', { characterId: $state.params.characterId });
                    }
                },
                {
                    id: 'nav.attributes',
                    name: 'Core Stats',
                    icon: 'fa-fw fa-user-circle-o',
                    action: function () {
                        $state.go('profile.character.attributes', { characterId: $state.params.characterId });
                    }
                },
                {
                    id: 'nav.links',
                    name: 'Links',
                    icon: 'fa-fw fa-user-circle-o',
                    action: function () {
                        $state.go('profile.character.links', { characterId: $state.params.characterId });
                    }
                },
                {
                    id: 'nav.attributes',
                    name: 'Executes',
                    icon: 'fa-fw fa-user-circle-o',
                    action: function () {
                        $state.go('profile.character.executes', { characterId: $state.params.characterId });
                    }
                },
                {
                    id: 'nav.attributes',
                    name: 'Commands',
                    icon: 'fa-fw fa-user-circle-o',
                    action: function () {
                        $state.go('profile.character.commands', { characterId: $state.params.characterId });
                    }
                },
                {
                    id: 'nav.characters',
                    name: 'Characters',
                    icon: 'fa-fw fa-users',
                    action: function () {
                        $state.go('profile.characters');
                    }
                }
            ];
            return common.concat(more || []);
        };

        return service;
    }]);    

})();
(function () {

    'use strict';

    var module = angular.module('rpgsmith-services');

    module.factory('rulesetService', ['$http',

        function ($http) {

            var _controller = "/api/RuleSet";

            function Service() {
            };

            var service = new Service();

            service.GetRuleSets = function () {
                return $http.get(_controller + "/Get");
            }

            service.GetNewRuleset = function () {
                return $http.get(_controller + "/GetNewRuleset");
            }
            service.GetNewRulesetByRuleSetId = function (RuleSetId) {
                var response = $http({
                    method: "get",
                    url: _controller + "/GetRulesetByRuleSetId?RuleSetId=" + RuleSetId,
                    //params: {
                    //    RuleSetId: JSON.stringify(RuleSetId)
                    //}
                });
                return response;
            }
            service.saveRuleSet = function (ruleset) {

                var clientImages = [];

                var _ruleset = angular.copy(ruleset);

                for (var i = 0; i < _ruleset.Rulesetproperty.length; i++) {
                    var ruleSetProperty = _ruleset.Rulesetproperty[i];
                    if (i == 2 && ruleSetProperty.Value.Image.image != null && ruleSetProperty.Value.Image.image != "" && angular.isUndefined(ruleSetProperty.Value.Image.image) == false) {
                        // Split the base64 string in data and contentType
                        var block = ruleSetProperty.Value.Image.image.split(";");
                        // Get the content type
                        var contentType = block[0].split(":")[1];
                        // get the real base64 content of the file
                        var realData = block[1].split(",")[1];

                        // Convert to blob
                        var blob = b64toBlob(realData, contentType);
                        var splitFileExt = contentType.split('/');
                        var fileExt = splitFileExt[1];

                        var currentDate = Date.now();

                        var file = new File([blob], _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt, { type: contentType });
                        //ruleSetImage = file;
                        clientImages.push(file);

                        ruleSetProperty.Value.Image.image = _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                        break;
                    }
                }
                for (var i = 0; i < _ruleset.Items.length; i++) {
                    var item = _ruleset.Items[i];
                    for (var j = 0; j < item.ItemProperties.length; j++) {
                        if (j == 1 && item.ItemProperties[j].Value.Image.image != null && item.ItemProperties[j].Value.Image.image != "" && angular.isUndefined(item.ItemProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            var block = item.ItemProperties[j].Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                            //items.push(file);
                            clientImages.push(file);

                            item.ItemProperties[j].Value.Image.image = item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            break;
                        }
                    }

                }
                for (var i = 0; i < _ruleset.Spells.length; i++) {
                    var spell = _ruleset.Spells[i];
                    for (var j = 0; j < spell.SpellProperties.length; j++) {
                        if (j == 1 && spell.SpellProperties[j].Value.Image.image != null && spell.SpellProperties[j].Value.Image.image != "" && angular.isUndefined(spell.SpellProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            var block = spell.SpellProperties[j].Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                            //spells.push(file);
                            clientImages.push(file);

                            spell.SpellProperties[j].Value.Image.image = spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            break;
                        }
                    }
                }
                for (var i = 0; i < _ruleset.Abilities.length; i++) {
                    var ability = _ruleset.Abilities[i];
                    for (var j = 0; j < ability.AbilityProperties.length; j++) {
                        if (j == 1 && ability.AbilityProperties[j].Value.Image.image != null && ability.AbilityProperties[j].Value.Image.image != "" && angular.isUndefined(ability.AbilityProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            var block = ability.AbilityProperties[j].Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                            //abilities.push(file);
                            clientImages.push(file);

                            ability.AbilityProperties[j].Value.Image.image = ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            break;
                        }
                    }
                }
                //var itemfiles = items;
                //var spellfiles = spells;
                //var abilityfiles = abilities;
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/Create",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("ruleSetViewModel", angular.toJson(data.ruleSetViewModel));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { ruleSetViewModel: _ruleset, clientImages: clientImages }
                })
                // return $http.post(_controller + "/Create", _ruleset);
            }
            service.updateRuleSet = function (ruleset) {

                var clientImages = [];

                var _ruleset = angular.copy(ruleset);

                for (var i = 0; i < _ruleset.Rulesetproperty.length; i++) {
                    var ruleSetProperty = _ruleset.Rulesetproperty[i];
                    if (i == 2 && ruleSetProperty.Value.Image.image != null && ruleSetProperty.Value.Image.image != "" && angular.isUndefined(ruleSetProperty.Value.Image.image) == false) {
                        // Split the base64 string in data and contentType
                        if (ruleSetProperty.Value.Image.image.includes("wwwroot") == false) {
                            var block = ruleSetProperty.Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt, { type: contentType });
                            //ruleSetImage = file;
                            clientImages.push(file);

                            ruleSetProperty.Value.Image.image = _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                        }
                        break;
                    }
                }
                for (var i = 0; i < _ruleset.Items.length; i++) {
                    var item = _ruleset.Items[i];
                    for (var j = 0; j < item.ItemProperties.length; j++) {
                        if (j == 1 && item.ItemProperties[j].Value.Image.image != null && item.ItemProperties[j].Value.Image.image != "" && angular.isUndefined(item.ItemProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            if (item.ItemProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                var block = item.ItemProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //items.push(file);
                                clientImages.push(file);

                                item.ItemProperties[j].Value.Image.image = item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }

                }
                for (var i = 0; i < _ruleset.Spells.length; i++) {
                    var spell = _ruleset.Spells[i];
                    for (var j = 0; j < spell.SpellProperties.length; j++) {
                        if (j == 1 && spell.SpellProperties[j].Value.Image.image != null && spell.SpellProperties[j].Value.Image.image != "" && angular.isUndefined(spell.SpellProperties[j].Value.Image.image) == false) {
                            if (spell.SpellProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                // Split the base64 string in data and contentType
                                var block = spell.SpellProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //spells.push(file);
                                clientImages.push(file);

                                spell.SpellProperties[j].Value.Image.image = spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }
                }
                for (var i = 0; i < _ruleset.Abilities.length; i++) {
                    var ability = _ruleset.Abilities[i];
                    for (var j = 0; j < ability.AbilityProperties.length; j++) {
                        if (j == 1 && ability.AbilityProperties[j].Value.Image.image != null && ability.AbilityProperties[j].Value.Image.image != "" && angular.isUndefined(ability.AbilityProperties[j].Value.Image.image) == false) {
                            if (ability.AbilityProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                // Split the base64 string in data and contentType
                                var block = ability.AbilityProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //abilities.push(file);
                                clientImages.push(file);

                                ability.AbilityProperties[j].Value.Image.image = ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }
                }
                //var itemfiles = items;
                //var spellfiles = spells;
                //var abilityfiles = abilities;
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/Update",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("ruleSetViewModel", angular.toJson(data.ruleSetViewModel));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { ruleSetViewModel: _ruleset, clientImages: clientImages }
                })
                // return $http.post(_controller + "/Create", _ruleset);
            }
            service.copyRuleSet = function (ruleset) {
                var clientImages = [];

                var _ruleset = angular.copy(ruleset);

                for (var i = 0; i < _ruleset.Rulesetproperty.length; i++) {
                    var ruleSetProperty = _ruleset.Rulesetproperty[i];
                    if (i == 2 && ruleSetProperty.Value.Image.image != null && ruleSetProperty.Value.Image.image != "" && angular.isUndefined(ruleSetProperty.Value.Image.image) == false) {
                        // Split the base64 string in data and contentType
                        if (ruleSetProperty.Value.Image.image.includes("wwwroot") == false) {
                            var block = ruleSetProperty.Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt, { type: contentType });
                            //ruleSetImage = file;
                            clientImages.push(file);

                            ruleSetProperty.Value.Image.image = _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                        }
                        break;
                    }
                }
                for (var i = 0; i < _ruleset.Items.length; i++) {
                    var item = _ruleset.Items[i];
                    for (var j = 0; j < item.ItemProperties.length; j++) {
                        if (j == 1 && item.ItemProperties[j].Value.Image.image != null && item.ItemProperties[j].Value.Image.image != "" && angular.isUndefined(item.ItemProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            if (item.ItemProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                var block = item.ItemProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //items.push(file);
                                clientImages.push(file);

                                item.ItemProperties[j].Value.Image.image = item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }

                }
                for (var i = 0; i < _ruleset.Spells.length; i++) {
                    var spell = _ruleset.Spells[i];
                    for (var j = 0; j < spell.SpellProperties.length; j++) {
                        if (j == 1 && spell.SpellProperties[j].Value.Image.image != null && spell.SpellProperties[j].Value.Image.image != "" && angular.isUndefined(spell.SpellProperties[j].Value.Image.image) == false) {
                            if (spell.SpellProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                // Split the base64 string in data and contentType
                                var block = spell.SpellProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //spells.push(file);
                                clientImages.push(file);

                                spell.SpellProperties[j].Value.Image.image = spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }
                }
                for (var i = 0; i < _ruleset.Abilities.length; i++) {
                    var ability = _ruleset.Abilities[i];
                    for (var j = 0; j < ability.AbilityProperties.length; j++) {
                        if (j == 1 && ability.AbilityProperties[j].Value.Image.image != null && ability.AbilityProperties[j].Value.Image.image != "" && angular.isUndefined(ability.AbilityProperties[j].Value.Image.image) == false) {
                            if (ability.AbilityProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                // Split the base64 string in data and contentType
                                var block = ability.AbilityProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //abilities.push(file);
                                clientImages.push(file);

                                ability.AbilityProperties[j].Value.Image.image = ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }
                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/Copy",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("ruleSetViewModel", angular.toJson(data.ruleSetViewModel));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { ruleSetViewModel: _ruleset, clientImages: clientImages }
                })
            }
            //service.GetTypes = function () {
            //    return $http.get("/api/RPGSmithType/Get");
            //}
            service.GetTypes = function () {
                return $http.get("/api/RPGSmithType/GetRPGSmithTypeForCoreStat");
            }
            service.DeleteRuleSet = function (ID) {
                var RuleSetID = { 'RuleSetID': ID };
                //$http.post(_controller + "/Delete", RuleSetID).then(function (data, status, headers, config) {
                //    return data;
                //}, function (data, status, headers, config) {
                //    return data;
                //});
                return $http.post(_controller + "/Delete", RuleSetID);
            }
            service.GetCoreStatById = function (CoreStatID) {
                var response = $http({
                    method: "post",
                    url: _controller + "/GetCoreStatsByCoreStatId",
                    params: {
                        CoreStatID: JSON.stringify(CoreStatID)
                    }
                });
                return response;
            }
            //service.DeleteCoreStat = function (ID) {
            //    var CoreStatID = { 'CoreStatID': ID };
            //    return $http.post(_controller + "/DeleteCoreStat", CoreStatID);
            //}
            service.GetRuleSetItemsForItemInventory = function (characterId) {
                return $http.post(_controller + "/GetRuleSetItemsByCharacterProfileId?CharacterProfileId=" + characterId);
            }
            service.GetRuleSetSpellsForSpellInventory = function (characterId) {
                return $http.post(_controller + "/GetRuleSetSpellsByCharacterProfileId?CharacterProfileId=" + characterId);
            }
            service.GetRuleSetAbilitiesForAbilityInventory = function (characterId) {
                return $http.post(_controller + "/GetRuleSetAbilitiesByCharacterProfileId?CharacterProfileId=" + characterId);
            }
            //service.GetCorestats = function () {
            //    return $http.get(_controller + "/GetAllCorestats");
            //}


            service.GetRuleSetForLinkTile = function (characterId) {
                return $http.post(_controller + "/GetRuleSetByCharacterProfileId?CharacterProfileId=" + characterId);
            }
            service.ExportRuleset = function (rulesetId) {
                location.href = "/api/RuleSetImportExport/Export?RuleSetID=" + rulesetId;
            }


            var b64toBlob = function (b64Data, contentType, sliceSize) {
                contentType = contentType || '';
                sliceSize = sliceSize || 512;

                var byteCharacters = atob(b64Data);
                var byteArrays = [];

                for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                    var slice = byteCharacters.slice(offset, offset + sliceSize);

                    var byteNumbers = new Array(slice.length);
                    for (var i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }

                    var byteArray = new Uint8Array(byteNumbers);

                    byteArrays.push(byteArray);
                }

                var blob = new Blob(byteArrays, { type: contentType });
                return blob;
            };


            service.uploadFileToUrl = function (RuleSetId, file, fileName, RuleSetName) {
                var fd = new FormData();
                fd.append('filedata', file);
                fd.append('rulesetId', RuleSetId);
                fd.append('filename', fileName);
                fd.append('RuleSetName', RuleSetName);

                return $http.post('/api/RuleSetImportExport/Import', fd, {
                    transformRequest: angular.identity,
                    headers: { 'Content-Type': undefined }
                });
                //.then(function (data) {
                //    if (data.data.StatusCode == 200) {

                //    }
                //    else if (data.data.StatusCode == 400) {

                //    }
                //});
            }

            //For New Design


            service.GetAllRuleSets = function () {
                return $http.get(_controller + "/GetRulesetsByUserId");
            }
            service.CopyRulesetByRulesetId = function (RulesetId, Name) {
                return $http.post(_controller + "/CopyRulesetByRulesetId?RulesetId=" + RulesetId + "&Name=" + Name);
            }
            service.GetRuleSetGeneralSettings = function (RulesetId) {
                return $http.post(_controller + "/GetRulesetGeneralSettingsByRulesetId?RulesetId=" + RulesetId);
            }
            service.GetGeneralSettingsMetadata = function () {
                return $http.get(_controller + "/GetGeneralSettingsMetaData");
            }
            service.CreateGeneralSettings = function (_rulesetProperty) {
                var clientImages = [];

                var _ruleset = angular.copy(_rulesetProperty);

                for (var i = 0; i < _rulesetProperty.length; i++) {
                    var ruleSetProperty = _ruleset[i];
                    if (i == 2 && ruleSetProperty.Value.Image.image != null && ruleSetProperty.Value.Image.image != "" && angular.isUndefined(ruleSetProperty.Value.Image.image) == false) {
                        // Split the base64 string in data and contentType
                        var block = ruleSetProperty.Value.Image.image.split(";");
                        // Get the content type
                        var contentType = block[0].split(":")[1];
                        // get the real base64 content of the file
                        var realData = block[1].split(",")[1];

                        // Convert to blob
                        var blob = b64toBlob(realData, contentType);
                        var splitFileExt = contentType.split('/');
                        var fileExt = splitFileExt[1];

                        var currentDate = Date.now();

                        var file = new File([blob], _ruleset[0].RulesetName + "~" + currentDate + "." + fileExt, { type: contentType });
                        //ruleSetImage = file;
                        clientImages.push(file);

                        ruleSetProperty.Value.Image.image = _ruleset[0].RulesetName + "~" + currentDate + "." + fileExt;
                        break;
                    }
                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CreateRulesetGeneralSettings",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_rulesetProperty", angular.toJson(data._rulesetProperty));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _rulesetProperty: _ruleset, clientImages: clientImages }
                })
            }

            service.UpdateGeneralSettings = function (_updateGeneralSettings) {
                var clientImages = [];

                var _ruleset = angular.copy(_updateGeneralSettings);

                for (var i = 0; i < _updateGeneralSettings.length; i++) {
                    var ruleSetProperty = _ruleset[i];
                    if (i == 2 && ruleSetProperty.Value.Image.image != null && ruleSetProperty.Value.Image.image != "" && angular.isUndefined(ruleSetProperty.Value.Image.image) == false) {
                        // Split the base64 string in data and contentType
                        if (ruleSetProperty.Value.Image.image.includes("wwwroot") == false) {
                            var block = ruleSetProperty.Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt, { type: contentType });
                            //ruleSetImage = file;
                            clientImages.push(file);

                            ruleSetProperty.Value.Image.image = _ruleset.Name + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                        }
                        break;
                    }
                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/UpdateRulesetGeneralSettings",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_updateGeneralSettings", angular.toJson(data._updateGeneralSettings));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _updateGeneralSettings: _ruleset, clientImages: clientImages }
                })
            }

            service.GetRulesetCorestats = function (RulesetId) {
                return $http.post(_controller + "/GetCorestatsByRulesetId?RulesetId=" + RulesetId);
            }
            service.GetCorestatsMetadata = function () {
                return $http.get(_controller + "/GetCorestatsMetadata");
            }

            service.CreateCorestats = function (_rulesetCorestats) {
                return $http.post(_controller + "/CreateCorestats", _rulesetCorestats);
            }
            service.UpdateCorestats = function (_updateCorestats) {
                return $http.post(_controller + "/UpdateCorestats", _updateCorestats);
            }

            service.CopyCorestats = function (_copyCorestats) {
                return $http.post(_controller + "/CopyCorestats", _copyCorestats);
            }
            service.DeleteCorestats = function (deletecorestats) {
                return $http.post(_controller + "/DeleteCorestats", deletecorestats);
            }
            service.GetRulesetItems = function (RUlesetId) {
                //var response = $http({
                //    method: "get",
                //    url: _controller + "/GetRulesetItemsByRulesetId",
                //    params: {
                //        RulesetId: JSON.stringify(RulesetId)
                //    }
                //});
                //return response;
                return $http.get(_controller + "/GetRulesetItemsByRulesetId/?RUlesetId=" + RUlesetId);
            }
            service.GetItemsMetadata = function (RulesetId) {
                var response = $http({
                    method: "post",
                    url: _controller + "/GetRulesetItemsMetadata",
                    params: {
                        RulesetId: JSON.stringify(RulesetId)
                    }
                });
                return response;
                //return $http.post(_controller + "/GetRulesetItemsMetadata?RulesetId=", RulesetId);
            }
            service.CreateItems = function (_rulesetItems) {
                var clientImages = [];
                var _ruleset = angular.copy(_rulesetItems);
                for (var i = 0; i < _rulesetItems.length; i++) {
                    var item = _ruleset[i];
                    for (var j = 0; j < item.ItemProperties.length; j++) {
                        if (j == 1 && item.ItemProperties[j].Value.Image.image != null && item.ItemProperties[j].Value.Image.image != "" && angular.isUndefined(item.ItemProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            var block = item.ItemProperties[j].Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], item.ItemProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt);
                            //items.push(file);
                            clientImages.push(file);

                            item.ItemProperties[j].Value.Image.image = item.ItemProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt;
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CreateRulesetItems",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_rulesetItems", angular.toJson(data._rulesetItems));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _rulesetItems: _ruleset, clientImages: clientImages }
                })

            }

            service.UpdateItems = function (_updateItems) {
                var clientImages = [];
                var _ruleset = angular.copy(_updateItems);
                for (var i = 0; i < _updateItems.length; i++) {
                    var item = _ruleset[i];
                    for (var j = 0; j < item.ItemProperties.length; j++) {
                        if (j == 1 && item.ItemProperties[j].Value.Image.image != null && item.ItemProperties[j].Value.Image.image != "" && angular.isUndefined(item.ItemProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            if (item.ItemProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                var block = item.ItemProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //items.push(file);
                                clientImages.push(file);

                                item.ItemProperties[j].Value.Image.image = item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/UpdateRulesetItems",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_updateItems", angular.toJson(data._updateItems));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _updateItems: _ruleset, clientImages: clientImages }
                })
            }

            service.CopyItems = function (_copyItems) {
                var clientImages = [];
                var _ruleset = angular.copy(_copyItems);
                for (var i = 0; i < _copyItems.length; i++) {
                    var item = _ruleset[i];
                    for (var j = 0; j < item.ItemProperties.length; j++) {
                        if (j == 1 && item.ItemProperties[j].Value.Image.image != null && item.ItemProperties[j].Value.Image.image != "" && angular.isUndefined(item.ItemProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            if (item.ItemProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                var block = item.ItemProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //items.push(file);
                                clientImages.push(file);

                                item.ItemProperties[j].Value.Image.image = item.ItemProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CopyRulesetItems",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_copyItems", angular.toJson(data._copyItems));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _copyItems: _ruleset, clientImages: clientImages }
                })
            }
            service.DeleteItems = function (deleteitem) {
                return $http.post(_controller + "/DeleteItem", deleteitem);
            }
            service.GetRulesetSpells = function (RUlesetId) {
                //var response = $http({
                //    method: "get",
                //    url: _controller + "/GetRulesetItemsByRulesetId",
                //    params: {
                //        RulesetId: JSON.stringify(RulesetId)
                //    }
                //});
                //return response;
                return $http.get(_controller + "/GetRulesetSpellsByRulesetId/?RUlesetId=" + RUlesetId);
            }

            service.GetSpellsMetadata = function (RulesetId) {
                var response = $http({
                    method: "post",
                    url: _controller + "/GetRulesetSpellsMetadata",
                    params: {
                        RulesetId: JSON.stringify(RulesetId)
                    }
                });
                return response;
                //return $http.post(_controller + "/GetRulesetItemsMetadata?RulesetId=", RulesetId);
            }



            service.CreateSpells = function (_rulesetSpells) {
                var clientImages = [];
                var _ruleset = angular.copy(_rulesetSpells);
                for (var i = 0; i < _rulesetSpells.length; i++) {
                    var spell = _ruleset[i];
                    for (var j = 0; j < spell.SpellProperties.length; j++) {
                        if (j == 1 && spell.SpellProperties[j].Value.Image.image != null && spell.SpellProperties[j].Value.Image.image != "" && angular.isUndefined(spell.SpellProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            var block = spell.SpellProperties[j].Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], spell.SpellProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt);
                            //items.push(file);
                            clientImages.push(file);

                            spell.SpellProperties[j].Value.Image.image = spell.SpellProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt;
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CreateRulesetSpells",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_rulesetSpells", angular.toJson(data._rulesetSpells));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _rulesetSpells: _ruleset, clientImages: clientImages }
                })

            }

            service.UpdateSpells = function (_updateSpells) {
                var clientImages = [];
                var _ruleset = angular.copy(_updateSpells);
                for (var i = 0; i < _updateSpells.length; i++) {
                    var spell = _ruleset[i];
                    for (var j = 0; j < spell.SpellProperties.length; j++) {
                        if (j == 1 && spell.SpellProperties[j].Value.Image.image != null && spell.SpellProperties[j].Value.Image.image != "" && angular.isUndefined(spell.SpellProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            if (spell.SpellProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                var block = spell.SpellProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], spell.SpellProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt);
                                //items.push(file);
                                clientImages.push(file);

                                spell.SpellProperties[j].Value.Image.image = spell.SpellProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/UpdateRulesetSpells",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_updateSpells", angular.toJson(data._updateSpells));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _updateSpells: _ruleset, clientImages: clientImages }
                })
            }

            service.CopySpells = function (_copySpells) {
                var clientImages = [];
                var _ruleset = angular.copy(_copySpells);
                for (var i = 0; i < _copySpells.length; i++) {
                    var spell = _copySpells[i];
                    for (var j = 0; j < spell.SpellProperties.length; j++) {
                        if (j == 1 && spell.SpellProperties[j].Value.Image.image != null && spell.SpellProperties[j].Value.Image.image != "" && angular.isUndefined(spell.SpellProperties[j].Value.Image.image) == false) {
                            if (spell.SpellProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                // Split the base64 string in data and contentType
                                var block = spell.SpellProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //spells.push(file);
                                clientImages.push(file);

                                spell.SpellProperties[j].Value.Image.image = spell.SpellProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }
                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CopyRulesetSpells",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_copySpells", angular.toJson(data._copySpells));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _copySpells: _ruleset, clientImages: clientImages }
                })
            }

            service.DeleteSpells = function (deletespell) {
                return $http.post(_controller + "/DeleteSpell", deletespell);
            }

            service.GetRulesetAbilities = function (RUlesetId) {
                //var response = $http({
                //    method: "get",
                //    url: _controller + "/GetRulesetItemsByRulesetId",
                //    params: {
                //        RulesetId: JSON.stringify(RulesetId)
                //    }
                //});
                //return response;
                return $http.get(_controller + "/GetRulesetAbilitiesByRulesetId/?RUlesetId=" + RUlesetId);
            }


            service.GetAbilitiesMetadata = function (RulesetId) {
                var response = $http({
                    method: "post",
                    url: _controller + "/GetRulesetAbilitiesMetadata",
                    params: {
                        RulesetId: JSON.stringify(RulesetId)
                    }
                });
                return response;
                //return $http.post(_controller + "/GetRulesetItemsMetadata?RulesetId=", RulesetId);
            }

            service.CreateAbilities = function (_rulesetAbilities) {
                var clientImages = [];
                var _ruleset = angular.copy(_rulesetAbilities);
                for (var i = 0; i < _rulesetAbilities.length; i++) {
                    var ability = _ruleset[i];
                    for (var j = 0; j < ability.AbilityProperties.length; j++) {
                        if (j == 1 && ability.AbilityProperties[j].Value.Image.image != null && ability.AbilityProperties[j].Value.Image.image != "" && angular.isUndefined(ability.AbilityProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            var block = ability.AbilityProperties[j].Value.Image.image.split(";");
                            // Get the content type
                            var contentType = block[0].split(":")[1];
                            // get the real base64 content of the file
                            var realData = block[1].split(",")[1];

                            // Convert to blob
                            var blob = b64toBlob(realData, contentType);
                            var splitFileExt = contentType.split('/');
                            var fileExt = splitFileExt[1];

                            var currentDate = Date.now();

                            var file = new File([blob], ability.AbilityProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt);
                            //items.push(file);
                            clientImages.push(file);

                            ability.AbilityProperties[j].Value.Image.image = ability.AbilityProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt;
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CreateRulesetAbilities",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_rulesetAbilities", angular.toJson(data._rulesetAbilities));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _rulesetAbilities: _ruleset, clientImages: clientImages }
                })

            }


            service.UpdateAbilities = function (_updateAbilities) {
                var clientImages = [];
                var _ruleset = angular.copy(_updateAbilities);
                for (var i = 0; i < _updateAbilities.length; i++) {
                    var ability = _ruleset[i];
                    for (var j = 0; j < ability.AbilityProperties.length; j++) {
                        if (j == 1 && ability.AbilityProperties[j].Value.Image.image != null && ability.AbilityProperties[j].Value.Image.image != "" && angular.isUndefined(ability.AbilityProperties[j].Value.Image.image) == false) {
                            // Split the base64 string in data and contentType
                            if (ability.AbilityProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                var block = ability.AbilityProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], ability.AbilityProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt);
                                //items.push(file);
                                clientImages.push(file);

                                ability.AbilityProperties[j].Value.Image.image = ability.AbilityProperties[0].Value.Text.value + "~" + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }

                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/UpdateRulesetAbilities",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_updateAbilities", angular.toJson(data._updateAbilities));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _updateAbilities: _ruleset, clientImages: clientImages }
                })
            }

            service.CopyAbilities = function (_copyAbilities) {
                var clientImages = [];
                var _ruleset = angular.copy(_copyAbilities);
                for (var i = 0; i < _copyAbilities.length; i++) {
                    var ability = _copyAbilities[i];
                    for (var j = 0; j < ability.AbilityProperties.length; j++) {
                        if (j == 1 && ability.AbilityProperties[j].Value.Image.image != null && ability.AbilityProperties[j].Value.Image.image != "" && angular.isUndefined(ability.AbilityProperties[j].Value.Image.image) == false) {
                            if (ability.AbilityProperties[j].Value.Image.image.includes("wwwroot") == false) {
                                // Split the base64 string in data and contentType
                                var block = ability.AbilityProperties[j].Value.Image.image.split(";");
                                // Get the content type
                                var contentType = block[0].split(":")[1];
                                // get the real base64 content of the file
                                var realData = block[1].split(",")[1];

                                // Convert to blob
                                var blob = b64toBlob(realData, contentType);
                                var splitFileExt = contentType.split('/');
                                var fileExt = splitFileExt[1];

                                var currentDate = Date.now();

                                var file = new File([blob], ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt);
                                //spells.push(file);
                                clientImages.push(file);

                                ability.AbilityProperties[j].Value.Image.image = ability.AbilityProperties[0].Value.Text.value + "~" + _ruleset.UserId + currentDate + "." + fileExt;
                            }
                            break;
                        }
                    }
                }
                var ruleSetImage = angular.isUndefined(ruleSetImage) == false ? ruleSetImage : null;
                return $http({
                    url: _controller + "/CopyRulesetAbilities",
                    method: "POST",
                    headers: { "Content-Type": undefined },
                    transformRequest: function (data) {
                        var formData = new FormData();
                        formData.append("_copyAbilities", angular.toJson(data._copyAbilities));
                        for (var i = 0; i < data.clientImages.length; i++) {
                            formData.append("clientImages[" + i + "]", data.clientImages[i]);
                        }
                        //for (var i = 0; i < data.itemfiles.length; i++) {
                        //    formData.append("itemfiles[" + i + "]", data.itemfiles[i]);
                        //}
                        //for (var i = 0; i < data.spellfiles.length; i++) {
                        //    formData.append("spellfiles[" + i + "]", data.spellfiles[i]);
                        //}
                        //for (var i = 0; i < data.abilityfiles.length; i++) {
                        //    formData.append("abilityfiles[" + i + "]", data.abilityfiles[i]);
                        //}
                        //formData.append("ruleSetImage", data.ruleSetImage);
                        return formData;
                    },
                    data: { _copyAbilities: _ruleset, clientImages: clientImages }
                })
            }

            service.DeleteAbilities = function (deleteability) {
                return $http.post(_controller + "/DeleteAbility", deleteability);
            }
            service.GetTilesMetadataForRuleset = function () {
                return $http.get(_controller + "/GetTilesMetadataForRuleset");
            }
            service.SaveRulesetTiles = function (_rulesetContent) {
                return $http.post(_controller + "/SaveOrUpdateRulesetContentTiles", _rulesetContent);
            }
            //Convert base64 bit image in to Http posted file (Blob)
            function b64toBlob(b64Data, contentType, sliceSize) {
                contentType = contentType || '';
                sliceSize = sliceSize || 512;

                var byteCharacters = atob(b64Data);
                var byteArrays = [];

                for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                    var slice = byteCharacters.slice(offset, offset + sliceSize);

                    var byteNumbers = new Array(slice.length);
                    for (var i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }

                    var byteArray = new Uint8Array(byteNumbers);

                    byteArrays.push(byteArray);
                }

                var blob = new Blob(byteArrays, { type: contentType }, name);
                return blob;
            }

            return service;
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-services');

    app.factory('tabService', ['$http','$rootScope', '$state', '$localStorage', 'authService',
        function ($http,$rootScope, $state, $localStorage, authService) {

        var navs = {};
        var service = {};
        var _controller = "/api/Tab";
        service.topNav = {};

        service.GetTabs = function (LayoutId) {
            return $http.get(_controller + "/GetTabListByLayoutId/?LayoutId="+LayoutId);
        }

        service.AddTab = function (NewTab) {
            return $http.post(_controller + "/Create" , NewTab);
        }
        service.UpdateTab = function (tabmodel) {
            return $http.post(_controller + "/Update", tabmodel);
        }

        service.deleteTab = function (deleteTab) {
            //var TabID = { 'TabID': ID };
            return $http.post(_controller + "/DeleteTab", deleteTab);
        }
        //service.InsertNewTab = function (TabViewModel) {
        //    return $http.post('/Tab/MarketExpenseTypeInsert', TabViewModel);
        //}

        return service;
    }]);    

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-services');

    app.factory('tileService', ['$http', '$rootScope', '$state', '$localStorage', 'authService',
        function ($http, $rootScope, $state, $localStorage, authService) {

            var navs = {};
            var service = {};
            var _controller = "/api/Tile";
            service.topNav = {};
            service.GetTileTypes = function () {
                return $http.get(_controller + "/GetTileTypes");
            }
            service.AddTile = function (NewTile) {
                return $http.post(_controller + "/Create", NewTile);
            }

            service.UpdateTile = function (UpdateTile) {
                return $http.post(_controller + "/Update", UpdateTile);
            }
            service.deleteTile = function (Tile) {
                //var TileID = { 'TileID': ID };
                return $http.post(_controller + "/DeleteTile", Tile);
            }
            service.GetAllTileTypesRelatedCharacter = function (ID) {
                var CharacterProfileID = { 'CharacterProfileID': ID };
                return $http.post(_controller + "/GetAllTileTypesRelatedCharacter", CharacterProfileID);
            }
            //service.InsertNewTab = function (TabViewModel) {
            //    return $http.post('/Tab/MarketExpenseTypeInsert', TabViewModel);
            //}

            return service;
        }]);

})();
// Note: This is a modification of the textcolor picker modified for body background

/**
 * plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*global tinymce:true */
/*eslint consistent-this:0 */

tinymce.PluginManager.add('rpgsbackgroundcolor', function (editor) {

    // Called externally
    this.updateStyles = function(styles) {
        styles.tile.styles['background-color'] = editor.getContentAreaContainer().style.backgroundColor;
    };

    var cols, rows;
    var previewEl = null;

    rows = {
        forecolor: editor.settings.forecolor_rows || editor.settings.textcolor_rows || 5,
        backcolor: editor.settings.backcolor_rows || editor.settings.textcolor_rows || 5
    };
    cols = {
        forecolor: editor.settings.forecolor_cols || editor.settings.textcolor_cols || 8,
        backcolor: editor.settings.backcolor_cols || editor.settings.textcolor_cols || 8
    };

    function getCurrentColor(format) {
        return editor.getContentAreaContainer().style.backgroundColor;
    }

    function mapColors(type) {
        var i, colors = [], colorMap;

        colorMap = [
            "000000", "Black",
            "993300", "Burnt orange",
            "333300", "Dark olive",
            "003300", "Dark green",
            "003366", "Dark azure",
            "000080", "Navy Blue",
            "333399", "Indigo",
            "333333", "Very dark gray",
            "500000", "Maroon",
            "FF6600", "Orange",
            "805000", "Olive",
            "005000", "Green",
            "008080", "Teal",
            "0000FF", "Blue",
            "666699", "Grayish blue",
            "808080", "Gray",
            "FF0000", "Red",
            "FF9900", "Amber",
            "99CC00", "Yellow green",
            "339966", "Sea green",
            "33CCCC", "Turquoise",
            "3366FF", "Royal blue",
            "500080", "Purple",
            "999999", "Medium gray",
            "FF00FF", "Magenta",
            "FFCC00", "Gold",
            "FFFF00", "Yellow",
            "00FF00", "Lime",
            "00FFFF", "Aqua",
            "00CCFF", "Sky blue",
            "993366", "Red violet",
            "FFFFFF", "White",
            "FF99CC", "Pink",
            "FFCC99", "Peach",
            "FFFF99", "Light yellow",
            "CCFFCC", "Pale green",
            "CCFFFF", "Pale cyan",
            "99CCFF", "Light sky blue",
            "CC99FF", "Plum"
        ];

        colorMap = editor.settings.textcolor_map || colorMap;
        colorMap = editor.settings[type + '_map'] || colorMap;

        for (i = 0; i < colorMap.length; i += 2) {
            colors.push({
                text: colorMap[i + 1],
                color: '#' + colorMap[i]
            });
        }

        return colors;
    }

    function renderColorPicker() {
        var ctrl = this, colors, color, html, last, x, y, i, id = ctrl._id, count = 0, type;

        type = ctrl.settings.origin;

        function getColorCellHtml(color, title) {
            var isNoColor = color == 'initial';

            return (
                '<td class="mce-grid-cell' + (isNoColor ? ' mce-colorbtn-trans' : '') + '">' +
                '<div id="' + id + '-' + (count++) + '"' +
                ' data-mce-color="' + (color ? color : '') + '"' +
                ' role="option"' +
                ' tabIndex="-1"' +
                ' style="' + (color ? 'background-color: ' + color : '') + '"' +
                ' title="' + tinymce.translate(title) + '">' +
                (isNoColor ? '&#215;' : '') +
                '</div>' +
                '</td>'
            );
        }

        colors = mapColors(type);
        colors.push({
            text: tinymce.translate("No color"),
            color: "initial"
        });

        html = '<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>';
        last = colors.length - 1;

        for (y = 0; y < rows[type]; y++) {
            html += '<tr>';

            for (x = 0; x < cols[type]; x++) {
                i = y * cols[type] + x;

                if (i > last) {
                    html += '<td></td>';
                } else {
                    color = colors[i];
                    html += getColorCellHtml(color.color, color.text);
                }
            }

            html += '</tr>';
        }

        if (editor.settings.color_picker_callback) {
            html += (
                '<tr>' +
                '<td colspan="' + cols[type] + '" class="mce-custom-color-btn">' +
                '<div id="' + id + '-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" ' +
                'role="button" tabindex="-1" aria-labelledby="' + id + '-c" style="width: 100%">' +
                '<button type="button" role="presentation" tabindex="-1">' + tinymce.translate('Custom...') + '</button>' +
                '</div>' +
                '</td>' +
                '</tr>'
            );

            html += '<tr>';

            for (x = 0; x < cols[type]; x++) {
                html += getColorCellHtml('', 'Custom color');
            }

            html += '</tr>';
        }

        html += '</tbody></table>';

        return html;
    }

    function applyFormat(format, value) {
        editor.undoManager.transact(function () {
            editor.getContentAreaContainer().style.backgroundColor = value;
        });
    }

    function removeFormat(format) {
        editor.undoManager.transact(function () {
            editor.getContentAreaContainer().style.backgroundColor = null;
        });
    }

    function onPanelClick(e) {
        var buttonCtrl = this.parent(), value, type;

        type = buttonCtrl.settings.origin;

        function selectColor(value) {
            buttonCtrl.hidePanel();
            buttonCtrl.color(value);
            applyFormat(buttonCtrl.settings.format, value);
        }

        function resetColor() {
            buttonCtrl.hidePanel();
            buttonCtrl.resetColor();
            removeFormat(buttonCtrl.settings.format);
        }

        function setDivColor(div, value) {
            div.style.background = value;
            div.setAttribute('data-mce-color', value);
        }

        if (tinymce.DOM.getParent(e.target, '.mce-custom-color-btn')) {
            buttonCtrl.hidePanel();

            editor.settings.color_picker_callback.call(editor, function (value) {
                var tableElm = buttonCtrl.panel.getEl().getElementsByTagName('table')[0];
                var customColorCells, div, i;

                customColorCells = tinymce.map(tableElm.rows[tableElm.rows.length - 1].childNodes, function (elm) {
                    return elm.firstChild;
                });

                for (i = 0; i < customColorCells.length; i++) {
                    div = customColorCells[i];
                    if (!div.getAttribute('data-mce-color')) {
                        break;
                    }
                }

                // Shift colors to the right
                // TODO: Might need to be the left on RTL
                if (i == cols[type]) {
                    for (i = 0; i < cols[type] - 1; i++) {
                        setDivColor(customColorCells[i], customColorCells[i + 1].getAttribute('data-mce-color'));
                    }
                }

                setDivColor(div, value);
                selectColor(value);
            }, getCurrentColor(buttonCtrl.settings.format));
        }

        value = e.target.getAttribute('data-mce-color');
        if (value) {
            if (this.lastId) {
                document.getElementById(this.lastId).setAttribute('aria-selected', false);
            }

            e.target.setAttribute('aria-selected', true);
            this.lastId = e.target.id;

            if (value == 'transparent') {
                resetColor();
            } else {
                selectColor(value);
            }
        } else if (value !== null) {
            buttonCtrl.hidePanel();
        }
    }

    function onButtonClick() {
        var self = this;

        if (self._color) {
            applyFormat(self.settings.format, self._color);
        } else {
            removeFormat(self.settings.format);
        }
    }

    editor.buttons.backcolor.tooltip = "Text background color";

    editor.on('ExecCommand', function(e) {
        if (e.command === 'RemoveFormat') {
            // Do we do anything?
        }
    });

    editor.addButton('rpgsbackgroundcolor', {
        type: 'colorbutton',
        tooltip: 'Tile background color',
        panel: {
            origin: 'backcolor',
            role: 'application',
            ariaRemember: true,
            html: renderColorPicker,
            onclick: onPanelClick
        },
        onpostrender: function () {
            previewEl = arguments[0].control.$el.find('i.mce-i-rpgsbackgroundcolor');
        },
        onclick: onButtonClick
    });
});
// Note: This is a modification of the textcolor picker modified for body background

/**
 * plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*global tinymce:true */
/*eslint consistent-this:0 */

tinymce.PluginManager.add('rpgsborder', function(editor) {

    // Called externally
    this.updateStyles = function(styles) {

        var el = editor.getContentAreaContainer();

        styles.tile.styles['border'] = el.style.border;
        styles.tile.styles['border-radius'] = el.style.borderRadius;
        
        styles.tile.styles['box-shadow'] = el.style.boxShadow || null;
    };

    function makeValues() {
        var arr = [];
        for (var i = 1; i <= 10; i++)
            arr.push({ text: i + 'px', value: i + 'px' });
        return arr;
    }

    function createColorPickAction() {
        var colorPickerCallback = editor.settings.color_picker_callback;

        if (colorPickerCallback) {
            return function() {
                var self = this;

                colorPickerCallback.call(
                    editor,
                    function(value) {
                        self.value(value).fire('change');
                    },
                    self.value()
                );
            };
        }
    };

    editor.on('Init', function(ed) {

        var dst = editor.getContentAreaContainer(),
            src = editor.getParam('tileStyle').tile;

        // The editor or something puts in a 1px border inline. This will remove it.
        dst.style.borderWidth = null;

        // our styles
        dst.style.backgroundColor = src.styles['background-color'];
        dst.style.border = src.styles['border'];
        dst.style.borderRadius = src.styles['border-radius'];

        dst.style.boxShadow = src.styles['box-shadow'];
    });

    editor.on('ExecCommand', function(e) {
        if (e.command === 'RemoveFormat') {
            // Do we do anything?
        }
    });

    editor.addButton('rpgsborder', {
        type: 'button',
        tooltip: 'Tile border',
        onclick: function() {

            var style = editor.getContentAreaContainer().style;
            
            editor.windowManager.open({
                title: 'Edit border',
                body: [
                    {
                        type: 'listbox',
                        name: 'style',
                        label: 'Style',
                        values: [
                            { text: 'Use default', value: 'inherit' },
                            { text: 'None', value: 'none' },
                            { text: 'Dotted', value: 'dotted' },
                            { text: 'Double', value: 'double' },
                            { text: 'Dashed', value: 'dashed' },
                            { text: 'Groove', value: 'groove' },
                            { text: 'Inset', value: 'inset' },
                            { text: 'Outset', value: 'outset' },
                            { text: 'Ridge', value: 'ridge' },
                            { text: 'Solid', value: 'solid' }
                        ],
                        value: style.borderStyle
                    },
                    {
                        type: 'colorbox',
                        name: 'color',
                        label: 'Color',
                        onaction: createColorPickAction(),
                        value: style.borderColor
                    },
                    {
                        type: 'combobox',
                        name: 'width',
                        label: 'Width',
                        values: makeValues(),
                        value: style.borderWidth
                    },
                    {
                        type: 'combobox',
                        name: 'radius',
                        label: 'Radius',
                        values: makeValues(),
                        value: style.borderRadius
                    },
                    {
                        type: 'listbox',
                        name: 'shadow',
                        label: 'Shadow',
                        values: [
                            { text: 'Use default', value: 'inherit' },
                            { text: 'Yes', value: 'yes' },
                            { text: 'No', value: 'no' }
                        ],
                        value: (function() {
                            return style.boxShadow === 'none' ? 'no' : 'yes'
                        })()
                    }
                ],
                onsubmit: function(e) {
                    
                    editor.undoManager.transact(function() {
                        
                        switch (e.data.style) {
                            case '':
                            case 'inherit':
                                style.border = null;
                                break;
                            case 'none':
                                style.border = 'none';
                                break;
                            default:
                                style.border = e.data.width + ' ' + e.data.style + ' ' + e.data.color;
                                break;
                        }

                        switch (e.data.shadow) {
                            case '':
                            case 'inherit':
                            case 'yes':
                                style.boxShadow = null;
                                break;
                            case 'no':
                                style.boxShadow = 'none';
                                break;
                            default:
                        }

                        if (e.data.radius === 'inherit' || e.data.radius === '')
                            style.borderRadius = null;
                        else
                            style.borderRadius = e.data.radius;

                    });

                    editor.focus();
                }
            });
        }
    });
});
// Note: This is a modification of the textcolor picker modified for body background

/**
 * plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*global tinymce:true */
/*eslint consistent-this:0 */

tinymce.PluginManager.add('rpgsstaticcontent', function(editor) {

    // Called externally
    this.updateStyles = function(styles) {
        var node = $(innerNode());

        styles.content.classes = node.attr('class');
        styles.content.styles = rpgsmith.styles2Obj(node.attr('style'));
    };

    var _old_apply = null;

    function innerNode() {
        var node = editor.dom.select('p')[0];

        if (node) {
            while (node.children.length > 0)
                node = node.children[0];
        }

        return node;
    }

    function selectNode() {
        var node = innerNode();
        editor.focus();
        editor.selection.select(node);
        return node;
    }

    var valignButtons = ['valigntop', 'valignmiddle', 'valignbottom'];

    function lock(yesNo) {
        editor.getBody().setAttribute('contenteditable', !yesNo);
    }

    function beforeCommand() {
        lock(false);
        selectNode();
    };

    function afterCommand() {
        editor.selection.collapse();
        lock(true);
    }

    function valign(command) {

        beforeCommand();

        valignButtons.forEach(function(f) {
            if (f !== command)
                editor.formatter.remove(f);
        });

        editor.formatter.toggle(command, undefined);
        editor.nodeChanged();

        afterCommand();
    }
    
    editor.on('PreInit', function(ed) {

        _old_apply = editor.formatter.apply;

        editor.formatter.apply = function apply(name, vars, node) {
            editor.fire('BeforeExecCommand', { command: name });
            _old_apply.call(arguments);
            editor.fire('ExecCommand', { command: name });
        };

        editor.formatter.unregister('bold');
        editor.formatter.unregister('italic');
        editor.formatter.unregister('underline');

        editor.formatter.unregister('alignleft');
        editor.formatter.unregister('aligncenter');
        editor.formatter.unregister('alignright');

        // Text format
        editor.formatter.register('bold', {
            inline: 'span', styles: { 'font-weight': 'bold' }
        });
        editor.formatter.register('italic', {
            inline: 'span', styles: { 'font-style': 'italic' }
        });
        editor.formatter.register('underline', {
            inline: 'span', styles: { 'text-decoration': 'underline' }
        });

        // Horizontal Alignment
        editor.formatter.register('alignleft', {
            inline: 'span', classes: 'tile-content-left'
        });
        editor.formatter.register('aligncenter', {
            inline: 'span', classes: 'tile-content-center'
        });
        editor.formatter.register('alignright', {
            inline: 'span', classes: 'tile-content-right'
        });

        // Vertical Alignment
        editor.formatter.register('valigntop', {
            inline: 'span', classes: 'tile-content-top'
        });
        editor.formatter.register('valignmiddle', {
            inline: 'span', classes: 'tile-content-middle'
        });
        editor.formatter.register('valignbottom', {
            inline: 'span', classes: 'tile-content-bottom'
        });

        window.setTimeout(function() {
            lock(true);
            selectNode();
            editor.selection.collapse();
        }, 5);
    });

    editor.on('BeforeExecCommand', function(e) {

        console.log('BeforeExecCommand');

        switch (e.command) {
            case 'mceInsertContent':
                return false;
            default:
                selectNode();
                lock(false);
                break;
        }
    });

    editor.on('ExecCommand', function(e) {
        if (e.command !== 'selectAll') {
            lock(true);
            editor.selection.collapse();
        }
    });

    editor.addButton('valigntop', {
        text: 'T',
        tooltip: 'Align top',
        icon: false,
        onclick: function() {
            valign('valigntop');            
        },
        onpostrender: function() {
            var btn = this;
            editor.on('init', function() {
                editor.formatter.formatChanged('valigntop', function(state) {
                    btn.active(state);
                });
            });
        }
    });

    editor.addButton('valignmiddle', {
        text: 'M',
        tooltip: 'Align middle',
        icon: false,
        onclick: function() {
            valign('valignmiddle');            
        },
        onpostrender: function() {
            var btn = this;
            editor.on('init', function() {
                editor.formatter.formatChanged('valignmiddle', function(state) {
                    btn.active(state);
                });
            });
        }
    });

    editor.addButton('valignbottom', {
        text: 'B',
        tooltip: 'Align bottom',
        icon: false,
        onclick: function() {
            valign('valignbottom');            
        },
        onpostrender: function() {
            var btn = this;
            editor.on('init', function() {
                editor.formatter.formatChanged('valignbottom', function(state) {
                    btn.active(state);
                });
            });
        }
    });
    
});
(function () {
    'use strict';


    var module = angular.module('rpgsmith-dialogs');

    module.controller('dialogAddNewCharacter',
        ['$scope', '$state', '$q', '$uibModalInstance', 'Upload', 'data', 'rulesetService', 'characterService', 'toaster',
            function ($scope, $state, $q, $uibModalInstance, Upload, data, rulesetService, characterService, toaster) {
                //$scope.character = {};

                //$scope.character.Action = data.mode;

                $scope.character = data.characterData;
				$scope.showimagebtns = false;
                //$scope.file = null;
                if (data.mode == 1) {

                    $scope.pageHeading = "New Character";
                    $scope.pageButton = "Save"

                    $scope.disableNameControl = false;
                    $scope.disableAllControls = false;

                    $scope.mode = 1;
                }
                else if (data.mode == 2) {

                    $scope.pageHeading = "Edit Character";
                    $scope.pageButton = "Save"

                    $scope.disableNameControl = true;
                    $scope.disableAllControls = false;

                    $scope.mode = 2;

                }
                else {
                    $scope.pageHeading = "Duplicate Character";
                    $scope.pageButton = "Save"


                    $scope.character.name = "";

                    $scope.disableNameControl = false;
                    $scope.disableAllControls = true;

                    $scope.mode = 3;
                }

                $scope.cancel = function () {
                    //$("#loading").css("display", "block");
                    $uibModalInstance.dismiss('Canceled');
                   // $("#loading").fadeOut("slow");
                };

                $scope.getThumbNail = function () {
                    if ($scope.file)
                        return $scope.file;
                    var c = $scope.item;
                    if (c.id && c.portrait)
                        return '/characterdata/' + c.id + '/' + c.portrait;
                    return null;
				}
				//Upload file
				$scope.OpenFile = function () {
					console.log("Open and upload file...");
					$("#newCharacterImage").click();
					//var input = $('input[type=file]');//.val();
					//input.click();
					//return false;
				}
                $scope.characterImageUpload = function (input) {
                    if (input.files && input.files[0]) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            $scope.file = e.target.result
                            $scope.character.file = $scope.file;
                        };
                        reader.readAsDataURL(input.files[0]);
                    }
                }
                $scope.save = function () {
                    //$("#loading").css("display", "block");
                    var character = {};
                    if ($scope.mode == 1 && $scope.character.id == 0) {
                        character = {
                            Id: 0,
                            Name: $scope.character.name,
                            Portrait: $scope.character.file,
                            RulesetID: $scope.character.RulesetID,
                        };
                        if ($scope.character.RulesetID > 0) {
                            var addcharacter = characterService.saveCharacter(character);
                            addcharacter.then(function (res) {
                                if (res.data.StatusCode == 200) {
                                    //$("#loading").fadeOut("slow");
                                    $uibModalInstance.close(res.data.PayLoad);

                                }
                                else {
                                    if (res.data.StatusCode == 400) {
                                        if (res.data.ShowToUser == true) {
                                            toaster.pop('error', res.data.ErrorMessage);
                                            //$("#loading").fadeOut("slow");
                                        }
                                    }
                                }
                            });
                        }
                        else
                        {
                            toaster.pop('error', 'Please select one ruleset');
                        }
                        }
                        else {
                            var data;
                            if ($scope.mode == 2) {
                                character = {
                                    Id: $scope.character.id,
                                    Name: $scope.character.name,
                                    Portrait: $scope.character.file,
                                    RulesetID: $scope.character.RulesetID,
                                };
                                data = characterService.EditCharacter(character);
                            }
                            else if ($scope.mode == 3) {
                                character = {
                                    Id: $scope.character.id,
                                    Name: $scope.character.name,
                                    Portrait: $scope.character.file,
                                    RulesetID: $scope.character.RulesetID,
                                };
                                data = characterService.CopyCharacter(character);
                            }
                            data.then(function (res) {
                                if (res.data.StatusCode == 200) {
                                    //$("#loading").fadeOut("slow");

                                $uibModalInstance.close(res.data.PayLoad);
                            }
                            else {
                                if (res.data.StatusCode == 400) {
                                    if (res.data.ShowToUser == true) {
                                        toaster.pop('error', res.data.ErrorMessage);
                                        //$("#loading").fadeOut("slow");
                                    }
                                }
                            }

                        })
                    }
                }

                rulesetService.GetRuleSets().then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.RuleSets = data.data.PayLoad;
                        //$("#loading").fadeOut("slow");
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop('error', data.data.ErrorMessage);

                                //$("#loading").fadeOut("slow");
                            }
                        }
                    }
                });
                $scope.manageRuleSets = function () {
                    $uibModalInstance.dismiss('Canceled');
                    $state.go('profile.AddNewRuleSet');
                }

            }]);

    module.controller('dialogEditCharacter',
        ['$scope', '$q', '$uibModalInstance', 'Upload', 'data',
            function ($scope, $q, $uibModalInstance, Upload, data) {
                $scope.isEdit = data.isEdit;
                $scope.item = data.item;
                $scope.file = null;

                $scope.cancel = function () {
                    $uibModalInstance.dismiss('Canceled');
                };

                $scope.getThumbNail = function () {

                    if ($scope.file)
                        return $scope.file;

                    var c = $scope.item;
                    if (c.id && c.portrait)
                        return '/characterdata/' + c.id + '/' + c.portrait;

                    return null;
                }

                $scope.save = function () {

                  

                };

            }]);

    module.controller('dialogLayoutRename', ['$scope', '$uibModalInstance', 'data', 'rulesetService', function ($scope, $uibModalInstance, data, rulesetService) {
        $scope.Tab = data.scope;
        $scope.TabHeading = data.State;
        $scope.ButtonText = data.btntext;
        $scope.cancel = function () {
            $uibModalInstance.dismiss('Canceled');
        };

        $scope.save = function () {

            $uibModalInstance.close($scope.Tab);
        };

        $scope.hitEnter = function (evt) {
            if (evt.which === 13 && !(angular.equals($scope.name, null) || angular.equals($scope.name, '')))
                $scope.save();
        };
        $scope.cancel = function () {

            $uibModalInstance.dismiss('Canceled');
        };

        $scope.SaveCorestat = function () {
            $uibModalInstance.close($scope.CoreStatProperties);
        }
    }]);

    module.controller('dialogTabRename', ['$scope', '$uibModalInstance', 'data', 'rulesetService', function ($scope, $uibModalInstance, data, rulesetService) {
        $scope.Tab = data.scope;
        $scope.TabHeading = data.State;
        $scope.ButtonText = data.btntext;
        $scope.cancel = function () {
            $uibModalInstance.dismiss('Canceled');
        };

        $scope.save = function () {
            $uibModalInstance.close($scope.Tab);
        };

        $scope.hitEnter = function (evt) {
            if (evt.which === 13 && !(angular.equals($scope.name, null) || angular.equals($scope.name, '')))
                $scope.save();
        };
        $scope.cancel = function () {
            //$("#loading").css("display", "block");
            $uibModalInstance.dismiss('Canceled');
            //$("#loading").fadeOut("slow");
        };

        $scope.SaveCorestat = function () {
            $uibModalInstance.close($scope.CoreStatProperties);
        }
    }]);

    module.controller('dialogTileTypes', ['$scope', '$uibModalInstance', 'data', 'dialogs', 'tileService', function ($scope, $uibModalInstance, data, dialogs, tileService) {

        $scope.tileTypes = data.scope;
        $scope.cancel = function () {
           // $("#loading").css("display", "block");
            $uibModalInstance.dismiss('Canceled');
            //$("#loading").fadeOut("slow");
        };

        $scope.choosetile = function (tile) {
            $uibModalInstance.close(tile);
        }

        $scope.cancel = function () {
           // $("#loading").css("display", "block");
            $uibModalInstance.dismiss('Canceled');
           // $("#loading").fadeOut("slow");
        };

    }]);

    module.controller('dialogAddTile', ['$scope', '$uibModalInstance', 'data', 'tileService', function ($scope, $uibModalInstance, data, tileService) {
        $scope.Tiles = data.scope;

    }]);

   
    module.controller('dialogCreateCoreStat', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', function ($scope, $uibModalInstance, data, toaster, rulesetService) {

		
		$scope.OperationTypeMode = data.CoreStatMode;
        $scope.CoreStatProperties = data.scope;
        $scope.CoreStatsInGrid = data.CoreStatsInGrid;
        $scope.CoreStatsNameInGrid = data.CoreStatsNameInGrid;
        $scope.CoreStatProperties.Value.Choices.choices = [];
        $scope.tabName = data.tabname;
        $scope.buttontext = data.btntext;
		$scope.IsButtonDisabled = data.IsenableBtn;
		$scope.CoreStatProperties.Value.Choices.choices.push({ ChoiceName: '' });
        if ($scope.OperationTypeMode == "Create") {
            $scope.DisableField = false;
        }
        rulesetService.GetTypes().then(function (data) {
            if (data.data.StatusCode == 200) {
				$scope.Types = data.data.PayLoad;
				console.log("data.data.PayLoad", data.data.PayLoad);
                $scope.weight = data.data.PayLoad[6].Units
                $scope.Height = data.data.PayLoad[8].Units
                $scope.Volume = data.data.PayLoad[9].Units
            }
            else {
                if (data.data.StatusCode == 400) {
                    if (data.data.ShowToUser == true) {
                        toaster.pop('error', data.data.ErrorMessage);
                    }
                }
            }
        });
        $scope.CoreStatOnChange = function () {
            if ($scope.CoreStatProperties.TypeId == undefined) {
                $scope.IsButtonDisabled = true;
                $scope.ShowChoices = false;
                $scope.ShowCalculation = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            else if ($scope.CoreStatProperties.TypeId == 2) {
                $scope.ShowChoices = true;
                $scope.IsButtonDisabled = false;
                $scope.ShowCalculation = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            else if ($scope.CoreStatProperties.TypeId == 16) {
                $scope.ShowCalculation = true;
                $scope.IsButtonDisabled = false;
                $scope.ShowChoices = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            else if ($scope.CoreStatProperties.TypeId == 5) {
                $scope.ShowCalculation = false;
                $scope.IsButtonDisabled = false;
                $scope.ShowChoices = false;
                $scope.ShowValueandSubvalue = true;
                $scope.ShowCurrentMaxValue = false;
            }
            else if ($scope.CoreStatProperties.TypeId == 6) {
                $scope.ShowCalculation = false;
                $scope.IsButtonDisabled = false;
                $scope.ShowChoices = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = true;
            }
            else if ($scope.CoreStatProperties.TypeId > 0 || $scope.CoreStatProperties.Name != "") {
                $scope.ShowChoices = false;
                $scope.ShowCalculation = false;
                $scope.IsButtonDisabled = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            else {
                $scope.IsButtonDisabled = false;
            }
        }

       
        $scope.AddValueSubvalue = function (value) {
            if (value == 'Value') {
                $scope.valueName = value;
            }
            else if (value == 'SubValue') {
                $scope.valueName = value;
            }
        }

        $scope.Addcurrentmax = function (value) {
            if (value == 'CurrentValue') {
                $scope.CurrentMaxvalue = value;
            }
            else if (value == 'MaxValue') {
                $scope.CurrentMaxvalue = value;
            }
        }
        $scope.ExistCoreStatOnChange = function () {
            if ($scope.CoreStatsInGrid.Name != undefined) {
                var a = "[abc]";
                a = a.replace("abc", $scope.CoreStatsInGrid.Name.Name);
                $scope.tempVar = a;
            }
            else {
                if ($scope.Formula == "" || $scope.Formula == undefined) {
                    $scope.Formula = "";
                }
                else {
                    $scope.Formula = $scope.Formula;
                }
            }
        }
        $scope.CreateFormula = function () {
            if ($scope.Formula == "" || $scope.Formula == undefined) {
                $scope.Formula = $scope.tempVar;
            }
            else if ($scope.Formula != "") {
                $scope.Formula = $scope.Formula + "" + $scope.tempVar;
            }
        }
        $scope.addChoice = function () {
            $scope.CoreStatProperties.Value.Choices.choices.push({ ChoiceName: '' });
        }
        $scope.RemoveChoice = function (choice) {
            var idx = $scope.CoreStatProperties.Value.Choices.choices.indexOf(choice);
            $scope.CoreStatProperties.Value.Choices.choices.splice(idx, 1);
        }
       
        $scope.SaveCorestat = function () {
            //$scope.CoreStatsNameInGrid = rulesetDataShareService.getRulesetCoreStatData();
			//alert("Test");
            if ($scope.CoreStatProperties.Name == "" || $scope.CoreStatProperties.Name === undefined || $scope.CoreStatProperties.Name == null) {
                toaster.pop('error', "Please enter CoreStat Name");
                return;
            }
            else if ($scope.CoreStatProperties.TypeId == 0 || $scope.CoreStatProperties.TypeId === undefined || $scope.CoreStatProperties.TypeId == "") {
                toaster.pop('error', "Please Select CoreStat Type");
                return;
            }
            else if ($scope.CoreStatsNameInGrid != undefined) {
                for (var i = 0; i < $scope.CoreStatsNameInGrid.length; i++) {
                    if ($scope.CoreStatsNameInGrid[i].Name === undefined) {
                        toaster.pop('error', "Please enter CoreStat Name");
                        return;
                    }
                   
                }
            }
            for (var k = 0; k < $scope.Types.length; k++) {
                if ($scope.Types[k].TypeId == $scope.CoreStatProperties.TypeId) {
                    $scope.CoreStatProperties.TypeName = $scope.Types[k].Name;
                    if (($scope.Types[k].TypeId == 16) && ($scope.CoreStatProperties.TypeId == 16)) {
                        $scope.CoreStatProperties.Value.Calculation.formulae = $scope.Formula;
                    }
                   
                }
            }
            $uibModalInstance.close($scope.CoreStatProperties);

        }


        $scope.cancel = function () {

            $uibModalInstance.close('cancel');
        }


    }]);

    module.controller('dialogAddCorestatValues', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'rulesetDataShareService', function ($scope, $uibModalInstance, data, rulesetService, rulesetDataShareService) {

        $scope.characters = data.scope;
        $scope.SaveCorestatValues = function () {
           // $("#loading").css("display", "block");
            rulesetDataShareService.setcorestatvalue($scope.characters);
            $uibModalInstance.close($scope.characters);
        }
        $scope.cancel = function () {

            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogAssociatedSpells', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {

        $scope.Spells = data.scope;

        var AssociatedSpells = data.associatedspells;

        if (AssociatedSpells != null && AssociatedSpells != undefined) {
            for (var i = 0; i < $scope.Spells.length; i++) {
                for (var j = 0; j < AssociatedSpells.length; j++) {
                    if ($scope.Spells[i].SpellProperties[0].Value.Text.value == AssociatedSpells[j].SpellProperties[0].Value.Text.value) {
                        $scope.Spells[i].Selected = true;
                    }
                }
            }
        }
        $scope.SaveAssociatedSpells = function () {
            var exampleArray = [];
            for (var i = 0; i < $scope.Spells.length; i++) {
                if ($scope.Spells[i].Selected) {
                    exampleArray.push($scope.Spells[i]);
                }
            }
            $uibModalInstance.close(exampleArray)
        }

        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }


    }]);

	module.controller('dialogAssociatedRulesetItems', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {

		$scope.RulesetItems = data.scope;

		$scope.SaveAssociatedRulesetItems = function () {
			console.log("In rulesetsItems: " + $scope.RulesetItems.length);
			var exampleArray = [];
			for (var i = 0; i < $scope.RulesetItems.length; i++) {
				console.log("$scope.RulesetItems[i].Selected: " + $scope.RulesetItems[i].Selected);
				if ($scope.RulesetItems[i].Selected) {
					exampleArray.push($scope.RulesetItems[i]);
				}
			}
			$uibModalInstance.close(exampleArray)
		}


		$scope.cancel = function () {
			$uibModalInstance.close('cancel');
		}


	}]);

	module.controller('dialogAssociatedRulesetSpells', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {

		$scope.RulesetSpells = data.scope;

		$scope.SaveAssociatedRulesetSpells = function () {
			console.log("In rulesetsItems: " + $scope.RulesetSpells.length);
			var exampleArray = [];
			for (var i = 0; i < $scope.RulesetSpells.length; i++) {
				console.log("$scope.RulesetItems[i].Selected: " + $scope.RulesetSpells[i].Selected);
				if ($scope.RulesetSpells[i].Selected) {
					exampleArray.push($scope.RulesetSpells[i]);
				}
			}
			$uibModalInstance.close(exampleArray)
		}


		$scope.cancel = function () {
			$uibModalInstance.close('cancel');
		}


	}]);

	module.controller('dialogAssociatedRulesetAbilities', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {

		$scope.RulesetAbilities = data.scope;

		$scope.SaveAssociatedRulesetAbilities = function () {
			console.log("In rulesetsAbilities: " + $scope.RulesetAbilities.length);
			var exampleArray = [];
			for (var i = 0; i < $scope.RulesetAbilities.length; i++) {
				console.log("$scope.RulesetItems[i].Selected: " + $scope.RulesetAbilities[i].Selected);
				if ($scope.RulesetAbilities[i].Selected) {
					exampleArray.push($scope.RulesetAbilities[i]);
				}
			}
			$uibModalInstance.close(exampleArray)
		}


		$scope.cancel = function () {
			$uibModalInstance.close('cancel');
		}


	}]);

    module.controller('dialogAssociatedAbilities', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {
        $scope.Abilities = data.scope;

        var AssociatedAbilities = data.associatedabilities;

        if (AssociatedAbilities != null && AssociatedAbilities != undefined) {
            for (var i = 0; i < $scope.Abilities.length; i++) {
                for (var j = 0; j < AssociatedAbilities.length; j++) {
                    if ($scope.Abilities[i].AbilityProperties[0].Value.Text.value == AssociatedAbilities[j].AbilityProperties[0].Value.Text.value) {
                        $scope.Abilities[i].Selected = true;
                    }
                }
            }
        }
        $scope.SaveAssociatedAbilities = function () {
            var exampleArray = [];
            for (var i = 0; i < $scope.Abilities.length; i++) {
                if ($scope.Abilities[i].Selected) {
                    exampleArray.push($scope.Abilities[i]);
                }
            }
            $uibModalInstance.close(exampleArray)
        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogCreateItem', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, toaster, rulesetService, dialogs) {

        var Spells = data.Spells;
        var Abilities = data.Abilities;

        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.buttontext = data.btntext;
        $scope.IsBtnDisabled = data.IsBtnDisabled;
        $scope.Content_ItemProperties = data.Content_ItemProperties;
        $scope.ShowAssociatedSpells = true;
        $scope.ShowAssociatedAbilities = true;
		$scope.showimagebtns = false;
		console.log("$scope.Properties: ", $scope.Properties);
		//Upload file
		$scope.OpenFile = function () {
			console.log("Open and upload file...");
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}

		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {

						$scope.Properties[1].Value.Image.image = e.target.result;
					});


				};
				reader.readAsDataURL(input.files[0]);

			}
		}
        $scope.OpenAssociatedSpells = function () {
            var dlg = dialogs.create('/views/dialogs/AssociatedSpells.html', 'dialogAssociatedSpells',
                { scope: Spells, associatedspells: $scope.AssociatedSpells }
            );

            dlg.result.then(function (res) {
                $scope.AssociatedSpells = res;
            });
        }

        $scope.OpenAssociatedAbilities = function () {
            var dlg = dialogs.create('/views/dialogs/AssociatedAbilities.html', 'dialogAssociatedAbilities',
                { scope: Abilities, associatedabilities: $scope.AssociatedAbilities }
            );

            dlg.result.then(function (res) {
                $scope.AssociatedAbilities = res;
            });
        }

        $scope.Create = function () {
            if ($scope.Content_ItemProperties != undefined) {
                for (var i = 0; i < $scope.Content_ItemProperties.length; i++) {
                    if ($scope.Content_ItemProperties[i].toLowerCase() == $scope.Properties[0].Value.Text.value.toLowerCase()) {
                        toaster.pop('Error', "Please enter unique Item Name");
                        return;
                    }
                }
            }

            var createItemResult = {};
            for (var i = 0; i < $scope.Properties.length; i++) {
                if ($scope.Properties[i].TypeId == 2) {
                    $scope.Properties[i].Value.Choices.SelectedChoiceName = $scope.Properties[i].Value.Choices.selectedchoice.ChoiceName;
                    $scope.Properties[i].Value.Choices.selectedchoice = "";
				}
				if ($scope.Properties[i].TypeId == 14) {
					$scope.Properties[i].Value.Text = null;
				}
            }
            createItemResult.Properties = $scope.Properties;
            createItemResult.AssociatedSpells = $scope.AssociatedSpells;
            createItemResult.AssociatedAbilities = $scope.AssociatedAbilities;

            $uibModalInstance.close(createItemResult);
            //$uibModalInstance.close($scope.Properties);
        }

        $scope.ItemcloseDialog = function () {

            $uibModalInstance.close($scope.CoreStatProperties);
        }

        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogCreateSpell', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', function ($scope, $uibModalInstance, data, toaster, rulesetService) {
        $scope.OperationTypeMode = data.SpellMode;
        $scope.Content_SpellProperties = data.Content_SpellProperties;
        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.buttontext = data.btntext;
        $scope.Create = function () {
            if ($scope.Content_SpellProperties != undefined) {
                for (var i = 0; i < $scope.Content_SpellProperties.length; i++) {
                    if ($scope.Content_SpellProperties[i].toLowerCase() == $scope.Properties[0].Value.Text.value.toLowerCase()) {
                        toaster.pop('Error', "Please enter unique Spell Name");
                        return;
                    }
                }
            }
            $uibModalInstance.close($scope.Properties);
		}
		//Upload file
		$scope.OpenFile = function () {
			console.log("Open and upload file...");
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}

		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {

						$scope.Properties[1].Value.Image.image = e.target.result;
					});


				};
				reader.readAsDataURL(input.files[0]);

			}
		}
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }
    }]);

    module.controller('dialogCreateAbility', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', function ($scope, $uibModalInstance, data, toaster, rulesetService) {
        $scope.OperationTypeMode = data.AbilityMode;
        $scope.Content_AbilityProperties = data.Content_AbilityProperties;
        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.buttontext = data.btntext;
        $scope.ShowAssociatedSpells = false;
		$scope.ShowAssociatedAbilities = false;
		$scope.showimagebtns = false;
		//Upload file
		$scope.OpenFile = function () {
			console.log("Open and upload file...");
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}

		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {

						$scope.Properties[1].Value.Image.image = e.target.result;
					});


				};
				reader.readAsDataURL(input.files[0]);

			}
		}
        $scope.Create = function () {
            if ($scope.Content_AbilityProperties != undefined) {
                for (var i = 0; i < $scope.Content_AbilityProperties.length; i++) {
                    if ($scope.Content_AbilityProperties[i].toLowerCase() == $scope.Properties[0].Value.Text.value.toLowerCase()) {
                        toaster.pop('Error', "Please enter unique Ability Name");
                        return;
                    }
                }
            }
            for (var i = 0; i < $scope.Properties.length; i++) {
                if ($scope.Properties[i].TypeId == 2) {
                    $scope.Properties[i].Value.Choices.SelectedChoiceName = $scope.Properties[i].Value.Choices.selectedchoice.ChoiceName;
                    $scope.Properties[i].Value.Choices.selectedchoice = "";
                }
            }
            $uibModalInstance.close($scope.Properties);
        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }
    }]);

    module.controller('ShowAllTileContent', ['$scope', '$uibModalInstance', 'data', 'rulesetService', function ($scope, $uibModalInstance, data, rulesetService) {

        $scope.Content = data.scope;
        $scope.ShowAssociatedSpells = false;
        $scope.ShowAssociatedAbilities = false;
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }
    }]);

    module.controller('dialogTabReorder', ['$scope', '$uibModalInstance', '$filter', 'data', function ($scope, $uibModalInstance, $filter, data) {
        $scope.temp = data;

        $scope.cancel = function () {
            $uibModalInstance.dismiss('Canceled');
        };

        $scope.save = function () {
            $uibModalInstance.close($scope.items);
        };

        $scope.hitEnter = function (evt) {
            if (evt.which === 13 && !(angular.equals($scope.name, null) || angular.equals($scope.name, '')))
                $scope.save();
        };

        (function () {

            var copy = (data.items || []).slice();

            data.sorter(copy);
            $scope.items = copy;
        })();

    }]);
   
    module.controller('dialogCopyCoreStat', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', function ($scope, $uibModalInstance, data, toaster, rulesetService) {
        $scope.OperationTypeMode = data.CoreStatMode;
        $scope.CoreStatProperties = data.scope;
        $scope.CoreStatsInGrid = data.CoreStatsInGrid;
        $scope.CoreStatsNameInGrid = data.CoreStatsNameInGrid;
        $scope.tabName = data.tabname;
        $scope.copyitem = data.item;
        $scope.count = data.count;
        $scope.buttontext = data.btntext;
        $scope.IsButtonDisabled = data.IsenableBtn;
        $scope.OperationTypeMode = data.CoreStatMode;
        if ($scope.OperationTypeMode == "Edit") {
            $scope.DisablecopyFields = false;
            $scope.DisableNameField = true;
        }
        else if ($scope.OperationTypeMode == "Copy") {
            $scope.CoreStatProperties.Name = "";
            $scope.DisablecopyFields = true;
            $scope.DisableNameField = false;
        }
        if ($scope.CoreStatProperties.TypeId == 2) {
            $scope.ShowChoices = true;
            $scope.ShowCalculation = false;
            $scope.ShowValueandSubvalue = false;
            $scope.ShowCurrentMaxValue = false;
        }
        if ($scope.CoreStatProperties.TypeId == 16) {
            $scope.ShowCalculation = true;
            $scope.ShowChoices = false;
            $scope.ShowValueandSubvalue = false;
            $scope.ShowCurrentMaxValue = false;
            $scope.Formula = $scope.CoreStatProperties.Value.Calculation.formulae;
        }
        if ($scope.CoreStatProperties.TypeId == 5) {
            $scope.ValSub = $scope.CoreStatProperties.ValSub;
            $scope.ShowCalculation = false;
            $scope.ShowChoices = false;
            $scope.ShowValueandSubvalue = true;
            $scope.IsButtonDisabled = false;
            $scope.ShowCurrentMaxValue = false;
        }
        if ($scope.CoreStatProperties.TypeId == 6) {
            $scope.CurrentMaxVal = $scope.CoreStatProperties.CurrentMaxVal;
            $scope.ShowCalculation = false;
            $scope.ShowChoices = false;
            $scope.ShowValueandSubvalue = false;
            $scope.IsButtonDisabled = false;
            $scope.ShowCurrentMaxValue = true;
        }

        rulesetService.GetTypes().then(function (data) {
            if (data.data.StatusCode == 200) {
                $scope.Types = data.data.PayLoad;
                $scope.weight = data.data.PayLoad[6].Units
                $scope.Height = data.data.PayLoad[8].Units
                $scope.Volume = data.data.PayLoad[9].Units
            }
            else {
                if (data.data.StatusCode == 400) {
                    if (data.data.ShowToUser == true) {
                        alert(data.data.ErrorMessage);
                    }
                }
            }
        });
        $scope.addChoice = function () {
            $scope.CoreStatProperties.Value.Choices.choices.push({ ChoiceName: '' });
        }
        $scope.RemoveChoice = function (choice) {
            var idx = $scope.CoreStatProperties.Value.Choices.choices.indexOf(choice);
            $scope.CoreStatProperties.Value.Choices.choices.splice(idx, 1);
        }
        $scope.CoreStatOnChange = function () {
            if ($scope.CoreStatProperties.TypeId == undefined) {
                $scope.IsButtonDisabled = true;
                $scope.ShowChoices = false;
                $scope.ShowCalculation = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            if ($scope.CoreStatProperties.TypeId == 2) {
                $scope.ShowChoices = true;
                $scope.IsButtonDisabled = false;
                $scope.ShowCalculation = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            else {
                $scope.ShowChoices = false;
            }
            if ($scope.CoreStatProperties.TypeId == 16) {
                $scope.ShowCalculation = true;
                $scope.IsButtonDisabled = false;
                $scope.ShowChoices = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = false;
            }
            else {
                $scope.ShowCalculation = false;
            }
            if ($scope.CoreStatProperties.TypeId == 5) {
                $scope.ShowCalculation = false;
                $scope.IsButtonDisabled = false;
                $scope.ShowChoices = false;
                $scope.ShowValueandSubvalue = true;
                $scope.ShowCurrentMaxValue = false;
            }
            else {
                $scope.ShowValueandSubvalue = false;
            }
            if ($scope.CoreStatProperties.TypeId == 6) {
                $scope.ShowCalculation = false;
                $scope.IsButtonDisabled = false;
                $scope.ShowChoices = false;
                $scope.ShowValueandSubvalue = false;
                $scope.ShowCurrentMaxValue = true;
            }
            else {
                $scope.ShowCurrentMaxValue = false;
            }
        }
        $scope.AddValueSubvalue = function (value) {
            if (value == 'Value') {
                $scope.valueName = value;
            }
            else if (value == 'SubValue') {
                $scope.valueName = value;
            }
        }
        $scope.Addcurrentmax = function (value) {
            if (value == 'CurrentValue') {
                $scope.CurrentMaxvalue = value;
            }
            else if (value == 'MaxValue') {
                $scope.CurrentMaxvalue = value;
            }
        }
      
        $scope.ExistCoreStatOnChange = function () {
            if ($scope.CoreStatsInGrid.Name != undefined) {
                var a = "[abc]";
                a = a.replace("abc", $scope.CoreStatsInGrid.Name.Name);
                $scope.tempVar = a;
            }
            else {
                if ($scope.Formula == "" || $scope.Formula == undefined) {
                    $scope.Formula = "";
                }
                else {
                    $scope.Formula = $scope.Formula;
                }
            }
        }
        $scope.CreateFormula = function () {
            if ($scope.Formula == "" || $scope.Formula == undefined) {
                $scope.Formula = $scope.tempVar;
            }
            else if ($scope.Formula != "") {
                $scope.Formula = $scope.Formula + "" + $scope.tempVar;
            }
        }
        
        $scope.SaveCorestat = function () {
            //$scope.CoreStatsNameInGrid = rulesetDataShareService.getRulesetCoreStatData();
            //$scope.CoreStatsNameInGrid = $scope.CoreStatsNameInGrid;
            if ($scope.CoreStatProperties.Name == "" || $scope.CoreStatProperties.Name === undefined || $scope.CoreStatProperties.Name == null) {
                toaster.pop('error', "Please enter CoreStat Name");
                return;
            }
            else if ($scope.CoreStatProperties.TypeId == 0 || $scope.CoreStatProperties.TypeId === undefined || $scope.CoreStatProperties.TypeId == "") {
                toaster.pop('error', "Please Select CoreStat Type");
                return;
            }
            else if ($scope.CoreStatsNameInGrid != undefined) {
                for (var i = 0; i < $scope.CoreStatsNameInGrid.length; i++) {
                    if ($scope.CoreStatsNameInGrid[i].TypeId == 5) {
                      
                    }
                    else if ($scope.CoreStatsNameInGrid[i].TypeId == 6) {
                      
                    }
                  
                }
            }
            for (var k = 0; k < $scope.Types.length; k++) {
                $scope.valueName = $scope.ValSub;
                $scope.CurrentMaxvalue = $scope.CurrentMaxVal;
                if ($scope.Types[k].TypeId == $scope.CoreStatProperties.TypeId) {
                    $scope.CoreStatProperties.TypeName = $scope.Types[k].Name;
                    if (($scope.Types[k].TypeId == 16) && ($scope.CoreStatProperties.TypeId == 16)) {
                        $scope.CoreStatProperties.Value.Calculation.formulae = $scope.Formula;
                    }
                   
                }
                //}

            }
            $uibModalInstance.close($scope.CoreStatProperties);
        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogCopyItem', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', 'characterService', 'dialogs', function ($scope, $uibModalInstance, data, toaster, rulesetService, characterService, dialogs) {


        $scope.AssociatedSpells = data.AssociatedSpells;
        $scope.AssociatedAbilities = data.AssociatedAbilities;

        var Spells = data.Spells;
        var Abilities = data.Abilities;
        $scope.OperationTypeMode = data.ItemMode;
        $scope.Content_ItemProperties = data.Content_ItemProperties;
        $scope.Properties = data.scope;
        $scope.contentType = data.contentType
        $scope.tabName = data.tabName;
        $scope.copyitem = data.item;
        $scope.count = data.count;
        $scope.buttontext = data.btntext;
        $scope.IsBtnDisabled = data.IsBtnDisabled;
        $scope.ShowAssociatedSpells = true;
        $scope.ShowAssociatedAbilities = true;
        $scope.SelectAssociatedSpells = data.SelectAssociatedSpells ;
		$scope.SelectAssociatedAbilities = data.SelectAssociatedAbilities;
		//Upload file
		$scope.OpenFile = function () {
			console.log("Open and upload file...");
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}

		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {

						$scope.Properties[1].Value.Image.image = e.target.result;
					});


				};
				reader.readAsDataURL(input.files[0]);

			}
		}
        $scope.Create = function () {
            if ($scope.Content_ItemProperties != undefined) {
                for (var i = 0; i < $scope.Content_ItemProperties.length; i++) {
                    if ($scope.Content_ItemProperties[i].toLowerCase() == $scope.Properties[0].Value.Text.value.toLowerCase()) {
                        //toaster.pop('Error', "Please enter unique Item Name");
                        alert("Please enter unique Item Name");
                        return;
                    }
                }
            }

            var createItemResult = {};
           
            createItemResult.ItemProperties = $scope.Properties;
            createItemResult.AssociatedSpells = $scope.AssociatedSpells;
            createItemResult.AssociatedAbilities = $scope.AssociatedAbilities;

            $uibModalInstance.close(createItemResult);
        }

        $scope.OpenAssociatedSpells = function () {
            var dlg = dialogs.create('/views/dialogs/AssociatedSpells.html', 'dialogAssociatedSpells',
                { scope: Spells, associatedspells: $scope.AssociatedSpells }
            );

            dlg.result.then(function (res) {
                $scope.AssociatedSpells = res;
            });
        }

        $scope.OpenAssociatedAbilities = function () {
            var dlg = dialogs.create('/views/dialogs/AssociatedAbilities.html', 'dialogAssociatedAbilities',
                { scope: Abilities, associatedabilities: $scope.AssociatedAbilities }
            );

            dlg.result.then(function (res) {
                $scope.AssociatedAbilities = res;
            });
        }

        $scope.DropItem = function () {
            if ($scope.Properties[0].CharacterItemId != undefined) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Item, "' + $scope.Properties[0].Value.Text.value + '", and all associated pages, tabs, and tiles?',
                    {}
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            var deleteitem = characterService.DeleteCharacterContent($scope.Properties[0].CharacterItemId).then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Properties.Action = "Delete";
                                    $uibModalInstance.close($scope.Properties);
                                }


                            })
                        }

                    })
            }
            else if ($scope.Properties[0].CharacterSpellValueId != undefined) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Spell, "' + $scope.Properties[0].Value.Text.value + '"?',
                    {}
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            var deletespell = characterService.DeleteCharacterSpellContent($scope.Properties[0].CharacterSpellId).then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Properties.Action = "Delete";
                                    $uibModalInstance.close($scope.Properties);
                                }


                            })
                        }

                    })
            }
            else if ($scope.Properties[0].CharacterAbilityValueId != undefined) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Ability, "' + $scope.Properties[0].Value.Text.value + '",?',
                    {}
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            var deleteability = characterService.DeleteCharacterAbilityContent($scope.Properties[0].CharacterAbilityId).then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Properties.Action = "Delete";
                                    $uibModalInstance.close($scope.Properties);
                                }

                            });
                        }

                    });
            }


            //$uibModalInstance.close($scope.Properties);
        }
        $scope.EditItem = function () {
            $scope.pageName = "Editing Item";
            $scope.buttontext = "Update";
            $scope.IsButtonDisabled = true;
            $scope.isBtnShow = true;
            var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                { scope: $scope.Properties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow }

            );

            dlg.result.then(function (res) {
                $scope.Properties = res;
                $scope.Properties.Action = "Edit";
                $uibModalInstance.close($scope.Properties);
            });
        }
        $scope.DuplicateItem = function () {
            $scope.pageName = "Copying Item";
            $scope.buttontext = "Copy";
            $scope.IsButtonDisabled = true;
            $scope.isBtnShow = true;
            var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                { scope: item.CharacterItemsValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow }

            );
            dlg.result.then(function (res) {
                $scope.Properties = res;
                $scope.Properties.Action = "Copy";
                $uibModalInstance.close($scope.Properties);
            });

        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }
    }]);
    module.controller('dialogCopySpell', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', function ($scope, $uibModalInstance, data, toaster, rulesetService) {
        $scope.OperationTypeMode = data.SpellMode;
        $scope.Content_SpellProperties = data.Content_SpellProperties;
        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.copyitem = data.item;
        $scope.count = data.count;
        $scope.buttontext = data.btntext;

        $scope.SelectAssociatedSpells = false;
		$scope.ShowAssociatedAbilities = false;
		$scope.showimagebtns = false;
		//Upload file
		$scope.OpenFile = function () {
			console.log("Open and upload file...");
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}

		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {

						$scope.Properties[1].Value.Image.image = e.target.result;
					});


				};
				reader.readAsDataURL(input.files[0]);

			}
		}
        $scope.Create = function () {
            if ($scope.Content_SpellProperties != undefined) {
                for (var i = 0; i < $scope.Content_SpellProperties.length; i++) {
                    if ($scope.Content_SpellProperties[i].toLowerCase() == $scope.Properties[0].Value.Text.value.toLowerCase()) {
                        //toaster.pop('Error', "Please enter unique Spell Name");
                        toaster.pop('error', 'Please enter unique Spell Name');

                        return;
                    }
                }
            }
            $uibModalInstance.close($scope.Properties);
        }


        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogCopyAbility', ['$scope', '$uibModalInstance', 'data', 'toaster', 'rulesetService', function ($scope, $uibModalInstance, data, toaster, rulesetService) {
        $scope.OperationTypeMode = data.AbilityMode;
        $scope.Content_AbilityProperties = data.Content_AbilityProperties;
        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.copyitem = data.item;
        $scope.count = data.count;
        $scope.buttontext = data.btntext;

        $scope.SelectAssociatedSpells = false;
		$scope.ShowAssociatedAbilities = false;
		$scope.showimagebtns = false;
		//Upload file
		$scope.OpenFile = function () {
			console.log("Open and upload file...");
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}

		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {

						$scope.Properties[1].Value.Image.image = e.target.result;
					});


				};
				reader.readAsDataURL(input.files[0]);

			}
		}
        $scope.Create = function () {
            if ($scope.Content_AbilityProperties != undefined) {
                for (var i = 0; i < $scope.Content_AbilityProperties.length; i++) {
                    if ($scope.Content_AbilityProperties[i].toLowerCase() == $scope.Properties[0].Value.Text.value.toLowerCase()) {
                        //toaster.pop('Error', "Please enter unique Ability Name");
                        //alert("Please enter unique Ability Name");
                        toaster.pop('error', "Please enter unique Ability Name");
                        return;
                    }
                }
            }
            $uibModalInstance.close($scope.Properties);
        }


        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('ShowItems', ['$scope', '$rootScope', '$uibModalInstance', 'data', 'characterService', 'dialogs', function ($scope, $rootScope, $uibModalInstance, data, characterService, dialogs) {

        $scope.Properties = data.scope;
        $scope.EditItem = function (item, count, num) {
            if (num == 1) {
                $scope.pageName = "Editing Item";
                $scope.buttontext = "Update";
                $scope.IsButtonDisabled = true;
                $scope.isBtnShow = true;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                    { scope: item.CharacterItemsValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Fullscope: item }

                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (count == 0) {
                            $scope.RemainingItemData = [];
                            for (var k = 0; k < $scope.Properties.length; k++) {
                                if (k != 0) {
                                    $scope.RemainingItemData.push($scope.Properties[k].CharacterItemsValues);

                                }
                            }
                            var ItemProperties = { "CharacterItemsValues": res };
                            $scope.Properties.splice(count);
                            $scope.Properties.push(ItemProperties);
                            for (var j = 0; j < $scope.RemainingItemData.length; j++) {
                                var RemainingItemProperties = { "CharacterItemsValues": $scope.RemainingItemData[j] };
                                $scope.Properties.push(RemainingItemProperties);
                            }

                        }
                        else {
                            var ItemProperties = { "CharacterItemsValues": res };
                            $scope.Properties.splice(count);
                            $scope.Properties.push(ItemProperties);
                        }
                    }
                });
            }
            else if (num == 2) {
                $scope.pageName = "Editing Spell";
                $scope.buttontext = "Update";
                $scope.isBtnShow = true;
                //var indexcount = count - 1;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                    { scope: item.CharacterSpellsValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullSpellscope: item }

                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (count == 0) {
                            $scope.RemainingSpellData = [];
                            for (var k = 0; k < $scope.Properties.length; k++) {
                                if (k != 0) {
                                    $scope.RemainingSpellData.push($scope.Properties[k].CharacterSpellsValues);

                                }
                            }
                            var SpellProperties = { "CharacterSpellsValues": res };
                            $scope.Properties.splice(count);
                            $scope.Properties.push(SpellProperties);
                            for (var j = 0; j < $scope.RemainingSpellData.length; j++) {
                                var RemainingSpellProperties = { "CharacterSpellsValues": $scope.RemainingSpellData[j] };
                                $scope.Properties.push(RemainingSpellProperties);
                            }

                        }
                        else {
                            var SpellProperties = { "CharacterSpellsValues": res };
                            $scope.Properties.splice(count);
                            $scope.Properties.push(SpellProperties);
                        }
                    }
                });
            }
            else if (num == 3) {
                $scope.pageName = "Editing Ability";
                $scope.buttontext = "Update";
                $scope.isBtnShow = true;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                    { scope: item.CharacterAbilitiesValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullAbilityScope: item }

                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        if (count == 0) {
                            $scope.RemainingAbilityData = [];
                            for (var k = 0; k < $scope.Properties.length; k++) {
                                if (k != 0) {
                                    $scope.RemainingAbilityData.push($scope.Properties[k].CharacterAbilitiesValues);
                                }
                            }
                            var AbilityProperties = { "CharacterAbilitiesValues": res };
                            $scope.Properties.splice(count);
                            $scope.Properties.push(AbilityProperties);
                            for (var j = 0; j < $scope.RemainingAbilityData.length; j++) {
                                var RemainingAbilityProperties = { "CharacterAbilitiesValues": $scope.RemainingAbilityData[j] };
                                $scope.Properties.push(RemainingAbilityProperties);
                            }
                        }
                        else {
                            var AbilityProperties = { "CharacterAbilitiesValues": res };
                            $scope.Properties.splice(count);
                            $scope.Properties.push(AbilityProperties);
                        }
                    }

                });
            }


        };
        $scope.CopyItem = function (item, index, num) {
            if (num == 1) {
                $scope.pageName = "Copying Item";
                $scope.buttontext = "Copy";
                $scope.IsButtonDisabled = true;
                $scope.isBtnShow = true;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                    { scope: item.CharacterItemsValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Fullscope: item }

                );
                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        var ItemProperties = { "CharacterItemsValues": res };
                        $scope.Properties.push(ItemProperties);
                    }
                });
            }
            else if (num == 2) {
                $scope.pageName = "Copying Spell";
                $scope.buttontext = "Copy";
                $scope.isBtnShow = true;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                    { scope: item.CharacterSpellsValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullSpellscope: item }

                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        var SpellProperties = { "CharacterSpellsValues": res };
                        $scope.Properties.push(SpellProperties);

                    }

                });
            }
            else if (num == 3) {
                $scope.pageName = "Copying Ability";
                $scope.buttontext = "Copy";
                $scope.isBtnShow = true;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                    { scope: item.CharacterAbilitiesValues, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullAbilityScope: item }

                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        var AbilityProperties = { "CharacterAbilitiesValues": res };
                        $scope.Properties.push(AbilityProperties);
                    }


                });
            }

        };
        $scope.ShowAllItemProperties = function (item, count) {
            var dlg = dialogs.create('/views/dialogs/characteritemcontent.html', 'dialogCopyItem',
                { scope: item.CharacterItemsValues }
            );
            dlg.result.then(function (res) {
                if (res.Action == "Delete") {
                    var index = -1;
                    var deleteitem = eval($scope.Properties);
                    //deleteitem[i].CharacterItemsValues.Action = "Delete";
                    for (var i = 0; i < deleteitem.length; i++) {
                        if (deleteitem[i].CharacterItemsValues === res) {
                            index = i;
                            break;
                        }
                    }
                    $scope.Properties.splice(index, 1);
                    //if (index === -1) {
                    //    alert("Something gone wrong");
                    //}

                }
                else if (res.Action == "Edit") {
                    if (count == 0) {
                        $scope.RemainingItemData = [];
                        for (var k = 0; k < $scope.Properties.length; k++) {
                            if (k != 0) {
                                $scope.RemainingItemData.push($scope.Properties[k].CharacterItemsValues);

                            }
                        }
                        var ItemProperties = { "CharacterItemsValues": res };
                        $scope.Properties.splice(count);
                        $scope.Properties.push(ItemProperties);
                        for (var j = 0; j < $scope.RemainingItemData.length; j++) {
                            var RemainingItemProperties = { "CharacterItemsValues": $scope.RemainingItemData[j] };
                            $scope.Properties.push(RemainingItemProperties);
                        }

                    }
                    else {
                        var ItemProperties = { "CharacterItemsValues": res };
                        $scope.Properties.splice(count);
                        $scope.Properties.push(ItemProperties);
                    }
                }
                else if (res.Action == "Copy") {
                    var ItemProperties = { "CharacterItemsValues": res };
                    $scope.Properties.push(ItemProperties);
                }
            });
        }
        $scope.ShowAllSpellProperties = function (item, count) {
            var dlg = dialogs.create('/views/dialogs/characterspellcontent.html', 'dialogCopyItem',
                { scope: item.CharacterSpellsValues }
            );
            dlg.result.then(function (res) {
                if (res.Action == "Delete") {
                    var index = -1;
                    var deletespell = eval($scope.Properties);
                    //deletespell[i].CharacterSpellsValues.Action = "Delete";
                    for (var i = 0; i < deletespell.length; i++) {
                        if (deletespell[i].CharacterSpellsValues === res) {
                            index = i;
                            break;
                        }
                    }
                    $scope.Properties.splice(index, 1);
                    //if (index === -1) {
                    //    alert("Something gone wrong");
                    //}

                }
                else if (res.Action == "Edit") {
                    if (count == 0) {
                        $scope.RemainingSpellData = [];
                        for (var k = 0; k < $scope.Properties.length; k++) {
                            if (k != 0) {
                                $scope.RemainingSpellData.push($scope.Properties[k].CharacterSpellsValues);

                            }
                        }
                        var SpellProperties = { "CharacterSpellsValues": res };
                        $scope.Properties.splice(count);
                        $scope.Properties.push(SpellProperties);
                        for (var j = 0; j < $scope.RemainingSpellData.length; j++) {
                            var RemainingSpellProperties = { "CharacterSpellsValues": $scope.RemainingSpellData[j] };
                            $scope.Properties.push(RemainingSpellProperties);
                        }

                    }
                    else {
                        var SpellProperties = { "CharacterSpellsValues": res };
                        $scope.Properties.splice(count);
                        $scope.Properties.push(SpellProperties);
                    }
                }
                else if (res.Action == "Copy") {
                    var SpellProperties = { "CharacterSpellsValues": res };
                    $scope.Properties.push(SpellProperties);
                }
            });
        }
        $scope.ShowAllAbilityProperties = function (item, count) {
            var dlg = dialogs.create('/views/dialogs/characterabilitycontent.html', 'dialogCopyItem',
                { scope: item.CharacterAbilitiesValues }
            );
            dlg.result.then(function (res) {
                if (res.Action == "Delete") {
                    var index = -1;
                    var deleteability = eval($scope.Properties);
                    // deleteability[i].CharacterAbilitiesValues.Action = "Delete";
                    for (var i = 0; i < deleteability.length; i++) {
                        if (deleteability[i].CharacterAbilitiesValues === res) {
                            index = i;
                            break;
                        }
                    }
                    $scope.Properties.splice(index, 1);
                    //if (index === -1) {
                    //    alert("Something gone wrong");
                    //}

                }
                else if (res.Action == "Edit") {
                    if (count == 0) {
                        $scope.RemainingAbilityData = [];
                        for (var k = 0; k < $scope.Properties.length; k++) {
                            if (k != 0) {
                                $scope.RemainingAbilityData.push($scope.Properties[k].CharacterAbilitiesValues);

                            }
                        }
                        var AbilityProperties = { "CharacterAbilitiesValues": res };
                        $scope.Properties.splice(count);
                        $scope.Properties.push(AbilityProperties);
                        for (var j = 0; j < $scope.RemainingAbilityData.length; j++) {
                            var RemainingAbilityProperties = { "CharacterAbilitiesValues": $scope.RemainingAbilityData[j] };
                            $scope.Properties.push(RemainingAbilityProperties);
                        }

                    }
                    else {
                        var AbilityProperties = { "CharacterAbilitiesValues": res };
                        $scope.Properties.splice(count);
                        $scope.Properties.push(AbilityProperties);
                    }
                }
                else if (res.Action == "Copy") {
                    var AbilityProperties = { "CharacterAbilitiesValues": res };
                    $scope.Properties.push(AbilityProperties);
                }
            });
        }
        $scope.Removeitem = function (item, Num) {
            if (Num == 1) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Item, "' + item.CharacterItemsValues[0].Value.Text.value + '", and all associated pages, tabs, and tiles?',
                    {}
                );

                dlg.result.then(
                    function (res) {

                    
                        if (res == "yes") {
                            var deleteitem = characterService.DeleteCharacterContent(item.CharacterItemsValues[0].CharacterItemId).then(function (data) {
                              
                                if (data.data.StatusCode == 200) {
                                    var index = -1;
                                    var deleteitem = eval($scope.Properties);
                                    for (var i = 0; i < deleteitem.length; i++) {
                                        if (deleteitem[i].CharacterItemsValues === item.CharacterItemsValues) {
                                            index = i;
                                            break;
                                        }
                                    }
                                    $scope.Properties.splice(index, 1);

                                  
                                }

                               
                            })
                        }

                    })

            }
            else if (Num == 2) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Spell, "' + item.CharacterSpellsValues[0].Value.Text.value + '",?',
                    {}
                );

                dlg.result.then(
                    function (res) {
                       
                        if (res == "yes") {
                            var deleteitem = characterService.DeleteCharacterSpellContent(item.CharacterSpellsValues[0].CharacterSpellId).then(function (data) {
                               
                                if (data.data.StatusCode == 200) {
                                    var index = -1;
                                    var deletespell = eval($scope.Properties);
                                    for (var i = 0; i < deletespell.length; i++) {
                                        if (deletespell[i].CharacterSpellsValues === item.deletespell) {
                                            index = i;
                                            break;
                                        }
                                    }
                                    $scope.Properties.splice(index, 1);
                                  
                                }

                                //$uibModalInstance.close($scope.Properties);
                            })
                        }

                    })
            }
            else if (Num == 3) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Ability, "' + item.CharacterAbilitiesValues[0].Value.Text.value + '",?',
                    {}
                );

                dlg.result.then(
                    function (res) {
                        
                        if (res == "yes") {
                            var deleteitem = characterService.DeleteCharacterAbilityContent(item.CharacterAbilitiesValues[0].CharacterAbilityId).then(function (data) {
                               
                                if (data.data.StatusCode == 200) {
                                    var index = -1;
                                    var deleteability = eval($scope.Properties);
                                    for (var i = 0; i < deleteability.length; i++) {
                                        if (deleteability[i].CharacterAbilitiesValues === item.deleteability) {
                                            index = i;
                                            break;
                                        }
                                    }
                                    $scope.Properties.splice(index, 1);
                                   
                                }

                                //$uibModalInstance.close($scope.Properties);
                            })
                        }

                    })
            }

            //$uibModalInstance.close($scope.Properties);
        }

        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogEditCharacterItem', ['$scope', '$uibModalInstance', 'data', 'characterService', 'dialogs', 'rulesetDataShareService', function ($scope, $uibModalInstance, data, characterService, dialogs, rulesetDataShareService) {
        debugger;
        $scope.AssociatedSpells = data.AssocSpells;
        $scope.AssociatedAbilities = data.AssocAbilities;

        $scope.ShowAssociatedSpells = true;
        $scope.ShowAssociatedAbilities = true;

        if (data.tabName == "Editing Spell" || data.tabName == "Copying Spell" || data.tabName == "Editing Ability" || data.tabName == "Copying Ability") {
            $scope.ShowAssociatedSpells = false;
            $scope.ShowAssociatedAbilities = false;
        }

        $scope.Properties = data.scope;
        $scope.Items = data.Fullscope;
        $scope.Spells = data.FullSpellscope;
        $scope.Abilities = data.FullAbilityScope;
        $scope.tabName = data.tabName;
        $scope.copyitem = data.item;
        $scope.count = data.count;
        $scope.buttontext = data.btntext;
        $scope.IsBtnDisabled = data.IsBtnDisabled;
        $scope.OperationTypeMode = data.OperationTypeMode;
        $scope.SelectAssociatedSpells = data.SelectAssociatedSpells;
        $scope.SelectAssociatedAbilities = data.SelectAssociatedAbilities;
        $scope.CharacterId = data.CharacterId;

        $scope.Create = function () {
          
            $("#loading").css("display", "block");
            $scope.OperationTypeMode = "Create";
            if ($scope.Properties[0].CharacterItemId != undefined) {
                if ($scope.AssociatedSpellsChanged != undefined) {
                    $scope.Items.AssociatedSpells = $scope.AssociatedSpellsChanged
                }
                if ($scope.AssociatedAbilitiesChanged != undefined) {
                    $scope.Items.AssociatedAbilities = $scope.AssociatedAbilitiesChanged
                }
                if ($scope.Items == undefined) {

                    var Items = {
                        CharacterItemId: $scope.Properties[0].CharacterItemId,
                        CharacterItemsValues: $scope.Properties
                    };
                    $scope.Items = Items;
                }
                else {
                    $scope.Items.CharacterItemsValues = $scope.Properties;
                }
            }
            else if ($scope.Properties[0].CharacterSpellId != undefined) {
                if ($scope.Spells == undefined) {
                    var Spells = {
                        CharacterSpellId: $scope.Properties[0].CharacterSpellId,
                        CharacterSpellsValues: $scope.Properties
                    };
                    $scope.Spells = Spells;
                }
                else {
                    $scope.Spells.CharacterSpellsValues = $scope.Properties;
                }
            }
            else if ($scope.Properties[0].CharacterAbilityId != undefined) {
                if ($scope.Abilities == undefined) {
                    var Abilities = {
                        CharacterAbilityId: $scope.Properties[0].CharacterAbilityId,
                        CharacterAbilitiesValues: $scope.Properties
                    };
                    $scope.Abilities = Abilities;
                }
                else {
                    $scope.Abilities.CharacterAbilitiesValues = $scope.Properties;
                }
            }
            if ($scope.buttontext == "Update" && $scope.Items != undefined) {
                var CharacterContent = {
                    CharacterItem: $scope.Items,
                    CharacterSpell: null,
                    CharacterAbility: null
                };

                var edititem = characterService.EditCharacterContent(CharacterContent).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $uibModalInstance.close(data.data.PayLoad.CharacterItem);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
            else if ($scope.buttontext == "Copy" && $scope.Items != undefined) {
                var CharacterContent = {
                    CharacterItem: $scope.Items,
                    CharacterSpell: null,
                    CharacterAbility: null
                };
                var copyitem = characterService.CopyCharacterContent(CharacterContent).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $uibModalInstance.close(data.data.PayLoad.CharacterItem);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
            else if ($scope.buttontext == "Update" && $scope.Spells != undefined) {
                var CharacterContent = {
                    CharacterItem: null,
                    CharacterSpell: $scope.Spells,
                    CharacterAbility: null
                };
                var editspell = characterService.EditCharacterContent(CharacterContent).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $uibModalInstance.close(data.data.PayLoad.CharacterSpell);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
            else if ($scope.buttontext == "Copy" && $scope.Spells != undefined) {
                var CharacterContent = {
                    CharacterItem: null,
                    CharacterSpell: $scope.Spells,
                    CharacterAbility: null
                };
                var copyspell = characterService.CopyCharacterContent(CharacterContent).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        //$scope.Properties = data.data.PayLoad.CharacterSpell.CharacterSpellsProperties;
                        $uibModalInstance.close(data.data.PayLoad.CharacterSpell);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }

            else if ($scope.buttontext == "Update" && $scope.Abilities != undefined) {
                var CharacterContent = {
                    CharacterItem: null,
                    CharacterSpell: null,
                    CharacterAbility: $scope.Abilities
                };
                var editability = characterService.EditCharacterContent(CharacterContent).then(function (data) {
                    if (data.data.StatusCode == 200) {
                      
                        $uibModalInstance.close(data.data.PayLoad.CharacterAbility);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
            else if ($scope.buttontext == "Copy" && $scope.Abilities != undefined) {
                var CharacterContent = {
                    CharacterItem: null,
                    CharacterSpell: null,
                    CharacterAbility: $scope.Abilities
                };
                var copyability = characterService.CopyCharacterContent(CharacterContent).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        //$scope.Properties = data.data.PayLoad.CharacterAbility.CharacterAbilitiesProperties;
                        $uibModalInstance.close(data.data.PayLoad.CharacterAbility);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
            //$uibModalInstance.close($scope.Properties);
        }

        $scope.OpenAssociatedSpells = function () {
            var Spells = rulesetDataShareService.getLayoutSpellInventoryData();
            if (angular.equals({}, Spells) == false) {
                var dlg = dialogs.create('/views/dialogs/CharacterAssociatedSpells.html', 'dialogCharacterAssociatedSpells',
                    { scope: Spells.CharacterSpells, associatedspells: $scope.AssociatedSpells }
                );
                dlg.result.then(function (res) {
                    $scope.AssociatedSpellsChanged = res;
                });
            }
            else {
                var spellcontent = characterService.GetCharacterSpellContent($scope.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var Spells = data.data.PayLoad;
                        rulesetDataShareService.setLayoutSpellInventoryData(Spells);
                        var dlg = dialogs.create('/views/dialogs/CharacterAssociatedSpells.html', 'dialogCharacterAssociatedSpells',
                            { scope: Spells.CharacterSpells, associatedspells: $scope.AssociatedSpells }
                        );
                        dlg.result.then(function (res) {
                            $scope.AssociatedSpellsChanged = res;
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
        }

        $scope.OpenAssociatedAbilities = function () {
            var Abilities = rulesetDataShareService.getLayoutAbilityInventoryData();
            if (angular.equals({}, Abilities) == false) {
                var dlg = dialogs.create('/views/dialogs/CharacterAssociatedAbilities.html', 'dialogCharacterAssociatedAbilities',
                    { scope: Abilities.CharacterAbilities, associatedabilities: $scope.AssociatedAbilities }
                );

                dlg.result.then(function (res) {
                    $scope.AssociatedAbilitiesChanged = res;
                });
            }
            else {
                var abilitycontent = characterService.GetCharacterAbilityContent($scope.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var Abilities = data.data.PayLoad;
                        rulesetDataShareService.setLayoutAbilityInventoryData(Abilities);
                        var dlg = dialogs.create('/views/dialogs/CharacterAssociatedAbilities.html', 'dialogCharacterAssociatedAbilities',
                            { scope: Abilities.CharacterAbilities, associatedabilities: $scope.AssociatedAbilities }
                        );

                        dlg.result.then(function (res) {
                            $scope.AssociatedAbilitiesChanged = res;
                        });
                    }
                })
            }
        }

        $scope.cancel = function () {
            //$("#loading").css("display", "block");
            $uibModalInstance.close('cancel');
            //$("#loading").fadeOut("slow");
        }
    }]);

    module.controller('dialogCharacterAssociatedSpells', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {
        $scope.Spells = data.scope;

        var AssociatedSpells = data.associatedspells;

        if (AssociatedSpells != null && AssociatedSpells != undefined) {
            for (var i = 0; i < $scope.Spells.length; i++) {
                for (var j = 0; j < AssociatedSpells.length; j++) {
                    if ($scope.Spells[i].CharacterSpellsProperties[0].Value.Text.value == AssociatedSpells[j].CharacterSpellsProperties[0].Value.Text.value) {
                        $scope.Spells[i].Selected = true;
                    }
                }
            }
        }
        $scope.SaveAssociatedSpells = function () {
            var exampleArray = [];
            for (var i = 0; i < $scope.Spells.length; i++) {
                if ($scope.Spells[i].Selected) {
                    exampleArray.push($scope.Spells[i]);
                }
            }
            $uibModalInstance.close(exampleArray)
        }
        $scope.cancel = function () {
            //$("#loading").css("display", "block");
            $uibModalInstance.close('cancel');
            //$("#loading").fadeOut("slow");
        }
    }]);

    module.controller('dialogCharacterAssociatedAbilities', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'dialogs', function ($scope, $uibModalInstance, data, characterService, dialogs) {
        $scope.Abilities = data.scope;

        var AssociatedAbilities = data.associatedabilities;

        if (AssociatedAbilities != null && AssociatedAbilities != undefined) {
            for (var i = 0; i < $scope.Abilities.length; i++) {
                for (var j = 0; j < AssociatedAbilities.length; j++) {
                    if ($scope.Abilities[i].CharacterAbilitiesProperties[0].Value.Text.value == AssociatedAbilities[j].CharacterAbilitiesProperties[0].Value.Text.value) {
                        $scope.Abilities[i].Selected = true;
                    }
                }
            }
        }
        $scope.SaveAssociatedAbilities = function () {
            var exampleArray = [];
            for (var i = 0; i < $scope.Abilities.length; i++) {
                if ($scope.Abilities[i].Selected) {
                    exampleArray.push($scope.Abilities[i]);
                }
            }
            $uibModalInstance.close(exampleArray)
        }
        $scope.cancel = function () {
            //$("#loading").css("display", "block");
            $uibModalInstance.close('cancel');
            //$("#loading").fadeOut("slow");
        }

    }]);

    module.controller('dialogCreateInventoryItem', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'characterService', 'rulesetDataShareService', 'dialogs','toaster', function ($scope, $uibModalInstance, data, rulesetService, characterService, rulesetDataShareService, dialogs,toaster) {

        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.buttontext = data.btntext;
        $scope.IsBtnDisabled = data.IsBtnDisabled;
        $scope.InventoryItems = data.NewInventory;
        $scope.CharacterId = data.CharacterId;

        $scope.ShowAssociatedSpells = true;
        $scope.ShowAssociatedAbilities = true;

        $scope.OpenAssociatedSpells = function () {
            var Spells = rulesetDataShareService.getLayoutSpellInventoryData();
            if (angular.equals({}, Spells) == false) {
                var dlg = dialogs.create('/views/dialogs/CharacterAssociatedSpells.html', 'dialogCharacterAssociatedSpells',
                    { scope: Spells.CharacterSpells, associatedspells: $scope.AssociatedSpells }
                );
                dlg.result.then(function (res) {
                    $scope.AssociatedSpells = res;
                });
            }
            else {
                var spellcontent = characterService.GetCharacterSpellContent($scope.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var Spells = data.data.PayLoad;
                        rulesetDataShareService.setLayoutSpellInventoryData(Spells);
                        var dlg = dialogs.create('/views/dialogs/CharacterAssociatedSpells.html', 'dialogCharacterAssociatedSpells',
                            { scope: Spells.CharacterSpells, associatedspells: $scope.AssociatedSpells }
                        );
                        dlg.result.then(function (res) {
                            $scope.AssociatedSpells = res;
                        });
                    }
                })
            }
        }

        $scope.OpenAssociatedAbilities = function () {
            var Abilities = rulesetDataShareService.getLayoutAbilityInventoryData();
            if (angular.equals({}, Abilities) == false) {
                var dlg = dialogs.create('/views/dialogs/CharacterAssociatedAbilities.html', 'dialogCharacterAssociatedAbilities',
                    { scope: Abilities.CharacterAbilities, associatedabilities: $scope.AssociatedAbilities }
                );

                dlg.result.then(function (res) {
                    $scope.AssociatedAbilities = res;
                });
            }
            else {
                var abilitycontent = characterService.GetCharacterAbilityContent($scope.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var Abilities = data.data.PayLoad;
                        rulesetDataShareService.setLayoutAbilityInventoryData(Abilities);
                        var dlg = dialogs.create('/views/dialogs/CharacterAssociatedAbilities.html', 'dialogCharacterAssociatedAbilities',
                            { scope: Abilities.CharacterAbilities, associatedabilities: $scope.AssociatedAbilities }
                        );

                        dlg.result.then(function (res) {
                            $scope.AssociatedAbilities = res;
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                        }
                    }
                })
            }
        }
        $scope.Create = function () {
            $("#loading").css("display", "block");
            if ($scope.Properties[0].CharacterItemId != undefined) {
                $scope.InventoryItems.CharacterItems.CharacterProfileId = $scope.CharacterId;
                $scope.InventoryItems.CharacterItems.CharacterItemsProperties = $scope.Properties;
                $scope.InventoryItems.CharacterItems.AssociatedSpells = $scope.AssociatedSpells;
                $scope.InventoryItems.CharacterItems.AssociatedAbilities = $scope.AssociatedAbilities;
            }
            var InventoryItems = [];
            InventoryItems.push($scope.InventoryItems.CharacterItems);
            var items = characterService.CreateCharacterInventoryItems(InventoryItems).then(function (data) {
                if (data.data.StatusCode == 200) {
                    if (data.data.PayLoad.length != 0) {
                        for (var i = 0; i < data.data.PayLoad.length; i++) {
                            $scope.Properties = data.data.PayLoad[i];
                        }
                    }
                    $uibModalInstance.close($scope.Properties);
                    $("#loading").fadeOut("slow");
                }
                else if (data.data.StatusCode == 400) {
                    if (data.data.ShowToUser == true)
                    {
                        toaster.pop('error', data.data.ErrorMessage);
                    }
                }
            })
        }

        $scope.ItemcloseDialog = function () {

            $uibModalInstance.close($scope.CoreStatProperties);
        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogCreateInventorySpell', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'characterService', function ($scope, $uibModalInstance, data, rulesetService, characterService) {

        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.buttontext = data.btntext;
        $scope.IsBtnDisabled = data.IsBtnDisabled;
        $scope.InventorySpells = data.NewInventory;
        $scope.CharacterId = data.CharacterId;
        $scope.Create = function () {
            //$("#loading").css("display", "block");
            if ($scope.Properties[0].CharacterSpellId != undefined) {
                $scope.InventorySpells.CharacterSpells.CharacterProfileId = $scope.CharacterId;
                $scope.InventorySpells.CharacterSpells.CharacterSpellsProperties = $scope.Properties;
            }
            var InventorySpells = [];
            InventorySpells.push($scope.InventorySpells.CharacterSpells);
            var items = characterService.CreateCharacterInventorySpells(InventorySpells).then(function (data) {
                if (data.data.StatusCode == 200) {
                    if (data.data.PayLoad.length != 0) {
                        for (var i = 0; i < data.data.PayLoad.length; i++) {
                            $scope.Properties = data.data.PayLoad[i];
                        }
                    }
                    $uibModalInstance.close($scope.Properties);
                    $("#loading").fadeOut("slow");
                }
                else if (data.data.StatusCode == 400) {
                    if (data.data.ShowToUser == true) {
                        toaster.pop('error', data.data.ErrorMessage);
                    }
                }
            });
        }
        $scope.ItemcloseDialog = function () {

            $uibModalInstance.close($scope.CoreStatProperties);
        }
        $scope.cancel = function () {
          //  $("#loading").css("display", "block");
            $uibModalInstance.close('cancel');
           // $("#loading").fadeOut("slow");
        }

    }]);

    module.controller('dialogCreateInventoryAbility', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'characterService', function ($scope, $uibModalInstance, data, rulesetService, characterService) {

        $scope.Properties = data.scope;
        $scope.tabName = data.tabName;
        $scope.buttontext = data.btntext;
        $scope.IsBtnDisabled = data.IsBtnDisabled;
        $scope.InventoryAbility = data.NewInventory;
        $scope.CharacterId = data.CharacterId;
        $scope.Create = function () {
            if ($scope.Properties[0].CharacterAbilityId != undefined) {
                $scope.InventoryAbility.CharacterAbilities.CharacterProfileId = $scope.CharacterId;
                $scope.InventoryAbility.CharacterAbilities.CharacterAbilitiesProperties = $scope.Properties;
            }
            var InventoryAbility = [];
            InventoryAbility.push($scope.InventoryAbility.CharacterAbilities);
            var items = characterService.CreateCharacterInventoryAbility(InventoryAbility).then(function (data) {
                if (data.data.StatusCode == 200) {
                    if (data.data.PayLoad.length != 0) {
                        for (var i = 0; i < data.data.PayLoad.length; i++) {
                            $scope.Properties = data.data.PayLoad[i];
                        }
                    }
                    $uibModalInstance.close($scope.Properties);
                }
               else if (data.data.StatusCode == 400) {
                    if (data.data.ShowToUser == true)
                    {
                        toaster.pop('error', data.data.ErrorMessage);
                    }
                }
            })
        }

        $scope.ItemcloseDialog = function () {

            $uibModalInstance.close($scope.CoreStatProperties);
        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    //TileContoller dialogs

    module.controller('NoteTile', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'toaster', 'dialogs', 'rulesetDataShareService', function ($scope, $uibModalInstance, data, rulesetService, toaster, dialogs, rulesetDataShareService) {
        $scope.NoteTile = data.scope;
        $scope.LinkExecuteTileContent = rulesetDataShareService.getLinkTileData();
        if (angular.equals({}, $scope.LinkExecuteTileContent) == true) {
            $scope.LinkExecuteTileContent = data.RuleSetContentForLinkExecuteTile;
            if (angular.isUndefined($scope.LinkExecuteTileContent) == true) {
                $scope.LinkExecuteTileContent = data.fullscope;
            }
        }
        $scope.Fullscope = data.fullscope;
        $scope.Modes = data.mode;
       
        $scope.TileBorder = function () {

            var dlg = dialogs.create('/views/dialogs/SelectTileBorder.html', 'dialogTileBorder',
                { scope: $scope.NoteTile.Styles }

            );

            dlg.result.then(function (res) {
                switch (res.shadow) {
                    case "Use default":
                        res.shadow = "10px 10px";
                        break;
                    case "Yes":
                        res.shadow = "10px 10px 5px grey";
                        break;
                    case "No":
                        res.shadow = "";
                        break;
                    default:
                        res.shadow = "";
                        break;

                }
                if (res.shadow == null || res.shadow == "") res.shadow = "";
                if (res.backgroundColor == null || res.backgroundColor == "#008fff" || res.shadow == "") res.backgroundColor = "";
                if (res.color == null || res.shadow == "") res.color = "";
                if (res.radius == null || res.shadow == "") res.radius = "";
                if (res.style == null || res.shadow == "") res.style = "";
                if (res.width == null || res.shadow == "") res.width = "";
                $scope.NoteTile.Styles = res;
            });
        }
        $scope.TileTitleBackground = function () {

            var dlg = dialogs.create('/views/dialogs/SelectTileTitleBackground.html', 'dialogTileBorder',
                { scope: $scope.NoteTile.Styles }

            );

            dlg.result.then(function (res) {
               
                $scope.NoteTile.Styles = res;
            });
        }

        //Getting Unique id
        function uniqId() {
            return Math.round(new Date().getTime() + (Math.random() * 100));
        }
        $scope.SaveTile = function () {
            $("#loading").css("display", "block");
            if (angular.isUndefined($scope.NoteTile.Styles) == false) {
                if ($scope.NoteTile.Styles != null) {
                    //$scope.NoteTile.Styles.backgroundColor = $("#backgroundcolor").val();
                }
            }
            if ($scope.NoteTile.EditClientId == 0) {
                $scope.NoteTile.EditClientId = uniqId();
            }
            $uibModalInstance.close($scope.NoteTile);
            $("#loading").fadeOut("slow");
        }

        $scope.SaveCounterTile = function () {
            $("#loading").css("display", "block");
            if ($scope.NoteTile.Value.Counter.Min > $scope.NoteTile.Value.Counter.Max) {
                toaster.pop('error', "Min Value Should be Less Than Max Value ");
            }
            else {
                if ($scope.NoteTile.Styles != null) {
                    $scope.NoteTile.Styles.backgroundColor = $("#backgroundcolor").val();
                }
                if ($scope.NoteTile.EditClientId == 0) {
                    $scope.NoteTile.EditClientId = uniqId();
                }
                $uibModalInstance.close($scope.NoteTile);
                $("#loading").fadeOut("slow");
            }
        }
        $scope.SaveAttributeTile = function () {
            for (var i = 0; i < $scope.NoteTile.CorestatValues.length; i++) {
                if ($scope.NoteTile.CorestatValues[i].Name != null) {
                    if ($scope.NoteTile.Value.Attribute.CorestatValue == $scope.NoteTile.CorestatValues[i].Name) {
                        $scope.NoteTile.Value.Attribute.CoreStatValue = $scope.NoteTile.CorestatValues[i].Value;
                        if ($scope.NoteTile.CorestatValues[i].Id == 0) {
                            toaster.pop("error", "CoreStats Values are not saved for " + $scope.NoteTile.CorestatValues[i].Name + "  CoreStat");
                            return false;
                        }
                        $scope.NoteTile.Value.Attribute.CoreStatValueId = $scope.NoteTile.CorestatValues[i].Id;
                        $scope.NoteTile.Value.Attribute.TypeId = $scope.NoteTile.CorestatValues[i].TypeId;
                        $scope.NoteTile.Value.Attribute.CharacterProfileId = $scope.NoteTile.CorestatValues[i].CharacterId;
                        $scope.NoteTile.Value.Attribute.CorestatValue = $scope.NoteTile.CorestatValues[i].Name;
                        $scope.NoteTile.Value.Attribute.AttributeContent = $scope.NoteTile.CorestatValues[i];
                        $scope.NoteTile.Value.Attribute.Name = $scope.NoteTile.CorestatValues[i].Name;
                        $scope.NoteTile.Value.Attribute.SelectedCorestatValue = $scope.NoteTile.CorestatValues[i].Name;
                        if ($scope.NoteTile.Value.Attribute.TypeId == 1) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Text:" + $scope.NoteTile.CorestatValues[i].Value.Text.value;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 2) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Choices:" + $scope.NoteTile.CorestatValues[i].Value.Choices;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 3) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "On/Off:" + $scope.NoteTile.CorestatValues[i].Value.OnOrOff.value;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 4) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Yes/No:" + $scope.NoteTile.CorestatValues[i].Value.YesOrNo.value;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 5) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Value:" + $scope.NoteTile.CorestatValues[i].Value.ValueAndSubValue.value + " " + "Sub Value:" + $scope.NoteTile.CorestatValues[i].Value.ValueAndSubValue.subvalue;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 6) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Current Value:" + $scope.NoteTile.CorestatValues[i].Value.CurrentAndMaxValue.CurrentValue + " " + "Max Value:" + $scope.NoteTile.CorestatValues[i].Value.CurrentAndMaxValue.MaxValue;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 7) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Weight:" + $scope.NoteTile.CorestatValues[i].Value.Weight.value
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 8) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Image:" + $scope.NoteTile.CorestatValues[i].Value.Image.image
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 12) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Height:" + $scope.NoteTile.CorestatValues[i].Value.Height.value + $scope.NoteTile.CorestatValues[i].Value.Height.units.selectedUnit;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 13) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Volume:" + $scope.NoteTile.CorestatValues[i].Value.Volume.value.depthvalue + "  " + $scope.NoteTile.CorestatValues[i].Value.Volume.units.selectedUnit;
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 14) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Number:" + $scope.NoteTile.CorestatValues[i].Value.Number.value
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 15) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Dice:" + $scope.NoteTile.CorestatValues[i].Value.DefaultDice.value
                        }
                        else if ($scope.NoteTile.Value.Attribute.TypeId == 19) {
                            $scope.NoteTile.Value.Attribute.CorestatValues = "Text Area:" + $scope.NoteTile.CorestatValues[i].Value.TextArea.value
                        }
                        rulesetDataShareService.setTilelst($scope.NoteTile);
                    }
                }
            }
            if ($scope.NoteTile.EditClientId == 0) {
                $scope.NoteTile.EditClientId = uniqId();
            }
            $uibModalInstance.close($scope.NoteTile);
            $("#loading").fadeOut("slow");
        }


        $scope.SaveLinkTile = function () {
			$("#loading").css("display", "block");
			debugger;
            var IsItem = false; var IsSpell = false; var IsAbility = false;
            if (angular.isUndefined($scope.NoteTile.LinkTileItems) == false) {
                if ($scope.NoteTile.Value.Link.SelectedPropertyValue == "Items") {
                    for (var i = 0; i < $scope.NoteTile.LinkTileItems.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.NoteTile.LinkTileItems[i].ItemProperties[0].Value.Text.value) {
                            IsItem = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Link.SelectedPropertyValue == "Spells") {
                    for (var i = 0; i < $scope.NoteTile.LinkTileSpells.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.NoteTile.LinkTileSpells[i].SpellProperties[0].Value.Text.value) {
                            IsSpell = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Link.SelectedPropertyValue == "Abilities") {
                    for (var i = 0; i < $scope.NoteTile.LinkTileAbilities.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.NoteTile.LinkTileAbilities[i].AbilityProperties[0].Value.Text.value) {
                            IsAbility = true;
                        }
                    }
                }
                if (IsItem == true) {
					for (var i = 0; i < $scope.NoteTile.LinkTileItems.length; i++) {
						console.log("$scope.NoteTile.Value.Link.SelectedProperty: ", $scope.NoteTile.Value.Link.SelectedProperty);
						console.log("$scope.NoteTile.LinkTileItems[i].ItemProperties[0].Value.Text.value: ", $scope.NoteTile.LinkTileItems[i].ItemProperties[0].Value.Text.value);
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.NoteTile.LinkTileItems[i].ItemProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Link.Title = $scope.NoteTile.Value.Link.Title;
                            $scope.NoteTile.Value.Link.SelectedPropertyValueImage = $scope.NoteTile.LinkTileItems[i].ItemProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Link.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Link.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Link.SelectedProperty = $scope.NoteTile.LinkTileItems[i].ItemProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Link.Content = $scope.NoteTile.LinkTileItems[i];
                        }
                    }
                }
                else if (IsSpell == true) {
                    for (var i = 0; i < $scope.NoteTile.LinkTileSpells.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.NoteTile.LinkTileSpells[i].SpellProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Link.Title = $scope.NoteTile.Value.Link.Title;
                            $scope.NoteTile.Value.Link.SelectedPropertyValueImage = $scope.NoteTile.LinkTileSpells[i].SpellProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Link.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Link.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Link.SelectedProperty = $scope.NoteTile.LinkTileSpells[i].SpellProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Link.Content = $scope.NoteTile.LinkTileSpells[i];
                        }
                    }
                }
                else if (IsAbility == true) {
                    for (var i = 0; i < $scope.NoteTile.LinkTileAbilities.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.NoteTile.LinkTileAbilities[i].AbilityProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Link.Title = $scope.NoteTile.Value.Link.Title;
                            $scope.NoteTile.Value.Link.SelectedPropertyValueImage = $scope.NoteTile.LinkTileAbilities[i].AbilityProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Link.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Link.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Link.SelectedProperty = $scope.NoteTile.LinkTileAbilities[i].AbilityProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Link.Content = $scope.NoteTile.LinkTileAbilities[i];
                        }
                    }
                }

            }
            else {
                if (angular.isUndefined($scope.LinkExecuteTileContent) == true) {
                    $scope.LinkExecuteTileContent = {};
                    var RuleSetTileContents = rulesetDataShareService.getRulesetData();
                    $scope.LinkExecuteTileContent.Items = RuleSetTileContents.Items;
                    $scope.LinkExecuteTileContent.Spells = RuleSetTileContents.Spells;
                    $scope.LinkExecuteTileContent.Abilities = RuleSetTileContents.Abilities;
                }
                if ($scope.NoteTile.Value.Link.SelectedPropertyValue == "Items") {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Items.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.LinkExecuteTileContent.Items[i].ItemProperties[0].Value.Text.value) {
                            IsItem = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Link.SelectedPropertyValue == "Spells") {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Spells.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.LinkExecuteTileContent.Spells[i].SpellProperties[0].Value.Text.value) {
                            IsSpell = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Link.SelectedPropertyValue == "Abilities") {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Abilities.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[0].Value.Text.value) {
                            IsAbility = true;
                        }
                    }
                }
                if (IsItem == true) {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Items.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.LinkExecuteTileContent.Items[i].ItemProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Link.Title = $scope.NoteTile.Value.Link.Title;
                            $scope.NoteTile.Value.Link.SelectedPropertyValueImage = $scope.LinkExecuteTileContent.Items[i].ItemProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Link.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Link.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Link.SelectedProperty = $scope.LinkExecuteTileContent.Items[i].ItemProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Link.Content = $scope.LinkExecuteTileContent.Items[i];
                        }
                    }
                }
                else if (IsSpell == true) {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Spells.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.LinkExecuteTileContent.Spells[i].SpellProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Link.Title = $scope.NoteTile.Value.Link.Title;
                            $scope.NoteTile.Value.Link.SelectedPropertyValueImage = $scope.LinkExecuteTileContent.Spells[i].SpellProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Link.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Link.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Link.SelectedProperty = $scope.LinkExecuteTileContent.Spells[i].SpellProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Link.Content = $scope.LinkExecuteTileContent.Spells[i];
                        }
                    }
                }
                else if (IsAbility == true) {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Abilities.length; i++) {
                        if ($scope.NoteTile.Value.Link.SelectedProperty == $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Link.Title = $scope.NoteTile.Value.Link.Title;
                            $scope.NoteTile.Value.Link.SelectedPropertyValueImage = $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Link.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Link.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Link.SelectedProperty = $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Link.Content = $scope.LinkExecuteTileContent.Abilities[i];
                        }
                    }
                }
            }
            if ($scope.NoteTile.Styles != null) {
                $scope.NoteTile.Styles.backgroundColor = $("#backgroundcolor").val();
            }
            if ($scope.NoteTile.EditClientId == 0) {
                $scope.NoteTile.EditClientId = uniqId();
            }
            $uibModalInstance.close($scope.NoteTile);
            $("#loading").fadeOut("slow");
        }
        $scope.SaveExecuteTile = function () {
            $("#loading").css("display", "block");
            var IsItem = false; var IsSpell = false; var IsAbility = false;
            if (angular.isUndefined($scope.NoteTile.ExecuteTileItems) == false) {
                if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == "Items") {
                    for (var i = 0; i < $scope.NoteTile.ExecuteTileItems.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.NoteTile.ExecuteTileItems[i].ItemProperties[0].Value.Text.value) {
                            IsItem = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == "Spells") {
                    for (var i = 0; i < $scope.NoteTile.ExecuteTileSpells.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.NoteTile.ExecuteTileSpells[i].SpellProperties[0].Value.Text.value) {
                            IsSpell = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == "Abilities") {
                    for (var i = 0; i < $scope.NoteTile.ExecuteTileAbilities.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.NoteTile.ExecuteTileAbilities[i].AbilityProperties[0].Value.Text.value) {
                            IsAbility = true;
                        }
                    }
                }
                if (IsItem == true) {
                    for (var i = 0; i < $scope.NoteTile.ExecuteTileItems.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.NoteTile.ExecuteTileItems[i].ItemProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Execute.Name = $scope.NoteTile.Value.Execute.Name;
                            $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = $scope.NoteTile.ExecuteTileItems[i].ItemProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Execute.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Execute.SelectedProperty = $scope.NoteTile.ExecuteTileItems[i].ItemProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Execute.Command = "";
                            $scope.NoteTile.Value.Execute.CommandLastResult = "";
                            //  rulesetDataShareService.setTilelst($scope.NoteTile);
                            $scope.NoteTile.Value.Execute.Content = $scope.NoteTile.ExecuteTileItems[i];
                        }
                    }
                }
                else if (IsSpell == true) {
                    for (var i = 0; i < $scope.NoteTile.ExecuteTileSpells.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.NoteTile.ExecuteTileSpells[i].SpellProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Execute.Name = $scope.NoteTile.Value.Execute.Name;
                            $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = $scope.NoteTile.ExecuteTileSpells[i].SpellProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Execute.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Execute.SelectedProperty = $scope.NoteTile.ExecuteTileSpells[i].SpellProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Execute.Command = "";
                            $scope.NoteTile.Value.Execute.CommandLastResult = "";
                            $scope.NoteTile.Value.Execute.Content = $scope.NoteTile.ExecuteTileSpells[i];
                            // rulesetDataShareService.setTilelst($scope.NoteTile);
                            $scope.NoteTile.Value.Execute.Content = $scope.NoteTile.ExecuteTileSpells[i];
                        }
                    }
                }
                else if (IsAbility == true) {
                    for (var i = 0; i < $scope.NoteTile.ExecuteTileAbilities.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == $scope.NoteTile.ExecuteTileAbilities[i].AbilityProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Execute.Name = $scope.NoteTile.Value.Execute.Name;
                            $scope.NoteTile.Value.Execute.SelectedPropertyValue = $scope.NoteTile.ExecuteTileAbilities[i].AbilityProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Execute.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Execute.SelectedProperty = $scope.NoteTile.ExecuteTileAbilities[i].AbilityProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Execute.Command = $scope.NoteTile.Value.Execute.Command;
                            $scope.NoteTile.Value.Execute.CommandLastResult = $scope.NoteTile.Value.Execute.CommandLastResult;
                            //  rulesetDataShareService.setTilelst($scope.NoteTile);
                            $scope.NoteTile.Value.Execute.Content = $scope.NoteTile.ExecuteTileAbilities[i];
                        }
                    }
                }
            }
            else {
                if (angular.isUndefined($scope.LinkExecuteTileContent) == true) {
                    $scope.LinkExecuteTileContent = {};
                    var RuleSetTileContents = rulesetDataShareService.getRulesetData();
                    $scope.LinkExecuteTileContent.Items = RuleSetTileContents.Items;
                    $scope.LinkExecuteTileContent.Spells = RuleSetTileContents.Spells;
                    $scope.LinkExecuteTileContent.Abilities = RuleSetTileContents.Abilities;
                }
                if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == "Items") {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Items.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.LinkExecuteTileContent.Items[i].ItemProperties[0].Value.Text.value) {
                            IsItem = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == "Spells") {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Spells.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.LinkExecuteTileContent.Spells[i].SpellProperties[0].Value.Text.value) {
                            IsSpell = true;
                        }
                    }
                }
                else if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == "Abilities") {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Abilities.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[0].Value.Text.value) {
                            IsAbility = true;
                        }
                    }
                }
                if (IsItem == true) {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Items.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.LinkExecuteTileContent.Items[i].ItemProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Execute.Name = $scope.NoteTile.Value.Execute.Title;
                            $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = $scope.LinkExecuteTileContent.Items[i].ItemProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Execute.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Execute.SelectedProperty = $scope.LinkExecuteTileContent.Items[i].ItemProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Execute.Command = "";
                            $scope.NoteTile.Value.Execute.CommandLastResult = "";
                            //  rulesetDataShareService.setTilelst($scope.NoteTile);
                            $scope.NoteTile.Value.Execute.Content = $scope.LinkExecuteTileContent.Items[i];
                        }
                    }
                }
                else if (IsSpell == true) {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Spells.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedProperty == $scope.LinkExecuteTileContent.Spells[i].SpellProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Execute.Name = $scope.NoteTile.Value.Execute.Title;
                            $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = $scope.LinkExecuteTileContent.Spells[i].SpellProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Execute.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Execute.SelectedProperty = $scope.LinkExecuteTileContent.Spells[i].SpellProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Execute.Command = "";
                            $scope.NoteTile.Value.Execute.CommandLastResult = "";
                            $scope.NoteTile.Value.Execute.Content = $scope.LinkExecuteTileContent.Spells[i];
                            // rulesetDataShareService.setTilelst($scope.NoteTile);
                            $scope.NoteTile.Value.Execute.Content = $scope.LinkExecuteTileContent.Spells[i];
                        }
                    }
                }
                else if (IsAbility == true) {
                    for (var i = 0; i < $scope.LinkExecuteTileContent.Abilities.length; i++) {
                        if ($scope.NoteTile.Value.Execute.SelectedPropertyValue == $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[0].Value.Text.value) {
                            $scope.NoteTile.Value.Execute.Name = $scope.NoteTile.Value.Execute.Title;
                            $scope.NoteTile.Value.Execute.SelectedPropertyValue = $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[1].Value.Image.image;
                            if ($scope.NoteTile.Value.Execute.SelectedPropertyValueImage == null) {
                                $scope.NoteTile.Value.Execute.SelectedPropertyValueImage = "";
                            }
                            $scope.NoteTile.Value.Execute.SelectedProperty = $scope.LinkExecuteTileContent.Abilities[i].AbilityProperties[0].Value.Text.value;
                            $scope.NoteTile.Value.Execute.Command = $scope.NoteTile.Value.Execute.Command;
                            $scope.NoteTile.Value.Execute.CommandLastResult = $scope.NoteTile.Value.Execute.CommandLastResult;
                            //  rulesetDataShareService.setTilelst($scope.NoteTile);
                            $scope.NoteTile.Value.Execute.Content = $scope.LinkExecuteTileContent.Abilities[i];
                        }
                    }
                }
            }
            if ($scope.NoteTile.Styles != null) {
                $scope.NoteTile.Styles.backgroundColor = $("#backgroundcolor").val();
            }
            if ($scope.NoteTile.EditClientId == 0) {
                $scope.NoteTile.EditClientId = uniqId();
            }
            $uibModalInstance.close($scope.NoteTile)
            $("#loading").fadeOut("slow");
        }
        $scope.SaveCommandTile = function () {
            $("#loading").css("display", "block");
            if ($scope.NoteTile.Value.Command.command != null) {
                var command = $scope.NoteTile.Value.Command.command;
                if (!dicenotationvalidator(command)) {
                    toaster.pop('error', "Invalid Command");
                }
                else {
                    if ($scope.NoteTile.Styles != null) {
                        $scope.NoteTile.Styles.backgroundColor = $("#backgroundcolor").val();
                    }
                    $scope.NoteTile.Value.Command.commandLastResult = localStorage.getItem("rollresult");
                    if ($scope.NoteTile.EditClientId == 0) {
                        $scope.NoteTile.EditClientId = uniqId();
                    }
                    $uibModalInstance.close($scope.NoteTile);
                    $("#loading").fadeOut("slow");
                }
            }

        }
        $scope.SaveImageTile = function () {
            $("#loading").css("display", "block");
            if ($scope.NoteTile.Styles != null) {
                $scope.NoteTile.Styles.backgroundColor = $("#backgroundcolor").val();
            }
            if ($scope.NoteTile.EditClientId == 0) {
                $scope.NoteTile.EditClientId = uniqId();
            }
            $uibModalInstance.close($scope.NoteTile);
            $("#loading").fadeOut("slow");
        }
        $scope.cancel = function () {
          //  $("#loading").css("display", "block");
            $uibModalInstance.close('cancel');
          //  $("#loading").fadeOut("slow");
        }
    }]);
    module.controller('ShowAllTileContent', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'toaster', 'dialogs', 'layoutService', function ($scope, $uibModalInstance, data, rulesetService, toaster, dialogs, layoutService) {

        $scope.Content = data.scope;
        if ($scope.Content.TileTypeName == "Attribute") {
            if ($scope.Content.Value.Attribute.AttributeContent.TypeId == 5) {
                $scope.Value = $scope.Content.Value.Attribute.AttributeContent.Value.ValueAndSubValue.value;
                $scope.Subvalue = $scope.Content.Value.Attribute.AttributeContent.Value.ValueAndSubValue.subvalue;
                $scope.ValueSubValue = true;
                $scope.CurrentMax = false;
                $scope.Number = false;
            }
            else if ($scope.Content.Value.Attribute.AttributeContent.TypeId == 6) {
                $scope.Currentvalue = $scope.Content.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.CurrentValue;
                $scope.Maxvalue = $scope.Content.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.MaxValue;
                $scope.ValueSubValue = false;
                $scope.CurrentMax = true;
                $scope.Number = false;
            }
            else if ($scope.Content.Value.Attribute.AttributeContent.TypeId == 14) {
                $scope.Numbers = $scope.Content.Value.Attribute.AttributeContent.Value.Number.value;
                $scope.ValueSubValue = false;
                $scope.CurrentMax = false;
                $scope.Number = true;
            }
        }
        $scope.SaveCounterUpdatedValue = function () {
            if ($scope.Content.Value.Counter.Value > $scope.Content.Value.Counter.Max) {
                toaster.pop('error', "Value Should Not be Greater Than Max Value ");
            }
            else {
                $uibModalInstance.close($scope.Content);
            }

        }

        $scope.Increment = function (val) {
            if (val == 1) {
                var val = $scope.Maxvalue;
                val += 1;
                $scope.Maxvalue = val;
            }
            else if (val == 2) {
                var val = $scope.Currentvalue;
                val += 1;
                $scope.Currentvalue = val;
            }
            else if (val == 3) {
                var val = $scope.Value;
                val += 1;
                $scope.Value = val;
            }
            else if (val == 4) {
                var val = $scope.Subvalue;
                val += 1;
                $scope.Subvalue = val;
            }
            else if (val == 5) {
                var val = $scope.Numbers;
                val += 1;
                $scope.Numbers = val;
            }
        }
        $scope.Decrement = function (val) {
            if (val == 1) {
                var val = $scope.Maxvalue;
                val -= 1;
                $scope.Maxvalue = val;
            }
            else if (val == 2) {
                var val = $scope.Currentvalue;
                val -= 1;
                $scope.Currentvalue = val;
            }
            else if (val == 3) {
                var val = $scope.Value;
                val -= 1;
                $scope.Value = val;
            }
            else if (val == 4) {
                var val = $scope.Subvalue;
                val -= 1;
                $scope.Subvalue = val;
            }
            else if (val == 5) {
                var val = $scope.Numbers;
                val -= 1;
                $scope.Numbers = val;
            }
        }
        $scope.Reset = function (val) {
            if (val == 1) {
                var dlg = dialogs.confirm(
                    'Confirm Reset',
                    'Are you sure you want to reset Max Value to "' + $scope.Content.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.MaxValue + '"?',
                    { size: 'md' }
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            $scope.Maxvalue = $scope.Content.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.MaxValue;
                        }

                    });
            }
            else if (val == 2) {
                var dlg = dialogs.confirm(
                    'Confirm Reset',
                    'Are you sure you want to reset Current Value to "' + $scope.Content.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.CurrentValue + '"?',
                    { size: 'md' }
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            $scope.Currentvalue = $scope.Content.Value.Attribute.AttributeContent.Value.CurrentAndMaxValue.CurrentValue;
                        }

                    });
            }
            else if (val == 3) {
                var dlg = dialogs.confirm(
                    'Confirm Reset',
                    'Are you sure you want to reset Value to "' + $scope.Content.Value.Attribute.AttributeContent.Value.ValueAndSubValue.value + '"?',
                    { size: 'md' }
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            $scope.Value = $scope.Content.Value.Attribute.AttributeContent.Value.ValueAndSubValue.value;
                        }

                    });
            }
            else if (val == 4) {
                var dlg = dialogs.confirm(
                    'Confirm Reset',
                    'Are you sure you want to reset Sub Value to "' + $scope.Content.Value.Attribute.AttributeContent.Value.ValueAndSubValue.subvalue + '"?',
                    { size: 'md' }
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            $scope.Subvalue = $scope.Content.Value.Attribute.AttributeContent.Value.ValueAndSubValue.subvalue;
                        }

                    });
            }
            else if (val == 5) {
                var dlg = dialogs.confirm(
                    'Confirm Reset',
                    'Are you sure you want to reset Number to "' + $scope.Content.Value.Attribute.AttributeContent.Value.Number.value + '"?',
                    { size: 'md' }
                );

                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            $scope.Numbers = $scope.Content.Value.Attribute.AttributeContent.Value.Number.value;
                        }

                    });
            }

        }
        $scope.SaveAttributeCorestatValue = function () {
            if ($scope.Content.Value.Attribute.AttributeContent.TypeId == 6) {
              
            }
            else if ($scope.Content.Value.Attribute.AttributeContent.TypeId == 5) {
                //$scope.Content.Value.Attribute.CoreStatValue.ValueAndSubValue = "value:" + $scope.Value + "subvalue:" + $scope.Subvalue;
                $scope.Content.Value.Attribute.CoreStatValue.ValueAndSubValue.value = $scope.Value;
                $scope.Content.Value.Attribute.CoreStatValue.ValueAndSubValue.subvalue = $scope.Subvalue;
            }
            else if ($scope.Content.Value.Attribute.AttributeContent.TypeId == 14) {
                //$scope.Content.Value.Attribute.CoreStatValue.Number = "value:" + $scope.Numbers;
                $scope.Content.Value.Attribute.CoreStatValue.Number.value = $scope.Numbers;
            }
            $uibModalInstance.close($scope.Content);
        }
        $scope.DiceRoll = function (val) {
            if (val == 1) {
                var defaultdice = layoutService.GetDefaultDice($scope.Content.Value.Attribute.AttributeContent.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var command = data.data.PayLoad + "+" + $scope.Maxvalue;
                        $scope.Content.Command = command;
                        var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                            { scope: $scope.Content, mode: 2 }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {

                            }
                        });
                        //dicerollwithcommand(command)
                    }
                    else if (data.data.StatusCode == 400) {
                        alert(data.data.ErrorMessage);
                    }
                })
            }
            else if (val == 2) {
                var defaultdice = layoutService.GetDefaultDice($scope.Content.Value.Attribute.AttributeContent.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var command = data.data.PayLoad + "+" + $scope.Currentvalue;
                        $scope.Content.Command = command;
                        var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                            { scope: $scope.Content, mode: 2 }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {

                            }
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        alert(data.data.ErrorMessage);
                    }
                })
            }
            else if (val == 3) {
                var defaultdice = layoutService.GetDefaultDice($scope.Content.Value.Attribute.AttributeContent.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var command = data.data.PayLoad + "+" + $scope.Value;
                        $scope.Content.Command = command;
                        var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                            { scope: $scope.Content, mode: 2 }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {

                            }
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        alert(data.data.ErrorMessage);
                    }
                })
            }
            else if (val == 4) {
                var defaultdice = layoutService.GetDefaultDice($scope.Content.Value.Attribute.AttributeContent.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var command = data.data.PayLoad + "+" + $scope.Subvalue;
                        $scope.Content.Command = command;
                        var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                            { scope: $scope.Content, mode: 2 }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {

                            }
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        alert(data.data.ErrorMessage);
                    }
                })
            }
            else if (val == 5) {
                var defaultdice = layoutService.GetDefaultDice($scope.Content.Value.Attribute.AttributeContent.CharacterId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        var command = data.data.PayLoad + "+" + $scope.Numbers;
                        $scope.Content.Command = command;
                        var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                            { scope: $scope.Content, mode: 2 }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {

                            }
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        alert(data.data.ErrorMessage);
                    }
                })
            }
        }
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

    module.controller('dialogTileBorder', ['$scope', '$uibModalInstance', 'data', 'dialogs', function ($scope, $uibModalInstance, data, dialogs, tileService) {

        $scope.TileBorders = data.scope;
        $scope.cancel = function () {
          //  $("#loading").css("display", "block");
            $uibModalInstance.dismiss('Canceled');
            //$("#loading").fadeOut("slow");
        };

        $scope.SaveTileBorder = function () {
            $scope.TileBorders.color = $("#bordercolor").val();
            $uibModalInstance.close($scope.TileBorders);

        }
        $scope.SaveTileBackgrounds = function () {
            $scope.TileBorders.titletextcolor = $("#titletextcolor").val();
            $scope.TileBorders.titlebackgroundcolor = $("#titlebackgroundcolor").val();
            $scope.TileBorders.bodytextcolor = $("#bodytextcolor").val();
            $scope.TileBorders.bodybackgroundColor = $("#bodybackgroundColor").val();
            $uibModalInstance.close($scope.TileBorders);
        }

    }]);
    module.controller('dialogImportRulesetinCharecter', ['$scope', '$uibModalInstance', 'data', 'characterService', 'toaster', function ($scope, $uibModalInstance, data, characterService, toaster) {
        var characterProfileId = data.characterProfileId;
        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }


        $scope.rulesetFileUpload = function (input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $scope.file = e.target.result
                };
                reader.readAsDataURL(input.files[0]);
                $scope.fileName = input.files[0].name;
            }
        }


        $scope.uploadFile = function () {
            var importRuleSet = {
                RuleSetId: characterProfileId,
                File: $scope.file,
            };

         
            characterService.uploadFileToUrl(characterProfileId, $scope.file, $scope.fileName).then(function (data) {

                if (data.data.StatusCode == 200) {
                    if (data.data.PayLoad == "Sucess") {
                        toaster.pop('success', 'Ruleset Imported Sucessfully');
                        $uibModalInstance.close(data.data.PayLoad);
                    }
                    else {
                        toaster.pop('error', data.data.ErrorMessage);
                        // $uibModalInstance.close(data.data.PayLoad);
                    }

                }
                else if (data.data.StatusCode == 400) {
                    toaster.pop('error', data.data.ErrorMessage);
                }

            });
        }

    }]);



    module.controller('dialogImportRuleset', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'toaster', function ($scope, $uibModalInstance, data, rulesetService, toaster) {

        var ruleSetId = data.ruleSetId;

        $scope.rulesetFileUpload = function (input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                   
                    $scope.file = e.target.result
                    //$scope.character.file = $scope.file;
                };
                reader.readAsDataURL(input.files[0]);
                $scope.fileName = input.files[0].name;
            }
        }

        $scope.uploadFile = function () {

            var importRuleSet = {
                RuleSetId: ruleSetId,
                File: $scope.file,
            };
            if (angular.isUndefined($scope.file) == true)
            {
                toaster.pop('error', 'Please select zip file');
                return false;
            }
            rulesetService.uploadFileToUrl(ruleSetId, $scope.file, $scope.fileName, $scope.RuleSetName).then(function (data) {
                if (data.data.StatusCode == 200) {

                    toaster.pop('success', 'Ruleset Imported Sucessfully');
                    $uibModalInstance.close(data.data.PayLoad);
                }

                else {
                    toaster.pop('error', data.data.ErrorMessage);
                   
                }
            });

        
        }
        $scope.cancel = function () {

            $uibModalInstance.close('');
        }
    }]);

  

    module.controller('dialogDefaultDiceSelect', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'layoutService', 'dialogs', 'rulesetDataShareService', function ($scope, $uibModalInstance, data, rulesetService, layoutService, dialogs, rulesetDataShareService) {
        $scope.Result = data.scope;
        $scope.CharacterId = data.CharacterId;
        $scope.Dicelist = data.Dice;
        $scope.Lastresult = data.LastResult;
        $scope.Corestats = rulesetDataShareService.getLayoutData();
        if ($scope.Result != undefined && $scope.Result != null) {
            if ($scope.Result.length <= 0) {
                $scope.ShowNonNumericCorestats = true;
            }
        }
        $uibModalInstance.rendered.then(function () {
            if (data.mode == 1) {
                //dice_initialize(document.body);
                if ($scope.Result != undefined && $scope.Result != null && $scope.Result != "")
                {
                    $("#customset").val($scope.Result);
                }
                diceselectcommand();
            }
            else if (data.mode == 2) {

                if ($scope.Result.length <= 0) {
                    $scope.ShowNonNumericCorestats = true;
                }

                $scope.DiceVisible = false;
                if ($scope.Result.TileTypeName == "Execute") {
                    if ($scope.Result.ItemProperties != null) {
                        if ($scope.Result.ItemProperties[10].Value.Text.value != null) {
                            var command = $scope.Result.ItemProperties[10].Value.Text.value;
                            $("#customset").val(command);
                        }
                        else {
                            var command = "4d6 + d20";
                            $("#customset").val(command);
                        }
                    }
                }
                else if ($scope.Result.TileTypeName == "Command") {
                    if ($scope.Result.Value.Command.command != null) {
                        var command = $scope.Result.Value.Command.command;
                        $("#customset").val(command);
                    }
                }
                else if ($scope.Result.TileTypeName == "Attribute") {
                    var command = $scope.Result.Command;
                    $("#customset").val(command);
                }
                else {
                    var command = "4d6 + d20";
                    $("#customset").val(command);
                }

                dicerollwithcommand(command)
            }
            else if (data.mode == 3) {

                var dice = layoutService.GetDice($scope.Result);
                dice.then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.DiceList = data.data.PayLoad;
                        $scope.DiceVisible = true;
                    }
                });

                dicerollwithoutcommand();

            }
        });

        $scope.DefaultDiceSelect = function () {

            var dice = $("#customset").val();
            $uibModalInstance.close(dice);
        }

        $scope.DiceSaveCommand = function () {

            var dice = $("#customset").val();
            //var result = $("div#sethelp")[0].innerHTML;
            if (dicenotationvalidator(dice)) {
                var dlg = dialogs.create('/views/dialogs/adddicename.html', 'dialogDefaultDiceSelect',
                    { scope: dice, Dice: $scope.DiceList, LastResult: $scope.Lastresult, CharacterId: $scope.Result }
                );
                dlg.result.then(function (res) {

                    $scope.DiceList = res;
                })
            } else {
                alert('Invalid Command');
            }
        }

        $scope.save = function () {
            var dicesave =
                {
                    CharacterId: $scope.CharacterId,
                    Name: $scope.Name,
                    Command: $scope.Result,
                    LastRunResult: $scope.Lastresult
                };
            var savedice = layoutService.SaveDice(dicesave);
            savedice.then(function (data) {
                if (data.data.StatusCode == 200) {
                    $scope.Dicelist.push(dicesave);
                    $uibModalInstance.close($scope.Dicelist);
                }
            })

        }
        $scope.ShowCommand = function (name) {
            for (var i = 0; i < $scope.DiceList.length; i++) {
                if (name == $scope.DiceList[i].Name) {
                    $("#customset").val($scope.DiceList[i].Command);
                }
            }
        }
        $scope.AddNumericCorestats = function () {
            $scope.NumericCorestats = [];
            for (var i = 0; i < $scope.Corestats.CorestatValues.length; i++) {
                if ($scope.Corestats.CorestatValues[i].TypeId == 5 || $scope.Corestats.CorestatValues[i].TypeId == 6 || $scope.Corestats.CorestatValues[i].TypeId == 14)
                    $scope.NumericCorestats.push($scope.Corestats.CorestatValues[i].Name);
            }
            var dlg = dialogs.create('/views/dialogs/addnumericcorestats.html', 'dialogDefaultDiceSelect',
                { scope: $scope.NumericCorestats }
            );
            dlg.result.then(function (res) {
            })

        }
        

        $scope.ShowCorestatValue = function () {
            $scope.CurrentMaxValue = false;
            $scope.ValueSubValue = false;
            $scope.Number = false;
            for (var i = 0; i < $scope.Corestats.CorestatValues.length; i++) {
                if ($scope.corestattype == $scope.Corestats.CorestatValues[i].CorestatName) {
                    if ($scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue != null) {
                        $scope.CurrentMaxValue = true;
                        $scope.ValueSubValue = false;
                        $scope.Number = false;
                        $scope.currenttext = false;
                        $scope.maxtext = false;
                        $scope.subvaltext = false;
                        $scope.valtext = false;
                        $scope.CurrentMaxVal = false;
                    }
                    else if ($scope.Corestats.CorestatValues[i].Value.ValueAndSubValue != null) {
                        $scope.CurrentMaxValue = false;
                        $scope.ValueSubValue = true;
                        $scope.Number = false;
                        $scope.currenttext = false;
                        $scope.maxtext = false;
                        $scope.subvaltext = false;
                        $scope.valtext = false;
                        $scope.ValSub = false;
                    }
                    else if ($scope.Corestats.CorestatValues[i].Value.Number != null) {
                        $scope.CurrentMaxValue = false;
                        $scope.ValueSubValue = false;
                        $scope.Number = true;
                        $scope.currenttext = false;
                        $scope.maxtext = false;
                        $scope.subvaltext = false;
                        $scope.valtext = false;
                        $scope.number = $scope.Corestats.CorestatValues[1].Value.Number.value;
                    }
                }
            }
        }

       
        $scope.showcurrentmax = function (value) {
            $scope.currenttext = true;
            $scope.maxtext = false;
            $scope.subvaltext = false;
            $scope.valtext = false;
            for (var i = 0; i < $scope.Corestats.CorestatValues.length; i++) {
                if ($scope.corestattype == $scope.Corestats.CorestatValues[i].CorestatName) {
                    if (value == 'MaxValue') {
                        $scope.value = 'MaxValue';
                        $scope.maxtext = true;
                        $scope.currenttext = false;
                        $scope.max = $scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue.MaxValue;
                    }
                    else if (value == 'CurrentValue') {
                        $scope.value = 'CurrentValue';
                        $scope.maxtext = false;
                        $scope.currenttext = true;
                        $scope.current = $scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue.CurrentValue;
                    }
                }
            }
        }

       
        $scope.showValueSubvalue = function (value) {
            $scope.currenttext = false;
            $scope.maxtext = false;
            $scope.subvaltext = true;
            $scope.valtext = false;
            for (var i = 0; i < $scope.Corestats.CorestatValues.length; i++) {
                if ($scope.corestattype == $scope.Corestats.CorestatValues[i].CorestatName) {
                    if (value == 'Value') {
                        $scope.value = 'Value';
                        $scope.valtext = true;
                        $scope.subvaltext = false;
                        $scope.val = $scope.Corestats.CorestatValues[i].Value.ValueAndSubValue.value;
                    }
                    else if (value == 'SubValue') {
                        $scope.value = 'SubValue';
                        $scope.valtext = false;
                        $scope.subvaltext = true;
                        $scope.subval = $scope.Corestats.CorestatValues[i].Value.ValueAndSubValue.subvalue;
                    }
                }
            }
        }
        $scope.SaveCorestatValues = function () {

            //if ($scope.checked && !$scope.subvalue && !$scope.currentvalue) {
            for (var i = 0; i < $scope.Corestats.CorestatValues.length; i++) {
                if ($scope.corestatype == $scope.Corestats.CorestatValues[i].Name) {
                    var diceresult = $("#customset").val();
                    if ($scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue != null) {
                        if ($scope.value == 'MaxValue' && $scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue.MaxValue != null) {
                            $scope.value = diceresult + " +" + $scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue.MaxValue;
                        }
                        else if ($scope.value == 'CurrentValue' && $scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue.CurrentValue != null) {
                            $scope.value = diceresult + " +" + $scope.Corestats.CorestatValues[i].Value.CurrentAndMaxValue.CurrentValue;
                        }
                        $("#customset").val($scope.value);
                        $uibModalInstance.dismiss($("#customset").val($scope.value));
                    }
                    else if ($scope.Corestats.CorestatValues[i].Value.ValueAndSubValue != null) {
                        if ($scope.value == 'Value' && $scope.Corestats.CorestatValues[i].Value.ValueAndSubValue.value != null) {
                            $scope.value = diceresult + " +" + $scope.Corestats.CorestatValues[i].Value.ValueAndSubValue.value;
                        }
                        else if ($scope.value == 'SubValue' && $scope.Corestats.CorestatValues[i].Value.ValueAndSubValue.subvalue != null) {
                            $scope.value = diceresult + " +" + $scope.Corestats.CorestatValues[i].Value.ValueAndSubValue.subvalue;
                        }
                        $("#customset").val($scope.value);
                        $uibModalInstance.dismiss($("#customset").val($scope.value));
                    }
                    else if ($scope.corestatype == $scope.Corestats.CorestatValues[i].Name) {
                        var diceresult = $("#customset").val();
                        $scope.value = diceresult + "+" + $scope.Corestats.CorestatValues[i].Value.Number.value;
                        $("#customset").val($scope.value);
                        $uibModalInstance.dismiss($("#customset").val($scope.value));

                    }

                }
            }
        }
        
        $scope.Tracing = function () {
            diceselectcommandtrace();
        }
        $scope.cancel = function () {

            $uibModalInstance.close('');
        }




    }]);


    //For New Design

    module.controller('dialogGeneralSettings', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'toaster', 'dialogs', function ($scope, $uibModalInstance, data, rulesetService, toaster, dialogs) {
        //if (data.btntext == "Copy")
        //{
        //    data.scope[0].RulesetName = "";
        //}
		$scope.showimagebtns = false;
		$scope.GeneralSettings = data.scope;
		$scope.imageLoaded = false;
		console.log("$scope.GeneralSettings : ", $scope.GeneralSettings);
		$scope.buttontext = data.btntext;
        $scope.pageName = data.tabname;
        $scope.Disabled = data.Disabled;
        $scope.DisableName = data.DisableName;
        $scope.RulesetData = function () {
            rulesetService.GetRuleSets().then(function (data) {
                if (data.data.StatusCode == 200) {
                    $scope.RuleSets = data.data.PayLoad;
                    $scope.HeaderContents = rulesetDataShareService.getDisplayCharacterRulesetCount();
                    $scope.HeaderContents.TotalRuleSetCount = $scope.RuleSets.length;
                    $("#loading").fadeOut("slow");
                }
            });
        }
		$scope.OpenFile = function () {
			$("#newRulesetImage").click();
			//var input = $('input[type=file]');//.val();
			//input.click();
			//return false;
		}
		$scope.ItemImageUpload = function (input) {
			console.log("File Input: ", input);
			$scope.showimagebtns = false;
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					//console.log("e.target.result: "+e.target.result);
					$scope.$apply(function () {
						$scope.GeneralSettings[2].Value.Image.image = e.target.result;
					});
					
					
				};
				reader.readAsDataURL(input.files[0]);
				
			}
		}

		$scope.OpenManageRuleset = function () {
			console.log("OPenManageRuleSet");
			data.openManageRuleset($scope.GeneralSettings[0].RulesetId);
		}

		$scope.OpenBingSearch = function () {
			console.log("OPenManageRuleSet");
			data.OpenBingSearch();
		}

		$scope.ManageRuleset = function () {
			console.log("$Scope.generalsettings: "+ $scope.GeneralSettings[0].RulesetId);
            $("#loading").css("display", "block");
            if ($scope.GeneralSettings[0].RulesetId == 0) {
                var savesettings = rulesetService.CreateGeneralSettings($scope.GeneralSettings);
                savesettings.then(function (data) {
                    //$("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200)
                    {
                        $scope.GeneralSettings = data.data.PayLoad;
                        $uibModalInstance.close($scope.GeneralSettings);
                        $("#loading").fadeOut("slow");
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop('error', data.data.ErrorMessage);
                            $("#loading").fadeOut("slow");
                        }
                    }
                })
            }
            else if ($scope.GeneralSettings[0].RulesetId != 0 && $scope.buttontext == "Update") {
                var updategeneralsettings = rulesetService.UpdateGeneralSettings($scope.GeneralSettings);
                updategeneralsettings.then(function (data) {
           
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        $scope.GeneralSettings = data.data.PayLoad;
                        $uibModalInstance.close($scope.GeneralSettings);
                        $("#loading").fadeOut("slow");
                    }
                })
            }

            else if ($scope.GeneralSettings[0].RulesetId != 0 && $scope.buttontext == "Copy") {
                var _rulesetID = $scope.GeneralSettings[0].RulesetId;
                var Name = $scope.GeneralSettings[0].RulesetName;
                var CopyRuleset = rulesetService.CopyRulesetByRulesetId(_rulesetID, Name);
                CopyRuleset.then(function (data) {
           
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        //$scope.GeneralSettings = data.data.PayLoad.Result;
                        $uibModalInstance.close(data.data.PayLoad.Result);
                        $("#loading").fadeOut("slow");
                    }
                })
            }
        }
        $scope.cancel = function () {
           // $("#loading").css("display", "block");
            $uibModalInstance.close('cancel');
           // $("#loading").fadeOut("slow");
        }

    }]);
    module.controller('dialogManageRuleset', ['$scope', '$uibModalInstance', 'data', 'rulesetService', 'toaster', 'dialogs', 'rulesetDataShareService', '$interval', function ($scope, $uibModalInstance, data, rulesetService, toaster, dialogs, rulesetDataShareService, $interval) {

		console.log("RulesetGeneralSettings: ", data.scope);
		$scope.GeneralSettings = data.scope;
		//$scope.RulesetID = data.scope;
        $scope.ShowAllRulesetContent = function (value) {
            $scope.Response = value;
            //$scope.Response.RulesetID = $scope.RulesetID;
            $uibModalInstance.close($scope.Response);

        }

        $scope.ExportRuleSet = function () {
            var rulesetId = rulesetDataShareService.getRulesetsData();
            rulesetService.ExportRuleset(rulesetId);
           // $interval(toaster.pop("success", "RuleSet Exported Successfully."), 45000);
        }

        $scope.cancel = function () {
            $uibModalInstance.close('cancel');
        }

    }]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('attributesPageController', ['$scope', '$q', '$timeout', '$transition', 'dialogs', 'toaster', 'navService', 'dataService',
        function ($scope, $q, $timeout, $transition, dialogs, toaster, navService, dataService) {
            
            $scope.data = null;

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);
            
            (function () {                
                navService.updateBody(true, false);

                $timeout(function () {                    
                    $scope.data = {
                        corestats: dataService.character.campaign.coreStats
                    };
                });

            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');
    app.controller('charactersPageController', ['$scope', '$state', '$window', 'dialogs', '$timeout', '$transition', 'toaster', 'navService', 'characterService', 'rulesetService', 'rulesetDataShareService', 'authService',
        function ($scope, $state, $window, dialogs, $timeout, $transition, toaster, navService, characterService, rulesetService, rulesetDataShareService, authService) {
            //Event Handlers for Characters Page.
            $scope.file = "";
            $scope.showBtn = false;
            $scope.Imagesrc = "http://www.advacto.com/images/user.jpg";
            $scope.characterAdd = function () {
                $state.go('profile.addnewcharacterdialog');
            };

            $scope.characterSubmitForm = function (valid) {
                valid = false;
            }
            $scope.CharacterRuleSetOnChange = function () {
                if ($scope.character.RulesetID > 0) {

                    $scope.character.Button = false;
                }
                else {
                    $scope.character.Button = true;
                }
            }
            $scope.newCharacter = function () {

                var newCharacterData = {
                    id: 0,
                    name: "",
                    file: null,
                    RulesetID: 0
                }

                var dlg = dialogs.create('/views/dialogs/character-addnew.html', 'dialogAddNewCharacter',
                    { mode: 1, characterData: newCharacterData }
                );

                dlg.result.then(function (res) {
                    if (res != 'cancel') {
                        $scope.characters.push(res);
                        toaster.pop('success', 'Character Created Successfully');
                    }
                });
            };
            $scope.GetRulesets = function () {
                $state.go('profile.AddNewRuleSet');
            };
            $scope.EditData = function () {
                $state.go('profile.EditProfile');
            }
            $scope.ReSetPassword = function () {
                $state.go('profile.ResetPassword');
            }
            $scope.newstyles = function (c) {
                if (c.Portrait) {
                    return {
                        'background-size': '100% 100%',
                        'background-repeat': 'no-repeat',
                        'width': '120px',
                        'height': '120px'
                    }
                }
                return {
                    'background-color': 'transparent',
                    'background-repeat': 'no-repeat',
                    'width': '120px',
                    'height': '120px'
                }
            };
            $scope.getStyles = function (c) {
                if (c.Portrait) {
                    return {
                        'background-image': 'url(' + c.Id + '/' + c.Portrait + ')',
                        'background-color': 'white',
                        'width': '10%',
                        'height': '10%'
                    }
                }
                else {
                    return {
                        'background-color': 'transparent',
                        'width': '10%',
                        'height': '10%'
                    }
                }

            };
            //characterService.GetHeaderContentsCounts();
            characterService.GetCharacters().then(function (data) {
                if (data.data.StatusCode == 200) {
                    $scope.characters = data.data.PayLoad;
                    //$scope.HeaderContents = rulesetDataShareService.getDisplayCharacterRulesetCount();
                    //$scope.HeaderContents.TotalCharactersCount = $scope.characters.length;
                }
                else {
                    if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            alert(data.data.ErrorMessage);
                        }
                    }
                }
            });

            $scope.GetCharacters = function () {
                characterService.GetCharacters().then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.characters = data.data.PayLoad;
                        //$scope.HeaderContents = rulesetDataShareService.getDisplayCharacterRulesetCount();
                        //$scope.HeaderContents.TotalCharactersCount = $scope.characters.length;
                        $("#loading").fadeOut("slow");
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                                $("#loading").fadeOut("slow");
                            }
                        }
                    }
                });
            }

            rulesetService.GetRuleSets().then(function (data) {
                if (data.data.StatusCode == 200) {
                    $scope.RuleSets = data.data.PayLoad;
                    $scope.HeaderContents = rulesetDataShareService.getDisplayCharacterRulesetCount();
                    $scope.HeaderContents.TotalRuleSetCount = $scope.RuleSets.length;
                    $("#loading").fadeOut("slow");
                }
                else {
                    if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            alert(data.data.ErrorMessage);
                            $("#loading").fadeOut("slow");
                        }
                    }
                }
            });

            $scope.GetRuleset = function () {
                rulesetService.GetRuleSets().then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.RuleSets = data.data.PayLoad;
                        //$scope.HeaderContents = rulesetDataShareService.getDisplayCharacterRulesetCount();
                        //$scope.HeaderContents.TotalRuleSetCount = $scope.RuleSets.length;
                        $("#loading").fadeOut("slow");
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                                $("#loading").fadeOut("slow");
                            }
                        }
                    }
                });
            }

            $scope.getThumbNail = function () {
                if ($scope.varRoot.file)
                    return $scope.varRoot.file;
                return null;
            }
            $scope.characterImageUpload = function (input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#characterImage')
                            .attr('src', e.target.result)
                            .width(120)
                            .height(120);
                        $scope.file = e.target.result
                        $scope.character.file = $scope.file;
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }
            $scope.tilePickerApi = {
                messageId: null,
                beforeSelect: function () {
                    toaster.clear('*');
                    $scope.tilePickerApi.messageId = toaster.pop({
                        type: 'note',
                        body: 'Click a character to ' + $scope.tilePickerApi.action + ' it.',
                        timeout: 0
                    });
                },
                onClose: function () {
                    if ($scope.tilePickerApi.messageId)
                        toaster.clear($scope.tilePickerApi.messageId);
                }
            };
            $scope.addNewRuleSet = function () {
                $state.go('profile.NewRuleSet');
            }
            $scope.cancel = function () {
                //$("#loading").css("display", "block");
                $window.history.back();
                $scope.character.name = "";
                $scope.character.file = "";
                $scope.character.RulesetID = "";

            }
            $scope.save = function () {
                $("#loading").css("display", "block");
                var character = {
                    Id: $scope.character.id,
                    Name: $scope.character.name,
                    Portrait: $scope.character.file,
                    RulesetID: $scope.character.RulesetID,
                    Heading: $scope.character.Heading,
                    Action: $scope.character.Action
                };

                if ($scope.character.RulesetID > 0) {
                    if ($scope.character.id == 0) {
                        var addcharacter = characterService.saveCharacter(character);
                        addcharacter.then(function (res) {
                            if (res.data.StatusCode == 200) {
                                $scope.character.name = "";
                                $scope.character.file = "";
                                $scope.character.RulesetID = "";
                                $scope.createcharacter = res.PayLoad;
                                $("#loading").fadeOut("slow");
                                toaster.pop('success', "Character Created Successfully");
                            }
                            else {
                                if (res.data.StatusCode == 400) {

                                    if (res.data.ShowToUser == true) {
                                        toaster.pop('error', res.data.ErrorMessage);
                                        $("#loading").fadeOut("slow");
                                    }
                                }
                            }

                        });
                    }
                    else {
                        var data;
                        if ($scope.character.Action == "New") {
                            data = characterService.saveCharacter(character);
                        }
                        else if ($scope.character.Action == "edit") {
                            data = characterService.EditCharacter(character);
                        }
                        else {
                            data = characterService.CopyCharacter(character);
                        }
                        data.then(function (res) {
                            if (res.data.StatusCode == 200) {
                                $scope.character.name = "";
                                $scope.character.file = "";
                                $scope.character.RulesetID = "";
                                $scope.createcharacter = res.PayLoad;
                                $("#loading").fadeOut("slow");
                                toaster.pop('success', "Character Created Successfully");
                            }
                            else {
                                if (res.data.StatusCode == 400) {

                                    if (res.data.ShowToUser == true) {
                                        //alert(res.data.ErrorMessage);
                                        toaster.pop('error', res.data.ErrorMessage);
                                        $("#loading").fadeOut("slow");
                                    }
                                }
                            }

                        })
                    }

                } else {
                    toaster.pop('error', 'Please select one ruleset');
                }
            }



            $scope.copyCharacter = function (characterData) {

                var copyCharacterData = {
                    id: characterData.Id,
                    name: characterData.Name,
                    file: characterData.Portrait,
                    RulesetID: characterData.RulesetId,
                };

                var dlg = dialogs.create('/views/dialogs/character-addnew.html', 'dialogAddNewCharacter',
                    { mode: 3, characterData: copyCharacterData }
                );

                dlg.result.then(function (res) {
                    if (res != 'cancel') {
                        $scope.characters.push(res);
                        toaster.pop('success', 'Character Copied Successfully');
                    }
                });

            }

            $scope.editCharacter = function (characterData) {

                var editCharacterData = {
                    id: characterData.Id,
                    name: characterData.Name,
                    file: characterData.Portrait,
                    RulesetID: characterData.RulesetId,
                }

                var dlg = dialogs.create('/views/dialogs/character-addnew.html', 'dialogAddNewCharacter',
                    { mode: 2, characterData: editCharacterData }
                );

                dlg.result.then(function (res) {
                    if (res != 'cancel') {

                        var editedCharacterIndex = -1;
                        for (var i = 0; i < $scope.characters.length; i++) {
                            if ($scope.characters[i].Id == editCharacterData.id) {
                                editedCharacterIndex = i;
                            }
                        }
                        if (editedCharacterIndex > -1) {
                            $scope.characters[editedCharacterIndex] = res;
                            toaster.pop('success', "Character Edited Successfully");
                        }
                        
                    }
                });
            }

            $scope.selectCharacter = function (c) {
                if ($scope.tilePickerApi.selecting) {
                    $scope.tilePickerApi.endSelect(c);
                }
                else {
                    if ($scope.tilePickerApi.selecting)
                        $scope.tilePickerApi.endSelect(c);

                    else {
                        $state.go('profile.character.layout', { characterId: c.Id, action: 1, isNew: 1 });
                        //$transition.router.stateService.go('profile.character.layout', { characterId: c.Id, action: 1, isNew: 1 });
                        //$("#loading").css("display", "block");
                    }

                }
            };


            $scope.showContextMenu = function (c) {
                var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");

                if (cardActionsHover.hasClass("hide")) {
                    cardActionsHover.removeClass("hide");
                    cardActionsHover.addClass("show");
                }
                else {
                    cardActionsHover.removeClass("show");
                    cardActionsHover.addClass("hide");
                }

            };


            $scope.hideContextMenu = function (c) {
                var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");
                cardActionsHover.removeClass("show");
                cardActionsHover.addClass("hide");
            };


            $scope.characterDelete = function (item) {
                var dlg = dialogs.confirm(
                    'Confirm Delete',
                    'Are you sure you want to delete this Character, "' + item.Name + '", and all associated pages, tabs, and tiles?',
                    { size: "sm" }
                );
                dlg.result.then(
                    function (res) {
                        if (res == "yes") {
                            $("#loading").css("display", "block");
                            var characterId = item.Id;
                            var deletes = characterService.Deletecharacter(characterId);
                            deletes.then(function (res) {
                                if (res.data.StatusCode == 200) {
                                    var deletedCharacterIndex = -1;
                                    for (var i = 0; i < $scope.characters.length; i++) {
                                        if ($scope.characters[i].Id == characterId) 
                                        {
                                            deletedCharacterIndex = i;
                                        }
                                    }
                                    if (deletedCharacterIndex > -1) {
                                        $scope.characters.splice(deletedCharacterIndex, 1);
                                        toaster.pop('success', "Character Deleted Successfully");
                                    }
                                    $("#loading").fadeOut("slow");
                                }
                                else {
                                    if (res.data.StatusCode == 400) {
                                        if (res.data.ShowToUser == true) {
                                            toaster.pop('error', res.data.ErrorMessage);
                                            $("#loading").fadeOut("slow");
                                        }
                                    }
                                }
                            })
                        }

                    });
            }
            
        }
    ])
})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('commandsPageController', ['$scope', '$transition', '$q', '$timeout', 'dialogs', 'toaster', 'navService', 'tileService',
        function ($scope, $transition, $q, $timeout, dialogs, toaster, navService, tileService) {

            $scope.data = null;

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            (function () {
                debugger;
                navService.updateBody(true, false);
                debugger;
                var characterId = $transition.params().characterId;
                var result = tileService.GetAllTileTypesRelatedCharacter(characterId);
                result.then(function (data) {
                    debugger;
                    if (data.data.StatusCode == 200) {
                        debugger;
                        $scope.AllTilesData = data.data.PayLoad;
                        $scope.commands = data.data.PayLoad.Commands;
                        $scope.data = {
                            notes: $scope.commands
                        }
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }

                })


            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('countersPageController', ['$scope', '$transition', '$q', '$timeout', 'dialogs', 'toaster', 'navService', 'tileService',
        function ($scope, $transition, $q, $timeout, dialogs, toaster, navService,tileService) {

            $scope.data = null;

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            (function () {

                navService.updateBody(true, false);
                var characterId = $transition.params().characterId;
                var result = tileService.GetAllTileTypesRelatedCharacter(characterId);
                result.then(function (data) {
                    debugger;
                    if (data.data.StatusCode == 200) {
                        $scope.AllTilesData = data.data.PayLoad;
                        $scope.counters = data.data.PayLoad.Counters;
                        $scope.data = {
                            counters: $scope.counters
                        }
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }

                })
               

            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('executesPageController', ['$scope', '$transition', '$q', '$timeout', 'dialogs', 'toaster', 'navService', 'tileService',
        function ($scope, $transition, $q, $timeout, dialogs, toaster, navService, tileService) {

            $scope.data = null;

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            (function () {
                debugger;
                navService.updateBody(true, false);
                debugger;
                var characterId = $transition.params().characterId;
                var result = tileService.GetAllTileTypesRelatedCharacter(characterId);
                result.then(function (data) {
                    debugger;
                    if (data.data.StatusCode == 200) {
                        debugger;
                        $scope.AllTilesData = data.data.PayLoad;
                        $scope.executes = data.data.PayLoad.Executes;
                        $scope.data = {
                            notes: $scope.executes
                        }
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }

                })


            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('layoutPageController', ['$scope', 'characterService', '$q', '$window', '$transition', '$state', '$timeout', '$interval', '$log', 'dialogs', 'navService', 'rulesetDataShareService', 'layoutService', 'tabService', '$compile', 'rulesetService', 'toaster', 'tileService',
        function ($scope, characterService, $q, $window, $transition, $state, $timeout, $interval, $log, dialogs, navService, rulesetDataShareService, layoutService, tabService, $compile, rulesetService, toaster, tileService) {

            $scope.$on("$destroy", function () {
                //if ($scope.ClientScopeChange == true) {
                //    var dlg = dialogs.confirm(
                //        'Confirm Delete',
                //        'The updated data is not saved yet. Do you want to save before exiting?',
                //        { size: 'sm' }
                //    );

                //    dlg.result.then(
                //        function (btn) {

                //            //saveLayoutwithTimer();
                //        }
                //    );
                //}
                //else {

                //}
            });
			
            $scope.initialClientObjectId = 1000;

            $scope.ClientScopeChange = false;

            if ($state.params.action == 1) {

                $scope.isLayoutSavingInProgress = false;

                if ($state.params.isNew == 1) {

                    rulesetDataShareService.setLayoutData({});

                    rulesetDataShareService.setCharacterLayoutsData({});

                    rulesetDataShareService.setcorestatvalue({});

                    rulesetDataShareService.setLayoutItemInventoryMetaData({});
                    rulesetDataShareService.setLayoutSpellInventoryMetaData({});
                    rulesetDataShareService.setLayoutAbilityInventoryMetaData({});

                    rulesetDataShareService.setLayoutItemInventoryData({});
                    rulesetDataShareService.setLayoutSpellInventoryData({});
                    rulesetDataShareService.setLayoutAbilityInventoryData({});
                    rulesetDataShareService.setLayoutRulesetItemInventoryData({});
                    rulesetDataShareService.setLayoutRulesetSpellInventoryData({});
                    rulesetDataShareService.setLayoutRulesetAbilityInventoryData({});

                    var defaultLayout = layoutService.GetCharacterLayouts($state.params.characterId);

                    defaultLayout.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            var layouts = setClientObjectId(data.data.PayLoad);
                            $scope.Layouts = layouts;
                            $scope.NewLayout = $scope.Layouts[0];    
                            $scope.LinkExecuteTileContent = $scope.NewLayout.RulesetViewModel;
                            rulesetDataShareService.setLinkTileData($scope.LinkExecuteTileContent);
                            $scope.selectedLayoutName = $scope.NewLayout.Name;

                            $scope.selectedPageName = $scope.NewLayout.TabList[0].TabName;

                            rulesetDataShareService.setLayoutData($scope.NewLayout);

                            rulesetDataShareService.setCharacterLayoutsData($scope.Layouts);
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        }
                    });

                   
                }
                else {
                    if (angular.equals({}, rulesetDataShareService.getLayoutData()) == false) {
                        $scope.NewLayout = rulesetDataShareService.getLayoutData();

                        $scope.selectedLayoutName = $scope.NewLayout.Name;
                        $scope.selectedPageName = $scope.NewLayout.TabList[0].TabName;
                    }
                    if (angular.equals({}, rulesetDataShareService.getCharacterLayoutsData()) == false) {
                        $scope.Layouts = rulesetDataShareService.getCharacterLayoutsData();
                    }
                    if (angular.equals({}, rulesetDataShareService.getCharacterLayoutsData()) == false) {
                        $scope.characters = rulesetDataShareService.setcorestatvalue();
                    }


                }

                
                var layoutAdd = function () {
                    var Scope = $scope.NewLayout;
                    Scope.LayoutId = $scope.NewLayout.LayoutId;
                    $scope.TabHeading = "Add Layout Name";
                    $scope.Buttontext = "Save";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (name) {
                        name.LayoutId = 0;
                        name.Name = name.TabName;
                        name.TabName = "";
                        var FirstTabArray;
                        for (var i = 0; i < name.TabList.length; i++) {
                            if (i == 0) {
                                FirstTabArray = name.TabList[i];
                            }
                        }
                        name.TabList = [];
                        name.TabList.push(FirstTabArray)
                        name.TabList[0].LayoutId = 0;
                        name.TabList[0].TabId = 0;
                        name.TabList[0].TabName = "Default";
                        name.TabList[0].TabOrder = 0;
                        name.TabList[0].TileList = [];
                        name.IsDefault = true;

                        layoutService.create(name).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                //FillCharacterLayoutsInLeftSideMenu();
                                $scope.NewLayout = data.data.PayLoad;

                                $("#loading").fadeOut("slow");
                                toaster.pop('success', "Layout Added Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        $("#loading").fadeOut("slow");
                                         toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                        //$timeout(function () {

                        //    var tab = dataService.createTab({
                        //        name: name,
                        //        order: $scope.LayoutTabs.length
                        //    });

                        //    $scope.LayoutTabs.push(tab);
                        //    $scope.state.tilesEditing = false;

                        //    $timeout(function () {
                        //        $scope.tabSet.index = tab.order;
                        //        updateTabs();
                        //    });
                        //});
                    });
                };



                var tabAdd = function () {
                    var Scope = $scope.NewLayout.LayoutMetaData.Tab;
                    Scope.LayoutId = $scope.NewLayout.LayoutId;
                    $scope.TabHeading = "Add Page Name";
                    $scope.Buttontext = "Save";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (res) {
                        if ($scope.NewLayout.TabList == null || $scope.NewLayout.TabList == undefined) {
                            $scope.NewLayout.TabList = [];
                        }
                        else {
                            res.ClientObjectId = $scope.initialClientObjectId;
                            res.IsSync = false;
                            res.SyncDate = Date.now();
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            $scope.NewLayout.TabList.push(res);
                            $scope.onTabSelected(res, $scope.NewLayout.TabList.length - 1);
                            $scope.ClientScopeChange = true;
                        }

                    });
                };

                $scope.AddNewtab = function () {
                    var Scope = $scope.NewLayout.LayoutMetaData.Tab;
                    Scope.LayoutId = $scope.NewLayout.LayoutId;
                    $scope.TabHeading = "Add Page Name";
                    $scope.Buttontext = "Save";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (res) {
                        if ($scope.NewLayout.TabList == null || $scope.NewLayout.TabList == undefined) {
                            $scope.NewLayout.TabList = [];
                        }
                        else {
                            res.ClientObjectId = $scope.initialClientObjectId;
                            res.IsSync = false;
                            res.SyncDate = Date.now();
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;

                            tabService.AddTab(res).then(function (data) {
                                if (data.data.StatusCode == 200) {

                                    //$scope.NewLayout.TabList.push(res);

                                    for (var i = 0; i < $scope.Layouts.length; i++) {
                                        if ($scope.Layouts[i].LayoutId == data.data.PayLoad.LayoutId) {
                                            $scope.Layouts[i].TabList.push(data.data.PayLoad);
                                            $scope.NewLayout = $scope.Layouts[i];
                                        }
                                    }
                                    $scope.onTabSelected(res, $scope.NewLayout.TabList.length - 1);
                                    $("#loading").fadeOut("slow");
                                    toaster.pop('success', "Tab Added Successfully.");

                                }
                                else {
                                    if (data.data.StatusCode == 400) {
                                        if (data.data.ShowToUser == true) {
                                            $("#loading").fadeOut("slow");
                                             toaster.pop("error", data.data.ErrorMessage);
                                        }
                                    }
                                }
                            });
                            $scope.ClientScopeChange = true;

                        }

                    });
                }

                $scope.layoutAdd = function () {
                    var Scope = $scope.NewLayout;
                    Scope.LayoutId = $scope.NewLayout.LayoutId;
                    $scope.TabHeading = "Add Layout Name";
                    $scope.Buttontext = "Save";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (name) {
                        name.LayoutId = 0;
                        name.Name = name.TabName;
                        name.TabName = "";
                        var FirstTabArray;
                        for (var i = 0; i < name.TabList.length; i++) {
                            if (i == 0) {
                                FirstTabArray = name.TabList[i];
                            }
                        }
                        name.TabList = [];
                        name.TabList.push(FirstTabArray)
                        name.TabList[0].LayoutId = 0;
                        name.TabList[0].TabId = 0;
                        name.TabList[0].TabName = "Default";
                        name.TabList[0].TabOrder = 0;
                        name.TabList[0].TileList = [];
                        name.IsDefault = true;

                        layoutService.create(name).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                //FillCharacterLayoutsInLeftSideMenu();
                                $scope.NewLayout = data.data.PayLoad;
                                $scope.Layouts.push(data.data.PayLoad);
                                $scope.selectedLayoutName = $scope.NewLayout.Name;
                                $scope.onTabSelected($scope.NewLayout.TabList[0], 0);
                                $("#loading").fadeOut("slow");
                                toaster.pop('success', "Layout Added Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        $("#loading").fadeOut("slow");
                                        toaster.pop("error", data.data.ErrorMessage);
                                   }
                                }
                            }
                        });
                    });
                };

                $scope.layoutLoad = function (layout) {
                    debugger;
                    $scope.state.tilesEditing = false;
                  
                    $scope.NewLayout = layout;
                    $scope.selectedLayoutName = $scope.NewLayout.Name;
                    $scope.onTabSelected($scope.NewLayout.TabList[0], 0);
                  
                };

                var tabRename = function () {

                    //var tabedit = $scope.NewLayout.TabList[$scope.tabSet.index];
                    $scope.TabHeading = "Rename";
                    $scope.Buttontext = "Update";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: $scope.NewLayout.TabList[$scope.tabSet.index], State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (res) {

                        res.IsSync = false;
                        res.SyncDate = Date.now();
                        $scope.NewLayout.TabList[$scope.tabSet.index] = res;
                    });

                }

                $scope.EditTab = function (tab) {
                    //var tabedit = $scope.NewLayout.TabList[$scope.tabSet.index];
                    $scope.TabHeading = "Edit";
                    $scope.Buttontext = "Update";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: tab, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (res) {
                        var edittab = tabService.UpdateTab(res).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                data.data.PayLoad.IsSync = false;
                                data.data.PayLoad.SyncDate = Date.now();
                                for (var i = 0; i < $scope.Layouts.length; i++) {
                                    for (var j = 0; j < $scope.Layouts[i].TabList.length; j++) {
                                        if ($scope.Layouts[i].TabList[j].ClientObjectId == data.data.PayLoad.ClientObjectId) {
                                            $scope.Layouts[i].TabList[j] = data.data.PayLoad;
                                        }
                                    }

                                }

                                //$scope.NewLayout.TabList[$scope.tabSet.index] = data.data.PayLoad;
                                $scope.ClientScopeChange = true;
                            }
                        })

                    });

                }

                $scope.DeleteTab = function (tab) {
                    //var tab = getActiveTab();

                    if (tab) {

                        var dlg = dialogs.confirm(
                            'Confirm Delete',
                            'Are you sure you want to delete "' + tab.TabName + '" and all its content?',
                            { size: 'sm' }
                        );

                        dlg.result.then(
                            function (res) {
                                if (res == 'yes') {
                                    if (tab.TabId > 0) {
                                        tabService.deleteTab(tab).then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                var deletedTabID = data.data.PayLoad.ClientObjectId;
                                                //var layoutId = data.data.PayLoad.Result.ClientObjectId;
                                                var requiredlayoutindex = -1;
                                                var requiredtabIndexId = -1;

                                                for (var i = 0; i < $scope.Layouts.length; i++) {

                                                    for (var j = 0; j < $scope.Layouts[i].TabList.length; j++) {
                                                        if ($scope.Layouts[i].TabList[j].ClientObjectId == deletedTabID) {
                                                            requiredlayoutindex = i;
                                                            requiredtabIndexId = j;
                                                        }
                                                    }

                                                   
                                                }
                                                if (requiredlayoutindex > -1 && requiredtabIndexId > -1) {
                                                    $scope.Layouts[requiredlayoutindex].TabList.splice(requiredtabIndexId, 1);
                                                   
                                                    if (requiredtabIndexId == $scope.selectedPageIndex && $scope.Layouts.length > 0) {
                                                        $scope.NewLayout = $scope.Layouts[requiredlayoutindex];
                                                        $scope.selectedPageIndex = 0;
                                                        $scope.selectedPageName = $scope.Layouts[requiredlayoutindex].TabList[0].TabName;
                                                    }
                                                    else if ($scope.NewLayout.TabList.length == 0)
                                                    {
                                                        $scope.NewLayout = $scope.Layouts[0];
                                                        $scope.selectedPageIndex = 0;
                                                        $scope.selectedPageName = $scope.NewLayout.TabList[0].TabName;
                                                    }
                                                }
                                               
                                                $("#loading").fadeOut("slow");
                                                toaster.pop('success', "Tab deleted Successfully.");
                                            }
                                            else {
                                                if (data.data.StatusCode == 400) {
                                                    if (data.data.ShowToUser == true) {
                                                         toaster.pop("error", data.data.ErrorMessage);
                                                    }
                                                }
                                            }

                                        });
                                    }
                                }

                                
                            })
                    }

                }
                $scope.SaveLayout = function (NewLayout) {

                    if ($scope.isLayoutSavingInProgress == false) {

                        $scope.isLayoutSavingInProgress = true;
                       
                        for (var i = 0; i < NewLayout.TabList.length; i++) {
                            var tab = NewLayout.TabList[i];
                            for (var j = 0; j < tab.TileList.length; j++) {
                                var tile = tab.TileList[j];
                                if (angular.equals({}, rulesetDataShareService.getTilelst()) == false) {
                                    //Getting saved edited Tile List from memory
                                    var EditTiles = JSON.parse(localStorage.getItem("Tilelst"));
                                    if (EditTiles != null) {
                                        for (var k = 0; k < EditTiles.length; k++) {
                                            var editTile = EditTiles[k];
                                            if (tile.EditClientId == editTile.EditClientId && tile.TileTypeName == editTile.TileTypeName) {
                                                tile.Value = editTile.Value;
                                                tile.Styles = editTile.Styles;

                                            }
                                            else if (angular.isUndefined(tile.TileId) == false && tile.TileId != null) {
                                                if (tile.TileId == editTile.TileId && tile.TileTypeName == editTile.TileTypeName) {
                                                    tile.Value = editTile.Value;
                                                    tile.Styles = editTile.Styles;
                                                }
                                            }
                                        }
                                    }
                                }
                                tile.TileLocationId = 1;
                            }
                        }
                        //Deleting Tile List from memory
                        localStorage.removeItem("Tilelst");
                        layoutService.update(NewLayout).then(function (data) {

                            $scope.isLayoutSavingInProgress = false

                            if (data.data.StatusCode == 200) {

                                var savedLayout = data.data.PayLoad;

                                for (var i = 0; i < $scope.Layouts.length; i++) {
                                    if ($scope.Layouts[i].LayoutId == savedLayout.LayoutId) {
                                        $scope.Layouts[i] = savedLayout;
                                    }
                                }

                                $scope.NewLayout = savedLayout;
                                $scope.state.tilesEditing = false;
                                toaster.pop('success', "Layout Updated Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    }
                }

                $scope.layoutRename = function (index, layout) {
                    var Scope = layout;
                    Scope.TabName = Scope.Name;
                    Scope.LayoutId = layout.LayoutId;
                    $scope.TabHeading = "Update Layout Name";
                    $scope.Buttontext = "Update";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );
                    dlg.result.then(function (res) {
                        res.Name = res.TabName;
                        layoutService.update(res).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                //$scope.Layouts[index] = layout;

                                var renamedLayoutID = data.data.PayLoad.ClientObjectId;
                                var requiredlayoutindex = -1;

                                for (var i = 0; i < $scope.Layouts.length; i++) {
                                    var layout = $scope.Layouts[i];
                                    if (layout.ClientObjectId == renamedLayoutID) {
                                        requiredlayoutindex = i;
                                    }
                                }


                                if (requiredlayoutindex > -1) {
                                    $scope.Layouts[requiredlayoutindex] = data.data.PayLoad;
                                    toaster.pop('success', "Layout Updated Successfully.");
                                }
                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                         toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        });

                    })
                };

                $scope.layoutCopy = function (index, layout) {
                    var Scope = layout;
                    Scope.TabName = Scope.Name;
                    Scope.LayoutId = layout.LayoutId;
                    $scope.TabHeading = "Copy Layout Name";
                    $scope.Buttontext = "Copy";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );
                    dlg.result.then(function (name) {
                        name.Name = name.TabName;
                        name.LayoutId = 0;
                        if (name.TabList != null) {
                            for (var i = 0; i < name.TabList.length; i++) {
                                var data = name.TabList[i];
                                data.LayoutId = 0;
                                data.TabId = 0;
                                if (data.TileList != null) {
                                    for (var j = 0; j < data.TileList.length; j++) {
                                        var dataTile = data.TileList[j];
                                        dataTile.EntityId = 0;
                                        dataTile.TabId = 0;
                                        dataTile.TileId = 0;
                                        if (dataTile.Value.Attribute != null) {
                                            dataTile.Value.Attribute.AttributeId = 0;
                                        }
                                        else if (dataTile.Value.Command != null) {
                                            dataTile.Value.Command.CommandId = 0;
                                        }
                                        else if (dataTile.Value.Counter != null) {
                                            dataTile.Value.Counter.CounterId = 0;
                                        }
                                        else if (dataTile.Value.Execute != null) {
                                            dataTile.Value.Execute.ExecuteId = 0;
                                        }
                                        else if (dataTile.Value.Link != null) {
                                            dataTile.Value.Link.LinkId = 0;
                                        }
                                        else if (dataTile.Value.Note != null) {
                                            dataTile.Value.Note.NoteId = 0;
                                        }

                                    }
                                }


                            }
                        }


                        layoutService.copyLayout(name).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                $scope.NewLayout = data.data.PayLoad;

                                $scope.Layouts.push(data.data.PayLoad);
                                $scope.selectedLayoutName = $scope.NewLayout.Name;
                                $scope.onTabSelected($scope.NewLayout.TabList[0], 0);
                                //FillCharacterLayoutsInLeftSideMenu();
                                toaster.pop('success', "Layout Copied Successfully.");
                                $transition.router.stateService.go('profile.character.layout', { characterId: $scope.NewLayout.CharacterProfileId, layoutId: $scope.NewLayout.LayoutId });

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                         toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    });
                };

                $scope.layoutDelete = function (index, layout) {
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this view, "' + layout.Name + '", and all associated pages, tabs, and tiles?',
                        { size: 'sm' }
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == 'yes') {
                                layoutService.deleteLayout(layout).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                        var deleteLayoutId = data.data.PayLoad.ClientObjectId;
                                        var requiredLayoutIndexId = -1;
                                        for (var i = 0; i < $scope.Layouts.length; i++) {
                                            if ($scope.Layouts[i].ClientObjectId == deleteLayoutId) {
                                                requiredLayoutIndexId = i;
                                            }
                                        }
                                        if (requiredLayoutIndexId > -1) {
                                            $scope.Layouts.splice(requiredLayoutIndexId, 1);
                                        }
                                        if ($scope.Layouts.length == 0) {
                                            $state.go("profile.characters");

                                        }
                                        else {

                                            $scope.selectedLayoutName = $scope.Layouts[0].Name;

                                            $scope.selectedPageName = $scope.Layouts[0].TabList[0].TabName;

                                        }
                                        //FillCharacterLayoutsInLeftSideMenu();
                                        toaster.pop('success', "Layout deletedSuccessfully.");

                                    }
                                    else {
                                        if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true) {
                                                 toaster.pop("error", data.data.ErrorMessage);
                                            }
                                        }
                                    }
                                });
                            }

                        }
                    );
                };


                $scope.state = {
                    tilesEditing: false,
                    tileDragging: false,
                    useOrEditMode: false,
                    tileDeleteId: null
                };

                $scope.ManageTiles = function () {
                    $scope.state.tilesEditing = !$scope.state.tilesEditing;
                    $scope.state.useOrEditMode = !$scope.state.useOrEditMode;
                }

                $scope.ManageTilesCompleted = function () {
                    $scope.state.tilesEditing = !$scope.state.tilesEditing;
                    $scope.state.useOrEditMode = !$scope.state.useOrEditMode;
                }

                $scope.ShowTiles = function () {
                    var dlg = dialogs.create('/views/dialogs/tile-type-picker.html', 'dialogTileTypes',
                        { scope: $scope.NewLayout.LayoutMetaData.TileTypes }
                    );
                    dlg.result.then(function (res) {
                        if (res.TileType == "Note") {
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                            //$scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                            // $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var dlg = dialogs.create('/views/dialogs/tile-editor-1.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile, Tablist: $scope.NewLayout.TabList }
                            );
                            dlg.result.then(function (res) {
                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;

                                    }
                                }
                                $scope.ClientScopeChange = true;
                            });
                        }
                        else if (res.TileType == "Counter") {
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;

                            $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            // $scope.NewLayout.LayoutMetaData.Tile.TabId = $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;

                            var dlg = dialogs.create('/views/dialogs/tile-editor-2.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile }
                            );
                            dlg.result.then(function (res) {

                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                }
                                $scope.ClientScopeChange = true;

                            });
                        }
                        else if (res.TileType == "Attribute") {
                            $scope.CorestatValues = rulesetDataShareService.getLayoutData();
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                            $scope.NewLayout.LayoutMetaData.Tile.Value.Attribute.CoreStatValue = res.Value.Attribute.CoreStatValue;
                            $scope.NewLayout.LayoutMetaData.Tile.CorestatValues = $scope.CorestatValues.CorestatValues;
                            $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            //  $scope.NewLayout.LayoutMetaData.Tile.TabId = $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var dlg = dialogs.create('/views/dialogs/tile-editor-3.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile }
                            );
                            dlg.result.then(function (res) {

                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                }
                                $scope.ClientScopeChange = true;

                            });
                        }
                        else if (res.TileType == "Link") {
                           
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                            $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            // $scope.NewLayout.LayoutMetaData.Tile.TabId = $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var dlg = dialogs.create('/views/dialogs/tile-editor-4.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile }
                            );
                            dlg.result.then(function (res) {

                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                }
                                $scope.ClientScopeChange = true;

                            });
                            //}

                            //});
                        }
                        else if (res.TileType == "Execute") {
                            
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;

                            $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            // $scope.NewLayout.LayoutMetaData.Tile.TabId = $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;

                            var dlg = dialogs.create('/views/dialogs/tile-editor-5.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile, fullscope: $scope.NewLayout.TabList }
                            );
                            dlg.result.then(function (res) {
                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                }
                            })
                            //}
                            $scope.ClientScopeChange = true;

                            //});

                        }
                        else if (res.TileType == "Command") {
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;

                            $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            // $scope.NewLayout.LayoutMetaData.Tile.TabId = $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var dlg = dialogs.create('/views/dialogs/tile-editor-6.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile }
                            );
                            dlg.result.then(function (res) {

                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                }

                                $scope.ClientScopeChange = true;

                            });
                        }
                        else if (res.TileType == "Image") {
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                            $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                            $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                            $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                            // $scope.NewLayout.LayoutMetaData.Tile.TabId = $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var SelectedTab;
                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if (i == $scope.selectedPageIndex) {
                                    SelectedTab = $scope.NewLayout.TabList[i];
                                }
                            }
                            $scope.NewLayout.LayoutMetaData.Tile.TabId = angular.isUndefined(SelectedTab) == false ? SelectedTab.TabId : $scope.NewLayout.TabList[$scope.tabSet.index].TabId;
                            var dlg = dialogs.create('/views/dialogs/tile-editor-7.html', 'NoteTile',
                                { scope: $scope.NewLayout.LayoutMetaData.Tile }
                            );
                            dlg.result.then(function (res) {
                                if (res != "cancel") {
                                    if ($scope.NewLayout.TabList[$scope.tabSet.index].TileList == null || $scope.NewLayout.TabList[$scope.tabSet.index].TileList == undefined) {
                                        $scope.NewLayout.TabList[$scope.tabSet.index].TileList = [];
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                    else {
                                        res.Height = "5";
                                        res.Width = "5";
                                        res.X = "0";
                                        res.Y = "0";
                                        res.CharacterProfileId = $scope.NewLayout.CharacterProfileId;
                                        res.ClientObjectId = $scope.initialClientObjectId + 1;
                                        res.IsSync = false;
                                        res.SyncDate = Date.now();
                                        $scope.NewLayout.TabList[$scope.selectedPageIndex > 0 ? $scope.selectedPageIndex : $scope.tabSet.index].TileList.push(res);
                                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                    }
                                }

                                $scope.ClientScopeChange = true;
                            });

                        }



                    });
                }
                $scope.state = {
                    tilesEditing: false,
                    tileDragging: false,
                    tileDeleteId: null
                };

                $scope.stackOptions = {
                    height: 150,
                    width: 400,
                    cellHeight: 30,
                    minWidth: 1,

                    pixelWidth: 35,
                    verticalMargin: 5,
                    alwaysShowResizeHandle: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),

                    resizable: {
                        handles: 'e, se, s, sw, w'
                    },
                    draggable: {
                        refreshPositions: true,
                        handle: '.grid-stack-item-content'
                    }
                };

                $scope.tabSet = {
                    api: {},
                    index: 0
                };

                $scope.tilePickerApi = {
                    messageId: null,
                    beforeSelect: function () {
                    },
                    onClose: function () {
                    }
                };

                var updateTabs = function () {
                    //$scope.navService.updateBody(true, $scope.NewLayout.TabList.length);
                    $scope.tabSet.api.doRecalculate();
                    $scope.tabSet.api.scrollTabIntoView();
                };

                var getActiveTab = function () {

                    if ($scope.tabSet.index >= 0)
                        return $scope.NewLayout.TabList[$scope.tabSet.index];
                    return null;
                };

                var tabsSort = function (arr) {
                    (arr || []).sort(function (a, b) { return a.order - b.order; });
                };

                var layoutRename = function () {

                    var Scope = $scope.NewLayout;
                    Scope.TabName = Scope.Name;
                    Scope.LayoutId = $scope.NewLayout.LayoutId;
                    $scope.TabHeading = "Update Layout Name";
                    $scope.Buttontext = "Update";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );
                    dlg.result.then(function (name) {

                        name.Name = name.TabName;
                        layoutService.update(name).then(function (data) {

                            if (data.data.StatusCode == 200) {

                                $scope.NewLayout.Name = name.Name;
                                //FillCharacterLayoutsInLeftSideMenu();
                                toaster.pop('success', "Layout Updated Successfully.");

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                         toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    });
                };

                var layoutDelete = function () {

                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this view, "' + $scope.NewLayout.Name + '", and all associated pages, tabs, and tiles?',
                        { size: 'sm' }
                    );

                    dlg.result.then(
                        function (btn) {

                            layoutService.deleteLayout($scope.NewLayout.LayoutId).then(function (data) {

                                if (data.data.StatusCode == 200) {

                                    //FillCharacterLayoutsInLeftSideMenu();
                                    $state.go("profile.characters");
                                    toaster.pop('success', "Layout deleted Successfully.");

                                }
                                else {
                                    if (data.data.StatusCode == 400) {
                                        if (data.data.ShowToUser == true) {
                                             toaster.pop("error", data.data.ErrorMessage);
                                        }
                                    }
                                }
                            });
                        }
                    );
                };

                var layoutCopy = function () {
                    var Scope = $scope.NewLayout;
                    Scope.TabName = Scope.Name;
                    Scope.LayoutId = $scope.NewLayout.LayoutId;
                    $scope.TabHeading = "Copy Layout Name";
                    $scope.Buttontext = "Copy";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: Scope, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );
                    dlg.result.then(function (name) {

                        name.Name = name.TabName;
                        name.LayoutId = 0;
                        for (var i = 0; i < name.TabList.length; i++) {
                            var data = name.TabList[i];
                            data.LayoutId = 0;
                            data.TabId = 0;
                            for (var j = 0; j < data.TileList.length; j++) {
                                var dataTile = data.TileList[j];
                                dataTile.EntityId = 0;
                                dataTile.TabId = 0;
                                dataTile.TileId = 0;
                                if (dataTile.Value.Attribute != null) {
                                    dataTile.Value.Attribute.AttributeId = 0;
                                }
                                else if (dataTile.Value.Command != null) {
                                    dataTile.Value.Command.CommandId = 0;
                                }
                                else if (dataTile.Value.Counter != null) {
                                    dataTile.Value.Counter.CounterId = 0;
                                }
                                else if (dataTile.Value.Execute != null) {
                                    dataTile.Value.Execute.ExecuteId = 0;
                                }
                                else if (dataTile.Value.Link != null) {
                                    dataTile.Value.Link.LinkId = 0;
                                }
                                else if (dataTile.Value.Note != null) {
                                    dataTile.Value.Note.NoteId = 0;
                                }

                            }

                        }

                        layoutService.copyLayout(name).then(function (data) {

                            if (data.data.StatusCode == 200) {

                                $scope.NewLayout = data.data.PayLoad;
                                //FillCharacterLayoutsInLeftSideMenu();
                                toaster.pop('success', "Layout Copied Successfully.");
                                $transition.router.stateService.go('profile.character.layout', { characterId: $scope.NewLayout.CharacterProfileId, layoutId: $scope.NewLayout.LayoutId });

                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                         toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        });
                    });
                };

                $scope.CopyTab = function (tab) {
                    $scope.TabHeading = "Copy Page";
                    $scope.Buttontext = "Copy";
                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { scope: tab, State: $scope.TabHeading, btntext: $scope.Buttontext }
                    );

                    dlg.result.then(function (res) {
                        res.ClientObjectId = $scope.initialClientObjectId;
                        res.IsSync = false;
                        res.SyncDate = Date.now();
                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;

                        res.TabId = 0;
                        var copytab = tabService.AddTab(res).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                data.data.PayLoad.IsSync = false;
                                data.data.PayLoad.SyncDate = Date.now();
                                $scope.NewLayout.TabList.push(data.data.PayLoad);
                                for (var i = 0; i < $scope.Layouts.length; i++) {
                                    if ($scope.Layouts[i].LayoutId == data.data.PayLoad.LayoutId) {
                                        $scope.Layouts[i].TabList.push(data.data.PayLoad);
                                    }
                                }

                                //$scope.NewLayout.TabList[$scope.tabSet.index] = data.data.PayLoad;
                                $scope.ClientScopeChange = true;
                            }
                        })
                    });
                };

                var tabReorder = function () {

                    var tab = getActiveTab(),
                        currentIdx = $scope.tabSet.index;

                    var dlg = dialogs.create('/views/dialogs/tab-reorder.html', 'dialogTabReorder',
                        {
                            items: $scope.NewLayout.TabList,
                            sorter: tabsSort
                        },
                        { size: 'sm', copy: false }
                    );

                    dlg.result.then(function (items) {

                        $timeout(function () {

                            items.forEach(function (item, idx) {
                                item.order = idx;
                                if (item === tab)
                                    currentIdx = idx;
                            });

                            tabsSort($scope.NewLayout.TabList);
                            $scope.tabSet.index = currentIdx;

                            updateTabs();

                        });
                    });
                }

                $scope.getTileClass = function (tile) {

                    var arr = [];

                    if ($scope.state.tilesEditing)
                        arr.push(tile.__randomShake);

                    if (tile.id === $scope.state.tileDeleteId)
                        arr.push('over-delete');

                    return arr.join(' ');
                };

                $scope.getAutoPosition = function (tile) {
                    var x = tile.id > 0 ? false : _autoPosition;
                    return x;
                };

                $scope.tileSelect = function (tile) {
                    if ($scope.tilePickerApi.selecting)
                        $scope.tilePickerApi.endSelect(tile);
                };

                $scope.tileEdit = function () {
                    $scope.tilePickerApi.beginSelect(function (tile) {

                    });
                }

                $scope.onDragStart = function (event, ui) {
                    $timeout(function () {
                        $scope.state.tileDragging = true;
                    });
                };

                $scope.onDragStop = function (event, ui) {
                    $timeout(function () {
                        $scope.state.tileDragging = false;
                    });
                };

                $scope.onDeleteDrop = function (event, ui) {
                    var requiredtabindex = -1;
                    var requiredtileIndexId = -1;
                    var tile = GridStackUI.Utils.getNodeData(ui.helper);
                    var clientobjectId = ui.helper[0].dataset.gsId;

                    $scope.Layout = $scope.NewLayout;
                    for (var i = 0; i < $scope.Layout.TabList.length; i++) {
                        var Tab = $scope.Layout.TabList[i];
                        var TabTiles = Tab.TileList;
                        for (var j = 0; j < TabTiles.length; j++) {
                            if (TabTiles[j].ClientObjectId == clientobjectId) {
                                requiredtabindex = i;
                                requiredtileIndexId = j;
                            }
                        }
                    }


                    if (requiredtabindex > -1 && requiredtileIndexId > -1) {
                        if ($scope.Layout.TabList[requiredtabindex].TileList[requiredtileIndexId].TileId == 0) {
                            $scope.Layout.TabList[requiredtabindex].TileList.splice(requiredtileIndexId, 1);
                            $scope.NewLayout = [];
                            $scope.NewLayout = $scope.Layout;
                            toaster.pop('success', "Tile deleted Successfully.");
                        }
                        else {
                            tileService.deleteTile($scope.Layout.TabList[requiredtabindex].TileList[requiredtileIndexId]).then(function (data) {
                                if (data.data.StatusCode == 200) {

                                    var deletedTileID = data.data.PayLoad.Result.TileId;
                                    var requiredtabindex = -1;
                                    var requiredtileIndexId = -1;

                                    for (var i = 0; i < $scope.Layout.TabList.length; i++) {
                                        var Tab = $scope.Layout.TabList[i];
                                        var TabTiles = Tab.TileList;
                                        for (var j = 0; j < TabTiles.length; j++) {
                                            if (TabTiles[j].TileId == deletedTileID) {
                                                requiredtabindex = i;
                                                requiredtileIndexId = j;
                                            }
                                        }
                                    }
                                    if (requiredtabindex > -1 && requiredtileIndexId > -1) {
                                        $scope.Layout.TabList[requiredtabindex].TileList.splice(requiredtileIndexId, 1);
                                    }
                                    $scope.NewLayout = [];
                                    $scope.NewLayout = $scope.Layout;
                                    toaster.pop('success', "Tile deleted Successfully.");
                                }
                                else {
                                    if (data.data.StatusCode == 400) {
                                        if (data.data.ShowToUser == true) {
                                             toaster.pop("error", data.data.ErrorMessage);
                                        }
                                    }
                                }
                            });
                        }
                    }
                };

                $scope.onDeleteOver = function (event, ui) {
                    var node = GridStackUI.Utils.getNodeData(ui.helper);
                    if (node) {
                        $timeout(function () {
                            $scope.state.tileDeleteId = node.id;
                        });
                    }
                };

                $scope.onDeleteOut = function (event) {
                    if ($scope.state.tileDeleteId) {
                        $timeout(function () {
                            $scope.state.tileDeleteId = null;
                        });
                    }
                };
                $scope.selectedPageIndex = 0;
                $scope.onTabSelected = function (tab, index) {
                    debugger;
                    $scope.selectedPageIndex = index;
                    $scope.selectedPageName = tab.TabName;
                };

                var layoutRender = function (pageIndex) {

                    $scope.state.tilesEditing = false;
                    var layoutId = $scope.NewLayout.LayoutId;
                    var layout = layoutService.loadLayout(layoutId);
                    layout.then(function (data) {

                        if (data.data.StatusCode == 200) {

                            $scope.Layout = data.data.PayLoad;
                            tabsSort($scope.Layout.tabs);

                            if ($scope.Layout.tabs.length) {

                                if (pageIndex || pageIndex === 0) {
                                    pageIndex = Math.clamp(0, $scope.Layout.tabs.length - 1);
                                }
                                else {
                                    pageIndex = 0;

                                    var pageId = $state.params.pageId;
                                    if (pageId) {
                                        pageIndex = $scope.Layout.tabs.findIndex(function (element, index) {
                                            return element.id === pageId;
                                        });
                                    }
                                }
                            }
                            else {
                                pageIndex = -1;
                            }

                            $scope.tabSet.index = pageIndex;
                            updateTabs();
                            //  rulesetDataShareService.setlayoutmetadata($scope.Layout);
                            // $transition.router.stateService.go('profile.character.layout', { characterId: $window.localStorage.getItem("CharacterProfileId"), layoutId: layoutId });
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        }
                    })

                };

                var layoutLoad = function (layoutId) {
                    $scope.state.tilesEditing = false;
                    var layout = layoutService.loadLayout(layoutId);


                    layout.then(function (data) {

                        if (data.data.StatusCode == 200) {
                            $scope.NewLayout = data.data.PayLoad;
                            $transition.router.stateService.go('profile.character.layout', { characterId: $scope.NewLayout.CharacterProfileId, layoutId: layoutId });
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        }
                    })
                };

               

                $scope.ToggleMenu = function (e) {
                    var actions = angular.element(e.target).find(".page-toolbar-wrapper-toggle-trigger .btn")
                    var button = actions;
                    var wrapper = ".page-toolbar-wrapper.initial";
                    var button_text = angular.element("#showAction").text();

                    if (angular.element(wrapper).hasClass("hide")) {
                        angular.element(wrapper).removeClass("hide");
                        angular.element(wrapper).addClass("show");
                    }
                    else {
                        angular.element(wrapper).removeClass("show");
                        angular.element(wrapper).addClass("hide");
                    }

                    angular.element(button).toggleClass("icon-arrow-down icon-arrow-up");
                    //wrapper.toggleClass("show");

                    if (button_text === "Show actions") {
                        angular.element("#showAction").text("Hide actions");

                    } else {
                        angular.element("#showAction").text("Show actions");
                    }

                };

                $scope.showContextMenu = function (e) {
                    var trigger = angular.element(e.target).parent();
                    //angular.element(e.target).parent(".dropdown-menu-item").find(".dropdown-menu-item-actions")
                    var actions = angular.element(e.target).parents(".dropdown-menu-item").find(".dropdown-menu-item-actions")

                    e.stopPropagation();

                    trigger.addClass("hide");
                    actions.addClass("show");

                    actions
                        .find("[data-action=close]")
                        .click(function (e) {
                            e.stopPropagation();
                            trigger.removeClass("hide");
                            actions.removeClass("show");
                        });



                };


              

                $scope.hideConteextMenu = function (c) {
                    var cardActionsHover = angular.element(c.target).parents(".dropdown-menu-item").find(".dropdown-menu-item-actions");
                    cardActionsHover.removeClass("show");
                    cardActionsHover.addClass("hide");
                };




            }
            else if ($state.params.action == 2) {

                if ($state.params.contentType == 1) {
                    $scope.ShowItems = true;
                    if (angular.equals({}, rulesetDataShareService.getLayoutItemInventoryData()) == false) {
                        $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
                        $scope.CharacterInventoryMetaData = rulesetDataShareService.getLayoutItemInventoryMetaData();
                        if ($scope.NewItemInventory.CharacterItems.length == 0) {
                            $scope.ShowItems = true;
                            $scope.ShowItem = false;
                        }
                        else {
                            $scope.ShowItems = false;
                            $scope.ShowItem = true;
                        }
                    }
                    else {
                        var itemcontent = characterService.GetCharacterItemContent($state.params.characterId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.NewItemInventory = data.data.PayLoad;
                                rulesetDataShareService.setLayoutItemInventoryData($scope.NewItemInventory);
                                rulesetDataShareService.setLayoutItemInventoryMetaData($scope.NewItemInventory.CharacterInventoryMetaData);
                                if ($scope.NewItemInventory.CharacterItems.length == 0) {
                                    $scope.ShowItems = true;
                                    $scope.ShowItem = false;
                                }
                                else {
                                    $scope.ShowItems = false;
                                    $scope.ShowItem = true;
                                }

                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }

                        });
                    }
                }

                else if ($state.params.contentType == 2) {
                    $scope.ShowSpells = true;
                    if (angular.equals({}, rulesetDataShareService.getLayoutSpellInventoryData()) == false) {
                        $scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
                        $scope.CharacterInventoryMetaSpellData = rulesetDataShareService.getLayoutSpellInventoryMetaData();
                        if ($scope.NewSpellInventory.CharacterSpells.length == 0) {
                            $scope.ShowSpells = true;
                            $scope.ShowSpell = false;
                        }
                        else {
                            $scope.ShowSpells = false;
                            $scope.ShowSpell = true;
                        }
                    }
                    else {
                        var spellcontent = characterService.GetCharacterSpellContent($state.params.characterId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.NewSpellInventory = data.data.PayLoad;
                                rulesetDataShareService.setLayoutSpellInventoryData($scope.NewSpellInventory);
                                rulesetDataShareService.setLayoutSpellInventoryMetaData($scope.NewSpellInventory.CharacterInventoryMetaData);
                                if ($scope.NewSpellInventory.CharacterSpells.length == 0) {
                                    $scope.ShowSpells = true;
                                    $scope.ShowSpell = false;
                                }
                                else {
                                    $scope.ShowSpells = false;
                                    $scope.ShowSpell = true;
                                }

                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }

                        });
                    }
                }
                else if ($state.params.contentType == 3) {
                    $scope.ShowAbilities = true;
                    if (angular.equals({}, rulesetDataShareService.getLayoutAbilityInventoryData()) == false) {
                        $scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
                        $scope.CharacterInventoryAbilityMetaData = rulesetDataShareService.getLayoutAbilityInventoryMetaData();
                        if ($scope.NewAbilityInventory.CharacterAbilities.length == 0) {
                            $scope.ShowAbilities = true;
                            $scope.ShowAbility = false;
                        }
                        else {
                            $scope.ShowAbilities = false;
                            $scope.ShowAbility = true;
                        }
                    }
                    else {
                        var abilitycontent = characterService.GetCharacterAbilityContent($state.params.characterId).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.NewAbilityInventory = data.data.PayLoad;
                                rulesetDataShareService.setLayoutAbilityInventoryData($scope.NewAbilityInventory);
                                rulesetDataShareService.setLayoutAbilityInventoryMetaData($scope.NewAbilityInventory.CharacterInventoryMetaData);
                                if ($scope.NewAbilityInventory.CharacterAbilities.length == 0) {
                                    $scope.ShowAbilities = true;
                                    $scope.ShowAbility = false;
                                }
                                else {
                                    $scope.ShowAbilities = false;
                                    $scope.ShowAbility = true;
                                }

                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }

                        });
                    }
                }

                $scope.GridViewTrigger = function (e) {
                    var gridViewTrigger = angular.element(e.target);
                    gridViewTrigger.parent().children().removeClass("selected");
                    gridViewTrigger.addClass("selected");

                    angular.element(".card-list").removeClass("view-list");
                }

                $scope.ListViewTrigger = function (e) {
                    var listViewTrigger = angular.element(e.target);
                    listViewTrigger.parent().children().removeClass("selected");
                    listViewTrigger.addClass("selected");

                    angular.element(".card-list").addClass("view-list");
                }




                $scope.hideConteextMenu = function (c) {

                    var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");
                    cardActionsHover.removeClass("show");
                    cardActionsHover.addClass("hide");
                };

                $scope.showContextMenu = function (e) {

                    var cardActionsHover = angular.element(e.target).parents(".card").find(".card-actions");

                    if (cardActionsHover.hasClass("hide")) {
                        cardActionsHover.removeClass("hide");
                        cardActionsHover.addClass("show");
                    }
                    else {
                        cardActionsHover.removeClass("show");
                        cardActionsHover.addClass("hide");
                    }

                };

            }
            else if ($state.params.action == 3) {
                if ($state.params.contentType == 1) {
                    if (angular.equals({}, rulesetDataShareService.getLayoutRulesetItemInventoryData()) == false) {
                        $scope.RulesetItems = rulesetDataShareService.getLayoutRulesetItemInventoryData();
                        if ($scope.RulesetItems.length == 0) {
                            $scope.ShowItems = true;
                            $scope.ShowItem = false;
                        }
                        else {
                            $scope.ShowItems = false;
                            $scope.ShowItem = true;
                        }
                    }
                    else {
                        var rulesetitemcontent = rulesetService.GetRuleSetItemsForItemInventory($state.params.characterId);
                        rulesetitemcontent.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetItems = data.data.PayLoad.Items;
                                rulesetDataShareService.setLayoutRulesetItemInventoryData($scope.RulesetItems);
                                if ($scope.RulesetItems.length == 0) {
                                    $scope.ShowItems = true;
                                    $scope.ShowItem = false;
                                }
                                else {
                                    $scope.ShowItems = false;
                                    $scope.ShowItem = true;
                                }

                            }
                        });
                    }

                }
                else if ($state.params.contentType == 2) {
                    if (angular.equals({}, rulesetDataShareService.getLayoutRulesetSpellInventoryData()) == false) {
                        $scope.RulesetSpells = rulesetDataShareService.getLayoutRulesetSpellInventoryData();
                        if ($scope.RulesetSpells.length == 0) {
                            $scope.ShowSpells = true;
                            $scope.ShowSpell = false;
                        }
                        else {
                            $scope.ShowSpells = false;
                            $scope.ShowSpell = true;
                        }
                    }
                    else {
                        var rulesetspellcontent = rulesetService.GetRuleSetSpellsForSpellInventory($state.params.characterId);
                        rulesetspellcontent.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetSpells = data.data.PayLoad.Spells;
                                rulesetDataShareService.setLayoutRulesetSpellInventoryData($scope.RulesetSpells);
                                if ($scope.RulesetSpells.length == 0) {
                                    $scope.ShowSpells = true;
                                    $scope.ShowSpell = false;
                                }
                                else {
                                    $scope.ShowSpells = false;
                                    $scope.ShowSpell = true;
                                }
                            }
                        });
                    }
                }
                else if ($state.params.contentType == 3) {
                    if (angular.equals({}, rulesetDataShareService.getLayoutRulesetAbilityInventoryData()) == false) {
                        $scope.RulesetAbilities = rulesetDataShareService.getLayoutRulesetAbilityInventoryData();
                        if ($scope.RulesetAbilities.length == 0) {
                            $scope.ShowAbilities = true;
                            $scope.ShowAbility = false;
                        }
                        else {
                            $scope.ShowAbilities = false;
                            $scope.ShowAbility = true;
                        }
                    }
                    else {
                        var rulesetabilitycontent = rulesetService.GetRuleSetAbilitiesForAbilityInventory($state.params.characterId);
                        rulesetabilitycontent.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetAbilities = data.data.PayLoad.Abilities;
                                rulesetDataShareService.setLayoutRulesetAbilityInventoryData($scope.RulesetAbilities);
                                if ($scope.RulesetAbilities.length == 0) {
                                    $scope.ShowAbilities = true;
                                    $scope.ShowAbility = false;
                                }
                                else {
                                    $scope.ShowAbilities = false;
                                    $scope.ShowAbility = true;
                                }
                            }
                        });
                    }
                }

            }
            else if ($state.params.action == 4) {

                if ($state.params.contentType == 1) {
                    $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
                    $scope.CharacterContent = $scope.NewItemInventory.CharacterItems[$state.params.index];
                    // Setting ClientObjectId For Tiles.
                    for (var i = 0; i < $scope.CharacterContent.CharacterItemsProperties.length; i++) {
                        var ItemPropertyLst = $scope.CharacterContent.CharacterItemsProperties[i];
                        if (ItemPropertyLst.CharacterItemId == 0 || ItemPropertyLst.CharacterItemId == undefined || ItemPropertyLst.CharacterItemId == "") {
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            ItemPropertyLst.tile.ClientObjectId = $scope.initialClientObjectId;
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }

                    $scope.CharacterContent.Index = $state.params.index;
                }
                else if ($state.params.contentType == 2) {

                    $scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
                    $scope.CharacterContent = $scope.NewSpellInventory.CharacterSpells[$state.params.index];
                    // Setting ClientObjectId For Tiles.
                    for (var i = 0; i < $scope.CharacterContent.CharacterSpellsProperties.length; i++) {
                        var spellPropertyLst = $scope.CharacterContent.CharacterSpellsProperties[i];
                        if (spellPropertyLst.CharacterSpellId == 0 || spellPropertyLst.CharacterSpellId == undefined || spellPropertyLst.CharacterSpellId == "") {
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            spellPropertyLst.tile.ClientObjectId = $scope.initialClientObjectId;
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }
                    $scope.CharacterContent.Index = $state.params.index;
                }
                else if ($state.params.contentType == 3) {

                    $scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
                    $scope.CharacterContent = $scope.NewAbilityInventory.CharacterAbilities[$state.params.index];
                    // Setting ClientObjectId For Tiles.
                    for (var i = 0; i < $scope.CharacterContent.CharacterAbilitiesProperties.length; i++) {
                        var abilityPropertyLst = $scope.CharacterContent.CharacterAbilitiesProperties[i];
                        if (abilityPropertyLst.CharacterAbilityId == 0 || abilityPropertyLst.CharacterAbilityId == undefined || abilityPropertyLst.CharacterAbilityId == "") {
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            abilityPropertyLst.tile.ClientObjectId = $scope.initialClientObjectId;
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }
                    $scope.CharacterContent.Index = $state.params.index;
                }
            }
            

            function setClientObjectId(Layouts) {
                for (var k = 0; k < Layouts.length; k++) {

                    Layouts[k].ClientObjectId = $scope.initialClientObjectId;
                    $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                    for (var i = 0; i < Layouts[k].TabList.length; i++) {
                        Layouts[k].TabList[i].ClientObjectId = $scope.initialClientObjectId;
                        $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        Layouts[k].TabList[i].IsSync = true;
                        Layouts[k].TabList[i].UpdateDate = Date.now();
                        for (var j = 0; j < Layouts[k].TabList[i].TileList.length; j++) {
                            Layouts[k].TabList[i].TileList[j].ClientObjectId = $scope.initialClientObjectId;
                            Layouts[k].TabList[i].TileList[j].IsSync = true;
                            Layouts[k].TabList[i].TileList[j].UpdateDate = Date.now();
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }
                }
                return Layouts;
            }



            function saveLayoutwithTimer() {

                if ($scope.ClientScopeChange == true) {
                    for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                        if ($scope.NewLayout.TabList[i].IsSync == false) {
                            syncLayoutTabwithTimer($scope.NewLayout.TabList[i]);
                        }
                        for (var j = 0; j < $scope.NewLayout.TabList[i].TileList.length; j++) {
                            if ($scope.NewLayout.TabList[i].TileList[j].IsSync == false) {
                                syncLayoutTilewithTimer($scope.NewLayout.TabList[i].TileList[j]);
                            }
                        }
                    }
                }
                $scope.ClientScopeChange = false;
            }

            function syncLayoutTabwithTimer(tabObjectforUpdate) {


                if (tabObjectforUpdate.TabId == null || tabObjectforUpdate.TabId == "" || tabObjectforUpdate.TabId == 0) {
                    tabService.AddTab(tabObjectforUpdate).then(function (data) {

                        if (data.data.StatusCode == 200) {

                            var UpdatedTabObject = data.data.PayLoad;

                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if ($scope.NewLayout.TabList[i].ClientObjectId == UpdatedTabObject.ClientObjectId) {
                                    if ($scope.NewLayout.TabList[i].UpdateDate <= UpdatedTabObject.UpdateDate) {
                                        $scope.NewLayout.TabList[i] = UpdatedTabObject;
                                        break;
                                    }
                                }
                            }
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    // toaster.pop("error", data.data.ErrorMessage);
                                    toaster.pop('error', "Problem in saving the data, please check your internet connection.");
                                }
                                $scope.ClientScopeChange = true;
                            }
                        }
                    });
                }
                else {
                    tabService.UpdateTab(tabObjectforUpdate).then(function (data) {

                        if (data.data.StatusCode == 200) {

                            var UpdatedTabObject = data.data.PayLoad;

                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                if ($scope.NewLayout.TabList[i].ClientObjectId == UpdatedTabObject.ClientObjectId) {
                                    if ($scope.NewLayout.TabList[i].UpdateDate <= UpdatedTabObject.UpdateDate) {
                                        $scope.NewLayout.TabList[i] = UpdatedTabObject;
                                        break;
                                    }
                                }
                            }
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    // toaster.pop("error", data.data.ErrorMessage);
                                    toaster.pop('error', "Problem in saving the data, please check your internet connection.");
                                }
                                $scope.ClientScopeChange = true;
                            }
                        }
                    });
                }
            }

            function syncLayoutTilewithTimer(tileObjectforUpdate) {


                if (tileObjectforUpdate.TileId == null || tileObjectforUpdate.TileId == "" || tileObjectforUpdate.TileId == 0) {
                    tileService.AddTile(tileObjectforUpdate).then(function (data) {

                        if (data.data.StatusCode == 200) {

                            var UpdatedObject = data.data.PayLoad;

                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {

                                for (var j = 0; j < $scope.NewLayout.TabList[i].TileList.length; j++) {

                                    if ($scope.NewLayout.TabList[i].TileList[j].ClientObjectId == UpdatedObject.ClientObjectId) {
                                        if ($scope.NewLayout.TabList[i].TileList[j].UpdateDate <= UpdatedObject.UpdateDate) {
                                            $scope.NewLayout.TabList[i].TileList[j] = UpdatedObject;
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    // toaster.pop("error", data.data.ErrorMessage);
                                    toaster.pop('error', "Problem in saving the data, please check your internet connection.");
                                }
                                $scope.ClientScopeChange = true;
                            }
                        }
                    });
                }
                else {
                    tileService.UpdateTile(tileObjectforUpdate).then(function (data) {

                        if (data.data.StatusCode == 200) {

                            var UpdatedTabObject = data.data.PayLoad;

                            for (var i = 0; i < $scope.NewLayout.TabList.length; i++) {
                                for (var j = 0; j < $scope.NewLayout.TabList[i].TileList.length; j++) {
                                    if ($scope.NewLayout.TabList[i].TileList[j].ClientObjectId == UpdatedObject.ClientObjectId) {
                                        if ($scope.NewLayout.TabList[i].TileList[j].UpdateDate <= UpdatedObject.UpdateDate) {
                                            $scope.NewLayout.TabList[i].TileList[j] = UpdatedObject;
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    // toaster.pop("error", data.data.ErrorMessage);
                                    toaster.pop('error', "Problem in saving the data, please check your internet connection.");
                                }
                                $scope.ClientScopeChange = true;
                            }
                        }
                    });
                }
            }


            var _autoPosition = false;

            var _menuOptionView = {
                id: 'nav.layouts.open',
                name: 'Switch Layout',
                icon: 'fa-fw fa-random',
                menus: []
            };
            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('character', $scope.menuCharacter);



            function SearchDialogCtrl(dep1, dep2) {

                $scope.cancel = function () {
                    $scope.modalInstance.close(); // the same instance that was created in element.on('click',...)
                }

                // you can call it from the template:  search.dialog.tpl.html
                $scope.someFunction = function () { }

                // it can bind to it in the search.dialog.tpl.html
                $scope.someProperty;

                // this will be two-way bound with some property from the parent field (look below)
                // if you want to perform some action on it just use $scope.$watch
                $scope.searchDialog;
            }


            $scope.ShowDice = function () {

                var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
                    { "mode": 3, scope: $scope.NewLayout.CharacterProfileId }
                );
                dlg.result.then(function (res, result) {

                })
            }

            $scope.AddCorestatvalues = function () {
                $scope.characters = [];
                if (angular.equals({}, rulesetDataShareService.getLayoutData()) == false) {
                    $scope.characters = rulesetDataShareService.getLayoutData();
                    //$scope.characters = rulesetDataShareService.getcorestatvalue();
                    if ($scope.characters == null) {
                        toaster.pop('error', "No CoreStat Available.");
                    }
                    $scope.characters.CorestatValuesHeading = "Add CoreStat Values";
                    $scope.characters.CorestatValuesIcon = "fa fa-floppy-o";
                    $scope.characters.CorestatValuesBtnText = "Save";
                    if ($scope.characters.CorestatValues != null && angular.isUndefined($scope.characters.CorestatValues) == false) {
                        for (var i = 0; i < $scope.characters.CorestatValues.length; i++) {
                            var result = $scope.characters.CorestatValues[i];
                            
                        }
                    }
                }
                else {
                    toaster.pop('error', "No CoreStat Available.");
                }
                // $scope.characters = rulesetDataShareService.getcorestatvalue();

                var dlg = dialogs.create('/views/dialogs/addcorestatvalues.html', 'dialogAddCorestatValues',
                    { scope: $scope.characters }

                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        res.Id = res.CharacterProfileId;
                        var values = characterService.AddCorestatValues(res);
                        values.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.characters = rulesetDataShareService.getLayoutData();
                                $scope.characters.CorestatValues = [];
                                for (var i = 0; i < data.data.PayLoad.CorestatValues.length; i++) {
                                    $scope.characters.CorestatValues.push(data.data.PayLoad.CorestatValues[i]);
                                }
                                rulesetDataShareService.setcorestatvalue($scope.characters);
                                toaster.pop('success', "CoreStat Values are Updated Successfully.");
                                $("#loading").fadeOut("slow");
                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                         toaster.pop("error", data.data.ErrorMessage);
                                    }
                                    $("#loading").fadeOut("slow");
                                }
                            }

                        })
                    }
                });
            }

            $scope.ShowTilesforInventory = function (item) {
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
                var dlg = dialogs.create('/views/dialogs/tile-type-picker.html', 'dialogTileTypes',
                    { scope: $scope.NewLayout.LayoutMetaData.TileTypes }
                );
                dlg.result.then(function (res) {
                    if (res.TileType == "Note") {
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                        //$scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                        $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;
                        var dlg = dialogs.create('/views/dialogs/tile-editor-1.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile, Tablist: $scope.NewLayout.TabList }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                               
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                                //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                //}
                            }
                            $scope.ClientScopeChange = true;
                        });
                    }
                    else if (res.TileType == "Counter") {
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;

                        $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;


                        var dlg = dialogs.create('/views/dialogs/tile-editor-2.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                               
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                                //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            }
                            //}
                            $scope.ClientScopeChange = true;

                        });
                    }
                    else if (res.TileType == "Attribute") {
                        $scope.Attributecorestats = rulesetDataShareService.getLayoutData();
                        $scope.CorestatValues = $scope.Attributecorestats.CorestatValues;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                        $scope.NewLayout.LayoutMetaData.Tile.Value.Attribute.CoreStatValue = res.Value.Attribute.CoreStatValue;
                        $scope.NewLayout.LayoutMetaData.Tile.CorestatValues = angular.isDefined($scope.CorestatValues.CorestatValues)
                            == true ? $scope.CorestatValues.CorestatValues :
                            $scope.CorestatValues;
                        $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;

                        var dlg = dialogs.create('/views/dialogs/tile-editor-3.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile }
                        );
                        dlg.result.then(function (res) {

                            if (res != "cancel") {
                             
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                                //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                //}
                            }
                            $scope.ClientScopeChange = true;

                        });
                    }
                    else if (res.TileType == "Link") {
                       
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                        //$scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;

                        var dlg = dialogs.create('/views/dialogs/tile-editor-4.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                              
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                               
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                $scope.LinkExecuteTileContent = rulesetDataShareService.getLinkTileData();
                               
                            }
                            $scope.ClientScopeChange = true;

                        });
                       
                    }
                    else if (res.TileType == "Execute") {
                      es;

                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;

                        //$scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;


                        var dlg = dialogs.create('/views/dialogs/tile-editor-5.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile, fullscope: $scope.NewLayout.TabList }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                             
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                                //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                                $scope.LinkExecuteTileContent = rulesetDataShareService.getLinkTileData();
                                
                            }
                        })
                      
                        $scope.ClientScopeChange = true;

                       

                    }
                    else if (res.TileType == "Command") {
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;

                        $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;

                        var dlg = dialogs.create('/views/dialogs/tile-editor-6.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                              
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                                //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                               
                            }

                            $scope.ClientScopeChange = true;

                        });
                    }
                    else if (res.TileType == "Image") {
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeId = res.TileId;
                        $scope.NewLayout.LayoutMetaData.Tile.TileTypeName = res.TileType;
                        $scope.NewLayout.LayoutMetaData.Tile.Value = res.Value;
                        $scope.NewLayout.LayoutMetaData.Tile.Mode = "Edit";
                        $scope.NewLayout.LayoutMetaData.Tile.TabId = 0;
                        var dlg = dialogs.create('/views/dialogs/tile-editor-7.html', 'NoteTile',
                            { scope: $scope.NewLayout.LayoutMetaData.Tile }
                        );
                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                              
                                res.Height = "5";
                                res.Width = "5";
                                res.X = "0";
                                res.Y = "0";
                                res.ClientObjectId = $scope.initialClientObjectId + 1;
                                res.IsSync = false;
                                res.SyncDate = Date.now();
                                //$scope.NewLayout.TabList[$scope.tabSet.index].TileList.push(res);
                                var tile = { "tile": res };
                                item.push(tile);
                                $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                             
                            }

                            $scope.ClientScopeChange = true;
                        });

                    }



                });
            }
            $scope.SaveInventoryTiles = function (tilecontent, Num) {
                //$scope.NewLayout = rulesetDataShareService.getLayoutData();

                if (Num == 1) {
                    $scope.CharacterInventoryMetaData = rulesetDataShareService.getLayoutItemInventoryMetaData();
                    $scope.CharacterInventoryMetaData.CharacterItems.CharacterItemId = tilecontent.CharacterItemId;
                    $scope.CharacterInventoryMetaData.CharacterItems.CharacterProfileId = tilecontent.CharacterProfileId;
                    $scope.CharacterInventoryMetaData.CharacterItems.CharacterItemsProperties = tilecontent.CharacterItemsProperties;
                    $scope.CharacterInventoryMetaData.CharacterItems.AssociatedSpells = tilecontent.AssociatedSpells;
                    $scope.CharacterInventoryMetaData.CharacterItems.AssociatedAbilities = tilecontent.AssociatedAbilities;
                    var InventoryItems = [];
                    InventoryItems.push($scope.CharacterInventoryMetaData.CharacterItems);
                    var items = characterService.CreateItemInventorytile(InventoryItems).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.CharacterContent = data.data.PayLoad.CharacterItems[0];
                            toaster.pop('success', "Tile Added Successfully");
                        }
                    });
                }
                else if (Num == 2) {
                    $scope.CharacterInventoryMetaSpellData = rulesetDataShareService.getLayoutSpellInventoryMetaData();
                    $scope.CharacterInventoryMetaSpellData.CharacterSpells.CharacterSpellId = tilecontent.CharacterSpellId;
                    $scope.CharacterInventoryMetaSpellData.CharacterSpells.CharacterProfileId = tilecontent.CharacterProfileId;
                    $scope.CharacterInventoryMetaSpellData.CharacterSpells.CharacterSpellsProperties = tilecontent.CharacterSpellsProperties;
                    var InventorySpells = [];
                    InventorySpells.push($scope.CharacterInventoryMetaSpellData.CharacterSpells);
                    var items = characterService.CreateSpellInventorytile(InventorySpells).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.CharacterContent = data.data.PayLoad.CharacterSpells[0];
                            toaster.pop('success', "Tile Added Successfully");
                        }
                    });
                }
                else if (Num == 3) {
                    $scope.CharacterInventoryAbilityMetaData = rulesetDataShareService.getLayoutAbilityInventoryMetaData();
                    $scope.CharacterInventoryAbilityMetaData.CharacterAbilities.CharacterAbilityId = tilecontent.CharacterAbilityId;
                    $scope.CharacterInventoryAbilityMetaData.CharacterAbilities.CharacterProfileId = tilecontent.CharacterProfileId;
                    $scope.CharacterInventoryAbilityMetaData.CharacterAbilities.CharacterAbilitiesProperties = tilecontent.CharacterAbilitiesProperties;
                    var InventoryAbilities = [];
                    InventoryAbilities.push($scope.CharacterInventoryAbilityMetaData.CharacterAbilities);
                    var items = characterService.CreateAbilityInventorytile(InventoryAbilities).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.CharacterContent = data.data.PayLoad.CharacterAbilities[0];
                            toaster.pop('success', "Tile Added Successfully");
                        }
                    });
                }
            }
            $scope.ItemInventory = function () {
                  rulesetDataShareService.setInventory($scope.NewInventory);
                $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, action: 2, isNew: 1, contentType: 1 });
                

            }
            $scope.BackToLayout = function () {
                $("#loading").css("display", "block");
                $state.go('profile.character.layout', { characterId: $state.params.characterId, action: 1, isNew: 1 });
                $("#loading").fadeOut("slow");
            }
            $scope.onloadFun = function () {
                $("#loading").fadeOut("slow");
            }
            $scope.ImportRuleSetCharecterleavel = function () {
                var dlg = dialogs.create('/views/dialogs/rulesetimport.html', 'dialogImportRulesetinCharecter',
                    { characterProfileId: $scope.NewLayout.CharacterProfileId }
                    //{ ruleSetId: $scope.NewRuleSet.Id }
                );

                dlg.result.then(function (res) {
                    if (res != 'cancel') {

                    }
                });
            }



            $scope.SpellInventory = function () {
                
                $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
            }

            $scope.AbilityInventory = function () {
                
                $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
			}

			$scope.widgets = [{ x: 0, y: 0, width: 100, height: 100 }, { x: 0, y: 0, width: 3, height: 100 }];
			$scope.options = {
				cellHeight: 200,
				verticalMargin: 10
			};
			$scope.addWidget = function () {
				var newWidget = { x: 0, y: 0, width: 1, height: 1 };
				$scope.widgets.push(newWidget);
			};
			$scope.moveWidget = function () {
				$scope.widgets[0].x = 1;
				$scope.widgets[0].width = 2;
				$scope.widgets[0].height = 2;
			};
			$scope.removeWidget = function (w) {
				var index = $scope.widgets.indexOf(w);
				$scope.widgets.splice(index, 1);
			};
			$scope.onChange = function (event, items) {
				$log.log("onChange event: " + event + " items:" + items);
			};
			$scope.onDragStart = function (event, ui) {
				$log.log("onDragStart event: " + event + " ui:" + ui);
			};
			$scope.onDragStop = function (event, ui) {
				$log.log("onDragStop event: " + event + " ui:" + ui);
			};
			$scope.onResizeStart = function (event, ui) {
				$log.log("onResizeStart event: " + event + " ui:" + ui);
			};
			$scope.onResizeStop = function (event, ui) {
				$log.log("onResizeStop event: " + event + " ui:" + ui);
			};
			$scope.onItemAdded = function (item) {
				$log.log("onItemAdded item: " + item);
			};
			$scope.onItemRemoved = function (item) {
				$log.log("onItemRemoved item: " + item);
			};

			$scope.AddRulesetItems = function () {
				var rulesetitemcontent = rulesetService.GetRuleSetItemsForItemInventory($state.params.characterId);
				rulesetitemcontent.then(function (data) {
					if (data.data.StatusCode == 200) {
						console.log("StatusCode 200: ", data.data.PayLoad.Items);
						$scope.RulesetItems = data.data.PayLoad.Items;
						var rulesets = data.data.PayLoad;
						var dlg = dialogs.create('/views/dialogs/AssociateRulesetItems.html', 'dialogAssociatedRulesetItems',
							{ scope: $scope.RulesetItems }
						);

						dlg.result.then(function (res) {
							console.log("res: "+res);
							$scope.rulesets = res;
							$scope.SaveRulesetItem();
						});
						//rulesetDataShareService.setLayoutRulesetItemInventoryData($scope.RulesetItems);

					}
					else if (data.data.StatusCode == 400) {
						console.log("!!!StatusCode 400: ", data);
						if (data.data.ShowToUser == true) {
							toaster.pop('error', data.data.ErrorMessage);
						}
					}
				});
			}

			$scope.AddRulesetSpell = function () {
				var rulesetitemcontent = rulesetService.GetRuleSetSpellsForSpellInventory($state.params.characterId);
				rulesetitemcontent.then(function (data) {
					if (data.data.StatusCode == 200) {
						console.log("StatusCode 200: ", data);
						$scope.RulesetSpells = data.data.PayLoad.Spells;
						var rulesets = data.data.PayLoad;
						var dlg = dialogs.create('/views/dialogs/AssociateRulesetSpells.html', 'dialogAssociatedRulesetSpells',
							{ scope: $scope.RulesetSpells }
						);

						dlg.result.then(function (res) {
							$scope.spells = res;
							$scope.SaveRulesetSpell();
						});
						//rulesetDataShareService.setLayoutRulesetItemInventoryData($scope.RulesetItems);

					}
					else if (data.data.StatusCode == 400) {
						console.log("!!!StatusCode 400: ", data);
						if (data.data.ShowToUser == true) {
							toaster.pop('error', data.data.ErrorMessage);
						}
					}
				});
			}

			$scope.AddRulesetAbility = function () {
				var rulesetitemcontent = rulesetService.GetRuleSetAbilitiesForAbilityInventory($state.params.characterId);
				rulesetitemcontent.then(function (data) {
					if (data.data.StatusCode == 200) {
						console.log("StatusCode 200: ", data);
						$scope.RulesetAbilities = data.data.PayLoad.Abilities;
						var rulesets = data.data.PayLoad;
						var dlg = dialogs.create('/views/dialogs/AssociateRulesetAbilities.html', 'dialogAssociatedRulesetAbilities',
							{ scope: $scope.RulesetAbilities }
						);

						dlg.result.then(function (res) {
							$scope.abilities = res;
							$scope.SaveRulesetAbility();
						});
						//rulesetDataShareService.setLayoutRulesetItemInventoryData($scope.RulesetItems);

					}
					else if (data.data.StatusCode == 400) {
						console.log("!!!StatusCode 400: ", data);
						if (data.data.ShowToUser == true) {
							toaster.pop('error', data.data.ErrorMessage);
						}
					}
				});
			}


			//$scope.AddRulesetSpells = function () {
   //             $transition.router.stateService.go("profile.CharacterRulesetSpells", { characterId: $state.params.characterId, action: 3, isNew: 1, contentType: 2 });

   //         }
            //$scope.AddRulesetAbilities = function () {
            //    $transition.router.stateService.go("profile.CharacterRulesetAbilities", { characterId: $state.params.characterId, action: 3, isNew: 1, contentType: 3 });

            //}
            $scope.CreateCharacterItem = function () {
                $scope.CharacterInventoryMetaData = rulesetDataShareService.getLayoutItemInventoryMetaData();
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
                $scope.buttontext = "Create";
                $scope.tabName = "Create Item";
                $scope.IsButtonDisabled = false;
                $scope.isBtnShow = false;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateInventoryItem',
                    { scope: $scope.CharacterInventoryMetaData.CharacterItems.CharacterItemsProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, NewInventory: $scope.CharacterInventoryMetaData, CharacterId: $scope.NewLayout.CharacterProfileId }
                );

                dlg.result.then(function (res) {


                 

                    if (res != "cancel") {
                        //var CharacterItemsProperties = { "CharacterItemsProperties": res };
                        $scope.NewItemInventory.CharacterItems.push(res);
                        if ($scope.NewItemInventory.CharacterItems.length == 0) {
                            $scope.ShowItems = true;
                            $scope.ShowItem = false;
                        }
                        else {
                            $scope.ShowItems = false;
                            $scope.ShowItem = true;
                        }
                        $state.go('profile.ItemInventory');
                        //rulesetDataShareService.set($scope.NewRuleSet.Items);
                        //$scope.isitemsadded = true;
                    }
                });
            }
            $scope.CreateCharacterSpell = function () {
                debugger;
                $scope.CharacterInventoryMetaData = rulesetDataShareService.getLayoutSpellInventoryMetaData();
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
                $scope.buttontext = "Create";
                $scope.tabName = "Create Spell";
                $scope.IsButtonDisabled = false;
                $scope.isBtnShow = false;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateInventorySpell',
                    { scope: $scope.CharacterInventoryMetaData.CharacterSpells.CharacterSpellsProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, NewInventory: $scope.CharacterInventoryMetaData, CharacterId: $scope.NewLayout.CharacterProfileId }
                );

                dlg.result.then(function (res) {


                    if (res != "cancel") {
                        //var CharacterSpellsProperties = { "CharacterSpellsProperties": res };
                        $scope.NewSpellInventory.CharacterSpells.push(res);
                        if ($scope.NewSpellInventory.CharacterSpells.length == 0) {
                            $scope.ShowSpells = true;
                            $scope.ShowSpell = false;
                        }
                        else {
                            $scope.ShowSpells = false;
                            $scope.ShowSpell = true;
                        }
                        $state.go('profile.SpellInventory');
                       
                    }
                });

            }
            $scope.CreateCharacterAbility = function () {
                $scope.CharacterInventoryMetaData = rulesetDataShareService.getLayoutAbilityInventoryMetaData();
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
                $scope.buttontext = "Create";
                $scope.tabName = "Create Ability";
                $scope.IsButtonDisabled = false;
                $scope.isBtnShow = false;
                var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateInventoryAbility',
                    { scope: $scope.CharacterInventoryMetaData.CharacterAbilities.CharacterAbilitiesProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, NewInventory: $scope.CharacterInventoryMetaData, CharacterId: $scope.NewLayout.CharacterProfileId }
                );

                dlg.result.then(function (res) {



                    if (res != "cancel") {
                        //var CharacterAbilitiesProperties = { "CharacterAbilitiesProperties": res };
                        $scope.NewAbilityInventory.CharacterAbilities.push(res);
                        if ($scope.NewAbilityInventory.CharacterAbilities.length == 0) {
                            $scope.ShowAbilities = true;
                            $scope.ShowAbility = false;
                        }
                        else {
                            $scope.ShowAbilities = false;
                            $scope.ShowAbility = true;
                        }
                        $state.go('profile.AbilityInventory');
                        //rulesetDataShareService.set($scope.NewRuleSet.Items);
                        //$scope.isitemsadded = true;
                    }
                });

            }
            var SelectedItems = [];
            var SelectedSpells = [];
            var SelectedAbilities = [];
            $scope.addName = function (item, Num) {
                if (Num == 1) {
                    var idx = SelectedItems.indexOf(item);
                    if (SelectedItems.indexOf(item) == -1) {
                        console.log('Pushing: ', item)
                        SelectedItems.push(item);
                        //selectedNames.push(id);
                    } else {
                        SelectedItems.splice(idx, 1);
                        console.log(SelectedItems);
                    }

                }
                else if (Num == 2) {
                    var idx = SelectedSpells.indexOf(item);
                    if (SelectedSpells.indexOf(item) == -1) {
                        console.log('Pushing: ', item)
                        SelectedSpells.push(item);
                        //selectedNames.push(id);
                    } else {
                        SelectedSpells.splice(idx, 1);
                        console.log(SelectedSpells);
                    }
                }
                else if (Num == 3) {
                    var idx = SelectedAbilities.indexOf(item);
                    if (SelectedAbilities.indexOf(item) == -1) {
                        console.log('Pushing: ', item)
                        SelectedAbilities.push(item);
                        //selectedNames.push(id);
                    } else {
                        SelectedAbilities.splice(idx, 1);
                        console.log(SelectedAbilities);
                    }
                }

            };
            $scope.checkSelected = function (item, Num) {
                if (Num == 1) {
                    var idx = SelectedItems.indexOf(item);
                    return idx > -1;
                }
                else if (Num == 2) {
                    var idx = SelectedSpells.indexOf(item);
                    return idx > -1;
                }
                else if (Num == 3) {
                    var idx = SelectedAbilities.indexOf(item);
                    return idx > -1;
                }

            }
            $scope.BackInventory = function () {
                //$("#loading").css("display", "block");
                $transition.router.stateService.go('profile.character.layout', { characterId: $state.params.characterId, action: 1 });
            }
            $scope.BackItem = function () {
                $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, 'action': '2', isNew: 0, contentType: 1 });
            }
            $scope.BackSpell = function () {
                $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
            }
            $scope.BackAbility = function () {
                $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
            }
            $scope.BackItemProperties = function () {
                $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, action: 2, contentType: 1 });
            }
            $scope.BackSpellProperties = function () {
                $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
            }
            $scope.BackAbilityProperties = function () {
                $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
            }
            $scope.SaveRulesetItem = function () {
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
                $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
				var RulesetItems = [];
				SelectedItems = $scope.rulesets;
                if (SelectedItems.length > 0) {
                    for (var i = 0; i < SelectedItems.length; i++) {
                        var CharacterItemsProperties = { "CharacterItemId": 0, "CharacterProfileId": $scope.NewLayout.CharacterProfileId, "CharacterItemsProperties": SelectedItems[i].ItemProperties };
                    }
                    var InventoryItems = [];
                    InventoryItems.push(CharacterItemsProperties);
                    var items = characterService.CreateCharacterInventoryItems(InventoryItems).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            if (data.data.PayLoad.length != 0) {
                                for (var i = 0; i < data.data.PayLoad.length; i++) {
                                    $scope.NewItemInventory.CharacterItems.push(data.data.PayLoad[i]);
                                }
                            }
                            $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, 'action': '2', isNew: 0, contentType: 1 });
                        }
                        else if (data.data.ErrorMessage == 400) {
                            alert($scope.data.ErrorMessage)
                        }
                    })
                }
                else {
                    $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, 'action': '2', isNew: 0, contentType: 1 });
                }

            }
			$scope.SaveRulesetSpell = function () {
				console.log("SaveRulesetSpell: ",$scope.spells);
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
				$scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
				SelectedSpells = $scope.spells;
                if (SelectedSpells.length > 0) {
                    for (var i = 0; i < SelectedSpells.length; i++) {
                        var CharacterSpellsProperties = { "CharacterSpellId": 0, "CharacterProfileId": $scope.NewLayout.CharacterProfileId, "CharacterSpellsProperties": SelectedSpells[i].SpellProperties };
                    }
                    var InventorySpells = [];
                    InventorySpells.push(CharacterSpellsProperties);
                    var spells = characterService.CreateCharacterInventorySpells(InventorySpells).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            if (data.data.PayLoad.length != 0) {
                                for (var i = 0; i < data.data.PayLoad.length; i++) {
                                    $scope.NewSpellInventory.CharacterSpells.push(data.data.PayLoad[i]);
                                }
                            }
                            $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
                        }
                        else if (data.data.ErrorMessage == 400) {
                            alert($scope.data.ErrorMessage)
                        }
                    })
                }
                else {
                    $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
                }

            }
			$scope.SaveRulesetAbility = function () {
				console.log("SaveRulesetAbility: ",$scope.abilities);
                $scope.NewLayout = rulesetDataShareService.getLayoutData();
				$scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
				SelectedAbilities = $scope.abilities;
                if (SelectedAbilities.length > 0) {
                    for (var i = 0; i < SelectedAbilities.length; i++) {
                        var CharacterAbilitiesProperties = { "CharacterAbilityId": 0, "CharacterProfileId": $scope.NewLayout.CharacterProfileId, "CharacterAbilitiesProperties": SelectedAbilities[i].AbilityProperties };
                    }
                    var InventoryAbility = [];
                    InventoryAbility.push(CharacterAbilitiesProperties);
                    var abilities = characterService.CreateCharacterInventoryAbility(InventoryAbility).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            if (data.data.PayLoad.length != 0) {
                                for (var i = 0; i < data.data.PayLoad.length; i++) {
                                    $scope.NewAbilityInventory.CharacterAbilities.push(data.data.PayLoad[i]);
                                }
							}
							console.log("$scope.NewAbilityInventory: ", $scope.NewAbilityInventory);
                            $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
                        }
                        else if (data.data.ErrorMessage == 400) {
                            alert(data.data.ErrorMessage)
                        }
                    })
                }
                else {
                    $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
                }

            }
            //For Editing Inventory Items
            $scope.EditItem = function (item, count, num) {
                debugger;
                if (num == 1) {
                    $scope.pageName = "Editing Item";
                    $scope.buttontext = "Update";
                    $scope.IsButtonDisabled = true;
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit";
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterItemsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Fullscope: item, AssocSpells: item.AssociatedSpells, AssocAbilities: item.AssociatedAbilities, OperationTypeMode: $scope.OperationTypeMode, CharacterId: item.CharacterProfileId}

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterItemsProperties = { "CharacterItemsProperties": res };
                            $scope.NewItemInventory.CharacterItems[count] = res;
                           
                        }
                    });
                }
                else if (num == 2) {
                    $scope.pageName = "Editing Spell";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit";
                    //var indexcount = count - 1;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterSpellsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullSpellscope: item, OperationTypeMode: $scope.OperationTypeMode}

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterSpellsProperties = { "CharacterSpellsProperties": res };
                            $scope.NewSpellInventory.CharacterSpells[count] = res;
                          
                        }
                    });
                }
                else if (num == 3) {
                    $scope.pageName = "Editing Ability";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit";
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterAbilitiesProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullAbilityScope: item, OperationTypeMode: $scope.OperationTypeMode }

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterAbilitiesProperties = { "CharacterAbilitiesProperties": res };
                            $scope.NewAbilityInventory.CharacterAbilities[count] = res;
                          
                        }

                    });
                }


            };
            $scope.CopyItem = function (item, index, num) {

                debugger;
                if (num == 1) {
                    $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.pageName = "Copying Item";
                    $scope.buttontext = "Copy";
                    $scope.IsButtonDisabled = true;
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy";
                    $scope.SelectAssociatedSpells = true;
                    $scope.SelectAssociatedAbilities = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterItemsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Fullscope: item, AssocSpells: item.AssociatedSpells, AssocAbilities: item.AssociatedAbilities, OperationTypeMode: $scope.OperationTypeMode, SelectAssociatedSpells: $scope.SelectAssociatedSpells, SelectAssociatedAbilities: $scope.SelectAssociatedAbilities }

                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterItemsProperties = { "CharacterItemsProperties": res };
                            $scope.NewItemInventory.CharacterItems.push(res);
                        }
                    });
                }
                else if (num == 2) {
                    $scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.pageName = "Copying Spell";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy";
                    $scope.SelectAssociatedSpells = true;
                    $scope.SelectAssociatedAbilities = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterSpellsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullSpellscope: item, SelectAssociatedSpells: $scope.SelectAssociatedSpells, SelectAssociatedAbilities: $scope.SelectAssociatedAbilities, OperationTypeMode: $scope.OperationTypeMode}

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterSpellsProperties = { "CharacterSpellsProperties": res };
                            $scope.NewSpellInventory.CharacterSpells.push(res);

                        }

                    });
                }
                else if (num == 3) {
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
                    $scope.pageName = "Copying Ability";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy";
                    $scope.SelectAssociatedSpells = true;
                    $scope.SelectAssociatedAbilities = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterAbilitiesProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullAbilityScope: item, SelectAssociatedSpells: $scope.SelectAssociatedSpells, SelectAssociatedAbilities: $scope.SelectAssociatedAbilities, OperationTypeMode: $scope.OperationTypeMode}

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterAbilitiesProperties = { "CharacterAbilitiesProperties": res };
                            $scope.NewAbilityInventory.CharacterAbilities.push(res);
                        }


                    });
                }

            };
            $scope.Removeitem = function (item, index, Num) {
                if (Num == 1) {
                    $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Item, "' + item.CharacterItemsProperties[0].Value.Text.value + '", and all associated pages, tabs, and tiles?',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteitem = characterService.DeleteCharacterContent(item.CharacterItemsProperties[0].CharacterItemId).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                      
                                        $scope.NewItemInventory.CharacterItems.splice(index, 1);
                                     
                                    }

                                    //$uibModalInstance.close($scope.Properties);
                                })
                            }

                        })

                }
                else if (Num == 2) {
                    $scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Spell, "' + item.CharacterSpellsProperties[0].Value.Text.value + '",?',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteitem = characterService.DeleteCharacterSpellContent(item.CharacterSpellsProperties[0].CharacterSpellId).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                      
                                        $scope.NewSpellInventory.CharacterSpells.splice(index, 1);
                                       
                                    }

                                    //$uibModalInstance.close($scope.Properties);
                                })
                            }

                        })
                }
                else if (Num == 3) {
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Ability, "' + item.CharacterAbilitiesProperties[0].Value.Text.value + '",?',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteability = characterService.DeleteCharacterAbilityContent(item.CharacterAbilitiesProperties[0].CharacterAbilityId).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                     

                                        $scope.NewAbilityInventory.CharacterAbilities.splice(index, 1);
                                       
                                    }

                                    //$uibModalInstance.close($scope.Properties);
                                })
                            }

                        })
                }

                //$uibModalInstance.close($scope.Properties);
            }
            $scope.ShowAllItemProperties = function (item, count) {
               
                $state.go("profile.CharacterItemsDetails", { characterId: $state.params.characterId, action: 4, contentType: 1, index: count });
            }
            $scope.ShowAllSpellProperties = function (item, count) {
               
                $state.go("profile.CharacterSpellDetails", { characterId: $state.params.characterId, action: 4, contentType: 2, index: count });
            }
            $scope.ShowAllAbilityProperties = function (item, count) {
                //$scope.ItemProperties = item.CharacterItemsProperties;
                rulesetDataShareService.setItemProperties(item);
                $state.go("profile.CharacterAbilityDetails", { characterId: $state.params.characterId, action: 4, contentType: 3, index: count });
            }
            //For Editing Inventory Itemzproperties
            $scope.EditItems = function (item, num) {
                if (num == 1) {
                    $scope.pageName = "Editing Item";
                    $scope.buttontext = "Update";
                    $scope.IsButtonDisabled = true;
                    $scope.isBtnShow = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterItemsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Fullscope: item }

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterItemsProperties = { "CharacterItemsProperties": res };
                            $scope.NewItemInventory.CharacterItems[item.Index] = res
                           
                            $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, action: 2, contentType: 1 });
                        }
                    });
                }
                else if (num == 2) {
                    $scope.pageName = "Editing Spell";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    //var indexcount = count - 1;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterSpellsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullSpellscope: item }

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterSpellsProperties = { "CharacterSpellsProperties": res };
                            $scope.NewSpellInventory.CharacterSpells[item.Index] = res;
                            $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
                          
                        }
                    });
                }
                else if (num == 3) {
                    $scope.pageName = "Editing Ability";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterAbilitiesProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullAbilityScope: item }

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterAbilitiesProperties = { "CharacterAbilitiesProperties": res };
                            $scope.NewAbilityInventory.CharacterAbilities[item.Index] = res;
                            $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
                           
                        }

                    });
                }


            };
            $scope.Removeitems = function (item, Num) {
                if (Num == 1) {
                    $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Item, "' + item.CharacterItemsProperties[0].Value.Text.value + '", and all associated pages, tabs, and tiles?',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteitem = characterService.DeleteCharacterContent(item.CharacterItemsProperties[0].CharacterItemId).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                       
                                        $scope.NewItemInventory.CharacterItems.splice(item.Index, 1);
                                        $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, action: 2, contentType: 1 });
                                    }


                                })
                            }

                        })

                }
                else if (Num == 2) {
                    $scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Spell, "' + item.CharacterSpellsProperties[0].Value.Text.value + '",?',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteitem = characterService.DeleteCharacterSpellContent(item.CharacterSpellsProperties[0].CharacterSpellId).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                     
                                        $scope.NewSpellInventory.CharacterSpells.splice(item.Index, 1);
                                        $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });

                                    }


                                })
                            }

                        })
                }
                else if (Num == 3) {
                   
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Ability, "' + item.CharacterAbilitiesProperties[0].Value.Text.value + '",?',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteitem = characterService.DeleteCharacterAbilityContent(item.CharacterAbilitiesProperties[0].CharacterAbilityId).then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                       
                                        $scope.NewAbilityInventory.CharacterAbilities.splice(item.Index, 1);
                                        $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
                                       
                                       
                                    }

                                    //$uibModalInstance.close($scope.Properties);
                                })
                            }

                        })
                }

                //$uibModalInstance.close($scope.Properties);
            }
            $scope.CopyItems = function (item, num) {
                if (num == 1) {
                    $scope.NewItemInventory = rulesetDataShareService.getLayoutItemInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.pageName = "Copying Item";
                    $scope.buttontext = "Copy";
                    $scope.IsButtonDisabled = true;
                    $scope.isBtnShow = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterItemsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Fullscope: item }

                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterItemsProperties = { "CharacterItemsProperties": res };
                            $scope.NewItemInventory.CharacterItems.push(res);
                            $transition.router.stateService.go('profile.ItemInventory', { characterId: $state.params.characterId, action: 2, contentType: 1 });
                        }
                    });
                }
                else if (num == 2) {
                    $scope.NewSpellInventory = rulesetDataShareService.getLayoutSpellInventoryData();
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.pageName = "Copying Spell";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterSpellsProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullSpellscope: item }

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterSpellsProperties = { "CharacterSpellsProperties": res };
                            $scope.NewSpellInventory.CharacterSpells.push(res);
                            $transition.router.stateService.go('profile.SpellInventory', { characterId: $state.params.characterId, action: 2, contentType: 2 });
                        }

                    });
                }
                else if (num == 3) {
                    $scope.NewLayout = rulesetDataShareService.getLayoutData();
                    $scope.NewAbilityInventory = rulesetDataShareService.getLayoutAbilityInventoryData();
                    $scope.pageName = "Copying Ability";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogEditCharacterItem',
                        { scope: item.CharacterAbilitiesProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, FullAbilityScope: item }

                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            //var CharacterAbilitiesProperties = { "CharacterAbilitiesProperties": res };
                            $scope.NewAbilityInventory.CharacterAbilities.push(res);
                            $transition.router.stateService.go('profile.AbilityInventory', { characterId: $state.params.characterId, action: 2, contentType: 3 });
                        }


                    });
                }

            };
            $scope.onloadFun = function ()
            {
                $("#loading").fadeOut("slow");
            }
            $scope.getTileClass = function (tile) {

                var arr = [];

                if ($scope.state.tilesEditing)
                    arr.push(tile.__randomShake);

                if (tile.id === $scope.state.tileDeleteId)
                    arr.push('over-delete');

                return arr.join(' ');
            };
            $scope.getTileClass = function (tile) {

                var arr = [];

                if ($scope.state.tilesEditing)
                    arr.push(tile.__randomShake);

                if (tile.id === $scope.state.tileDeleteId)
                    arr.push('over-delete');

                return arr.join(' ');
            };
            $scope.stackOptions = {
                height: 150,
                width: 400,
                cellHeight: 30,
                minWidth: 1,

                pixelWidth: 35,
                verticalMargin: 5,
                alwaysShowResizeHandle: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),

                resizable: {
                    handles: 'e, se, s, sw, w'
                },
                draggable: {
                    refreshPositions: true,
                    handle: '.grid-stack-item-content'
                }
            };

            $scope.onDragStart = function (event, ui) {
                $timeout(function () {
                    $scope.state.tileDragging = true;
                });
            };

            $scope.onDragStop = function (event, ui) {
                $timeout(function () {
                    $scope.state.tileDragging = false;
                });
            };

            $scope.state = {
                tilesEditing: false,
                tileDragging: false,
                tileDeleteId: null
            };

            
            $scope.onChange = function (event, items) {
                $log.log("onChange event: " + event + " items:" + items);
            };

            $scope.onResizeStop = function (event, ui) {
                $log.log("onResizeStop event: " + event + " ui:" + ui);
            };

            $scope.onItemAdded = function (item) {
                $log.log("onItemAdded item: " + item);
            };

            $scope.onItemRemoved = function (item) {
                $log.log("onItemRemoved item: " + item);
            };
            $scope.onDeleteDropCharacterTiles = function (event, ui) {
                var tile = GridStackUI.Utils.getNodeData(ui.helper);
                var ClientObjectTileId = ui.helper[0].dataset.gsId;

                var deletedTileIndex = -1;
                if ($scope.CharacterContent.CharacterItemsProperties != undefined && $scope.CharacterContent.CharacterItemsProperties != null && $scope.CharacterContent.CharacterItemsProperties != "") {
                    for (var i = 0; i < $scope.CharacterContent.CharacterItemsProperties.length; i++) {
                        var ItemPropertyLst = $scope.CharacterContent.CharacterItemsProperties[i];
                        if (ItemPropertyLst.CharacterItemId == 0 || ItemPropertyLst.CharacterItemId == undefined || ItemPropertyLst.CharacterItemId == "") {
                            if (ClientObjectTileId == $scope.CharacterContent.CharacterItemsProperties[i].tile.ClientObjectId) {
                                deletedTileIndex = i;
                            }
                        }
                    }

                    if ($scope.CharacterContent.CharacterItemsProperties[deletedTileIndex].tile.TileId == 0) {
                        $scope.CharacterContent.CharacterItemsProperties.splice(deletedTileIndex, 1);
                        toaster.pop('success', "Tile deleted Successfully.");
                    }
                    else {
                        tileService.deleteTile($scope.CharacterContent.CharacterItemsProperties[deletedTileIndex].tile).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.CharacterContent.CharacterItemsProperties.splice(deletedTileIndex, 1);
                                toaster.pop('success', "Tile deleted Successfully.");
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        });
                    }
                }

                else if ($scope.CharacterContent.CharacterSpellsProperties != undefined && $scope.CharacterContent.CharacterSpellsProperties != null && $scope.CharacterContent.CharacterSpellsProperties != "") {
                    for (var i = 0; i < $scope.CharacterContent.CharacterSpellsProperties.length; i++) {
                        var spellPropertyLst = $scope.CharacterContent.CharacterSpellsProperties[i];
                        if (spellPropertyLst.CharacterSpellId == 0 || spellPropertyLst.CharacterSpellId == undefined || spellPropertyLst.CharacterSpellId == "") {
                            if (ClientObjectTileId == $scope.CharacterContent.CharacterSpellsProperties[i].tile.ClientObjectId) {
                                deletedTileIndex = i;
                            }
                        }
                    }

                    if ($scope.CharacterContent.CharacterSpellsProperties[deletedTileIndex].tile.TileId == 0) {
                        $scope.CharacterContent.CharacterSpellsProperties.splice(deletedTileIndex, 1);
                        toaster.pop('success', "Tile deleted Successfully.");
                    }
                    else {
                        tileService.deleteTile($scope.CharacterContent.CharacterSpellsProperties[deletedTileIndex].tile).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.CharacterContent.CharacterSpellsProperties.splice(deletedTileIndex, 1);
                                toaster.pop('success', "Tile deleted Successfully.");
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        });
                    }
                }
                else if ($scope.CharacterContent.CharacterAbilitiesProperties != undefined && $scope.CharacterContent.CharacterAbilitiesProperties != null && $scope.CharacterContent.CharacterAbilitiesProperties != "") {
                    for (var i = 0; i < $scope.CharacterContent.CharacterAbilitiesProperties.length; i++) {
                        var abilityPropertyLst = $scope.CharacterContent.CharacterAbilitiesProperties[i];
                        if (abilityPropertyLst.CharacterAbilityId == 0 || abilityPropertyLst.CharacterAbilityId == undefined || abilityPropertyLst.CharacterAbilityId == "") {
                            if (ClientObjectTileId == $scope.CharacterContent.CharacterAbilitiesProperties[i].tile.ClientObjectId) {
                                deletedTileIndex = i;
                            }
                        }
                    }

                    if ($scope.CharacterContent.CharacterAbilitiesProperties[deletedTileIndex].tile.TileId == 0) {
                        $scope.CharacterContent.CharacterAbilitiesProperties.splice(deletedTileIndex, 1);
                        toaster.pop('success', "Tile deleted Successfully.");
                    }
                    else {
                        tileService.deleteTile($scope.CharacterContent.CharacterAbilitiesProperties[deletedTileIndex].tile).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.CharacterContent.CharacterAbilitiesProperties.splice(deletedTileIndex, 1);
                                toaster.pop('success', "Tile deleted Successfully.");
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                     toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        });
                    }
                }
            };
            $scope.onDeleteOverCharacterItem = function (event, ui) {
                var node = GridStackUI.Utils.getNodeData(ui.helper);
                if (node) {
                    $timeout(function () {
                        $scope.state.tileDeleteId = node.id;
                    });
                }
            };

            $scope.onDeleteOutCharacterItem = function (event) {
                if ($scope.state.tileDeleteId) {
                    $timeout(function () {
                        $scope.state.tileDeleteId = null;
                    });
                }
            };
            $scope.tileEdit = function () {
                $scope.tilePickerApi.beginSelect(function (tile) {

                });
            }
            function InventoryMetaData() {
                var metadata = characterService.GetNewCharacterInventory().then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.NewInventory = data.data.PayLoad;
                        rulesetDataShareService.setInventory($scope.NewInventory);
                    }
                    else if (data.data.StatusCode == 400) {
                        alert(data.data.ErrorMessage)
                    }
                })
            }

        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('layoutsPageController', ['$scope', '$q', '$window', '$timeout', '$transition', 'dialogs', 'toaster', 'navService', 'dataService',
        function ($scope, $q, $window, $timeout, $transition, dialogs, toaster, navService, dataService) {

            $scope.dataService = dataService;
            $scope.navService = navService;

            $scope.tilePickerApi = {
                messageId: null,
                beforeSelect: function () {
                    toaster.clear('*');
                    $scope.tilePickerApi.messageId = toaster.pop({
                        type: 'note',
                        body: 'Click a layout to ' + $scope.tilePickerApi.action + ' it.',
                        timeout: 0,
                        showCloseButton: false,
                        tapToDismiss: false
                    });
                },
                onClose: function () {
                    if ($scope.tilePickerApi.messageId)
                        toaster.clear($scope.tilePickerApi.messageId);
                }
            };

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([
                    {
                        name: 'Layouts',
                        header: true
                    },
                    {
                        id: 'view.new',
                        name: 'New Layout',
                        icon: 'fa-fw fa-file-o',
                        action: function () {
                            layoutAdd();
                        }
                    },
                    {
                        id: 'view.rename',
                        name: 'Rename Layout',
                        icon: 'fa-fw fa-i-cursor',
                        action: function () {
                            layoutRename();
                        }
                    },
                    {
                        id: 'view.delete',
                        name: 'Delete Layout',
                        icon: 'fa-fw fa-trash-o',
                        action: function () {
                            layoutDelete();
                        }
                    },
                    {
                        id: 'view.copy',
                        name: 'Copy Layout',
                        icon: 'fa-fw fa-files-o',
                        action: function () {
                            layoutCopy();
                        }
                    }
                ]),
                menuClick: function (item) {
                    $scope.menuHamburger.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            var layoutAdd = function () {

                var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                    { name: '' },
                    { size: 'sm' }
                );

                dlg.result.then(function (name) {

                    var layout = dataService.createLayout({
                        name: name
                    });

                    dataService.character.layouts.push(layout);
                    dataService.saveChanges()
                });

            };

            var layoutRename = function () {

                $scope.tilePickerApi.action = 'rename';
                $scope.tilePickerApi.beginSelect(function (item) {

                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { name: item.name },
                        { size: 'sm' }
                    );

                    dlg.result.then(function (name) {
                        item.name = name;
                        dataService.saveChanges()
                    });
                });
            };

            var layoutDelete = function () {

                $scope.tilePickerApi.action = 'delete';
                $scope.tilePickerApi.beginSelect(function (item) {

                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete the layout, "' + item.name + '", and all associated pages, tabs, and tiles?',
                        { size: 'sm' }
                    );

                    dlg.result.then(
                        function (btn) {
                            dataService.deleteLayout(item);
                            dataService.saveChanges();
                        }
                    );
                });
            };

            var layoutCopy = function () {

                $scope.tilePickerApi.action = 'copy';
                $scope.tilePickerApi.beginSelect(function (item) {

                    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                        { name: item.name },
                        { size: 'sm' }
                    );

                    dlg.result.then(function (name) {

                        alert('TODO');

                        // We have to ensure the layout is completely loaded before
                        // we can copy it.

                        //var layout = dataService.copyEntity(dataService.layout);
                        //layout.name = name;

                        //dataService.saveChanges();
                    });

                });
            };

            $scope.selectLayout = function (layout) {
                if ($scope.tilePickerApi.selecting)
                    $scope.tilePickerApi.endSelect(layout);
                else
                    $transition.router.stateService.go('profile.character.layout', { characterId: $transition.params().characterId, layoutId: layout.id });
            };

            $scope.newLayout = function () {
                if ($scope.tilePickerApi.selecting)
                    return;
                layoutAdd();
            };

            var createToastId = null;

            $scope.$watch('dataService.character.layouts.length', function (count) {
                if (count === 0) {
                    createToastId = toaster.pop({
                        type: 'note',
                        body: 'Click the plus button to create a new layout.',
                        timeout: 0,
                        showCloseButton: false,
                        tapToDismiss: true
                    });
                }
                else {
                    toaster.clear(createToastId);
                }
            });

            (function () {
                $scope.navService.updateBody(true, false);
            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('linksPageController', ['$scope', '$transition', '$q', '$timeout', 'dialogs', 'toaster', 'navService', 'tileService',
        function ($scope, $transition, $q, $timeout, dialogs, toaster, navService, tileService) {

            $scope.data = null;

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            (function () {
                debugger;
                navService.updateBody(true, false);
                debugger;
                var characterId = $transition.params().characterId;
                var result = tileService.GetAllTileTypesRelatedCharacter(characterId);
                result.then(function (data) {
                    debugger;
                    if (data.data.StatusCode == 200) {
                        debugger;
                        $scope.AllTilesData = data.data.PayLoad;
                        $scope.links = data.data.PayLoad.Links;
                        $scope.data = {
                            notes: $scope.links
                        }
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }

                })


            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('notesPageController', ['$scope', '$transition', '$q', '$timeout', 'dialogs', 'toaster', 'navService', 'tileService',
        function ($scope, $transition, $q, $timeout, dialogs, toaster, navService, tileService) {

            $scope.data = null;

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            (function () {
                debugger;
                navService.updateBody(true, false);
                debugger;
                var characterId = $transition.params().characterId;
                var result = tileService.GetAllTileTypesRelatedCharacter(characterId);
                result.then(function (data) {
                    debugger;
                    if (data.data.StatusCode == 200) {
                        debugger;
                        $scope.AllTilesData = data.data.PayLoad;
                        $scope.notes = data.data.PayLoad.Notes;
                        $scope.data = {
                            notes: $scope.notes
                        }
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }

                })


            })();
        }
    ]);

})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('ruleSetPageController', ['$scope', '$timeout', '$location', '$state', '$window', '$element', 'dialogs', 'navService', 'rulesetService', 'rulesetDataShareService', 'toaster', '$log', 'tileService',
        function ($scope, $timeout, $location, $state, $window, $element, dialogs, navService, rulesetService, rulesetDataShareService, toaster, $log, tileService) {

            $scope.action = "";
            $scope.spellslist = true;
			$scope.limit = 2;
			$scope.showimagebtns = false;

            $scope.$on("$destroy", function () {
                rulesetDataShareService.setRulesetData($scope.NewRuleSet);
            });
            function GetRulesets() {
                rulesetService.GetRuleSets().then(function (data) {
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        $scope.RuleSets = data.data.PayLoad;
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop("error", data.data.ErrorMessage);
                            }
                        }
                    }
                });
			}

			$scope.OpenFile = function () {
				$(".input-image").find("input[type=file]").click();
				//var input = $('input[type=file]');//.val();
				//input.click();
				//return false;
			}
			

            $scope.ImportRuleSet = function () {
                var dlg = dialogs.create('/views/dialogs/rulesetimport.html', 'dialogImportRuleset',
                    { ruleSetId: 25 }//Need to implement logic
                );

                dlg.result.then(function (res) {
                    GetRulesets();
                    var Rid = res;
                    var getData = rulesetService.GetNewRulesetByRuleSetId(Rid);
                    getData.then(function (data) {
                        $("#loading").fadeOut("slow");
                        if (data.data.StatusCode == 200) {
                            $scope.NewRuleSet = data.data.PayLoad
                            $scope.ItemProperties = $scope.NewRuleSet.RuleSetMetaData.ItemProperties;
                            $scope.SpellProperties = $scope.NewRuleSet.RuleSetMetaData.SpellProperties;
                            $scope.AbilityProperties = $scope.NewRuleSet.RuleSetMetaData.AbilityProperties;
                            $scope.CoreStatProperties = $scope.NewRuleSet.RuleSetMetaData.Corestats;

                            $scope.NewRuleSet.ImportRquired = true;

                            rulesetDataShareService.setRulesetData(null);
                            rulesetDataShareService.setRulesetData($scope.NewRuleSet);

                            if ($scope.NewRuleSet.Corestats.length == 0) {
                                $scope.NewRuleSet.IsAddDisabled = false;
                                $scope.iscorestatsadded = false;
                            }
                            else {
                                $scope.NewRuleSet.IsAddDisabled = true;
                                $scope.iscorestatsadded = true;
                            }
                            if ($scope.NewRuleSet.Items.length == 0) {
                                $scope.isitemsadded = false;
                            }
                            else {
                                $scope.isitemsadded = true;
                            }
                            if ($scope.NewRuleSet.Spells.length == 0) {
                                $scope.isspellsadded = false;
                            }
                            else {
                                $scope.isspellsadded = true;
                            }
                            if ($scope.NewRuleSet.Abilities.length == 0) {
                                $scope.isabilitiesadded = false;
                            }
                            else {
                                $scope.isabilitiesadded = true;
                            }

                            if (angular.equals({}, rulesetDataShareService.getruleset()) == false) {
                                $scope.NewRuleSet = rulesetDataShareService.getruleset();
                                if ($scope.NewRuleSet.Corestats != null) {
                                    if ($scope.NewRuleSet.Corestats.length > 0) {
                                        $scope.iscorestatsadded = true;
                                    }
                                }
                                if ($scope.NewRuleSet.Items != null) {
                                    if ($scope.NewRuleSet.Items.length > 0) {
                                        $scope.isitemsadded = true;
                                    }
                                }
                                if ($scope.NewRuleSet.Spells != null) {
                                    if ($scope.NewRuleSet.Spells.length > 0) {
                                        $scope.isspellsadded = true;
                                    }
                                }
                                if ($scope.NewRuleSet.Abilities != null) {
                                    if ($scope.NewRuleSet.Abilities.length > 0) {
                                        $scope.isabilitiesadded = true;
                                    }
                                }
                            }
                         

                            for (var i = 0; i < $scope.NewRuleSet.Corestats.length; i++) {
                                var result = $scope.NewRuleSet.Corestats[i];
                                for (var k = 0; k < $scope.Types.length; k++) {
                                    if ($scope.Types[k].TypeId == result.TypeId) {
                                        result.TypeName = $scope.Types[k].Name;
                                    }
                                }
                            }
                            $scope.ItemsCount = $scope.NewRuleSet.Items.length;
                            $scope.SpellsCount = $scope.NewRuleSet.Spells.length;
                            $scope.AbilitiesCount = $scope.NewRuleSet.Abilities.length;
                            if (CopyOrUpdate == 0) {
                                $scope.NewRuleSet.Action = "Copy";
                                $scope.NewRuleSet.ActionIcon = "fa fa-clone";
                                $scope.NewRuleSet.Heading = "Copy Ruleset Details";
                            }
                            else {
                                $scope.NewRuleSet.Action = "Update";
                                $scope.NewRuleSet.ActionIcon = "fa fa-pencil-square-o";
                                $scope.NewRuleSet.Heading = "Update Ruleset Details for " + $scope.NewRuleSet.Name;
                            }
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        }
                    },
                        function () {
                            toaster.pop("error", 'Error in getting records');
                        });


                });
            }
            if ($state.params.action == 1) {
                $("#loading").css("display", "block");
                rulesetService.GetRuleSets().then(function (data) {
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        $scope.RuleSets = data.data.PayLoad;
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop("error", data.data.ErrorMessage);
                            }
                        }
                    }
                });

                $scope.RulesetData = function () {
                    rulesetService.GetRuleSets().then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.RuleSets = data.data.PayLoad;
                            $scope.HeaderContents = rulesetDataShareService.getDisplayCharacterRulesetCount();
                            $scope.HeaderContents.TotalRuleSetCount = $scope.RuleSets.length;
                            $("#loading").fadeOut("slow");
                            toaster.pop('success', $scope.payload);
                        }
                    });
                }
                $scope.rulesets = function () {
                    $state.go('profile.NewRuleSet', { 'RuleSetId': 0, 'isNew': 1, 'IsAddRuleSet': 1 });
                }
                $scope.editRuleSet = function (ruleset) {
                    $scope.CopyOrUpdate = 1;
                    $state.go('profile.NewRuleSet', { 'RuleSetId': ruleset.Id, 'isNew': 1, 'CopyOrUpdate': 1 });
                }
                $scope.copyRuleSet = function (ruleset) {
                    $scope.CopyOrUpdate = 0;
                    $state.go('profile.NewRuleSet', { 'RuleSetId': ruleset.Id, 'isNew': 1, 'CopyOrUpdate': 0 });
                }
                $scope.deleteRuleSet = function (ruleset, counter) {
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'You are about to delete ' + ruleset.Name + '. Are you sure?',
                        { size: "sm" }
                    );
                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                $("#loading").css("display", "block");
                                var ruleSetId = ruleset.Id;
                                var Rulesetdelete = rulesetService.DeleteRuleSet(ruleset.Id);
                                Rulesetdelete.then(function (data) {
                                    $("#loading").fadeOut("slow");
                                    if (data.data.StatusCode == 200) {
                                        var deletedRuleSetIndex = -1;
                                        for (var i = 0; i < $scope.RuleSets.length; i++) {
                                            if ($scope.RuleSets[i].Id == ruleSetId) {
                                                deletedRuleSetIndex = i;
                                            }
                                        }
                                        if (deletedRuleSetIndex > -1) {
                                            $scope.RuleSets.splice(deletedRuleSetIndex, 1);
                                            toaster.pop('success', "RuleSet Deleted Successfully");
                                        }
                                    }
                                    else {
                                        if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true) {
                                                toaster.pop('error', data.data.ErrorMessage);
                                            }
                                        }
                                    }
                                })
                            }

                        });
                   
                }
                // Export Ruleset
                $scope.exportRuleSet = function (ruleset, counter) {
                    $("#loading").css("display", "block");
                    var Result = rulesetService.ImportRuleset(ruleset.Id);
                    Result.then(function (data) {
                        $("#loading").fadeOut("slow");
                        if (data.data != "") {
                            var anchor = angular.element('<a/>');
                            anchor.attr({
                                href: 'data:attachment/csv;charset=utf-8,' + encodeURI(data.data),
                                target: '_blank',
                                download: "Ruleset_" + ruleset.Name + ".csv"
                            })[0].click();
                        }

                    }
                    );
                }


            }
            else if ($state.params.action == 2) {

                if (angular.equals({}, rulesetDataShareService.getRulesetData()) == false) {
                    $scope.NewRuleSet = rulesetDataShareService.getRulesetData();
                }
                rulesetService.GetTypes().then(function (data) {

                    if (data.data.StatusCode == 200) {
                        $scope.Types = data.data.PayLoad;
                        $scope.weight = data.data.PayLoad[6].Units
                        $scope.Height = data.data.PayLoad[8].Units
                        $scope.Volume = data.data.PayLoad[9].Units
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop("error", data.data.ErrorMessage);
                            }
                        }
                    }
                });

                $scope.iscorestatsadded = false;
                $scope.isitemsadded = false;
                $scope.isspellsadded = false;
                $scope.isabilitiesadded = false;
                $scope.tabName = "ITEM";

                var RuleSetId = $state.params.RuleSetId;

                var CopyOrUpdate = $state.params.CopyOrUpdate;

                if ($state.params.isNew == 1) {
                    if (parseInt(RuleSetId) > 0) {
                        UpdateRuleSet(parseInt(RuleSetId), CopyOrUpdate);
                    }
                    else {
                        AddRuleSet();
                    }
                }
                else {
                    if (angular.equals({}, rulesetDataShareService.getRulesetData()) == false) {
                        $scope.NewRuleSet = rulesetDataShareService.getRulesetData();
                        $scope.ItemProperties = $scope.NewRuleSet.RuleSetMetaData.ItemProperties;
                        $scope.SpellProperties = $scope.NewRuleSet.RuleSetMetaData.SpellProperties;
                        $scope.AbilityProperties = $scope.NewRuleSet.RuleSetMetaData.AbilityProperties;
                        $scope.CoreStatProperties = $scope.NewRuleSet.RuleSetMetaData.Corestats;
                    }

                    if ($scope.NewRuleSet.Corestats != null) {
                        if ($scope.NewRuleSet.Corestats.length == 0) {
                            $scope.NewRuleSet.IsAddDisabled = false;
                            $scope.iscorestatsadded = false;
                        }
                        else {
                            $scope.NewRuleSet.IsAddDisabled = true;
                            $scope.iscorestatsadded = true;
                        }
                    }
                    else
                        $scope.iscorestatsadded = false;


                    if ($scope.NewRuleSet.Items != null) {
                        if ($scope.NewRuleSet.Items.length == 0) {
                            $scope.isitemsadded = false;
                        }
                        else {
                            $scope.isitemsadded = true;
                        }
                    }
                    else
                        $scope.isitemsadded = false;


                    if ($scope.NewRuleSet.Spells != null) {
                        if ($scope.NewRuleSet.Spells.length == 0) {
                            $scope.isspellsadded = false;
                        }
                        else {
                            $scope.isspellsadded = true;
                        }
                    }
                    else
                        $scope.isspellsadded = false;


                    if ($scope.NewRuleSet.Abilities != null) {
                        if ($scope.NewRuleSet.Abilities.length == 0) {
                            $scope.isabilitiesadded = false;
                        }
                        else {
                            $scope.isabilitiesadded = true;
                        }
                    }
                    else
                        $scope.isabilitiesadded = false;

                }
                $scope.tab = 1;

                $scope.setTab = function (newTab) {
                    if (newTab == 1) {
                        $scope.tabName = "ITEM";
                    }
                    else if (newTab == 2) {
                        $scope.tabName = "SPELL";
                    }
                    else if (newTab == 3) {
                        $scope.tabName = "ABILITY";
                    }
                    $scope.tab = newTab;
                };

                $scope.isSet = function (tabNum) {
                    return $scope.tab === tabNum;
                };
                $scope.GetRulesets = function () {
                    $window.localStorage.setItem("RuleSetId", 0);
                    $state.go("profile.AddNewRuleSet");

                };
                $scope.BackCharacters = function () {
                    return navService.gotoCharacters();
                }

                $scope.ImportRuleSet = function (ruleset) {
                    var dlg = dialogs.create('/views/dialogs/rulesetimport.html', 'dialogImportRuleset',
                        { ruleSetId: $scope.NewRuleSet.Id }
                    );

                    dlg.result.then(function (res) {

                        var Rid = res;
                        var getData = rulesetService.GetNewRulesetByRuleSetId(Rid);
                        getData.then(function (data) {
                            $("#loading").fadeOut("slow");
                            if (data.data.StatusCode == 200) {
                                $scope.NewRuleSet = data.data.PayLoad
                                $scope.ItemProperties = $scope.NewRuleSet.RuleSetMetaData.ItemProperties;
                                $scope.SpellProperties = $scope.NewRuleSet.RuleSetMetaData.SpellProperties;
                                $scope.AbilityProperties = $scope.NewRuleSet.RuleSetMetaData.AbilityProperties;
                                $scope.CoreStatProperties = $scope.NewRuleSet.RuleSetMetaData.Corestats;

                                $scope.NewRuleSet.ImportRquired = true;

                                rulesetDataShareService.setRulesetData(null);
                                rulesetDataShareService.setRulesetData($scope.NewRuleSet);

                                if ($scope.NewRuleSet.Corestats.length == 0) {
                                    $scope.NewRuleSet.IsAddDisabled = false;
                                    $scope.iscorestatsadded = false;
                                }
                                else {
                                    $scope.NewRuleSet.IsAddDisabled = true;
                                    $scope.iscorestatsadded = true;
                                }
                                if ($scope.NewRuleSet.Items.length == 0) {
                                    $scope.isitemsadded = false;
                                }
                                else {
                                    $scope.isitemsadded = true;
                                }
                                if ($scope.NewRuleSet.Spells.length == 0) {
                                    $scope.isspellsadded = false;
                                }
                                else {
                                    $scope.isspellsadded = true;
                                }
                                if ($scope.NewRuleSet.Abilities.length == 0) {
                                    $scope.isabilitiesadded = false;
                                }
                                else {
                                    $scope.isabilitiesadded = true;
                                }

                                if (angular.equals({}, rulesetDataShareService.getruleset()) == false) {
                                    $scope.NewRuleSet = rulesetDataShareService.getruleset();
                                    if ($scope.NewRuleSet.Corestats != null) {
                                        if ($scope.NewRuleSet.Corestats.length > 0) {
                                            $scope.iscorestatsadded = true;
                                        }
                                    }
                                    if ($scope.NewRuleSet.Items != null) {
                                        if ($scope.NewRuleSet.Items.length > 0) {
                                            $scope.isitemsadded = true;
                                        }
                                    }
                                    if ($scope.NewRuleSet.Spells != null) {
                                        if ($scope.NewRuleSet.Spells.length > 0) {
                                            $scope.isspellsadded = true;
                                        }
                                    }
                                    if ($scope.NewRuleSet.Abilities != null) {
                                        if ($scope.NewRuleSet.Abilities.length > 0) {
                                            $scope.isabilitiesadded = true;
                                        }
                                    }
                                }
                               

                                for (var i = 0; i < $scope.NewRuleSet.Corestats.length; i++) {
                                    var result = $scope.NewRuleSet.Corestats[i];
                                    for (var k = 0; k < $scope.Types.length; k++) {
                                        if ($scope.Types[k].TypeId == result.TypeId) {
                                            result.TypeName = $scope.Types[k].Name;
                                        }
                                    }
                                }
                                $scope.ItemsCount = $scope.NewRuleSet.Items.length;
                                $scope.SpellsCount = $scope.NewRuleSet.Spells.length;
                                $scope.AbilitiesCount = $scope.NewRuleSet.Abilities.length;
                                if (CopyOrUpdate == 0) {
                                    $scope.NewRuleSet.Action = "Copy";
                                    $scope.NewRuleSet.ActionIcon = "fa fa-clone";
                                    $scope.NewRuleSet.Heading = "Copy Ruleset Details";
                                }
                                else {
                                    $scope.NewRuleSet.Action = "Update";
                                    $scope.NewRuleSet.ActionIcon = "fa fa-pencil-square-o";
                                    $scope.NewRuleSet.Heading = "Update Ruleset Details for " + $scope.NewRuleSet.Name;
                                }
                            }
                            else {
                                if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            }
                        },
                            function () {
                                toaster.pop("error", 'Error in getting records');
                            });


                    });
                }
                $scope.addNewCoreStat = function () {
                    $scope.OperationTypeMode = "Create"
                    $scope.CoreStatsInGrid = [];
                    $scope.CoreStatProperties.Name = "";
                    if ($scope.NewRuleSet.Corestats != null) {
                        for (var i = 0; i < $scope.NewRuleSet.Corestats.length; i++) {
                            if ($scope.NewRuleSet.Corestats[i].TypeId == 14 || $scope.NewRuleSet.Corestats[i].TypeId == 5 || $scope.NewRuleSet.Corestats[i].TypeId == 6) {
                                $scope.CoreStatsInGrid.push($scope.NewRuleSet.Corestats[i]);
                            }
                        }
                        $scope.CoreStatsNameInGrid = $scope.NewRuleSet.Corestats;
                    }
                    $scope.CoreStatProperties.TypeId = "";
                    $scope.CoreStatProperties.Description = "";
                    $scope.IsButtonDisabled = true;
                    $scope.CoreStatProperties.Heading = "New Character Stats Details";
                    $scope.isInDatabaseCoreStat = true;
                    $scope.pageName = "New Character stat";
                    $scope.buttontext = "Save";
                    var dlg = dialogs.create('/views/dialogs/addnewcorestat.html', 'dialogCreateCoreStat',
                        { scope: $scope.CoreStatProperties, btntext: $scope.buttontext, tabname: $scope.pageName, IsenableBtn: $scope.IsButtonDisabled, CoreStatsInGrid: $scope.CoreStatsInGrid, CoreStatsNameInGrid: $scope.CoreStatsNameInGrid, CoreStatMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if (res != 'cancel') {
                            if ($scope.NewRuleSet.Corestats == null || $scope.NewRuleSet.Corestats == undefined) {
                                $scope.NewRuleSet.Corestats = [];
                            }
                            $scope.NewRuleSet.Corestats.push(res);

                            //rulesetDataShareService.setRulesetData($scope.NewRuleSet);

                            //rulesetDataShareService.setcorestat($scope.NewRuleSet.Corestats);
                            $scope.iscorestatsadded = true;
                        }
                    });
                };



                $scope.createitems = function () {
                    $scope.buttontext = "Create";
                    $scope.tabName = "Create New Item";
                    $scope.IsButtonDisabled = false;
                    $scope.isBtnShow = false;
                    $scope.OperationTypeMode = "Create"
                    var weight = "";
                    var volume = "";
                    $scope.Content_ItemProperties = [];
                    if ($scope.NewRuleSet.Items != null) {
                        for (var i = 0; i < $scope.NewRuleSet.Items.length; i++) {
                            $scope.Content_ItemProperties.push($scope.NewRuleSet.Items[i].ItemProperties[0].Value.Text.value);
                        }
                    }
                    for (var i = 0; i < $scope.NewRuleSet.Rulesetproperty.length; i++) {
                        if ($scope.NewRuleSet.Rulesetproperty[i].TypeId == 7) {
                            weight = $scope.NewRuleSet.Rulesetproperty[i].Units.selectedUnit;
                        }
                    }
                    for (var j = 0; j < $scope.ItemProperties.length; j++) {
                        if ($scope.ItemProperties[j].TypeId == 7) {
                            $scope.ItemProperties[j].Value.Weight.units.selectedUnit = weight;
                        }
                    }
                    for (var i = 0; i < $scope.NewRuleSet.Rulesetproperty.length; i++) {
                        if (($scope.NewRuleSet.Rulesetproperty[i].TypeId == 1) && ($scope.NewRuleSet.Rulesetproperty[i].Name.indexOf('Volume') > -1)) {
                            volume = $scope.NewRuleSet.Rulesetproperty[i].Value.Text.value;
                        }
                    }
                    for (var j = 0; j < $scope.ItemProperties.length; j++) {
                        if ($scope.ItemProperties[j].TypeId == 13) {
                            $scope.ItemProperties[j].Value.Volume.units.selectedUnit = volume;
                        }
                    }
					console.log("$scope.ItemProperties: ", $scope.ItemProperties);
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateItem',
						{ OpenBingSearch: $scope.OpenBingSearch, OpenFile: $scope.OpenFile, scope: $scope.ItemProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Content_ItemProperties: $scope.Content_ItemProperties, ItemMode: $scope.OperationTypeMode, Spells: $scope.NewRuleSet.Spells, Abilities: $scope.NewRuleSet.Abilities }
                    );

                    dlg.result.then(function (res) {
                        if ($scope.NewRuleSet.Items == null || $scope.NewRuleSet.Items == undefined) {
                            $scope.NewRuleSet.Items = [];
                        }

                        if (res != "cancel") {
                            var NewItem = {}
                            NewItem.ItemProperties = res.Properties;
                            NewItem.AssociatedSpells = res.AssociatedSpells;
                            NewItem.AssociatedAbilities = res.AssociatedAbilities;

                          
                            $scope.NewRuleSet.Items.push(NewItem);
                            //rulesetDataShareService.set($scope.NewRuleSet.Items);
                            $scope.isitemsadded = true;
                        }
                    });


                };

                $scope.createspells = function () {
                    $scope.buttontext = "Create";
                    $scope.tabName = "Create New Spell";
                    $scope.isBtnShow = false;
                    $scope.OperationTypeMode = "Create"
                    var weight = "";
                    var volume = "";
                    $scope.Content_SpellProperties = [];
                    if ($scope.NewRuleSet.Spells != null) {
                        for (var i = 0; i < $scope.NewRuleSet.Spells.length; i++) {
                            $scope.Content_SpellProperties.push($scope.NewRuleSet.Spells[i].SpellProperties[0].Value.Text.value);
                        }
                    }
                    for (var i = 0; i < $scope.NewRuleSet.Rulesetproperty.length; i++) {
                        if ($scope.NewRuleSet.Rulesetproperty[i].TypeId == 7) {
                            weight = $scope.NewRuleSet.Rulesetproperty[i].Units.selectedUnit;
                        }
                    }
                    for (var j = 0; j < $scope.SpellProperties.length; j++) {
                        if ($scope.SpellProperties[j].TypeId == 7) {
                            $scope.SpellProperties[j].Value.Weight.units.selectedUnit = weight;
                        }
                    }
                    for (var i = 0; i < $scope.NewRuleSet.Rulesetproperty.length; i++) {
                        if (($scope.NewRuleSet.Rulesetproperty[i].TypeId == 1) && ($scope.NewRuleSet.Rulesetproperty[i].Name.indexOf('Volume') > -1)) {
                            volume = $scope.NewRuleSet.Rulesetproperty[i].Value.Text.value;
                        }
                    }
                    for (var j = 0; j < $scope.SpellProperties.length; j++) {
                        if ($scope.SpellProperties[j].TypeId == 13) {
                            $scope.SpellProperties[j].Value.Volume.units.selectedUnit = volume;
                        }
                    }
                    var dlg = dialogs.create('/views/dialogs/createspells.html', 'dialogCreateSpell',
                        { scope: $scope.SpellProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_SpellProperties: $scope.Content_SpellProperties, SpellMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if ($scope.NewRuleSet.Spells == null || $scope.NewRuleSet.Spells == undefined) {
                            $scope.NewRuleSet.Spells = [];
                        }

                        if (res != "cancel") {
                            var SpellProperties = { "SpellProperties": res };
                            $scope.NewRuleSet.Spells.push(SpellProperties);
                            //rulesetDataShareService.setspell($scope.NewRuleSet.Spells);
                            $scope.isspellsadded = true;
                        }
                    });
                };

                $scope.createabilities = function () {
                    $scope.buttontext = "Create";
                    $scope.tabName = "Create New Ability";
                    $scope.isBtnShow = false;
                    $scope.OperationTypeMode = "Create"
                    var weight = "";
                    var volume = "";
                    $scope.Content_AbilityProperties = [];
                    if ($scope.NewRuleSet.Abilities != null) {
                        for (var i = 0; i < $scope.NewRuleSet.Abilities.length; i++) {
                            $scope.Content_AbilityProperties.push($scope.NewRuleSet.Abilities[i].AbilityProperties[0].Value.Text.value);
                        }
                    }
                    for (var i = 0; i < $scope.NewRuleSet.Rulesetproperty.length; i++) {
                        if ($scope.NewRuleSet.Rulesetproperty[i].TypeId == 7) {
                            weight = $scope.NewRuleSet.Rulesetproperty[i].Units.selectedUnit;
                        }
                    }
                    for (var j = 0; j < $scope.AbilityProperties.length; j++) {
                        if ($scope.AbilityProperties[j].TypeId == 7) {
                            $scope.AbilityProperties[j].Value.Weight.units.selectedUnit = weight;
                        }
                    }
                    for (var i = 0; i < $scope.NewRuleSet.Rulesetproperty.length; i++) {
                        if (($scope.NewRuleSet.Rulesetproperty[i].TypeId == 1) && ($scope.NewRuleSet.Rulesetproperty[i].Name.indexOf('Volume') > -1)) {
                            volume = $scope.NewRuleSet.Rulesetproperty[i].Value.Text.value;
                        }
                    }
                    for (var j = 0; j < $scope.AbilityProperties.length; j++) {
                        if ($scope.AbilityProperties[j].TypeId == 13) {
                            $scope.AbilityProperties[j].Value.Volume.units.selectedUnit = volume;
                        }
                    }
                    var dlg = dialogs.create('/views/dialogs/createabilities.html', 'dialogCreateAbility',
                        { scope: $scope.AbilityProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_AbilityProperties: $scope.Content_AbilityProperties, AbilityMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if ($scope.NewRuleSet.Abilities == null || $scope.NewRuleSet.Abilities == undefined) {
                            $scope.NewRuleSet.Abilities = [];
                        }
                        if (res != "cancel") {
                            var AbilityProperties = { "AbilityProperties": res };
                            $scope.NewRuleSet.Abilities.push(AbilityProperties);
                            //rulesetDataShareService.setability($scope.NewRuleSet.Abilities);
                            $scope.isabilitiesadded = true;
                        }

                    });
                };


                $scope.showallCorestats = function () {
                    $state.go("profile.Corestats", { RuleSetId: $scope.NewRuleSet.Id });
                    //  rulesetDataShareService.setruleset($scope.NewRuleSet);
                }


                $scope.showallitems = function () {
                    $state.go("profile.Items", { RuleSetId: $scope.NewRuleSet.Id });
                    //rulesetDataShareService.setruleset($scope.NewRuleSet);
                }

                $scope.ShowallSpells = function () {
                    $state.go("profile.Spells", { RuleSetId: $scope.NewRuleSet.Id });
                    //rulesetDataShareService.setruleset($scope.NewRuleSet);

                }
                $scope.ShowallAbilities = function () {
                    $state.go("profile.Abilities", { RuleSetId: $scope.NewRuleSet.Id });
                    // rulesetDataShareService.setruleset($scope.NewRuleSet);

                }


                $scope.save = function () {
                    var ruleset = $scope.NewRuleSet;
                    $("#loading").css("display", "block");
                    switch ($scope.NewRuleSet.Action) {
                        case "Copy":
                            var Rulesetadd = rulesetService.copyRuleSet(ruleset);
                            break;
                        case "Update":
                            var Rulesetadd = rulesetService.updateRuleSet(ruleset);
                            break;
                        default:
                            var Rulesetadd = rulesetService.saveRuleSet(ruleset);
                            break;
                    }
                    Rulesetadd.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.payload = data.data.PayLoad
                            switch ($scope.NewRuleSet.Action) {
                                case "Add":
                                    toaster.pop('success', "RuleSet Added Successfully.");
                                    $timeout($state.go('profile.AddNewRuleSet'), 500);
                                    break;
                                case "Copy":
                                    toaster.pop('success', "RuleSet Copied Successfully.");
                                    $timeout($state.go('profile.AddNewRuleSet'), 500);
                                    break;
                                default:
                                    toaster.pop('success', $scope.payload);
                                    $timeout($state.go('profile.AddNewRuleSet'), 500);
                                    break;
                            }
                            $("#loading").fadeOut("slow");
                            rulesetService.GetRuleSets();
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                $("#loading").fadeOut("slow");
                                if (data.data.ShowToUser == true) {
                                    //$timeout($state.go('profile.AddNewRuleSet'), 500);
                                    toaster.pop('error', data.data.ErrorMessage);
                                }
                            }
                        }
                    },
                        function () {
                            //$timeout($state.go('profile.AddNewRuleSet'), 500);
                            toaster.pop('error', "Error in getting records");
                            //alert('Error in getting records');
                        });
                }

                $scope.cancel = function () {
                    if ($state.params.IsAddRuleSet == 1) {
                        $state.go('profile.AddNewRuleSet');
                    }
                    else {
                        $state.go('profile.characters');
                    }
                }



            }
            else if ($state.params.action == 3) {
              
                //$scope.lists = false;
                //$scope.list = true;
                //$scope.RulesetId = $state.params.RuleSetId;
                $scope.RulesetId = parseInt($state.params.RuleSetId);

                var url = $location.absUrl().split('?')[0];
                if (url.indexOf("Corestats") > 0) {
                    if (angular.equals({}, rulesetDataShareService.getcorestat()) == false) {
                        $scope.Corestats = rulesetDataShareService.getcorestat();
                        if ($scope.Corestats.length > 0) {
                            $scope.lists = false;
                            $scope.list = true;
                        }
                        else {
                            $scope.lists = true;
                            $scope.list = false;
                        }
                    }
                    else {
                        var corestats = rulesetService.GetRulesetCorestats(parseInt($state.params.RuleSetId));
                        corestats.then(function (data) {

                            if (data.data.StatusCode == 200) {
                                $scope.Corestats = data.data.PayLoad;
                                rulesetService.GetTypes().then(function (data) {

                                    if (data.data.StatusCode == 200) {
                                        $scope.Types = data.data.PayLoad;
                                        rulesetDataShareService.setcorestat($scope.Corestats);
                                        for (var i = 0; i < $scope.Types.length; i++) {
                                            for (var j = 0; j < $scope.Corestats.length; j++) {
                                                if ($scope.Types[i].TypeId == $scope.Corestats[j].TypeId) {
                                                    $scope.Corestats[j].TypeName = $scope.Types[i].Name;
                                                }
                                            }

                                        }
                                        if ($scope.Corestats.length > 0) {
                                            $scope.lists = false;
                                            $scope.list = true;
                                        }
                                        else {
                                            $scope.lists = true;
                                            $scope.list = false;
                                        }
                                        $state.go("profile.Corestats", { RuleSetId: parseInt($state.params.RuleSetId) })
                                        $("#loading").fadeOut("slow");
                                    }
                                    else {
                                        if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true) {
                                                $("#loading").fadeOut("slow");
                                                toaster.pop("error", data.data.ErrorMessage);
                                                toaster.pop("error", data.data.ErrorMessage);
                                            }
                                        }
                                    }
                                });

                            }
                        })
                    }
                }
                else {
                    if (parseInt(RuleSetId) > 0) {
                        UpdateRuleSet(parseInt(RuleSetId), CopyOrUpdate);
                    }
                }


                $scope.addNewCoreStat = function () {

                    var corestatsmetadata = rulesetService.GetCorestatsMetadata();
                    corestatsmetadata.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.Corestats = rulesetDataShareService.getcorestat();
                            $scope.CoreStatProperties = data.data.PayLoad.RuleSetMetaData.Corestats;
                            $scope.OperationTypeMode = "Create"
                            $scope.CoreStatsInGrid = [];
                            $scope.CoreStatProperties.Name = "";
                            if ($scope.Corestats != null) {
                                for (var i = 0; i < $scope.Corestats.length; i++) {
                                    if ($scope.Corestats[i].TypeId == 14 || $scope.Corestats[i].TypeId == 5 || $scope.Corestats[i].TypeId == 6) {
                                        $scope.CoreStatsInGrid.push($scope.Corestats[i]);
                                    }
                                }
                                $scope.CoreStatsNameInGrid = $scope.Corestats;
                            }
                            $scope.CoreStatProperties.TypeId = "";
                            $scope.CoreStatProperties.Description = "";
                            $scope.IsButtonDisabled = true;
                            $scope.CoreStatProperties.Heading = "New Character Stats Details";
                            $scope.isInDatabaseCoreStat = true;
                            $scope.pageName = "New Character stat";
                            $scope.buttontext = "Save";
                            var dlg = dialogs.create('/views/dialogs/addnewcorestat.html', 'dialogCreateCoreStat',
                                { scope: $scope.CoreStatProperties, btntext: $scope.buttontext, tabname: $scope.pageName, IsenableBtn: $scope.IsButtonDisabled, CoreStatsInGrid: $scope.CoreStatsInGrid, CoreStatsNameInGrid: $scope.CoreStatsNameInGrid, CoreStatMode: $scope.OperationTypeMode }
                            );

                            dlg.result.then(function (res) {
                                if (res != 'cancel') {
                                    $scope.Corestatlist = [];
                                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                    res.RulesetId = $scope.RulesetId;
                                    $scope.Corestatlist.push(res);
                                    var savecorestat = rulesetService.CreateCorestats($scope.Corestatlist);
                                    savecorestat.then(function (data) {
                                        if (data.data.StatusCode == 200) {
                                            //$scope.Corestats = data.data.PayLoad.Result;
                                            $scope.Corestats = data.data.PayLoad;
                                            rulesetDataShareService.setcorestat($scope.Corestats);
                                            rulesetService.GetTypes().then(function (data) {

                                                if (data.data.StatusCode == 200) {
                                                    $scope.Types = data.data.PayLoad;
                                                    //$scope.Types = rulesetDataShareService.getRpgtypeData()
                                                    for (var i = 0; i < $scope.Types.length; i++) {
                                                        for (var j = 0; j < $scope.Corestats.length; j++) {
                                                            if ($scope.Types[i].TypeId == $scope.Corestats[j].TypeId) {
                                                                $scope.Corestats[j].TypeName = $scope.Types[i].Name;
                                                            }
                                                        }

                                                    }
                                                    if ($scope.Corestats.length > 0) {
                                                        $scope.lists = false;
                                                        $scope.list = true;
                                                    }
                                                    else {
                                                        $scope.lists = true;
                                                        $scope.list = false;
                                                    }

                                                    $state.go("profile.Corestats", { RuleSetId: $scope.RulesetId })
                                                }
                                            })

                                        }
                                        else if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true)
                                            {
                                                toaster.pop("error", data.data.ErrorMessage);
                                            }
                                            
                                        }
                                    })
                                }
                            });
                        }
                    })

                };


                $scope.editCoreStat = function (coreStat) {
                    $scope.action = "update";
                    $window.localStorage.setItem("RuleSetId", coreStat.Id);
                    $window.localStorage.setItem("Action", "edit");
                    $scope.isInDatabaseCoreStat = false;
                    var resultdata = rulesetService.GetCoreStatById(coreStat.Id);
                    resultdata.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.CoreStatProperties = data.data.PayLoad;
                            $scope.CoreStatProperties.Heading = "Edit CoreStats Details";
                            var dlg = dialogs.create('/views/dialogs/addnewcorestat.html', 'dialogCreateCoreStat',
                                { scope: $scope.CoreStatProperties }
                            );

                            dlg.result.then(function (res) {
                                if (res != 'cancel') {
                                    if ($scope.NewRuleSet.Corestats == null || $scope.NewRuleSet.Corestats == undefined) {
                                        $scope.NewRuleSet.Corestats = [];
                                    }
                                    $scope.NewRuleSet.Corestats.push(res);
                                    $scope.iscorestatsadded = true;
                                }
                            });
                            $scope.CoreStatProperties.Action = "Update";
                            $scope.CoreStatProperties.Heading = "Update Ruleset Details for " + $scope.CoreStatProperties.Name;
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        }
                    },
                        function () {
                            toaster.pop("error", 'Error in getting records');

                        });

                }

                $scope.deleteCoreStat = function (coreStat) {
                    var IsConf = confirm('You are about to delete ' + coreStat.Name + '. Are you sure?');
                    if (IsConf) {
                        var CoreStatdelete = rulesetService.DeleteCoreStat(coreStat.Id);
                        $state.go("profile.AddNewRuleSet");
                    }
                }
                $scope.deleteCorestats = function (corestatindex) {
                    $scope.NewRuleSet.Corestats.splice(corestatindex, 1);
                }

                $scope.ShowChoice = function () {

                    if ($scope.TypeId == "2") {
                        $scope.result = true;
                    }
                    else {
                        $scope.result = false;

                    }
                }

                var Choices = [];
                $scope.AddChoices = { Choices: [] };
                $scope.AddChoice = function () {
                    $scope.AddChoices.Choices.push('');
                }

                //For Corestats
                $scope.CopyCorestat = function (item, count) {
                    $scope.Corestats = rulesetDataShareService.getcorestat();
                    $scope.pageName = "Copying Corestat";
                    $scope.buttontext = "Copy";
                    $scope.IsButtonDisabled = false;
                    $scope.OperationTypeMode = "Copy"
                    $scope.CoreStatsInGrid = [];

                    if ($scope.Corestats != null) {
                        for (var i = 0; i < $scope.Corestats.length; i++) {
                            if ($scope.Corestats[i].TypeId == 14 || $scope.Corestats[i].TypeId == 5 || $scope.Corestats[i].TypeId == 6) {
                                $scope.CoreStatsInGrid.push($scope.Corestats[i]);
                            }
                        }
                        $scope.CoreStatsNameInGrid = $scope.Corestats;
                    }
                    var dlg = dialogs.create('/views/dialogs/addnewcorestat.html', 'dialogCopyCoreStat',
                        { scope: item, btntext: $scope.buttontext, tabname: $scope.pageName, IsenableBtn: $scope.IsButtonDisabled, CoreStatsNameInGrid: $scope.CoreStatsNameInGrid, CoreStatsInGrid: $scope.CoreStatsInGrid, CoreStatMode: $scope.OperationTypeMode}
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            $scope.CorestatList = [];
                            $scope.CorestatList.push(res);
                            var copycorestat = rulesetService.CopyCorestats($scope.CorestatList);
                            copycorestat.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Corestats = data.data.PayLoad;
                                    rulesetDataShareService.setcorestat($scope.Corestats);
                                    rulesetService.GetTypes().then(function (data) {

                                        if (data.data.StatusCode == 200) {
                                            $scope.Types = data.data.PayLoad;
                                            //$scope.Types = rulesetDataShareService.getRpgtypeData()
                                            for (var i = 0; i < $scope.Types.length; i++) {
                                                for (var j = 0; j < $scope.Corestats.length; j++) {
                                                    if ($scope.Types[i].TypeId == $scope.Corestats[j].TypeId) {
                                                        $scope.Corestats[j].TypeName = $scope.Types[i].Name;
                                                    }
                                                }

                                            }
                                            if ($scope.Corestats.length > 0) {
                                                $scope.lists = false;
                                                $scope.list = true;
                                            }
                                            else {
                                                $scope.lists = true;
                                                $scope.list = false;
                                            }

                                            $state.go("profile.Corestats", { RuleSetId: $scope.RulesetId })
                                        }
                                    })
                                    $state.go("profile.Corestats", { RuleSetId: $scope.NewRuleSet.Id })
                                }
                                else if (data.data.StatusCode == 400)
                                {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }

                            })
                            //$scope.NewRuleSet.Corestats.push(res);
                        }
                    });
                } 

                $scope.EditCorestat = function (item, count) {
                    $scope.Corestats = rulesetDataShareService.getcorestat();
                    $scope.pageName = "Editing Corestat";
                    $scope.buttontext = "Update";
                    $scope.IsButtonDisabled = false;
                    $scope.OperationTypeMode = "Edit"
                    $scope.CoreStatsInGrid = [];
                    if ($scope.Corestats != null) {
                        for (var i = 0; i < $scope.Corestats.length; i++) {
                            if ($scope.Corestats[i].TypeId == 14 || $scope.Corestats[i].TypeId == 5 || $scope.Corestats[i].TypeId == 6) {
                                $scope.CoreStatsInGrid.push($scope.Corestats[i]);
                            }
                        }
                        $scope.CoreStatsNameInGrid = $scope.Corestats;
                    }
                    var dlg = dialogs.create('/views/dialogs/addnewcorestat.html', 'dialogCopyCoreStat',
                        { scope: item, btntext: $scope.buttontext, IsenableBtn: $scope.IsButtonDisabled, tabname: $scope.pageName, CoreStatsNameInGrid: $scope.CoreStatsNameInGrid, CoreStatMode: $scope.OperationTypeMode, CoreStatsInGrid: $scope.CoreStatsInGrid }
                    );
                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            $scope.CorestatList = [];
                            $scope.CorestatList.push(res);
                            var editcorestat = rulesetService.UpdateCorestats($scope.CorestatList);
                            editcorestat.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    //$scope.Corestats = data.data.PayLoad;
                                    //$scope.Corestats = data.data.PayLoad.Result;
                                    $scope.Corestats = data.data.PayLoad;

                                    rulesetService.GetTypes().then(function (data) {

                                        if (data.data.StatusCode == 200) {
                                            $scope.Types = data.data.PayLoad;
                                            //$scope.Types = rulesetDataShareService.getRpgtypeData()
                                            for (var i = 0; i < $scope.Types.length; i++) {
                                                for (var j = 0; j < $scope.Corestats.length; j++) {
                                                    if ($scope.Types[i].TypeId == $scope.Corestats[j].TypeId) {
                                                        $scope.Corestats[j].TypeName = $scope.Types[i].Name;
                                                    }
                                                }
                                            }
                                            if ($scope.Corestats.length > 0) {
                                                $scope.lists = false;
                                                $scope.list = true;
                                            }
                                            else {
                                                $scope.lists = true;
                                                $scope.list = false;
                                            }
                                            $state.go("profile.Corestats", { RuleSetId: $scope.Corestats[0].RulesetId })
                                        }
                                    })
                                    $state.go("profile.Corestats", { RuleSetId: $scope.Corestats[0].RulesetId })
                                }
                                else if (data.data.StatusCode == 400) {

                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            })

                          

                        }
                    });
                }

                $scope.RemoveCorestat = function (item) {
                    $scope.Corestats = rulesetDataShareService.getcorestat();

                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Corestat, "' + item.Name + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                $scope.CorestatList = [];
                                $scope.CorestatList.push(item);
                                //$scope.Corestat = item;
                                var deletecorestat = rulesetService.DeleteCorestats($scope.CorestatList);
                                deletecorestat.then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                        $scope.Corestats = data.data.PayLoad;
                                        rulesetService.GetTypes().then(function (data) {

                                            if (data.data.StatusCode == 200) {
                                                $scope.Types = data.data.PayLoad;
                                                //$scope.Types = rulesetDataShareService.getRpgtypeData()
                                                for (var i = 0; i < $scope.Types.length; i++) {
                                                    for (var j = 0; j < $scope.Corestats.length; j++) {
                                                        if ($scope.Types[i].TypeId == $scope.Corestats[j].TypeId) {
                                                            $scope.Corestats[j].TypeName = $scope.Types[i].Name;
                                                        }
                                                    }

                                                }
                                                if ($scope.Corestats.length > 0) {
                                                    $scope.lists = false;
                                                    $scope.list = true;
                                                }
                                                else {
                                                    $scope.lists = true;
                                                    $scope.list = false;
                                                }

                                                //$state.go("profile.Corestats", { RuleSetId: $scope.RulesetId })
                                            }
                                        })
                                        //$state.go("profile.Corestats", { RuleSetId: $scope.NewRuleSet.Id });
                                    }
                                    else if (data.data.StatusCode == 400)
                                    {
                                        if (data.data.ShowToUser == true) {
                                            toaster.pop("error", data.data.ErrorMessage);
                                        }
                                    }
                                })
                            }
                        })
                   
                };

                $scope.BackCoreStat = function () {
                    //$scope.NewRuleSet = rulesetDataShareService.getruleset();
                    //rulesetDataShareService.setruleset($scope.NewRuleSet);
                    $state.go("profile.AddNewRuleSet");
                    $("#loading").fadeOut("slow");
                }

            }
            else if ($state.params.action == 4) {
                $scope.RulesetId = parseInt($state.params.RuleSetId);
                var url = $location.absUrl().split('?')[0];
                if (url.indexOf("Items") > 0) {
                    if (angular.equals({}, rulesetDataShareService.getRulesetItems()) == false) {
                        $scope.RulesetItems = rulesetDataShareService.getRulesetItems();
                        if ($scope.RulesetItems == null || $scope.RulesetItems == undefined || $scope.RulesetItems == {}) {
                            $scope.RulesetItems = [];
                        }
                        if ($scope.RulesetItems.length > 0) {
                            $scope.list = true;
                            $scope.grid = true;
                            $scope.Itemlist = false;
                        }
                        else {
                            $scope.Itemlist = true;
                            $scope.list = false;
                            $scope.grid = false
                        }
                    }
                    else {
                        var items = rulesetService.GetRulesetItems($scope.RulesetId);
                        items.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                //$scope.Ruleset = data.data.PayLoad;
                                $scope.RulesetItems = data.data.PayLoad;
                                if ($scope.RulesetItems == null || $scope.RulesetItems == undefined || $scope.RulesetItems == {}) {
                                    $scope.RulesetItems = [];
                                }
                                rulesetDataShareService.setRulesetItems($scope.RulesetItems);
                                if ($scope.RulesetItems.length > 0) {
                                    $scope.list = true;
                                    $scope.grid = true;
                                    $scope.Itemlist = false;
                                }
                                else {
                                    $scope.list = false;
                                    $scope.grid = false;
                                    $scope.Itemlist = true;
                                }
                                $state.go("profile.Items", { RuleSetId: $scope.RulesetId })
                                $("#loading").fadeOut("slow");
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.ShowToUser == true) {
                                    $("#loading").fadeOut("slow");
                                    toaster.pop("error", data.data.ErrorMessage);


                                }
                            }

                        })
                    }
                }
                else if (url.indexOf("Spells") > 0) {
                    if (angular.equals({}, rulesetDataShareService.getRulesetSpells()) == false) {
                        $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                        if ($scope.RulesetSpells.length > 0) {
                            $scope.list = true;
                            $scope.grid = true;
                            $scope.Itemlist = false;
                        }
                        else {
                            $scope.list = false;
                            $scope.grid = false;
                            $scope.Itemlist = true;
                        }
                        //$state.go("profile.Spells", { RuleSetId: $scope.Ruleset.Id })
                    }
                    else {
                        var spells = rulesetService.GetRulesetSpells($scope.RulesetId);
                        spells.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                //$scope.Ruleset = data.data.PayLoad;
                                $scope.RulesetSpells = data.data.PayLoad;
                                rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);
                                if ($scope.RulesetSpells.length > 0) {
                                    $scope.list = true;
                                    $scope.grid = true;
                                    $scope.Itemlist = false;
                                }
                                else {
                                    $scope.list = false;
                                    $scope.grid = false;
                                    $scope.Itemlist = true;
                                }
                                $state.go("profile.Spells", { RuleSetId: $scope.RulesetId });
                                $("#loading").fadeOut("slow");
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.ShowToUser == true) {
                                    $("#loading").fadeOut("slow");
                                    toaster.pop("error", data.data.ErrorMessage);

                                }
                            }

                        })
                    }
                }
                else if (url.indexOf("Abilities") > 0) {
                    if (angular.equals({}, rulesetDataShareService.getRulesetAbilities()) == false) {
                        $scope.RulesetAbilities = rulesetDataShareService.getRulesetAbilities();
                        if ($scope.RulesetAbilities.length > 0) {
                            $scope.list = true;
                            $scope.grid = true;
                            $scope.Itemlist = false;
                        }
                        else {
                            $scope.list = false;
                            $scope.grid = false;
                            $scope.Itemlist = true;
                        }
                        //$state.go("profile.Abilities", { RuleSetId: $scope.NewRuleSet.Id })
                    }
                    else {
                        var abilities = rulesetService.GetRulesetAbilities($scope.RulesetId);
                        abilities.then(function (data) {
                            if (data.data.StatusCode == 200) {
                                //$scope.Ruleset = data.data.PayLoad;
                                $scope.RulesetAbilities = data.data.PayLoad;
                                rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);
                                if ($scope.RulesetAbilities.length > 0) {
                                    $scope.list = true;
                                    $scope.grid = true;
                                    $scope.Itemlist = false;
                                }
                                else {
                                    $scope.list = false;
                                    $scope.grid = false;
                                    $scope.Itemlist = true;
                                }
                                $state.go("profile.Abilities", { RuleSetId: $scope.RulesetId })
                                $("#loading").fadeOut("slow");
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.ShowToUser == true) {
                                    $("#loading").fadeOut("slow");
                                    toaster.pop("error", data.data.ErrorMessage);

                                }
                            }

                        })

                    }
                }
                else {
                    if (parseInt($scope.RulesetId) > 0) {
                        UpdateRuleSet($scope.RulesetId, CopyOrUpdate);
                    }
                }

                $scope.BackItem = function () {
                    // $scope.NewRuleSet = rulesetDataShareService.getruleset();
                    //rulesetDataShareService.setruleset($scope.NewRuleSet);
                    //$state.go("profile.NewRuleSet");
                    $state.go("profile.AddNewRuleSet");
                    $("#loading").fadeOut("slow");
                }

                $scope.BackSpell = function () {
                    //$scope.NewRuleSet = rulesetDataShareService.getruleset();
                    //rulesetDataShareService.setruleset($scope.NewRuleSet);

                    // $state.go("profile.NewRuleSet");
                    $state.go("profile.AddNewRuleSet");
                    $("#loading").fadeOut("slow");
                }

                $scope.BackAbility = function () {
                    // $scope.NewRuleSet = rulesetDataShareService.getruleset();
                    //rulesetDataShareService.setruleset($scope.NewRuleSet);

                    // $state.go("profile.NewRuleSet");
                    $state.go("profile.AddNewRuleSet");
                    $("#loading").fadeOut("slow");
                }

                $scope.showlist = function () {
                    $scope.list = true;
                    $scope.grid = false;
                }

                $scope.showgrid = function () {
                    $scope.list = false;
                    $scope.grid = true;
                }

                //For Items
                $scope.CreateItem = function () {
                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var itemsmetadata = rulesetService.GetItemsMetadata($scope.RulesetId);
                    itemsmetadata.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            //$scope.RulesetItems = rulesetDataShareService.get();
                            $scope.ItemProperties = data.data.PayLoad.RuleSetMetaData.ItemProperties;
                            $scope.Rulesetproperty = data.data.PayLoad.Rulesetproperty;
                            $scope.Spells = data.data.PayLoad.Spells;
                            rulesetDataShareService.setRulesetSpells($scope.Spells);
                            $scope.Abilities = data.data.PayLoad.Abilities;
                            rulesetDataShareService.setRulesetAbilities($scope.Abilities);
                            $scope.buttontext = "Create";
                            $scope.tabName = "Create New Item";
                            $scope.IsButtonDisabled = false;
                            $scope.isBtnShow = false;
                            $scope.OperationTypeMode = "Create"
                            var weight = "";
							var volume = "";
							var currency = "";
                            $scope.Content_ItemProperties = [];
                            if ($scope.RulesetItems != null) {
                                for (var i = 0; i < $scope.RulesetItems.length; i++) {
                                    $scope.Content_ItemProperties.push($scope.RulesetItems[i].ItemProperties[0].Value.Text.value);
                                }
							}
							for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
								if ($scope.Rulesetproperty[i].TypeId == 1 && ($scope.Rulesetproperty[i].Name.indexOf('Currency Label') > -1)) {
									currency = $scope.Rulesetproperty[i].Value.Text.value;
								}
							}
							for (var j = 0; j < $scope.ItemProperties.length; j++) {
								if ($scope.ItemProperties[j].TypeId == 14) {
									$scope.ItemProperties[j].Value.Text = currency;
								}
							}
                            for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
								if ($scope.Rulesetproperty[i].TypeId == 1 && ($scope.Rulesetproperty[i].Name.indexOf('Weight') > -1)) {
									weight = $scope.Rulesetproperty[i].Value.Text.value;
                                }
                            }
                            for (var j = 0; j < $scope.ItemProperties.length; j++) {
                                if ($scope.ItemProperties[j].TypeId == 7) {
                                    $scope.ItemProperties[j].Value.Weight.units.selectedUnit = weight;
                                }
                            }
                            for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
                                if (($scope.Rulesetproperty[i].TypeId == 1) && ($scope.Rulesetproperty[i].Name.indexOf('Volume') > -1)) {
                                    volume = $scope.Rulesetproperty[i].Value.Text.value;
                                }
                            }
                            for (var j = 0; j < $scope.ItemProperties.length; j++) {
                                if ($scope.ItemProperties[j].TypeId == 13) {
                                    $scope.ItemProperties[j].Value.Volume.units.selectedUnit = volume;
                                }
                            }
							console.log("$scope.ItemProperties: ", $scope.ItemProperties);
                            var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateItem',
                                { scope: $scope.ItemProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Content_ItemProperties: $scope.Content_ItemProperties, ItemMode: $scope.OperationTypeMode, Spells: $scope.Spells, Abilities: $scope.Abilities }
                            );

                            dlg.result.then(function (res) {

                             

                                if (res != "cancel") {
                                    var NewItem = {}
									NewItem.ItemProperties = res.Properties;
									console.log("res.Properties: ", res.Properties);
                                    NewItem.AssociatedSpells = res.AssociatedSpells;
                                    NewItem.AssociatedAbilities = res.AssociatedAbilities;
                                    NewItem.RulesetID = $scope.RulesetId;
                                    //var ItemProperties = { "ItemProperties": res.Properties };
                                    //var AssociatedSpells = { "AssociatedSpells": res.AssociatedSpells };
                                    //$scope.NewRuleSet.Items.push(ItemProperties);
                                    //$scope.NewRuleSet.Items.push(AssociatedSpells);
                                    $scope.ItemList = [];
                                    $scope.ItemList.push(NewItem);
                                    var saveitem = rulesetService.CreateItems($scope.ItemList);
                                    saveitem.then(function (data) {
                                        if (data.data.StatusCode == 200) {
                                            //$scope.Ruleset = data.data.PayLoad.Result;
                                            var createdRulesetItems = [];
                                            //createdRulesetItems = data.data.PayLoad.Result;
                                            createdRulesetItems = data.data.PayLoad;
                                            for (var i = 0; i < createdRulesetItems.length; i++) {
                                                $scope.RulesetItems.push(createdRulesetItems[i]);
                                            }
                                            rulesetDataShareService.setRulesetItems($scope.RulesetItems);
                                            if ($scope.RulesetItems.length > 0) {
                                                $scope.list = true;
                                                $scope.grid = true;
                                                $scope.Itemlist = false;
                                            }
                                            else {
                                                $scope.list = false;
                                                $scope.grid = false;
                                                $scope.Itemlist = true;
                                            }
                                            $("#loading").fadeOut("slow");
                                            //$state.go("profile.Items", { RuleSetId: $scope.Ruleset.Id })
                                        }
                                        else if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true) {
                                                toaster.pop("error", data.data.ErrorMessage);

                                            }
                                        }
                                       
                                    });

                                }
                                $("#loading").fadeOut("slow");
                            });
                        }
                        else if (data.data.StatusCode == 400) {
                            if (data.ShowToUser == true) {
                                toaster.pop("error", data.data.ErrorMessage);

                            }
                        }
                    })
                };

                $scope.CopyItem = function (item, count) {
                    //$scope.RulesetItems = rulesetDataShareService.getRulesetItems();
                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var spells = rulesetService.GetRulesetSpells($scope.RulesetId);
                    spells.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.Spells = data.data.PayLoad;
                            var abilities = rulesetService.GetRulesetAbilities($scope.RulesetId);
                            abilities.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Abilities = data.data.PayLoad;
                                    $scope.pageName = "Copying Item";
                                    $scope.buttontext = "Copy";
                                    $scope.IsButtonDisabled = true;
                                    $scope.isBtnShow = true;
                                    $scope.OperationTypeMode = "Copy"
                                    $scope.Content_ItemProperties = [];
                                    $scope.SelectAssociatedSpells = true;
                                    $scope.SelectAssociatedAbilities = true;
                                    if ($scope.RulesetItems != null) {
                                        for (var i = 0; i < $scope.RulesetItems.length; i++) {
                                            $scope.Content_ItemProperties.push($scope.RulesetItems[i].ItemProperties[0].Value.Text.value);
                                        }
                                    }
                                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopyItem',
                                        { scope: item.ItemProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, ItemMode: $scope.OperationTypeMode, Spells: $scope.Spells, AssociatedSpells: $scope.RulesetItems[count].AssociatedSpells, Abilities: $scope.Abilities, AssociatedAbilities: $scope.RulesetItems[count].AssociatedAbilities, Content_ItemProperties: $scope.Content_ItemProperties, SelectAssociatedSpells: $scope.SelectAssociatedSpells, SelectAssociatedAbilities: $scope.SelectAssociatedAbilities }
                                    );

                                    dlg.result.then(function (res) {
                                       // $("#loading").css("display", "block");
                                        if (res != "cancel") {
                                            var ItemProperties = { "ItemProperties": res.ItemProperties };
                                            for (var i = 0; i < ItemProperties.ItemProperties.length; i++) {
                                                ItemProperties.ItemProperties[i].ContentId = 0;
                                            }
                                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                            var NewItem = {}
                                            //NewItem.ItemProperties = res.Properties;
                                            NewItem.ItemProperties = res.ItemProperties;
                                            NewItem.AssociatedSpells = res.AssociatedSpells;
                                            NewItem.AssociatedAbilities = res.AssociatedAbilities;
                                            NewItem.RulesetId = $scope.RulesetId;
                                            //$scope.RuleSetItems.push(ItemProperties);
                                            $scope.ItemList = [];
                                            $scope.ItemList.push(NewItem);
                                            var copyitem = rulesetService.CopyItems($scope.ItemList);
                                            copyitem.then(function (data) {
                                                $("#loading").fadeOut("slow");
                                                if (data.data.StatusCode == 200) {
                                                    //$scope.Ruleset = data.data.PayLoad.Result;
                                                    var createdRulesetItems = [];
                                                    //createdRulesetItems = data.data.PayLoad.Result;
                                                    createdRulesetItems = data.data.PayLoad;
                                                    for (var i = 0; i < createdRulesetItems.length; i++) {
                                                        $scope.RulesetItems.push(createdRulesetItems[i]);
                                                    }
                                                    rulesetDataShareService.setRulesetItems($scope.RulesetItems);
                                                    if ($scope.RulesetItems.length > 0) {
                                                        $scope.list = true;
                                                        $scope.grid = true;
                                                        $scope.Itemlist = false;
                                                    }
                                                    else {
                                                        $scope.list = false;
                                                        $scope.grid = false;
                                                        $scope.Itemlist = true;
                                                    }

                                                    //$state.go("profile.Items", { RuleSetId: $scope.Ruleset.Id })
                                                }
                                                else if (data.data.StatusCode == 400) {
                                                    if (data.data.ShowToUser == true) {
                                                        toaster.pop("error", data.data.ErrorMessage);

                                                    }
                                                }
                                               
                                            });
                                        }

                                        $("#loading").fadeOut("slow");
                                    });
                                }
                            })
                        }
                    })
                    // $scope.Spells = rulesetDataShareService.getspell();
                    //$scope.Abilities = rulesetDataShareService.getability();

                }

                $scope.EditItem = function (item, count) {
                    //$scope.RulesetItems = rulesetDataShareService.getRulesetItems();
                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var spells = rulesetService.GetRulesetSpells($scope.RulesetId);
                    spells.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.Spells = data.data.PayLoad;
                            var abilities = rulesetService.GetRulesetAbilities($scope.RulesetId);
                            abilities.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Abilities = data.data.PayLoad;
                                    $scope.pageName = "Editing Item";
                                    $scope.buttontext = "Update";
                                    $scope.IsButtonDisabled = true;
                                    $scope.isBtnShow = true;
                                    $scope.OperationTypeMode = "Edit"

                                    //var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateItem',
                                    //    { scope: $scope.ItemProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Content_ItemProperties: $scope.Content_ItemProperties, ItemMode: $scope.OperationTypeMode, AssociatedSpells: $scope.NewRuleSet.Spells, AssociatedAbilities: $scope.NewRuleSet.Abilities }
                                    //);

                                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopyItem',
                                        { scope: item.ItemProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, ItemMode: $scope.OperationTypeMode, Spells: $scope.Spells, AssociatedSpells: $scope.RulesetItems[count].AssociatedSpells, Abilities: $scope.Abilities, AssociatedAbilities: $scope.RulesetItems[count].AssociatedAbilities }
                                    );

                                    dlg.result.then(function (res) {
                                       // $("#loading").css("display", "block");
                                        if (res != "cancel") {
                                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                            var NewItem = {}
                                            //NewItem.ItemProperties = res.Properties;
                                            NewItem.ItemProperties = res.ItemProperties;
                                            NewItem.AssociatedSpells = res.AssociatedSpells;
                                            NewItem.AssociatedAbilities = res.AssociatedAbilities;
                                            NewItem.RulesetId = $scope.RulesetId;
                                            $scope.ItemList = [];
                                            $scope.ItemList.push(NewItem);
                                            var edititem = rulesetService.UpdateItems($scope.ItemList);
                                            edititem.then(function (data) {
                                                $("#loading").fadeOut("slow");
                                                if (data.data.StatusCode == 200) {
                                                    //$scope.Corestats = data.data.PayLoad;
                                                    //$scope.Ruleset = data.data.PayLoad.Result;
                                                    //$scope.RulesetItems = data.data.PayLoad.Result;

                                                   // var updatedRulesetItems = data.data.PayLoad.Result;
                                                    var updatedRulesetItems = data.data.PayLoad;

                                                    for (var i = 0; i < updatedRulesetItems.length; i++) {
                                                        for (var j = 0; j < $scope.RulesetItems.length; j++) {
                                                            if (updatedRulesetItems[i].ItemProperties[0].ContentId == $scope.RulesetItems[j].ItemProperties[0].ContentId) {
                                                                $scope.RulesetItems[j] = updatedRulesetItems[i];
                                                            }
                                                        }
                                                    }

                                                    rulesetDataShareService.setRulesetItems($scope.RulesetItems);

                                                    if ($scope.RulesetItems.length > 0) {
                                                        $scope.list = true;
                                                        $scope.grid = true;
                                                        $scope.Itemlist = false;
                                                    }
                                                    else {
                                                        $scope.list = false;
                                                        $scope.grid = false;
                                                        $scope.Itemlist = true;
                                                    }
                                                    //$state.go("profile.Items", { RuleSetId: $scope.Ruleset.Id })
                                                    // $state.go("profile.Items")
                                                }
                                                else if (data.data.StatusCode == 400) {
                                                    if (data.data.ShowToUser == true) {
                                                        toaster.pop("error", data.data.ErrorMessage);

                                                    }
                                                }
                                            })

                                            //$scope.NewRuleSet.Items[count] = NewItem;

                                        }
                                        $("#loading").fadeOut("slow");
                                    });
                                }
                               
                            })
                        }
                    });
                    //$scope.Spells = rulesetDataShareService.getspell();
                    //$scope.Abilities = rulesetDataShareService.getability();

                }

                $scope.Removeitem = function (item) {
                   
                    //var index = -1;
                    //$scope.RulesetItems = rulesetDataShareService.get();

                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Item, "' + item.ItemProperties[0].Value.Text.value + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                           // $("#loading").css("display", "block");
                            if (res == "yes") {
                                var deleteItemList = [];
                                //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                item.RulesetId = $scope.RulesetId;
                                deleteItemList.push(item);
                                //$scope.Corestat = item;
                                var deleteitems = rulesetService.DeleteItems(deleteItemList);
                                deleteitems.then(function (data) {
                                    
                                    $("#loading").fadeOut("slow");
                                    if (data.data.StatusCode == 200) {
                                        //$scope.Ruleset = data.data.PayLoad;
                                        //var deletedRulesetItems = data.data.PayLoad.Result;
                                        var deletedRulesetItems = data.data.PayLoad;

                                        var deletedRulesetItemIndexs = [];
                                        for (var i = 0; i < deletedRulesetItems.length; i++) {
                                            for (var j = 0; j < $scope.RulesetItems.length; j++) {
                                                if (deletedRulesetItems[i].ItemProperties[0].ContentId == $scope.RulesetItems[j].ItemProperties[0].ContentId) {
                                                    deletedRulesetItemIndexs.push(j);
                                                }
                                            }
                                        }

                                        for (var i = 0; i < deletedRulesetItemIndexs.length; i++) {
                                            $scope.RulesetItems.splice(deletedRulesetItemIndexs[i], 1);
                                        }

                                        rulesetDataShareService.setRulesetItems($scope.RulesetItems);

                                        if ($scope.RulesetItems.length > 0) {
                                            $scope.list = true;
                                            $scope.grid = true;
                                            $scope.Itemlist = false;
                                        }
                                        else {
                                            $scope.list = false;
                                            $scope.grid = false;
                                            $scope.Itemlist = true;
                                        }
                                        //$state.go("profile.Items", { RuleSetId: $scope.RulesetId })
                                    }
                                    else if (data.data.StatusCode == 400) {
                                        if (data.data.ShowToUser == true) {
                                            toaster.pop("error", data.data.ErrorMessage);

                                        }
                                    }
                                });
                            }
                            $("#loading").fadeOut("slow");
                        })
                  


                };

                //For Spells


                $scope.CreateSpell = function () {

                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var spellsmetadata = rulesetService.GetSpellsMetadata($scope.RulesetId);
                    spellsmetadata.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                            $scope.SpellProperties = data.data.PayLoad.RuleSetMetaData.SpellProperties;
                            $scope.Rulesetproperty = data.data.PayLoad.Rulesetproperty;
                            $scope.buttontext = "Create";
                            $scope.tabName = "Create New Spell";
                            $scope.isBtnShow = false;
                            $scope.OperationTypeMode = "Create"
                            var weight = "";
                            var volume = "";
                            $scope.Content_SpellProperties = [];
                            if ($scope.RulesetSpells != null) {
                                for (var i = 0; i < $scope.RulesetSpells.length; i++) {
                                    $scope.Content_SpellProperties.push($scope.RulesetSpells[i].SpellProperties[0].Value.Text.value);
                                }
                            }
                            for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
                                if ($scope.Rulesetproperty[i].TypeId == 7) {
                                    weight = $scope.Rulesetproperty[i].Units.selectedUnit;
                                }
                            }
                            for (var j = 0; j < $scope.SpellProperties.length; j++) {
                                if ($scope.SpellProperties[j].TypeId == 7) {
                                    $scope.SpellProperties[j].Value.Weight.units.selectedUnit = weight;
                                }
                            }
                            for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
                                if (($scope.Rulesetproperty[i].TypeId == 1) && ($scope.Rulesetproperty[i].Name.indexOf('Volume') > -1)) {
                                    volume = $scope.Rulesetproperty[i].Value.Text.value;
                                }
                            }
                            for (var j = 0; j < $scope.SpellProperties.length; j++) {
                                if ($scope.SpellProperties[j].TypeId == 13) {
                                    $scope.SpellProperties[j].Value.Volume.units.selectedUnit = volume;
                                }
                            }
                            var dlg = dialogs.create('/views/dialogs/createspells.html', 'dialogCreateSpell',
                                { scope: $scope.SpellProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_SpellProperties: $scope.Content_SpellProperties, SpellMode: $scope.OperationTypeMode }
                            );

                            dlg.result.then(function (res) {
                               // $("#loading").css("display", "block");

                                if (res != "cancel") {
                                    var SpellProperties = res;
                                    var newspell = {}
                                    newspell.SpellProperties = SpellProperties;
                                    newspell.RulesetID = $scope.RulesetId;

                                    $scope.SpellList = [];
                                    $scope.SpellList.push(newspell);
                                    var savespell = rulesetService.CreateSpells($scope.SpellList);
                                    savespell.then(function (data) {
                                        $("#loading").fadeOut("slow");
                                        if (data.data.StatusCode == 200) {

                                            
                                            //$scope.Ruleset = data.data.PayLoad.Result;
                                            var createdRulesetSpells = [];
                                            //createdRulesetSpells = data.data.PayLoad.Result;
                                            createdRulesetSpells = data.data.PayLoad;
                                            for (var i = 0; i < createdRulesetSpells.length; i++) {
                                                $scope.RulesetSpells.push(createdRulesetSpells[i]);
                                            }
                                            rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);
                                            if ($scope.RulesetSpells.length > 0) {
                                                $scope.list = true;
                                                $scope.grid = true;
                                                $scope.Itemlist = false;
                                            }
                                            else {
                                                $scope.list = false;
                                                $scope.grid = false;
                                                $scope.Itemlist = true;
                                            }
                                            //$state.go("profile.Spells", { RuleSetId: $scope.Ruleset.Id })
                                        }
                                        else if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true) {
                                                toaster.pop("error", data.data.ErrorMessage);

                                            }
                                        }
                                    });

                                }
                                $("#loading").fadeOut("slow");
                            });
                        }
                       
                    })

                };

                $scope.CopySpell = function (item, count) {
                    $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    $scope.pageName = "Copying Spell";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy"
                    $scope.Content_SpellProperties = [];
                    if ($scope.RulesetSpells != null) {
                        for (var i = 0; i < $scope.RulesetSpells.length; i++) {
                            $scope.Content_SpellProperties.push($scope.RulesetSpells[i].SpellProperties[0].Value.Text.value);
                        }
                    }
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopySpell',
                        { scope: item.SpellProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_SpellProperties: $scope.Content_SpellProperties, SpellMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                       // $("#loading").css("display", "block");
                        if (res != "cancel") {

                            var SpellProperties = res;
                            for (var i = 0; i < SpellProperties.length; i++) {
                                SpellProperties[i].ContentId = 0;
                            }
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewSpell = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewSpell.SpellProperties = SpellProperties;
                            NewSpell.RulesetId = $scope.RulesetId;
                            var SpellList = [];
                            SpellList.push(NewSpell);
                            var copyspell = rulesetService.CopySpells(SpellList);
                            copyspell.then(function (data) {
                                $("#loading").fadeOut("slow");
                                if (data.data.StatusCode == 200) {
                                    //$scope.RulesetSpells = data.data.PayLoad.Result;
                                    var createdRulesetSpells = [];
                                    //createdRulesetSpells = data.data.PayLoad.Result;
                                    createdRulesetSpells = data.data.PayLoad;
                                    for (var i = 0; i < createdRulesetSpells.length; i++) {
                                        $scope.RulesetSpells.push(createdRulesetSpells[i]);
                                    }

                                    rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);

                                    if ($scope.RulesetSpells.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    //$state.go("profile.Spells", { RuleSetId: $scope.Ruleset.Id })
                                }
                                else if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);

                                    }
                                }
                            });
                            //$scope.NewRuleSet.Spells.push(SpellProperties);

                        }
                        $("#loading").fadeOut("slow");

                    });
                }

                $scope.EditSpell = function (item, count) {
                    $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    $scope.pageName = "Editing Spell";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit"
                    var dlg = dialogs.create('/views/dialogs/createspells.html', 'dialogCopySpell',
                        { scope: item.SpellProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, SpellMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                       // $("#loading").css("display", "block");
                        if (res != "cancel") {
                            var SpellProperties = res;
                            //$scope.NewRuleSet.Spells[count] = SpellProperties
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewSpell = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewSpell.SpellProperties = SpellProperties;
                            NewSpell.RulesetId = $scope.RulesetId;
                            var SpellList = [];
                            SpellList.push(NewSpell);
                            var editspell = rulesetService.UpdateSpells(SpellList);
                            editspell.then(function (data) {
                                $("#loading").fadeOut("slow");
                                if (data.data.StatusCode == 200) {
                                    //$scope.RulesetSpells = data.data.PayLoad.Result;

                                    //var updatedRulesetSpells = data.data.PayLoad.Result;
                                    var updatedRulesetSpells = data.data.PayLoad;

                                    for (var i = 0; i < updatedRulesetSpells.length; i++) {
                                        for (var j = 0; j < $scope.RulesetSpells.length; j++) {
                                            if (updatedRulesetSpells[i].SpellProperties[0].ContentId == $scope.RulesetSpells[j].SpellProperties[0].ContentId) {
                                                $scope.RulesetSpells[j] = updatedRulesetSpells[i];
                                            }
                                        }
                                    }

                                    rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);

                                    if ($scope.RulesetSpells.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    //$state.go("profile.Spells", { RuleSetId: $scope.Ruleset.Id })

                                }
                                else if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);

                                    }
                                }
                               
                            });
                        }
                        $("#loading").fadeOut("slow");
                    });
                }

                $scope.RemoveSpell = function (item) {
                    //$scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    //var index = -1;
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Spell, "' + item.SpellProperties[0].Value.Text.value + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                           // $("#loading").css("display", "block");
                            if (res == "yes") {
                                $scope.SpellList = [];
                                //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                item.RulesetId = $scope.RulesetId;
                                $scope.SpellList.push(item);
                                //$scope.Corestat = item;
                                var deletespells = rulesetService.DeleteSpells($scope.SpellList);
                                deletespells.then(function (data) {
                                    $("#loading").fadeOut("slow");
                                    if (data.data.StatusCode == 200) {
                                        //$scope.RulesetSpells = data.data.PayLoad.Result;
                                        //rulesetDataShareService.setRulesetItems($scope.RulesetSpells);

                                       // var deletedRulesetSpells = data.data.PayLoad.Result;
                                        var deletedRulesetSpells = data.data.PayLoad;

                                        var deletedRulesetSpellIndexs = [];
                                        for (var i = 0; i < deletedRulesetSpells.length; i++) {
                                            for (var j = 0; j < $scope.RulesetSpells.length; j++) {
                                                if (deletedRulesetSpells[i].SpellProperties[0].ContentId == $scope.RulesetSpells[j].SpellProperties[0].ContentId) {
                                                    deletedRulesetSpellIndexs.push(j);
                                                }
                                            }
                                        }

                                        for (var i = 0; i < deletedRulesetSpellIndexs.length; i++) {
                                            $scope.RulesetSpells.splice(deletedRulesetSpellIndexs[i], 1);
                                        }

                                        rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);

                                        if ($scope.RulesetSpells.length > 0) {
                                            $scope.list = true;
                                            $scope.grid = true;
                                            $scope.Itemlist = false;
                                        }
                                        else {
                                            $scope.list = false;
                                            $scope.grid = false;
                                            $scope.Itemlist = true;
                                        }
                                        //$state.go("profile.Spells", { RuleSetId: $scope.Ruleset.Id })
                                    }
                                    else if (data.data.StatusCode == 400) {
                                        if (data.data.ShowToUser == true) {
                                            toaster.pop("error", data.data.ErrorMessage);

                                        }
                                    }
                                })
                            }
                            $("#loading").fadeOut("slow");
                        })

                };
                //For Abilitiies

                $scope.CreateAbility = function () {
                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var abilitiesmetadata = rulesetService.GetAbilitiesMetadata($scope.RulesetId);
                    abilitiesmetadata.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.RulesetAbilities = rulesetDataShareService.getRulesetAbilities();
                            $scope.AbilityProperties = data.data.PayLoad.RuleSetMetaData.AbilityProperties;
                            $scope.Rulesetproperty = data.data.PayLoad.Rulesetproperty;
                            $scope.buttontext = "Create";
                            $scope.tabName = "Create Ability";
                            $scope.isBtnShow = false;
                            $scope.OperationTypeMode = "Create"
                            var weight = "";
                            var volume = "";
                            $scope.Content_AbilityProperties = [];
                            if ($scope.RulesetAbilities != null) {
                                for (var i = 0; i < $scope.RulesetAbilities.length; i++) {
                                    $scope.Content_AbilityProperties.push($scope.RulesetAbilities[i].AbilityProperties[0].Value.Text.value);
                                }
                            }
                            for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
                                if ($scope.Rulesetproperty[i].TypeId == 7) {
                                    weight = $scope.Rulesetproperty[i].Units.selectedUnit;
                                }
                            }
                            for (var j = 0; j < $scope.AbilityProperties.length; j++) {
                                if ($scope.AbilityProperties[j].TypeId == 7) {
                                    $scope.AbilityProperties[j].Value.Weight.units.selectedUnit = weight;
                                }
                            }
                            for (var i = 0; i < $scope.Rulesetproperty.length; i++) {
                                if (($scope.Rulesetproperty[i].TypeId == 1) && ($scope.Rulesetproperty[i].Name.indexOf('Volume') > -1)) {
                                    volume = $scope.Rulesetproperty[i].Value.Text.value;
                                }
                            }
                            for (var j = 0; j < $scope.AbilityProperties.length; j++) {
                                if ($scope.AbilityProperties[j].TypeId == 13) {
                                    $scope.AbilityProperties[j].Value.Volume.units.selectedUnit = volume;
                                }
                            }
                            var dlg = dialogs.create('/views/dialogs/createabilities.html', 'dialogCreateAbility',
                                { scope: $scope.AbilityProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_AbilityProperties: $scope.Content_AbilityProperties, AbilityMode: $scope.OperationTypeMode }
                            );

                            dlg.result.then(function (res) {

                               // $("#loading").css("display", "block");
                                if (res != "cancel") {
                                    var AbilityProperties = res;
                                    var NewsAbility = {}
                                    NewsAbility.AbilityProperties = AbilityProperties;
                                    NewsAbility.RulesetID = $scope.RulesetId;
                                    $scope.AbilityList = [];
                                    $scope.AbilityList.push(NewsAbility);
                                    var saveability = rulesetService.CreateAbilities($scope.AbilityList);
                                    saveability.then(function (data) {
                                        $("#loading").fadeOut("slow");
                                        if (data.data.StatusCode == 200) {
                                            //$scope.Ruleset = data.data.PayLoad.Result;
                                            //$scope.RulesetAbilities = data.data.PayLoad.Result;

                                            var createdRulesetAbilities = [];
                                            //createdRulesetAbilities = data.data.PayLoad.Result;
                                            createdRulesetAbilities = data.data.PayLoad;
                                            for (var i = 0; i < createdRulesetAbilities.length; i++) {
                                                $scope.RulesetAbilities.push(createdRulesetAbilities[i]);
                                            }
                                            rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                            if ($scope.RulesetAbilities.length > 0) {
                                                $scope.list = true;
                                                $scope.grid = true;
                                                $scope.Itemlist = false;
                                            }
                                            else {
                                                $scope.list = false;
                                                $scope.grid = false;
                                                $scope.Itemlist = true;
                                            }
                                            //$state.go("profile.Abilities", { RuleSetId: $scope.NewRuleSet.Id })
                                        }
                                        else if (data.data.StatusCode == 400) {
                                            if (data.data.ShowToUser == true) {
                                                toaster.pop("error", data.data.ErrorMessage);


                                            }
                                        }
                                    });

                                }
                               
                            });
                        }
                        $("#loading").fadeOut("slow");
                    });

                };

                $scope.CopyAbility = function (item, count) {
                    //$scope.RulesetAbilities = rulesetDataShareService.getability();
                    $scope.pageName = "Copying Ability";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy"
                    $scope.Content_AbilityProperties = [];
                    if ($scope.RulesetAbilities != null) {
                        for (var i = 0; i < $scope.RulesetAbilities.length; i++) {
                            $scope.Content_AbilityProperties.push($scope.RulesetAbilities[i].AbilityProperties[0].Value.Text.value);
                        }
                    }
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopyAbility',
                        { scope: item.AbilityProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_AbilityProperties: $scope.Content_AbilityProperties, AbilityMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                      //  $("#loading").css("display", "block");
                        if (res != "cancel") {
                            var AbilityProperties = res;
                            for (var i = 0; i < AbilityProperties.length; i++) {
                                AbilityProperties[i].ContentId = 0;
                            }
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewAbility = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewAbility.AbilityProperties = AbilityProperties;
                            NewAbility.RulesetId = $scope.RulesetId;
                            $scope.AbilityList = [];
                            $scope.AbilityList.push(NewAbility);
                            var copyability = rulesetService.CopyAbilities($scope.AbilityList);
                            copyability.then(function (data) {
                                $("#loading").fadeOut("slow");
                                if (data.data.StatusCode == 200) {

                                    var createdRulesetAbilities = [];
                                    //createdRulesetAbilities = data.data.PayLoad.Result;
                                    createdRulesetAbilities = data.data.PayLoad;
                                    for (var i = 0; i < createdRulesetAbilities.length; i++) {
                                        $scope.RulesetAbilities.push(createdRulesetAbilities[i]);
                                    }

                                    rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                    if ($scope.RulesetAbilities.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    //$state.go("profile.Abilities", { RuleSetId: $scope.NewRuleSet.Id })
                                }
                                else if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);

                                    }
                                }
                            });
                        }

                        $("#loading").fadeOut("slow");
                    });
                }

                $scope.EditAbility = function (item, count) {
                    $scope.pageName = "Editing Ability";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit"
                    var dlg = dialogs.create('/views/dialogs/createabilities.html', 'dialogCopyAbility',
                        { scope: item.AbilityProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, AbilityMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                       // $("#loading").css("display", "block");
                        if (res != "cancel") {
                            var AbilityProperties = res;
                            //$scope.NewRuleSet.Spells[count] = SpellProperties
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewAbility = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewAbility.AbilityProperties = AbilityProperties;
                            NewAbility.RulesetId = $scope.RulesetId;
                            $scope.AbilityList = [];
                            $scope.AbilityList.push(NewAbility);
                            var editability = rulesetService.UpdateAbilities($scope.AbilityList);
                            editability.then(function (data) {
                                $("#loading").fadeOut("slow");
                                if (data.data.StatusCode == 200) {

                                   //var updatedRulesetAbilities = data.data.PayLoad.Result;
                                    var updatedRulesetAbilities = data.data.PayLoad;

                                    for (var i = 0; i < updatedRulesetAbilities.length; i++) {
                                        for (var j = 0; j < $scope.RulesetAbilities.length; j++) {
                                            if (updatedRulesetAbilities[i].AbilityProperties[0].ContentId == $scope.RulesetAbilities[j].AbilityProperties[0].ContentId) {
                                                $scope.RulesetAbilities[j] = updatedRulesetAbilities[i];
                                            }
                                        }
                                    }

                                    rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                    if ($scope.RulesetAbilities.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                   //$state.go("profile.Abilities", { RuleSetId: $scope.NewRuleSet.Id })

                                }
                                else if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);

                                    }
                                }
                            });
                        }
                        $("#loading").fadeOut("slow");
                    });
                }

                $scope.RemoveAbility = function (item) {
                    //$scope.RulesetAbilities = rulesetDataShareService.getability();
                    //var index = -1;
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Ability, "' + item.AbilityProperties[0].Value.Text.value + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                         //   $("#loading").css("display", "block");
                            if (res == "yes") {
                                $scope.AbilityList = [];
                                //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                item.RulesetID = $scope.RulesetId;
                                $scope.AbilityList.push(item);
                                //$scope.Corestat = item;
                                var deleteabilities = rulesetService.DeleteAbilities($scope.AbilityList);
                                deleteabilities.then(function (data) {
                                    $("#loading").fadeOut("slow");
                                    if (data.data.StatusCode == 200) {

                                        //var deletedRulesetAbilities = data.data.PayLoad.Result;
                                        var deletedRulesetAbilities = data.data.PayLoad;

                                        var deletedRulesetAbilityIndexs = [];
                                        for (var i = 0; i < deletedRulesetAbilities.length; i++) {
                                            for (var j = 0; j < $scope.RulesetAbilities.length; j++) {
                                                if (deletedRulesetAbilities[i].AbilityProperties[0].ContentId == $scope.RulesetAbilities[j].AbilityProperties[0].ContentId) {
                                                    deletedRulesetAbilityIndexs.push(j);
                                                }
                                            }
                                        }

                                        for (var i = 0; i < deletedRulesetAbilityIndexs.length; i++) {
                                            $scope.RulesetAbilities.splice(deletedRulesetAbilityIndexs[i], 1);
                                        }

                                        rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                        if ($scope.RulesetAbilities.length > 0) {
                                            $scope.list = true;
                                            $scope.grid = true;
                                            $scope.Itemlist = false;
                                        }
                                        else {
                                            $scope.list = false;
                                            $scope.grid = false;
                                            $scope.Itemlist = true;
                                        }
                                        //$state.go("profile.Abilities", { RuleSetId: $scope.NewRuleSet.Id })
                                    }
                                    else if (data.data.StatusCode == 400) {
                                        if (data.data.ShowToUser == true) {
                                            toaster.pop("error", data.data.ErrorMessage);

                                        }
                                    }
                                })
                            }
                            $("#loading").fadeOut("slow");
                        })


                };

                $scope.ShowAllItemProperties = function (index) {
                    $state.go("profile.RulesetItemDetails", { index: index, RuleSetId: $scope.RulesetId });
                } 

                $scope.ShowAllSpellsContent = function (index) {
                    //alert("Testing Aleart");
                    $state.go("profile.RulesetSpellDetails", { index: index, RuleSetId: $scope.RulesetId });
                }

                $scope.ShowAllAbilityContent = function (index) {
                    $state.go("profile.RulesetAbilityDetails", { index: index, RuleSetId: $scope.RulesetId });
                }

            }
            else if ($state.params.action == 5) {
                $scope.RulesetId = parseInt($state.params.RuleSetId);
                $scope.initialClientObjectId = 0;
                if (angular.equals({}, rulesetDataShareService.getRulesetData()) == false) {
                    $scope.NewRuleSet = rulesetDataShareService.getRulesetData();
                }
                else {
                    if (parseInt(RuleSetId) > 0) {
                        UpdateRuleSet(parseInt(RuleSetId), CopyOrUpdate);
                    }
                }
				
                if ($state.params.contentType == 1) {
                    $scope.RulesetItems = rulesetDataShareService.getRulesetItems();
                    $scope.RulesetContent = $scope.RulesetItems[$state.params.index];
					console.log("$scope.RulesetContent: ", $scope.RulesetContent);
                    // Setting ClientObjectId For Tiles.
                    for (var i = 0; i < $scope.RulesetContent.ItemProperties.length; i++) {
                        var ItemPropertyLst = $scope.RulesetContent.ItemProperties[i];
                        if (ItemPropertyLst.Id == 0 || ItemPropertyLst.Id == undefined || ItemPropertyLst.Id == "") {
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            ItemPropertyLst.tile.ClientObjectId = $scope.initialClientObjectId;
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }
                }
                else if ($state.params.contentType == 2) {
                    $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    $scope.RulesetContent = $scope.RulesetSpells[$state.params.index];
                    // Setting ClientObjectId For Tiles.
                    for (var i = 0; i < $scope.RulesetContent.SpellProperties.length; i++) {
                        var spellPropertyLst = $scope.RulesetContent.SpellProperties[i];
                        if (spellPropertyLst.Id == 0 || spellPropertyLst.Id == undefined || spellPropertyLst.Id == "") {
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            spellPropertyLst.tile.ClientObjectId = $scope.initialClientObjectId;
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }
                    //   $scope.LinkExecuteTileContent = $scope.NewRuleSet;
                }
                else if ($state.params.contentType == 3) {
                    $scope.RulesetAbilities = rulesetDataShareService.getRulesetAbilities();
                    $scope.RulesetContent = $scope.RulesetAbilities[$state.params.index];
                    // Setting ClientObjectId For Tiles.
                    for (var i = 0; i < $scope.RulesetContent.AbilityProperties.length; i++) {
                        var abilityPropertyLst = $scope.RulesetContent.AbilityProperties[i];
                        if (abilityPropertyLst.Id == 0 || abilityPropertyLst.Id == undefined || abilityPropertyLst.Id == "") {
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                            abilityPropertyLst.tile.ClientObjectId = $scope.initialClientObjectId;
                            $scope.initialClientObjectId = $scope.initialClientObjectId + 1;
                        }
                    }
                    //   $scope.LinkExecuteTileContent = $scope.NewRuleSet;
                }

                $scope.BackContent = function (val) {
                    $scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    if (val == 1) {

                        $state.go("profile.Items", { RuleSetId: $scope.RulesetId });
                    }
                    else if (val == 2) {
                        $state.go("profile.Spells", { RuleSetId: $scope.RulesetId });
                    }
                    else if (val == 3) {
                        $state.go("profile.Abilities", { RuleSetId: $scope.RulesetId });
                    }
                }
                //For Detail Screen Editing,Copying,Removing of Item.
                $scope.CopyItem = function (item) {
                    
                    //$scope.RulesetItems = rulesetDataShareService.getRulesetItems();
                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var spells = rulesetService.GetRulesetSpells($scope.RulesetId);
                    spells.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.Spells = data.data.PayLoad;
                            var abilities = rulesetService.GetRulesetAbilities($scope.RulesetId);
                            abilities.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Abilities = data.data.PayLoad;
                                    $scope.pageName = "Copying Item";
                                    $scope.buttontext = "Copy";
                                    $scope.IsButtonDisabled = true;
                                    $scope.isBtnShow = true;
                                    $scope.OperationTypeMode = "Copy"
                                    $scope.Content_ItemProperties = [];
                                    if ($scope.RulesetItems != null) {
                                        for (var i = 0; i < $scope.RulesetItems.length; i++) {
                                            $scope.Content_ItemProperties.push($scope.RulesetItems[i].ItemProperties[0].Value.Text.value);
                                        }
                                    }
                                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopyItem',
                                        { scope: item.ItemProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, ItemMode: $scope.OperationTypeMode, Spells: $scope.Spells, AssociatedSpells: $scope.RulesetContent.AssociatedSpells, Abilities: $scope.Abilities, AssociatedAbilities: $scope.RulesetContent.AssociatedAbilities, Content_ItemProperties: $scope.Content_ItemProperties }
                                    );

                                    dlg.result.then(function (res) {
                                        
                                        if (res != "cancel") {
                                            var ItemProperties = { "ItemProperties": res.ItemProperties };
                                            for (var i = 0; i < ItemProperties.ItemProperties.length; i++) {
                                                ItemProperties.ItemProperties[i].ContentId = 0;
                                            }
                                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                            var NewItem = {}
                                            //NewItem.ItemProperties = res.Properties;
                                            NewItem.ItemProperties = res.ItemProperties;
                                            NewItem.AssociatedSpells = res.AssociatedSpells;
                                            NewItem.AssociatedAbilities = res.AssociatedAbilities;
                                            NewItem.RulesetId = $scope.RulesetId;
                                            //$scope.RuleSetItems.push(ItemProperties);
                                            $scope.ItemList = [];
                                            $scope.ItemList.push(NewItem);
                                            var copyitem = rulesetService.CopyItems($scope.ItemList);
                                            copyitem.then(function (data) {
                                             
                                                if (data.data.StatusCode == 200) {
                                                    //$scope.Ruleset = data.data.PayLoad.Result;
                                                    var createdRulesetItems = [];
                                                    createdRulesetItems = data.data.PayLoad;
                                                    for (var i = 0; i < createdRulesetItems.length; i++) {
                                                        $scope.RulesetItems.push(createdRulesetItems[i]);
                                                    }
                                                    rulesetDataShareService.setRulesetItems($scope.RulesetItems);
                                                    if ($scope.RulesetItems.length > 0) {
                                                        $scope.list = true;
                                                        $scope.grid = true;
                                                        $scope.Itemlist = false;
                                                    }
                                                    else {
                                                        $scope.list = false;
                                                        $scope.grid = false;
                                                        $scope.Itemlist = true;
                                                    }
                                                    $state.go("profile.Items", { RuleSetId: $scope.RulesetId })
                                                }
                                                else if (data.data.StatusCode == 400) {
                                                    if (data.ShowToUser == true) {
                                                        toaster.pop("error", data.data.ErrorMessage);

                                                    }
                                                }

                                            });
                                        }


                                    });
                                }
                            })
                        }
                    })
                    // $scope.Spells = rulesetDataShareService.getspell();
                    //$scope.Abilities = rulesetDataShareService.getability();

                }

                $scope.EditItem = function (item) {
                    //$scope.RulesetItems = rulesetDataShareService.getRulesetItems();
                    //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                    var spells = rulesetService.GetRulesetSpells($scope.RulesetId);
                    spells.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.Spells = data.data.PayLoad;
                            var abilities = rulesetService.GetRulesetAbilities($scope.RulesetId);
                            abilities.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.Abilities = data.data.PayLoad;
                                    $scope.pageName = "Editing Item";
                                    $scope.buttontext = "Update";
                                    $scope.IsButtonDisabled = true;
                                    $scope.isBtnShow = true;
                                    $scope.OperationTypeMode = "Edit"

                                    //var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCreateItem',
                                    //    { scope: $scope.ItemProperties, tabName: $scope.tabName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, Content_ItemProperties: $scope.Content_ItemProperties, ItemMode: $scope.OperationTypeMode, AssociatedSpells: $scope.NewRuleSet.Spells, AssociatedAbilities: $scope.NewRuleSet.Abilities }
                                    //);

                                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopyItem',
                                        { scope: item.ItemProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnDisabled: $scope.IsButtonDisabled, IsBtnShow: $scope.isBtnShow, ItemMode: $scope.OperationTypeMode, Spells: $scope.Spells, AssociatedSpells: $scope.RulesetContent.AssociatedSpells, Abilities: $scope.Abilities, AssociatedAbilities: $scope.RulesetContent.AssociatedAbilities }
                                    );

                                    dlg.result.then(function (res) {
                                        if (res != "cancel") {
                                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                            var NewItem = {}
                                            //NewItem.ItemProperties = res.Properties;
                                            NewItem.ItemProperties = res.ItemProperties;
                                            NewItem.AssociatedSpells = res.AssociatedSpells;
                                            NewItem.AssociatedAbilities = res.AssociatedAbilities;
                                            NewItem.RulesetId = $scope.RulesetId;
                                            $scope.ItemList = [];
                                            $scope.ItemList.push(NewItem);
                                            var edititem = rulesetService.UpdateItems($scope.ItemList);
                                            edititem.then(function (data) {
                                                if (data.data.StatusCode == 200) {
                                                 
                                                    var updatedRulesetItems = data.data.PayLoad;

                                                    for (var i = 0; i < updatedRulesetItems.length; i++) {
                                                        for (var j = 0; j < $scope.RulesetItems.length; j++) {
                                                            if (updatedRulesetItems[i].ItemProperties[0].ContentId == $scope.RulesetItems[j].ItemProperties[0].ContentId) {
                                                                $scope.RulesetItems[j] = updatedRulesetItems[i];
                                                            }
                                                        }
                                                    }

                                                    rulesetDataShareService.setRulesetItems($scope.RulesetItems);

                                                    if ($scope.RulesetItems.length > 0) {
                                                        $scope.list = true;
                                                        $scope.grid = true;
                                                        $scope.Itemlist = false;
                                                    }
                                                    else {
                                                        $scope.list = false;
                                                        $scope.grid = false;
                                                        $scope.Itemlist = true;
                                                    }
                                                    $state.go("profile.Items", { RuleSetId: $scope.RulesetId })
                                                    // $state.go("profile.Items")
                                                }
                                            })

                                            //$scope.NewRuleSet.Items[count] = NewItem;

                                        }
                                    });
                                }
                            })
                        }
                    });
                  
                }
                $scope.Removeitem = function (item) {
                    //var index = -1;
                    //$scope.RulesetItems = rulesetDataShareService.get();

                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Item, "' + item.ItemProperties[0].Value.Text.value + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                var deleteItemList = [];
                                //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                //item.RulesetId = $scope.RulesetId;
                                deleteItemList.push(item);
                                //$scope.Corestat = item;
                                var deleteitems = rulesetService.DeleteItems(deleteItemList);
                                deleteitems.then(function (data) {
                                    debugger;
                                    if (data.data.StatusCode == 200) {
                                        //$scope.Ruleset = data.data.PayLoad;
                                        var deletedRulesetItems = data.data.PayLoad;

                                        var deletedRulesetItemIndexs = [];
                                        for (var i = 0; i < deletedRulesetItems.length; i++) {
                                            for (var j = 0; j < $scope.RulesetItems.length; j++) {
                                                if (deletedRulesetItems[i].ItemProperties[0].ContentId == $scope.RulesetItems[j].ItemProperties[0].ContentId) {
                                                    deletedRulesetItemIndexs.push(j);
                                                }
                                            }
                                        }

                                        for (var i = 0; i < deletedRulesetItemIndexs.length; i++) {
                                            $scope.RulesetItems.splice(deletedRulesetItemIndexs[i], 1);
                                        }

                                        rulesetDataShareService.setRulesetItems($scope.RulesetItems);

                                        if ($scope.RulesetItems.length > 0) {
                                            $scope.list = true;
                                            $scope.grid = true;
                                            $scope.Itemlist = false;
                                        }
                                        else {
                                            $scope.list = false;
                                            $scope.grid = false;
                                            $scope.Itemlist = true;
                                        }
                                        $state.go("profile.Items", { RuleSetId: $scope.RulesetId })
                                    }
                                })
                            }
                        })

                };
                //For Detail Screen Editing,Copying,Removing of Spell.
                $scope.CopySpell = function (item) {
                    $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    $scope.pageName = "Copying Spell";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy"
                    $scope.Content_SpellProperties = [];
                    if ($scope.RulesetSpells != null) {
                        for (var i = 0; i < $scope.RulesetSpells.length; i++) {
                            $scope.Content_SpellProperties.push($scope.RulesetSpells[i].SpellProperties[0].Value.Text.value);
                        }
                    }
                    var dlg = dialogs.create('/views/dialogs/createspells.html', 'dialogCopySpell',
                        { scope: item.SpellProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_SpellProperties: $scope.Content_SpellProperties, SpellMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            var SpellProperties = res;
                            for (var i = 0; i < SpellProperties.length; i++) {
                                SpellProperties[i].ContentId = 0;
                            }
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewSpell = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewSpell.SpellProperties = SpellProperties;
                            NewSpell.RulesetId = $scope.RulesetId;
                            var SpellList = [];
                            SpellList.push(NewSpell);
                            var copyspell = rulesetService.CopySpells(SpellList);
                            copyspell.then(function (data) {

                                if (data.data.StatusCode == 200) {
                                    //$scope.RulesetSpells = data.data.PayLoad.Result;
                                    var createdRulesetSpells = [];
                                    createdRulesetSpells = data.data.PayLoad;
                                    for (var i = 0; i < createdRulesetSpells.length; i++) {
                                        $scope.RulesetSpells.push(createdRulesetSpells[i]);
                                    }

                                    rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);

                                    if ($scope.RulesetSpells.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    $state.go("profile.Spells", { RuleSetId: $scope.RulesetId })
                                }

                            });
                            //$scope.NewRuleSet.Spells.push(SpellProperties);

                        }

                    });
                }

                $scope.EditSpell = function (item) {
                    $scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    $scope.pageName = "Editing Spell";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit"
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopySpell',
                        { scope: item.SpellProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, SpellMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            var SpellProperties = res;
                            //$scope.NewRuleSet.Spells[count] = SpellProperties
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewSpell = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewSpell.SpellProperties = SpellProperties;
                            NewSpell.RulesetId = $scope.RulesetId;
                            var SpellList = [];
                            SpellList.push(NewSpell);
                            var editspell = rulesetService.UpdateSpells(SpellList);
                            editspell.then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    //$scope.RulesetSpells = data.data.PayLoad.Result;

                                    var updatedRulesetSpells = data.data.PayLoad;

                                    for (var i = 0; i < updatedRulesetSpells.length; i++) {
                                        for (var j = 0; j < $scope.RulesetSpells.length; j++) {
                                            if (updatedRulesetSpells[i].SpellProperties[0].ContentId == $scope.RulesetSpells[j].SpellProperties[0].ContentId) {
                                                $scope.RulesetSpells[j] = updatedRulesetSpells[i];
                                            }
                                        }
                                    }

                                    rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);

                                    if ($scope.RulesetSpells.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    $state.go("profile.Spells", { RuleSetId: $scope.RulesetId })

                                }
                            });
                        }
                    });
                }
                $scope.RemoveSpell = function (item) {
                    //$scope.RulesetSpells = rulesetDataShareService.getRulesetSpells();
                    //var index = -1;
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Spell, "' + item.SpellProperties[0].Value.Text.value + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                $scope.SpellList = [];
                                //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                item.RulesetId = $scope.RulesetId;
                                $scope.SpellList.push(item);
                                //$scope.Corestat = item;
                                var deletespells = rulesetService.DeleteSpells($scope.SpellList);
                                deletespells.then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                        //$scope.RulesetSpells = data.data.PayLoad.Result;
                                        //rulesetDataShareService.setRulesetItems($scope.RulesetSpells);

                                        var deletedRulesetSpells = data.data.PayLoad;

                                        var deletedRulesetSpellIndexs = [];
                                        for (var i = 0; i < deletedRulesetSpells.length; i++) {
                                            for (var j = 0; j < $scope.RulesetSpells.length; j++) {
                                                if (deletedRulesetSpells[i].SpellProperties[0].ContentId == $scope.RulesetSpells[j].SpellProperties[0].ContentId) {
                                                    deletedRulesetSpellIndexs.push(j);
                                                }
                                            }
                                        }

                                        for (var i = 0; i < deletedRulesetSpellIndexs.length; i++) {
                                            $scope.RulesetSpells.splice(deletedRulesetSpellIndexs[i], 1);
                                        }

                                        rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);

                                        if ($scope.RulesetSpells.length > 0) {
                                            $scope.list = true;
                                            $scope.grid = true;
                                            $scope.Itemlist = false;
                                        }
                                        else {
                                            $scope.list = false;
                                            $scope.grid = false;
                                            $scope.Itemlist = true;
                                        }
                                        $state.go("profile.Spells", { RuleSetId: $scope.RulesetId })
                                    }
                                })
                            }
                        })

                };
                //For Detail Screen Editing,Copying,Removing of Ability.
                $scope.CopyAbility = function (item, count) {
                    //$scope.RulesetAbilities = rulesetDataShareService.getability();
                    $scope.pageName = "Copying Ability";
                    $scope.buttontext = "Copy";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Copy"
                    $scope.Content_AbilityProperties = [];
                    if ($scope.RulesetAbilities != null) {
                        for (var i = 0; i < $scope.RulesetAbilities.length; i++) {
                            $scope.Content_AbilityProperties.push($scope.RulesetAbilities[i].AbilityProperties[0].Value.Text.value);
                        }
                    }
                    var dlg = dialogs.create('/views/dialogs/createabilities.html', 'dialogCopyAbility',
                        { scope: item.AbilityProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, Content_AbilityProperties: $scope.Content_AbilityProperties, AbilityMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            var AbilityProperties = res;
                            for (var i = 0; i < AbilityProperties.length; i++) {
                                AbilityProperties[i].ContentId = 0;
                            }
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewAbility = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewAbility.AbilityProperties = AbilityProperties;
                            NewAbility.RulesetId = $scope.RulesetId;
                            $scope.AbilityList = [];
                            $scope.AbilityList.push(NewAbility);
                            var copyability = rulesetService.CopyAbilities($scope.AbilityList);
                            copyability.then(function (data) {
                                if (data.data.StatusCode == 200) {

                                    var createdRulesetAbilities = [];
                                    createdRulesetAbilities = data.data.PayLoad;
                                    for (var i = 0; i < createdRulesetAbilities.length; i++) {
                                        $scope.RulesetAbilities.push(createdRulesetAbilities[i]);
                                    }

                                    rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                    if ($scope.RulesetAbilities.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    $state.go("profile.Abilities", { RuleSetId: $scope.RulesetId })
                                }

                            });
                        }


                    });
                }

                $scope.EditAbility = function (item, count) {
                    $scope.pageName = "Editing Ability";
                    $scope.buttontext = "Update";
                    $scope.isBtnShow = true;
                    $scope.OperationTypeMode = "Edit"
                    var dlg = dialogs.create('/views/dialogs/createitems.html', 'dialogCopyAbility',
                        { scope: item.AbilityProperties, tabName: $scope.pageName, btntext: $scope.buttontext, IsBtnShow: $scope.isBtnShow, AbilityMode: $scope.OperationTypeMode }
                    );

                    dlg.result.then(function (res) {
                        if (res != "cancel") {
                            var AbilityProperties = res;
                            //$scope.NewRuleSet.Spells[count] = SpellProperties
                            //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                            var NewAbility = {}
                            //NewItem.ItemProperties = res.Properties;
                            NewAbility.AbilityProperties = AbilityProperties;
                            NewAbility.RulesetId = $scope.RulesetId;
                            $scope.AbilityList = [];
                            $scope.AbilityList.push(NewAbility);
                            var editability = rulesetService.UpdateAbilities($scope.AbilityList);
                            editability.then(function (data) {
                                if (data.data.StatusCode == 200) {

                                    var updatedRulesetAbilities = data.data.PayLoad;

                                    for (var i = 0; i < updatedRulesetAbilities.length; i++) {
                                        for (var j = 0; j < $scope.RulesetAbilities.length; j++) {
                                            if (updatedRulesetAbilities[i].AbilityProperties[0].ContentId == $scope.RulesetAbilities[j].AbilityProperties[0].ContentId) {
                                                $scope.RulesetAbilities[j] = updatedRulesetAbilities[i];
                                            }
                                        }
                                    }

                                    rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                    if ($scope.RulesetAbilities.length > 0) {
                                        $scope.list = true;
                                        $scope.grid = true;
                                        $scope.Itemlist = false;
                                    }
                                    else {
                                        $scope.list = false;
                                        $scope.grid = false;
                                        $scope.Itemlist = true;
                                    }
                                    $state.go("profile.Abilities", { RuleSetId: $scope.RulesetId })

                                }
                            });
                        }

                    });
                }

                $scope.RemoveAbility = function (item) {
                    //$scope.RulesetAbilities = rulesetDataShareService.getability();
                    //var index = -1;
                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete this Ability, "' + item.AbilityProperties[0].Value.Text.value + '"',
                        {}
                    );

                    dlg.result.then(
                        function (res) {
                            if (res == "yes") {
                                $scope.AbilityList = [];
                                //$scope.RulesetId = rulesetDataShareService.getRulesetsData();
                                item.RulesetID = $scope.RulesetId;
                                $scope.AbilityList.push(item);
                                //$scope.Corestat = item;
                                var deleteabilities = rulesetService.DeleteAbilities($scope.AbilityList);
                                deleteabilities.then(function (data) {
                                    if (data.data.StatusCode == 200) {
                                        var deletedRulesetAbilities = data.data.PayLoad;

                                        var deletedRulesetAbilityIndexs = [];
                                        for (var i = 0; i < deletedRulesetAbilities.length; i++) {
                                            for (var j = 0; j < $scope.RulesetAbilities.length; j++) {
                                                if (deletedRulesetAbilities[i].AbilityProperties[0].ContentId == $scope.RulesetAbilities[j].AbilityProperties[0].ContentId) {
                                                    deletedRulesetAbilityIndexs.push(j);
                                                }
                                            }
                                        }

                                        for (var i = 0; i < deletedRulesetAbilityIndexs.length; i++) {
                                            $scope.RulesetAbilities.splice(deletedRulesetAbilityIndexs[i], 1);
                                        }

                                        rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);

                                        if ($scope.RulesetAbilities.length > 0) {
                                            $scope.list = true;
                                            $scope.grid = true;
                                            $scope.Itemlist = false;
                                        }
                                        else {
                                            $scope.list = false;
                                            $scope.grid = false;
                                            $scope.Itemlist = true;
                                        }
                                        $state.go("profile.Abilities", { RuleSetId: $scope.RulesetId})
                                    }
                                })
                            }
                        })


                };
                //For Tiles
                $scope.ShowTiles = function (val) {
                    var tilesmetadata = rulesetService.GetTilesMetadataForRuleset();
                    tilesmetadata.then(function (data) {
                        if (data.data.StatusCode == 200) {
                            $scope.TileTypes = data.data.PayLoad.RuleSetMetaData.TileTypes;
                            $scope.ItemPropertyForTile = data.data.PayLoad.RuleSetMetaData.ItemProperty;

                            $scope.Tile = data.data.PayLoad.RuleSetMetaData.Tile;
                            for (var i = 0; i < $scope.TileTypes.length; i++) {
                                if ($scope.TileTypes[i].TileType == "Attribute") {
                                    var index = 2;
                                    if (index != -1) {
                                        $scope.TileTypes.splice(index, 1);
                                    }
                                }
                            }
                            var dlg = dialogs.create('/views/dialogs/tile-type-picker.html', 'dialogTileTypes',
                                { scope: $scope.TileTypes }
                            );
                            dlg.result.then(function (res) {
                                if (res.TileType == "Note") {
                                    $scope.Tile.TileTypeId = res.TileId;
                                    $scope.Tile.TileTypeName = res.TileType;
                                    $scope.Tile.Value = res.Value;
                                    var dlg = dialogs.create('/views/dialogs/tile-editor-1.html', 'NoteTile',
                                        { scope: $scope.Tile }
                                    );
                                    dlg.result.then(function (res) {
                                        if (res != "cancel") {
                                            res.Height = "5";
                                            res.Width = "5";
                                            res.X = "0";
                                            res.Y = "0";
                                            res.IsSync = false;
                                            res.SyncDate = Date.now();
                                            var tile = { "tile": res };
                                            var ItemPropertyForTile = $scope.ItemPropertyForTile;
                                            ItemPropertyForTile.tile = res;
                                            val.push(ItemPropertyForTile);

                                        }
                                        $scope.ClientScopeChange = true;
                                    });
                                }
                                else if (res.TileType == "Counter") {
                                    $scope.Tile.TileTypeId = res.TileId;
                                    $scope.Tile.TileTypeName = res.TileType;
                                    $scope.Tile.Value = res.Value;
                                    var dlg = dialogs.create('/views/dialogs/tile-editor-2.html', 'NoteTile',
                                        { scope: $scope.Tile }
                                    );
                                    dlg.result.then(function (res) {
                                        if (res != "cancel") {
                                            res.Height = "5";
                                            res.Width = "5";
                                            res.X = "0";
                                            res.Y = "0";
                                            res.IsSync = false;
                                            res.SyncDate = Date.now();
                                            var tile = { "tile": res };
                                            var ItemPropertyForTile = $scope.ItemPropertyForTile;
                                            ItemPropertyForTile.tile = res;
                                            val.push(ItemPropertyForTile);
                                        }
                                        $scope.ClientScopeChange = true;

                                    });
                                }
                                
                                else if (res.TileType == "Link") {
                                    
                                    $scope.RuleSetContentForLinkExecuteTile = {};
                                    if (angular.equals({}, rulesetDataShareService.getRulesetItems()) == false) {
                                        $scope.RuleSetContentForLinkExecuteTile.Items = rulesetDataShareService.getRulesetItems();
                                    }
                                    else
                                    {
                                        var items = rulesetService.GetRulesetItems(parseInt($state.params.RuleSetId));
                                        items.then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                //$scope.Ruleset = data.data.PayLoad;
                                                $scope.RuleSetContentForLinkExecuteTile.RulesetItems = data.data.PayLoad;
                                                rulesetDataShareService.setRulesetItems($scope.RuleSetContentForLinkExecuteTile.Items);
                                                $("#loading").fadeOut("slow");
                                            }
                                            else if (data.data.StatusCode == 400) {
                                                if (data.ShowToUser == true) {
                                                    $("#loading").fadeOut("slow");
                                                    toaster.pop("error", data.data.ErrorMessage);


                                                }
                                            }

                                        })
                                    }

                                    if (angular.equals({}, rulesetDataShareService.getRulesetSpells()) == false) {
                                        $scope.RuleSetContentForLinkExecuteTile.Spells = rulesetDataShareService.getRulesetSpells();
                                    }
                                    else
                                    {
                                        var spells = rulesetService.GetRulesetSpells(parseInt($state.params.RuleSetId));
                                        spells.then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                //$scope.Ruleset = data.data.PayLoad;
                                                $scope.RuleSetContentForLinkExecuteTile.Spells = data.data.PayLoad;
                                                rulesetDataShareService.setRulesetSpells($scope.RuleSetContentForLinkExecuteTile.Spells);
                                                $("#loading").fadeOut("slow");
                                            }
                                            else if (data.data.StatusCode == 400) {
                                                if (data.ShowToUser == true) {
                                                    $("#loading").fadeOut("slow");
                                                    toaster.pop("error", data.data.ErrorMessage);

                                                }
                                            }

                                        })
                                    }
                                    if (angular.equals({}, rulesetDataShareService.getRulesetAbilities()) == false) {
                                        $scope.RuleSetContentForLinkExecuteTile.Abilities = rulesetDataShareService.getRulesetAbilities();
                                    }
                                    else {
                                        var abilities = rulesetService.GetRulesetAbilities(parseInt($state.params.RuleSetId));
                                        abilities.then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                //$scope.Ruleset = data.data.PayLoad;
                                                $scope.RuleSetContentForLinkExecuteTile.Abilities = data.data.PayLoad;
                                                rulesetDataShareService.setRulesetAbilities($scope.RuleSetContentForLinkExecuteTile.Abilities);
                                                $("#loading").fadeOut("slow");
                                            }
                                            else if (data.data.StatusCode == 400) {
                                                if (data.ShowToUser == true) {
                                                    $("#loading").fadeOut("slow");
                                                    toaster.pop("error", data.data.ErrorMessage);

                                                }
                                            }

                                        })
                                    }
                                    $scope.Tile.TileTypeId = res.TileId;
                                    $scope.Tile.TileTypeName = res.TileType;
                                    $scope.Tile.Value = res.Value;

                                    var dlg = dialogs.create('/views/dialogs/tile-editor-4.html', 'NoteTile',
                                        { scope: $scope.Tile, RuleSetContentForLinkExecuteTile: $scope.RuleSetContentForLinkExecuteTile }
                                    );
                                    dlg.result.then(function (res) {
                                        if (res != "cancel") {
                                            res.Height = "5";
                                            res.Width = "5";
                                            res.X = "0";
                                            res.Y = "0";
                                            res.IsSync = false;
                                            res.SyncDate = Date.now();
                                            var tile = { "tile": res };
                                            var ItemPropertyForTile = $scope.ItemPropertyForTile;
                                            ItemPropertyForTile.tile = res;
                                            val.push(ItemPropertyForTile);

                                        }
                                        $scope.ClientScopeChange = true;

                                    });
                                }
                                else if (res.TileType == "Execute") {
                                   
                                    $scope.RuleSetContentForLinkExecuteTile = {};
                                    if (angular.equals({}, rulesetDataShareService.getRulesetItems()) == false) {
                                        $scope.RuleSetContentForLinkExecuteTile.Items = rulesetDataShareService.getRulesetItems();
                                    }
                                    else {
                                        var items = rulesetService.GetRulesetItems(parseInt($state.params.RuleSetId));
                                        items.then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                //$scope.Ruleset = data.data.PayLoad;
                                                $scope.RuleSetContentForLinkExecuteTile.RulesetItems = data.data.PayLoad;
                                                rulesetDataShareService.setRulesetItems($scope.RuleSetContentForLinkExecuteTile.Items);
                                                $("#loading").fadeOut("slow");
                                            }
                                            else if (data.data.StatusCode == 400) {
                                                if (data.ShowToUser == true) {
                                                    $("#loading").fadeOut("slow");
                                                    toaster.pop("error", data.data.ErrorMessage);

                                                }
                                            }

                                        })
                                    }

                                    if (angular.equals({}, rulesetDataShareService.getRulesetSpells()) == false) {
                                        $scope.RuleSetContentForLinkExecuteTile.Spells = rulesetDataShareService.getRulesetSpells();
                                    }
                                    else {
                                        var spells = rulesetService.GetRulesetSpells(parseInt($state.params.RuleSetId));
                                        spells.then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                //$scope.Ruleset = data.data.PayLoad;
                                                $scope.RuleSetContentForLinkExecuteTile.Spells = data.data.PayLoad;
                                                rulesetDataShareService.setRulesetSpells($scope.RuleSetContentForLinkExecuteTile.Spells);
                                                $("#loading").fadeOut("slow");
                                            }
                                            else if (data.data.StatusCode == 400) {
                                                if (data.ShowToUser == true) {
                                                    $("#loading").fadeOut("slow");
                                                    toaster.pop("error", data.data.ErrorMessage);

                                                }
                                            }

                                        })
                                    }
                                    if (angular.equals({}, rulesetDataShareService.getRulesetAbilities()) == false) {
                                        $scope.RuleSetContentForLinkExecuteTile.Abilities = rulesetDataShareService.getRulesetAbilities();
                                    }
                                    else {
                                        var abilities = rulesetService.GetRulesetAbilities(parseInt($state.params.RuleSetId));
                                        abilities.then(function (data) {
                                            if (data.data.StatusCode == 200) {
                                                //$scope.Ruleset = data.data.PayLoad;
                                                $scope.RuleSetContentForLinkExecuteTile.Abilities = data.data.PayLoad;
                                                rulesetDataShareService.setRulesetAbilities($scope.RuleSetContentForLinkExecuteTile.Abilities);
                                                $("#loading").fadeOut("slow");
                                            }
                                            else if (data.data.StatusCode == 400) {
                                                if (data.ShowToUser == true) {
                                                    $("#loading").fadeOut("slow");
                                                    toaster.pop("error", data.data.ErrorMessage);

                                                }
                                            }

                                        })
                                    }

                                    $scope.Tile.TileTypeId = res.TileId;
                                    $scope.Tile.TileTypeName = res.TileType;
                                    $scope.Tile.Value = res.Value;
                                    var dlg = dialogs.create('/views/dialogs/tile-editor-5.html', 'NoteTile',
                                        { scope: $scope.Tile, RuleSetContentForLinkExecuteTile: $scope.RuleSetContentForLinkExecuteTile }
                                    );
                                    dlg.result.then(function (res) {
                                        if (res != "cancel") {
                                            res.Height = "5";
                                            res.Width = "5";
                                            res.X = "0";
                                            res.Y = "0";
                                            res.IsSync = false;
                                            res.SyncDate = Date.now();
                                            var tile = { "tile": res };
                                            var ItemPropertyForTile = $scope.ItemPropertyForTile;
                                            ItemPropertyForTile.tile = res;
                                            val.push(ItemPropertyForTile);
                                        }
                                        $scope.ClientScopeChange = true;
                                    })

                                }
                                else if (res.TileType == "Command") {
                                    $scope.Tile.TileTypeId = res.TileId;
                                    $scope.Tile.TileTypeName = res.TileType;
                                    $scope.Tile.Value = res.Value;
                                    var dlg = dialogs.create('/views/dialogs/tile-editor-6.html', 'NoteTile',
                                        { scope: $scope.Tile }
                                    );
                                    dlg.result.then(function (res) {

                                        if (res != "cancel") {
                                            res.Height = "5";
                                            res.Width = "5";
                                            res.X = "0";
                                            res.Y = "0";
                                            res.IsSync = false;
                                            res.SyncDate = Date.now();
                                            var tile = { "tile": res };
                                            var ItemPropertyForTile = $scope.ItemPropertyForTile;
                                            ItemPropertyForTile.tile = res;
                                            val.push(ItemPropertyForTile);
                                        }

                                        $scope.ClientScopeChange = true;

                                    });
                                }
                                else if (res.TileType == "Image") {
                                    $scope.Tile.TileTypeId = res.TileId;
                                    $scope.Tile.TileTypeName = res.TileType;
                                    $scope.Tile.Value = res.Value;
                                    var dlg = dialogs.create('/views/dialogs/tile-editor-7.html', 'NoteTile',
                                        { scope: $scope.Tile }
                                    );
                                    dlg.result.then(function (res) {
                                        if (res != "cancel") {
                                            res.Height = "5";
                                            res.Width = "5";
                                            res.X = "0";
                                            res.Y = "0";
                                            res.IsSync = false;
                                            res.SyncDate = Date.now();
                                            var tile = { "tile": res };
                                            var ItemPropertyForTile = $scope.ItemPropertyForTile;
                                            ItemPropertyForTile.tile = res;
                                            val.push(ItemPropertyForTile);
                                        }

                                        $scope.ClientScopeChange = true;
                                    });

                                }
                            })

                        }
                    })
                    //var TileTypes = $scope.NewRuleSet.RuleSetMetaData.TileTypes;
                }

                $scope.SaveTilesForRuleset = function (tilecontent, Num) {
                    //$scope.NewLayout = rulesetDataShareService.getLayoutData();

                    if (Num == 1) {
                        //$scope.SelectedItemContent = tilecontent;
                        var RulesetTiles = {}
                        RulesetTiles.ItemProperties = tilecontent;
                        RulesetTiles.SpellProperties = null;
                        RulesetTiles.AbilityProperties = null
                        var items = rulesetService.SaveRulesetTiles(RulesetTiles).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetContent = data.data.PayLoad.Result;
                                toaster.pop('success', "Tile Added Successfully");
                            }
                        });
                    }
                    else if (Num == 2) {
                        var RulesetTiles = {}
                        RulesetTiles.ItemProperties = null;
                        RulesetTiles.SpellProperties = tilecontent;
                        RulesetTiles.AbilityProperties = null
                        var items = rulesetService.SaveRulesetTiles(RulesetTiles).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetContent = data.data.PayLoad.Result;
                                toaster.pop('success', "Tile Added Successfully");
                            }
                        });
                    }
                    else if (Num == 3) {
                        var RulesetTiles = {}
                        RulesetTiles.ItemProperties = null;
                        RulesetTiles.SpellProperties = null;
                        RulesetTiles.AbilityProperties = tilecontent
                        var items = rulesetService.SaveRulesetTiles(RulesetTiles).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetContent = data.data.PayLoad.Result;
                                toaster.pop('success', "Tile Added Successfully");
                            }
                        });
                    }
                }

                $scope.stackOptions = {
                    height: 150,
                    width: 400,
                    cellHeight: 30,
                    minWidth: 1,

                    pixelWidth: 35,
                    verticalMargin: 5,
                    alwaysShowResizeHandle: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),

                    resizable: {
                        handles: 'e, se, s, sw, w'
                    },
                    draggable: {
                        refreshPositions: true,
                        handle: '.grid-stack-item-content'
                    }
                };

                $scope.onDragStart = function (event, ui) {
                    $timeout(function () {
                        $scope.state.tileDragging = true;
                    });
                };

                $scope.onDragStop = function (event, ui) {
                    $timeout(function () {
                        $scope.state.tileDragging = false;
                    });
                };

                $scope.state = {
                    tilesEditing: false,
                    tileDragging: false,
                    tileDeleteId: null
                };

                $scope.moveWidget = function () {
                    $scope.widgets[0].x = 1;
                    $scope.widgets[0].width = 2;
                    $scope.widgets[0].height = 2;
                };

                $scope.widgets = [{ x: 0, y: 0, width: 1, height: 1 }, { x: 0, y: 0, width: 3, height: 1 }];
                $scope.onChange = function (event, items) {
                    $log.log("onChange event: " + event + " items:" + items);
                };

                $scope.onResizeStop = function (event, ui) {
                    $log.log("onResizeStop event: " + event + " ui:" + ui);
                };

                $scope.onItemAdded = function (item) {
                    $log.log("onItemAdded item: " + item);
                };

                $scope.onItemRemoved = function (item) {
                    $log.log("onItemRemoved item: " + item);
                };


                $scope.ShowAssociatedSpells = function (index) {
                    $state.go("profile.RulesetSpellDetails", { index: index });
                }

                $scope.ShowAllSpellsContent = function (index) {
                    //alert("Testing Aleart");

                    $state.go("profile.RulesetSpellDetails", { index: index });
                }

                $scope.ShowAssociatedSpells = function (index) {
                    //alert("Testing Aleart");

                    $state.go("profile.RulesetSpellDetails", { index: index });
                }


            }

            function UpdateRuleSet(Id, CopyOrUpdate) {
                $("#loading").css("display", "block");
                var getData = rulesetService.GetNewRulesetByRuleSetId(Id);
                getData.then(function (data) {
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        $scope.NewRuleSet = data.data.PayLoad
                        $scope.ItemProperties = $scope.NewRuleSet.RuleSetMetaData.ItemProperties;
                        $scope.SpellProperties = $scope.NewRuleSet.RuleSetMetaData.SpellProperties;
                        $scope.AbilityProperties = $scope.NewRuleSet.RuleSetMetaData.AbilityProperties;
                        $scope.CoreStatProperties = $scope.NewRuleSet.RuleSetMetaData.Corestats;

                        $scope.NewRuleSet.ImportRquired = true;

                        rulesetDataShareService.setRulesetData(null);
                        rulesetDataShareService.setRulesetData($scope.NewRuleSet);

                        if ($scope.NewRuleSet.Corestats.length == 0) {
                            $scope.NewRuleSet.IsAddDisabled = false;
                            $scope.iscorestatsadded = false;
                        }
                        else {
                            $scope.NewRuleSet.IsAddDisabled = true;
                            $scope.iscorestatsadded = true;
                        }
                        if ($scope.NewRuleSet.Items.length == 0) {
                            $scope.isitemsadded = false;
                        }
                        else {
                            $scope.isitemsadded = true;
                        }
                        if ($scope.NewRuleSet.Spells.length == 0) {
                            $scope.isspellsadded = false;
                        }
                        else {
                            $scope.isspellsadded = true;
                        }
                        if ($scope.NewRuleSet.Abilities.length == 0) {
                            $scope.isabilitiesadded = false;
                        }
                        else {
                            $scope.isabilitiesadded = true;
                        }

                        if (angular.equals({}, rulesetDataShareService.getruleset()) == false) {
                            $scope.NewRuleSet = rulesetDataShareService.getruleset();
                            if ($scope.NewRuleSet.Corestats != null) {
                                if ($scope.NewRuleSet.Corestats.length > 0) {
                                    $scope.iscorestatsadded = true;
                                }
                            }
                            if ($scope.NewRuleSet.Items != null) {
                                if ($scope.NewRuleSet.Items.length > 0) {
                                    $scope.isitemsadded = true;
                                }
                            }
                            if ($scope.NewRuleSet.Spells != null) {
                                if ($scope.NewRuleSet.Spells.length > 0) {
                                    $scope.isspellsadded = true;
                                }
                            }
                            if ($scope.NewRuleSet.Abilities != null) {
                                if ($scope.NewRuleSet.Abilities.length > 0) {
                                    $scope.isabilitiesadded = true;
                                }
                            }
                        }
                        //if (angular.equals({}, rulesetDataShareService.getRulesetcontent()) == false) {
                        //    $scope.RulesetContent = rulesetDataShareService.getRulesetcontent();
                        //    $scope.isabilitiesadded = true;
                        //}

                        for (var i = 0; i < $scope.NewRuleSet.Corestats.length; i++) {
                            var result = $scope.NewRuleSet.Corestats[i];
                            for (var k = 0; k < $scope.Types.length; k++) {
                                if ($scope.Types[k].TypeId == result.TypeId) {
                                    result.TypeName = $scope.Types[k].Name;
                                }
                            }
                        }
                        $scope.ItemsCount = $scope.NewRuleSet.Items.length;
                        $scope.SpellsCount = $scope.NewRuleSet.Spells.length;
                        $scope.AbilitiesCount = $scope.NewRuleSet.Abilities.length;
                        if (CopyOrUpdate == 0) {
                            $scope.NewRuleSet.Action = "Copy";
                            $scope.NewRuleSet.ActionIcon = "fa fa-clone";
                            $scope.NewRuleSet.Heading = "Copy Ruleset Details";
                        }
                        else {
                            $scope.NewRuleSet.Action = "Update";
                            $scope.NewRuleSet.ActionIcon = "fa fa-pencil-square-o";
                            $scope.NewRuleSet.Heading = "Update Ruleset Details for " + $scope.NewRuleSet.Name;
                        }
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop("error", data.data.ErrorMessage);
                            }
                        }
                    }
                },
                    function () {
                        toaster.pop("error", 'Error in getting records');

                    });
            }

            function AddRuleSet() {
                $("#loading").css("display", "block");
                rulesetService.GetNewRuleset().then(function (data) {
                    $("#loading").fadeOut("slow");
                    if (data.data.StatusCode == 200) {
                        $scope.NewRuleSet = data.data.PayLoad
                        $scope.ItemProperties = $scope.NewRuleSet.RuleSetMetaData.ItemProperties;
                        $scope.SpellProperties = $scope.NewRuleSet.RuleSetMetaData.SpellProperties;
                        $scope.AbilityProperties = $scope.NewRuleSet.RuleSetMetaData.AbilityProperties;
                        $scope.CoreStatProperties = $scope.NewRuleSet.RuleSetMetaData.Corestats;

                        rulesetDataShareService.setRulesetData(null);
                        rulesetDataShareService.setRulesetData($scope.NewRuleSet);

                       

                        $scope.NewRuleSet.IsAddDisabled = false;
                        $scope.NewRuleSet.Action = "Add";
                        $scope.NewRuleSet.ActionIcon = "fa fa-plus";
                        $scope.NewRuleSet.Heading = "Add New Ruleset";
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                toaster.pop("error", data.data.ErrorMessage);
                            }
                        }
                    }
                });
            }
            $scope.onDeleteDrop = function (event, ui) {
                var tile = GridStackUI.Utils.getNodeData(ui.helper);
                var ClientObjectTileId = ui.helper[0].dataset.gsId;

                var deletedTileIndex = -1;
                if ($scope.RulesetContent.ItemProperties != undefined && $scope.RulesetContent.ItemProperties != null && $scope.RulesetContent.ItemProperties != "")
                {
                    for (var i = 0; i < $scope.RulesetContent.ItemProperties.length; i++) {
                        var ItemPropertyLst = $scope.RulesetContent.ItemProperties[i];
                        if (ItemPropertyLst.Id == 0 || ItemPropertyLst.Id == undefined || ItemPropertyLst.Id == "") {
                            if (ClientObjectTileId == $scope.RulesetContent.ItemProperties[i].tile.ClientObjectId) {
                                deletedTileIndex = i;
                            }
                        }
                    }

                    if ($scope.RulesetContent.ItemProperties[deletedTileIndex].tile.TileId == 0) {
                        $scope.RulesetContent.ItemProperties.splice(deletedTileIndex, 1);
                    }
                    else {
                        tileService.deleteTile($scope.RulesetContent.ItemProperties[deletedTileIndex].tile).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetContent.ItemProperties.splice(deletedTileIndex, 1);
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        });
                    }
                }

                else if ($scope.RulesetContent.SpellProperties != undefined && $scope.RulesetContent.SpellProperties != null && $scope.RulesetContent.SpellProperties != "") {
                    for (var i = 0; i < $scope.RulesetContent.SpellProperties.length; i++) {
                        var spellPropertyLst = $scope.RulesetContent.SpellProperties[i];
                        if (spellPropertyLst.Id == 0 || spellPropertyLst.Id == undefined || spellPropertyLst.Id == "") {
                            if (ClientObjectTileId == $scope.RulesetContent.SpellProperties[i].tile.ClientObjectId) {
                                    deletedTileIndex = i;
                                }
                            }
                        }

                    if ($scope.RulesetContent.SpellProperties[deletedTileIndex].tile.TileId == 0) {
                        $scope.RulesetContent.SpellProperties.splice(deletedTileIndex, 1);
                        }
                        else {
                        tileService.deleteTile($scope.RulesetContent.SpellProperties[deletedTileIndex].tile).then(function (data) {
                                if (data.data.StatusCode == 200) {
                                    $scope.RulesetContent.SpellProperties.splice(deletedTileIndex, 1);
                                }
                                else if (data.data.StatusCode == 400) {
                                    if (data.data.ShowToUser == true) {
                                        toaster.pop("error", data.data.ErrorMessage);
                                    }
                                }
                            });
                        }
                }
                else if ($scope.RulesetContent.AbilityProperties != undefined && $scope.RulesetContent.AbilityProperties != null && $scope.RulesetContent.AbilityProperties != "") {
                    for (var i = 0; i < $scope.RulesetContent.AbilityProperties.length; i++) {
                        var abilityPropertyLst = $scope.RulesetContent.AbilityProperties[i];
                        if (abilityPropertyLst.Id == 0 || abilityPropertyLst.Id == undefined || abilityPropertyLst.Id == "") {
                            if (ClientObjectTileId == $scope.RulesetContent.AbilityProperties[i].tile.ClientObjectId) {
                                deletedTileIndex = i;
                            }
                        }
                    }

                    if ($scope.RulesetContent.AbilityProperties[deletedTileIndex].tile.TileId == 0) {
                        $scope.RulesetContent.AbilityProperties.splice(deletedTileIndex, 1);
                    }
                    else {
                        tileService.deleteTile($scope.RulesetContent.AbilityProperties[deletedTileIndex].tile).then(function (data) {
                            if (data.data.StatusCode == 200) {
                                $scope.RulesetContent.AbilityProperties.splice(deletedTileIndex, 1);
                            }
                            else if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        });
                    }
                }
                

                
            };
            $scope.onDeleteDropCharacterItem = function (event, ui) {
                var tile = GridStackUI.Utils.getNodeData(ui.helper);
                var TileId = ui.helper[0].dataset.gsId;
                if (TileId)
                    tileService.deleteTile(parseInt(TileId)).then(function (data) {
                        if (data.data.StatusCode == 200) {
                            //$scope.RuleSet = $scope.NewRuleSet;
                            $scope.RuleSetItems = rulesetDataShareService.getRulesetItems();
                            $scope.RuleSetSpells = rulesetDataShareService.getRulesetSpells();
                            $scope.RuleSetAbilities = rulesetDataShareService.getRulesetAbilities();
                            for (var i = 0; i < $scope.RuleSetItems.length; i++) {
                                var Item = $scope.RuleSetItems[i];
                                var ItemPropertyLst = Item.ItemProperties;
                                for (var j = 0; j < ItemPropertyLst.length; j++) {
                                    var TileItemProperties = ItemPropertyLst[j];
                                    if (ItemPropertyLst[j].ContentTypeId == null) {
                                        var RemainingTiles = [];
                                        if (j != 0) {
                                            RemainingTiles.push(ItemPropertyLst[j]);
                                        }
                                        if (ItemPropertyLst[j].tile.TileId == parseInt(TileId)) {
                                            if (j == 0) {
                                                ItemPropertyLst.splice(j, 1);
                                                TileItemProperties = RemainingTiles;
                                            }
                                            else {
                                                ItemPropertyLst.splice(j, 1);
                                            }
                                        }
                                    }
                                }
                            }
                            for (var i = 0; i < $scope.RuleSetSpells.length; i++) {
                                var Spell = $scope.RuleSetSpells[i];
                                var SpellPropertyLst = Spell.SpellProperties;
                                for (var j = 0; j < SpellPropertyLst.length; j++) {
                                    var TileSpellProperties = SpellPropertyLst[j];
                                    if (SpellPropertyLst[j].ContentTypeId == null) {
                                        var RemainingTiles = [];
                                        if (j != 0) {
                                            RemainingTiles.push(SpellPropertyLst[j]);
                                        }
                                        if (SpellPropertyLst[j].tile.TileId == parseInt(TileId)) {
                                            if (j == 0) {
                                                SpellPropertyLst.splice(j, 1);
                                                TileSpellProperties = RemainingTiles;
                                            }
                                            else {
                                                SpellPropertyLst.splice(j, 1);
                                            }
                                        }
                                    }
                                }
                            }
                            for (var i = 0; i < $scope.RuleSetAbilities.length; i++) {
                                var Ability = $scope.RuleSetAbilities[i];
                                var AbilityPropertyLst = Ability.AbilityProperties;
                                for (var j = 0; j < AbilityPropertyLst.length; j++) {
                                    var TileAbilityProperties = AbilityPropertyLst[j];
                                    if (AbilityPropertyLst[j].ContentTypeId == null) {
                                        var RemainingTiles = [];
                                        if (j != 0) {
                                            RemainingTiles.push(SpellPropertyLst[j]);
                                        }
                                        if (AbilityPropertyLst[j].tile.TileId == parseInt(TileId)) {
                                            if (j == 0) {
                                                AbilityPropertyLst.splice(j, 1);
                                                TileAbilityProperties = RemainingTiles;
                                            }
                                            else {
                                                AbilityPropertyLst.splice(j, 1);
                                            }
                                        }
                                    }
                                }
                            }
                            //$scope.NewRuleSet = [];
                            //$scope.NewRuleSet = $scope.RuleSet;
                            toaster.pop('success', "Tile deleted Successfully.");
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    toaster.pop("error", data.data.ErrorMessage);
                                }
                            }
                        }
                    });
			};

			//Bing Search
			$scope.OpenBingSearch = function () {
				$scope.buttontext = "Ok";
				$scope.pageName = "Bing Image Search";
				var dlg = dialogs.create('/views/search/BingSearch.html', 'dialogGeneralSettings',
					{ btntext: $scope.buttontext, tabname: $scope.pageName, BingSearch: $scope.BingSearch }
				);
				dlg.result.then(function (res) {
					if (res != 'cancel') {
						
					}
				});

			}

            // For New Design

            $scope.RulesetGeneralSettings = function () {
                var settings = rulesetService.GetGeneralSettingsMetadata();
                settings.then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.GeneralSettingsMetadata = data.data.PayLoad.Rulesetproperty;
                        $scope.buttontext = "Next";
                        $scope.pageName = "New Rule Set";
                        var dlg = dialogs.create('/views/dialogs/rulesetgeneralsettings.html', 'dialogGeneralSettings',
							{ OpenBingSearch: $scope.OpenBingSearch,OpenFile: $scope.OpenFile, scope: $scope.GeneralSettingsMetadata, btntext: $scope.buttontext, tabname: $scope.pageName, BingSearch: $scope.BingSearch}
                        );
                        dlg.result.then(function (res) {
                            if (res != 'cancel') {
                                GetRulesets();
                                $state.go('profile.AddNewRuleSet');
                                toaster.pop("success", "Rule Set created successfully");
                                $("#loading").fadeOut("slow");
                            }
                        });
                    }
                    else if (data.data.StatusCode == 400) {
                        if (data.data.ShowToUser == true) {
                            toaster.pop("error", data.data.ErrorMessage);
                        }
                    }
                })

			}

			$scope.ManageRuleset = function (val) {
               // $("#loading").css("display", "block");
				console.log("Val: ", val);
				var editsettings = rulesetService.GetRuleSetGeneralSettings(val);
				editsettings.then(function (data) {
					console.log("editsettings: ", editsettings);
					if (data.data.StatusCode == 200) {
						$scope.GeneralSettings = data.data.PayLoad;
						$scope.buttontext = "Update";
						$scope.pageName = "Edit Rule Set";
						$scope.Disabled = "Edit";
						$scope.DisableName = true;

						//Pass the ruleset in the dialog here
						$scope.RulesetId = val;
						rulesetDataShareService.setRulesetsData($scope.RulesetId);
						var dlg = dialogs.create('/views/dialogs/manageruleset.html', 'dialogManageRuleset',
							{ scope: $scope.GeneralSettings}
						);
						dlg.result.then(function (res, Id) {
							if (res == "General") {
								$("#loading").css("display", "block");
								$scope.RulesetId = rulesetDataShareService.getRulesetsData();
								$scope.EditGeneralSettings($scope.RulesetId);
							} else if (res == "Corestat") {
								$("#loading").css("display", "block");
								$scope.RulesetId = rulesetDataShareService.getRulesetsData();
								var corestats = rulesetService.GetRulesetCorestats($scope.RulesetId);
								corestats.then(function (data) {
									$("#loading").fadeOut("slow");
									if (data.data.StatusCode == 200) {
										$scope.Corestats = data.data.PayLoad;
										rulesetService.GetTypes().then(function (data) {
											if (data.data.StatusCode == 200) {
												$scope.Types = data.data.PayLoad;
												rulesetDataShareService.setcorestat($scope.Corestats);
												for (var i = 0; i < $scope.Types.length; i++) {
													for (var j = 0; j < $scope.Corestats.length; j++) {
														if ($scope.Types[i].TypeId == $scope.Corestats[j].TypeId) {
															$scope.Corestats[j].TypeName = $scope.Types[i].Name;
														}
													}
												}
												if ($scope.Corestats.length > 0) {
													$scope.lists = true;
													$scope.list = false;
												}
												else {
													$scope.lists = false;
													$scope.list = true;
												}
												$state.go("profile.Corestats", { RuleSetId: $scope.RulesetId })
											}
											else {
												if (data.data.StatusCode == 400) {
													if (data.data.ShowToUser == true) {
														toaster.pop("error", data.data.ErrorMessage);
													}
												}
											}
										});

									}
								})
							}
							else if (res == "Items") {
								$("#loading").css("display", "block");
								$scope.RulesetId = rulesetDataShareService.getRulesetsData();
								var items = rulesetService.GetRulesetItems($scope.RulesetId);
								items.then(function (data) {
									$("#loading").fadeOut("slow");
									if (data.data.StatusCode == 200) {
										//$scope.Ruleset = data.data.PayLoad;
										$scope.RulesetItems = data.data.PayLoad;
										rulesetDataShareService.setRulesetItems($scope.RulesetItems);
										if ($scope.RulesetItems.length > 0) {
											$scope.list = true;
											$scope.grid = true;
											$scope.Itemlist = false;
										}
										else {
											$scope.list = false;
											$scope.grid = false;
											$scope.Itemlist = true;
										}
										$state.go("profile.Items", { RuleSetId: $scope.RulesetId })
									}
									else if (data.data.StatusCode == 400) {
										if (data.ShowToUser == true) {
											toaster.pop("error", data.data.ErrorMessage);
										}
									}

								})
							}
							else if (res == "Spells") {
								$("#loading").css("display", "block");
								$scope.RulesetId = rulesetDataShareService.getRulesetsData();
								var spells = rulesetService.GetRulesetSpells($scope.RulesetId);
								spells.then(function (data) {
									$("#loading").fadeOut("slow");
									if (data.data.StatusCode == 200) {
										//$scope.Ruleset = data.data.PayLoad;
										$scope.RulesetSpells = data.data.PayLoad;
										rulesetDataShareService.setRulesetSpells($scope.RulesetSpells);
										if ($scope.RulesetSpells.length > 0) {
											$scope.list = true;
											$scope.grid = true;
											$scope.Itemlist = false;
										}
										else {
											$scope.list = false;
											$scope.grid = false;
											$scope.Itemlist = true;
										}
										$state.go("profile.Spells", { RuleSetId: $scope.RulesetId })
									}
									else if (data.data.StatusCode == 400) {
										if (data.ShowToUser == true) {
											toaster.pop("error", data.data.ErrorMessage);
										}
									}

								})
							}

							else if (res == "Abilities") {
								$("#loading").css("display", "block");
								$scope.RulesetId = rulesetDataShareService.getRulesetsData();
								var abilities = rulesetService.GetRulesetAbilities($scope.RulesetId);
								abilities.then(function (data) {
									$("#loading").fadeOut("slow");
									if (data.data.StatusCode == 200) {
										//$scope.Ruleset = data.data.PayLoad;
										$scope.RulesetAbilities = data.data.PayLoad;
										rulesetDataShareService.setRulesetAbilities($scope.RulesetAbilities);
										if ($scope.RulesetAbilities.length > 0) {
											$scope.list = true;
											$scope.grid = true;
											$scope.Itemlist = false;
										}
										else {
											$scope.list = false;
											$scope.grid = false;
											$scope.Itemlist = true;
										}
										$state.go("profile.Abilities", { RuleSetId: $scope.RulesetId })
									}
									else if (data.data.StatusCode == 400) {
										if (data.ShowToUser == true) {
											toaster.pop("error", data.data.ErrorMessage);

										}
									}

								})
							}
							$("#loading").fadeOut("slow");
						})
					}
				});
                
            }

            $scope.showContextMenu = function (c) {

                var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");

                if (cardActionsHover.hasClass("hide")) {
                    cardActionsHover.removeClass("hide");
                    cardActionsHover.addClass("show");
                }
                else {
                    cardActionsHover.removeClass("show");
                    cardActionsHover.addClass("hide");
                }

            };

            $scope.hideConteextMenu = function (c) {
                var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");
                cardActionsHover.removeClass("show");
                cardActionsHover.addClass("hide");
            };

            $scope.EditGeneralSettings = function (val) {
                var editsettings = rulesetService.GetRuleSetGeneralSettings(val)
                editsettings.then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.GeneralSettings = data.data.PayLoad;
                        $scope.buttontext = "Update";
                        $scope.pageName = "Edit Rule Set";
                        $scope.Disabled = "Edit";
                        $scope.DisableName = true;
                        var dlg = dialogs.create('/views/dialogs/rulesetgeneralsettings.html', 'dialogGeneralSettings',
							{ openManageRuleset: $scope.ManageRuleset, scope: $scope.GeneralSettings, btntext: $scope.buttontext, tabname: $scope.pageName, IsenableBtn: $scope.IsButtonDisabled, CoreStatsInGrid: $scope.CoreStatsInGrid, CoreStatsNameInGrid: $scope.CoreStatsNameInGrid, CoreStatMode: $scope.OperationTypeMode, Disabled: $scope.Disabled, DisableName: $scope.DisableName, BingSearch: $scope.BingSearch}
						);

                        dlg.result.then(function (res) {
                            if (res != "cancel") {
                                // $state.go("profile.AddNewRuleSet")
                                var editedRuleSetIndex = -1;
                                for (var i = 0; i < $scope.RuleSets.length; i++) {
                                    if ($scope.RuleSets[i].Id == res[0].RulesetId) {
                                        editedRuleSetIndex = i;
                                    }
                                }
                                if (editedRuleSetIndex > -1) {
                                    $scope.RuleSets[editedRuleSetIndex].Name = res[0].RulesetName;
                                    $scope.RuleSets[editedRuleSetIndex].Rulesetproperty = res;
                                }
                                toaster.pop('success', "Ruleset Updated Successfully");
                            }
                        })
                    }
                })
            }

            $scope.CopyRuleSet = function (item) {
                item.Rulesetproperty[0].RulesetId = item.Id;
                $scope.buttontext = "Copy";
                $scope.pageName = "Copy Ruleset";
                $scope.Disabled = "Copy";
                $scope.DisableName = false;
                var dlg = dialogs.create('/views/dialogs/rulesetgeneralsettings.html', 'dialogGeneralSettings',
                    { scope: item.Rulesetproperty, btntext: $scope.buttontext, tabname: $scope.pageName, IsenableBtn: $scope.IsButtonDisabled, CoreStatsInGrid: $scope.CoreStatsInGrid, CoreStatsNameInGrid: $scope.CoreStatsNameInGrid, CoreStatMode: $scope.OperationTypeMode, Disabled: $scope.Disabled, DisableName: $scope.DisableName}
                );

                dlg.result.then(function (res) {
                    if (res != "cancel") {
                        GetRulesets();
                        //  $state.go("profile.AddNewRuleSet")
                        toaster.pop('success', res);
                    }
                })

            }


            $scope.GridViewTrigger = function (e) {
                var gridViewTrigger = angular.element(e.target);
                gridViewTrigger.parent().children().removeClass("selected");
                gridViewTrigger.addClass("selected");

                angular.element(".card-list").removeClass("view-list");
            }

            $scope.ListViewTrigger = function (e) {
                var listViewTrigger = angular.element(e.target);
                listViewTrigger.parent().children().removeClass("selected");
                listViewTrigger.addClass("selected");

                angular.element(".card-list").addClass("view-list");
            }


            $scope.showContextMenu = function (c) {

                var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");

                if (cardActionsHover.hasClass("hide")) {
                    cardActionsHover.removeClass("hide");
                    cardActionsHover.addClass("show");
                }
                else {
                    cardActionsHover.removeClass("show");
                    cardActionsHover.addClass("hide");
                }

            };


            $scope.hideConteextMenu = function (c) {
                var cardActionsHover = angular.element(c.target).parents(".card").find(".card-actions");
                cardActionsHover.removeClass("show");
                cardActionsHover.addClass("hide");
            };

            function b64toBlob(b64Data, contentType, sliceSize) {
                contentType = contentType || '';
                sliceSize = sliceSize || 512;

                var byteCharacters = atob(b64Data);
                var byteArrays = [];

                for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                    var slice = byteCharacters.slice(offset, offset + sliceSize);

                    var byteNumbers = new Array(slice.length);
                    for (var i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }

                    var byteArray = new Uint8Array(byteNumbers);

                    byteArrays.push(byteArray);
                }

                var blob = new Blob(byteArrays, { type: contentType });
                return blob;
            }

        }
    ])
})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-controllers');

    app.controller('tilePageController', ['$scope', '$q', '$state', '$timeout', '$log', 'dialogs', 'navService', 'rulesetDataShareService', 'layoutService', 'tabService','tileService',
        function ($scope, $q, $state, $timeout, $log, dialogs, navService, rulesetDataShareService, layoutService, tabService, tileService) {

            $scope.navService = navService;
            //$scope.dataService = dataService;
            debugger;
            $scope.NewLayout = rulesetDataShareService.getlayoutmetadata();
            GetAllTabs();
          
               
            
            function GetAllTabs() {
                debugger;
                tabService.GetTabs($scope.NewLayout[0].LayoutId).then(function (data) {
                    if (data.data.StatusCode == 200) {
                        $scope.LayoutTabs = data.data.PayLoad
                    }
                    else {
                        if (data.data.StatusCode == 400) {
                            if (data.data.ShowToUser == true) {
                                alert(data.data.ErrorMessage);
                            }
                        }
                    }
                });
            }
           
            var _autoPosition = false;

            var _menuOptionView = {
                id: 'nav.layouts.open',
                name: 'Switch Layout',
                icon: 'fa-fw fa-random',
                menus: []
            };

            $scope.menuHamburger = {
                opened: false,
                menus: navService.getCommonHamburger([
                    {
                        name: 'Layouts',
                        header: true,
                        icon: 'fa-fw'
                    },
                    _menuOptionView,
                    {
                        id: 'view.new',
                        name: 'New Layout',
                        action: function () {
                            layoutAdd();
                        },
                        icon: 'fa-fw fa-file-o',
                    },
                    {
                        id: 'view.rename',
                        name: 'Rename Layout',
                        action: function () {
                            layoutRename();
                        },
                        icon: 'fa-fw fa-i-cursor'
                    },
                    {
                        id: 'view.delete',
                        name: 'Delete Layout',
                        action: function () {
                            layoutDelete();
                        },
                        icon: 'fa-fw fa-trash-o',
                    },
                    {
                        id: 'view.copy',
                        name: 'Copy Layout',
                        action: function () {
                            layoutCopy();
                        },
                        icon: 'fa-fw fa-files-o'
                    },
                    {
                        name: 'Tiles',
                        header: true,
                        icon: 'fa-fw'
                    },
                    {
                        id: 'tiles.edit',
                        name: 'Edit Tiles',
                        action: function () {
                            $scope.state.tilesEditing = !$scope.state.tilesEditing;
                        },
                        icon: 'fa-fw fa-pencil-square-o',
                    },
                    {
                        name: 'Pages',
                        header: true,
                        icon: 'fa-fw'
                    },
                    {
                        id: 'tab.new',
                        name: 'New Page',
                        action: function () {
                            tabAdd();
                        },
                        icon: 'fa-fw fa-file-o',
                    },
                    {
                        id: 'tab.rename',
                        name: 'Rename Page',
                        action: function () {
                            tabRename();
                        },
                        icon: 'fa-fw fa-i-cursor'
                    },
                    {
                        id: 'tab.delete',
                        name: 'Delete Page',
                        action: function () {
                            tabDelete();
                        },
                        icon: 'fa-fw fa-trash-o',
                    },
                    {
                        id: 'tab.copy',
                        name: 'Copy Page',
                        action: function () {
                            tabCopy();
                        },
                        icon: 'fa-fw fa-files-o'
                    },
                    {
                        id: 'tab.reorder',
                        name: 'Reorder Pages',
                        action: function () {
                            tabReorder();
                        },
                        icon: 'fa-fw fa-sort'
                    }
                ]),
                menuClick: function (item) {
                    $scope.menuHamburger.opened = false;
                }
            };

            $scope.menuCharacter = {
                opened: false,
                menus: navService.getCommonCharacterNav([]),
                menuClick: function (item) {
                    $scope.menuCharacter.opened = false;
                }
            };

            navService.registerNav('hamburger', $scope.menuHamburger);
            navService.registerNav('character', $scope.menuCharacter);

            $scope.state = {
                tilesEditing: false,
                tileDragging: false,
                tileDeleteId: null
            };

            $scope.stackOptions = {
                height: 0,
                width: 100,
                cellHeight: 30,
                minWidth: 1,
                // The width, plus padding.
                pixelWidth: 35,
                verticalMargin: 5,
                alwaysShowResizeHandle: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                //alwaysShowResizeHandle: true,
                resizable: {
                    handles: 'e, se, s, sw, w'
                },
                draggable: {
                    refreshPositions: true,
                    handle: '.grid-stack-item-content'
                }
            };

            $scope.tabSet = {
                api: {},
                index: -1
            };

            //$scope.LayoutTabs =
            //    [
            //    {
            //        "name": "Main1",
            //        "tiles": [{
            //            "id": "2",
            //            "x": "12",
            //            "y": "8",
            //            "width": "4",
            //            "height": "4",
            //            "minWidth": "2",
            //            "minHeight": "2",
            //            "typeId": "2"
            //        }]
            //    },
            //    {
            //        "name": "Main2",
            //        "tiles": [{
            //            "id": "1",
            //            "x": "4",
            //            "y": "0",
            //            "width": "11",
            //            "height": "4",
            //            "minWidth": "5",
            //            "minHeight": "2",
            //            "typeId": "1"
            //        }]
            //    },
            //    {
            //        "name": "Main3",
            //        "tiles": [{
            //            "id": "3",
            //            "x": "8",
            //            "y": "8",
            //            "width": "8",
            //            "height": "0",
            //            "minWidth": "4",
            //            "minHeight": "0",
            //            "typeId":"3"
            //        }]
            //    },
            //    {
            //        "name": "Main4",
            //        "tiles": [{
            //            "id": "4",
            //            "x": "4",
            //            "y": "8",
            //            "width": "4",
            //            "height": "0",
            //            "minWidth": "2",
            //            "minHeight": "0",
            //            "typeId": "4"
            //        }]
            //    }]
            //{
            //    name: "+",
            //    action: function () {
            //        tabAdd();
            //    }
            //        //"tiles": [{
            //        //    "id": "4",
            //        //    "x": "4",
            //        //    "y": "8",
            //        //    "width": "4",
            //        //    "height": "0",
            //        //    "minWidth": "2",
            //        //    "minHeight": "0",
            //        //    "typeId": ""
            //        //}]
            //}]

            $scope.tilePickerApi = {
                messageId: null,
                beforeSelect: function () {
                },
                onClose: function () {
                }
            };

            var updateTabs = function () {
                $scope.navService.updateBody(true, $scope.LayoutTabs.length);
                $scope.tabSet.api.doRecalculate();
                $scope.tabSet.api.scrollTabIntoView();
            };

            var getActiveTab = function () {
                if ($scope.tabSet.index >= 0)
                    return LayoutTabs[$scope.tabSet.index];
                return null;
            };

            var tabsSort = function (arr) {
                (arr || []).sort(function (a, b) { return a.order - b.order; });
            };

            //var layoutLoad = function (layoutId) {

            //    $scope.state.tilesEditing = false;

            //    dataService.loadLayout(layoutId).then(function () {
                    
            //        var pageId = navService.getLastPageId(dataService.character, dataService.layout);

            //        navService
            //            .gotoLayout(dataService.character.id, dataService.layout.id, pageId, true)
            //            .transition.onSuccess({}, function () {
            //                $timeout(function () {
            //                    layoutRender();
            //                });
            //            });
            //    });
            //};

            var layoutRender = function (pageIndex) {

                //$scope.state.tilesEditing = true;
                tabsSort($scope.LayoutTabs);

                if ($scope.LayoutTabs.length) {

                    if (pageIndex || pageIndex === 0) {
                        pageIndex = Math.clamp(0, $scope.LayoutTabs - 1);                        
                    }
                    else {
                        pageIndex = 0;

                        var pageId = $state.params.pageId;
                        if (pageId) {
                            pageIndex = $scope.LayoutTabs.findIndex(function (element, index) {
                                return element.id === pageId;
                            });
                        }
                    }
                }
                else {
                    pageIndex = -1;
                }

                $scope.tabSet.index = pageIndex;
                updateTabs();
            };
            //$scope.tab = function ()
            //{
            //    $state.go('profile.addnewcharacter');
            //}
            //var layoutDelete = function () {

            //    var dlg = dialogs.confirm(
            //        'Confirm Delete',
            //        'Are you sure you want to delete this view, "' + dataService.layout.name + '", and all associated pages, tabs, and tiles?',
            //        { size: 'sm' }
            //    );

            //    dlg.result.then(
            //        function (btn) {

            //            dataService.deleteLayout(dataService.layout);
            //            dataService
            //                .saveChanges()
            //                .then(function () {
            //                    navService.gotoLayouts(dataService.character.id, true);
            //                });
            //        }
            //    );
            //};

            var layoutAdd = function () {

                var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                    { name: '' },
                    { size: 'sm' }
                );

                dlg.result.then(function (name) {
                    debugger;
                    $scope.LayoutViewModel = {
                        Name: name,
                        CharacterProfileId:1
                    }

                    layoutService.createLayout($scope.LayoutViewModel).then(function (data) {
                        if (data.data.status.StatusCode === 200) {
                            alert("Success");
                        }
                        else {
                            alert("Failed");
                        }
                    });

                    dataService.character.layouts.push(layout);
                    dataService
                        .saveChanges()
                        .then(function () {
                            layoutLoad(layout.id);
                        });
                });
            };

            //var layoutRename = function () {

            //    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
            //        { name: dataService.layout.name },
            //        { size: 'sm' }
            //    );

            //    dlg.result.then(function (name) {
            //        dataService.layout.name = name;
            //        dataService.saveChanges()
            //    });
            //};

            //var layoutCopy = function () {

            //    var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
            //        { name: dataService.layout.name },
            //        { size: 'sm' }
            //    );

            //    dlg.result.then(function (name) {

            //        var layout = dataService.copyEntity(dataService.layout);
            //        layout.name = name;

            //        dataService
            //            .saveChanges()
            //            .then(function () {
            //                layoutLoad(layout.id);
            //            });
            //    });
            //};

            var tabDelete = function () {

                var tab = getActiveTab();

                if (tab) {

                    var dlg = dialogs.confirm(
                        'Confirm Delete',
                        'Are you sure you want to delete "' + tab.name + '" and all its content?',
                        { size: 'sm' }
                    );

                    dlg.result.then(
                        function (btn) {

                            dataService.deleteTab(tab);

                            $scope.tabSet.index--;
                            if ($scope.tabSet.index === -1 && $scope.LayoutTabs.length)
                                $scope.tabSet.index = 0;

                            dataService.saveChanges();

                            $timeout(function () {
                                $scope.tabSet.api.scrollTabIntoView();
                            });
                        }
                    );
                }
            }

            var tabAdd = function () {

                var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                    { name: null },
                    { size: 'sm' }
                );

                dlg.result.then(function (name) {

                    $timeout(function () {

                        var tab = dataService.createTab({
                            name: name,
                            order: $scope.LayoutTabs.length
                        });

                        $scope.LayoutTabs.push(tab);
                        $scope.state.tilesEditing = true;

                        $timeout(function () {
                            $scope.tabSet.index = tab.order;
                            updateTabs();
                        });
                    });
                });
            };
            $scope.AddNewtab = function () {
                debugger;
                var Scope = $scope.NewLayout[0].LayoutMetaData.Tab;
                Scope.LayoutId = $scope.LayoutTabs[0].LayoutId;
                var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
                    { scope: Scope}
                );

                dlg.result.then(function (res) {
                    debugger;
                    tabService.AddTab(res).then(function (data) {
                        debugger;
                        if (data.data.StatusCode == 200) {
                            GetAllTabs();
                        }
                        else {
                            if (data.data.StatusCode == 400) {
                                if (data.data.ShowToUser == true) {
                                    alert(data.data.ErrorMessage);
                                }
                            }
                        }
                    });
                });
            }



            $scope.ShowTiles = function () {
                debugger;
                var dlg = dialogs.create('/views/dialogs/showalltiles.html', 'dialogTileTypes',
                    {}
                );
                dlg.result.then(function (res) {
                    debugger;
                });
            }


            //$scope.AddCorestatvalues = function () {
            //    debugger;
            //    $scope.characters = rulesetDataShareService.getcorestatvalue();
            //    var dlg = dialogs.create('/views/dialogs/addcorestatvalues.html', 'dialogAddCorestatValues',
            //        { scope: $scope.characters }

            //    );

            //    dlg.result.then(function (res) {
            //        debugger;
            //        var values = characterService.AddCorestatValues(res);
            //        values.then(function (data)
            //        {
            //            debugger;
            //        })

            //        //$scope.LayoutTabs.push({ "name": res });
            //    });
            //}
            //var tabRename = function () {

            //    var tab = getActiveTab();

            //    if (tab) {

            //        var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'dialogTabRename',
            //            { name: tab.name },
            //            { size: 'sm' }
            //        );

            //        dlg.result.then(function (name) {
            //            tab.name = name;
            //            dataService.saveChanges()
            //        });
            //    }
            

            var tabCopy = function () {

                var dlg = dialogs.create('/views/dialogs/tab-rename.html', 'addNewCoreStat',
                    { name: 'Add New Core Stat' },
                    { size: 'sm' }
                );

                dlg.result.then(function (name) {
                    // Shuffle the order of the other tabs. The copy will add it to the backing array.
                  
                });
            };

            var tabReorder = function () {
                debugger;
                var tab = getActiveTab(),
                    currentIdx = $scope.tabSet.index;

                var dlg = dialogs.create('/views/dialogs/tab-reorder.html', 'dialogTabReorder',
                    {
                        items: $scope.NewLayout.TabList,
                        sorter: tabsSort
                    },
                    { size: 'sm', copy: false }
                );

                dlg.result.then(function (items) {

                    $timeout(function () {

                        items.forEach(function (item, idx) {
                            item.order = idx;
                            if (item === tab)
                                currentIdx = idx;
                        });

                        tabsSort($scope.NewLayout.TabList);
                        $scope.tabSet.index = currentIdx;

                        updateTabs();

                    });
                });
            }

            $scope.getTileClass = function (tile) {

                var arr = [];

                if ($scope.state.tilesEditing)
                    arr.push(tile.__randomShake);

                if (tile.id === $scope.state.tileDeleteId)
                    arr.push('over-delete');

                return arr.join(' ');
            };

            $scope.getAutoPosition = function (tile) {
                var x = tile.id > 0 ? false : _autoPosition;
                return x;
            };

            $scope.tileSelect = function (tile) {
                if ($scope.tilePickerApi.selecting)
                    $scope.tilePickerApi.endSelect(tile);
            };

            $scope.tileEdit = function () {
                $scope.tilePickerApi.beginSelect(function (tile) {
                   // tileService.edit(tile, true).then(function () {
                        // Nothing to do
                    //});
                });
            }

            //$scope.tileAdd = function () {

            //    tileService.add().then(function (tile) {

            //        _autoPosition = true;

            //        var tab = getActiveTab();

            //        tile.tabId = tab.id;
            //        tab.tiles.push(tile);

            //        $timeout(function () {
            //            _autoPosition = false;
            //        });
            //    });
            //};

            //$scope.onDragStart = function (event, ui) {
            //    $timeout(function () {
            //        $scope.state.tileDragging = true;
            //    });
            //};

            //$scope.onDragStop = function (event, ui) {
            //    $timeout(function () {
            //        $scope.state.tileDragging = false;
            //    });
            //};

            //$scope.onDeleteDrop = function (event, ui) {
            //    var tile = GridStackUI.Utils.getNodeData(ui.helper);
            //    if (tile)
            //        dataService.deleteTile(tile);
            //};

            //$scope.onDeleteOver = function (event, ui) {
            //    var node = GridStackUI.Utils.getNodeData(ui.helper);
            //    if (node) {
            //        $timeout(function () {
            //            $scope.state.tileDeleteId = node.id;
            //        });
            //    }
            //};

            //$scope.onDeleteOut = function (event) {
            //    if ($scope.state.tileDeleteId) {
            //        $timeout(function () {
            //            $scope.state.tileDeleteId = null;
            //        });
            //    }
            //};

            //$scope.onTabSelected = function (tab, index) {

            //    //console.log('onTabSelected');
                
            //    //if (tab && tab.id) {
            //    //    navService.setLastTabId(dataService.character.id, dataService.layout.id, tab.id);
            //    //    navService.gotoLayout(dataService.character.id, dataService.layout.id, tab.id, true);
            //    //}
            //};

            //$scope.saveChanges = function () {
            //    $scope.state.tilesEditing = false;
            //    return dataService.saveChanges();
            //};

            (function () {

                $scope.navService.updateBody(true, true);
                $scope.state.tilesEditing = false;

                //rpgsmith.fillArray(dataService.character.layouts, _menuOptionView.menus, function (layout) {
                //    return {
                //        id: 'view.load',
                //        context: layout,
                //        name: layout.name,
                //        action: function (item) {
                //            layoutLoad(item.context.id);
                //        },
                //        icon: 'fa-fw'
                //    };
                //});

                $timeout(function () {
                    layoutRender();
                });

            })();
        }
    ]);

})();
(function () {
	'use strict';

	var app = angular.module('rpgsmith-directives');

	app.directive('rpgsmithrulesettype', ['$compile', 'dialogs', function ($compile, dialogs) {
		var templateUrl1_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<input type="text" placeholder="Enter {{info.Name}}" class="form-control" ng-model="info.Value.Text.value" name="input" />';
		'</div>' +
			'</ng-form>';
		var templateUrl1 = '<div class="form-group"><input type="text" ng-model="info.Value.Text.value" class="form-control" placeholder="Enter {{info.Name}} value"></div>';
		//var templateUrl7 = '<select class="form-control inline" ng-options="unit for unit in info.Value.Weight.units.availableUnits" ng-model="info.Units.selectedUnit" >' +
		//    '<option value="">--Select--</option></select>';
		//var templateUrl7_withvalidation =
		//    '<ng-form name="form">' +
		//    '<div class="form-group">' +
		//    '<span ng-show="form.input.$invalid">' +
		//    '</span>' +
		//    '<select class="select_dropdown form-control inline" ng-options="unit for unit in info.Value.Weight.units.availableUnits" ng-model="info.Units.selectedUnit" name="input"  ng-required="info"> ' +
		//    '<option value="">--Select--</option></select>' +
		//    '</div>' +
		//    '</ng-form>';

		var templateUrl7 = '<div class="form-group"><input type="text"  ng-model="info.Units.selectedUnit" placeholder="Enter {{info.Name}}" class="form-control"/></div>';
		var templateUrl7_withvalidation =
			'<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<div class="form-group"><input type="text"  ng-model="info.Units.selectedUnit" placeholder="Enter {{info.Name}}" class="form-control"/></div>' +
			'</div>' +
			'</ng-form>';

		//var templateUrl8 = '<div class="pull-left edit-character-portrait"><img id="GeneralStngImage" ng-src="{{info.Value.Image.image}}" ng-model="info.Value.Image.image" alt="RuleSet Image" ngf-resize="{width: 120, height: 120}" /></div><div class="profile_image"><span>Choose Portrait</span><input type="file" name="file" onchange="angular.element(this).scope().ItemImageUpload(this)" accept="x-png,gif,jpeg"/></div>';
		var templateUrl8 = '<div class="form-group input-image"><div class="input-image-control-wrapper"><div class="input-image-note icon icon-upload"><span ng-model="info.Value.Image.image">Click here to upload.</span><small>(320 x 320 px)</small></div><input type="file"  class="form-control-file"  onchange="angular.element(this).scope().ItemImageUpload(this)" accept="x-png,gif,jpeg"></div></div>';
		var templateUrl8_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<div class="form-group input-image"><div class="input-image-control-wrapper"><div class="input-image-note icon icon-upload"><span ng-model="info.Value.Image.image">Click here to upload.</span><small>(320 x 320 px)</small></div><input type="file"  class="form-control-file"  onchange="angular.element(this).scope().ItemImageUpload(this)" accept="x-png,gif,jpeg"></div></div>';
		//'<div class="pull-left edit-character-portrait"><img id="GeneralStngImage" ng-src="{{info.Value.Image.image}}" name="input" ng-model="info.Value.Image.image" alt="RuleSet Image" ngf-resize="{width: 120, height: 120}" /></div><div class="profile_image"><span>Choose Portrait</span><input type="file" rpgsmithtype="info.Value.Image.image" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" onchange="angular.element(this).scope().ItemImageUpload(this)" accept="x-png,gif,jpeg" /> </div>';
		'</div>' +
			'</ng-form>';


		var templateUrl15 = '<span class="input-group-btn"><button type="button" title="" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary" data-original-title="Show Dice" ng-click="defaultDiceSelect()"></button></span><input type="text" ng-model="info.Value.DefaultDice.value" class="form-control" placeholder="Select dice">';
		var templateUrl15_withvalidation =
			'<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<span class="input-group-btn"><button type="button" title="" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary" data-original-title="Show Dice" ng-click="defaultDiceSelect()"></button></span><input type="text" ng-model="info.Value.DefaultDice.value" class="form-control" placeholder="Select dice">';
		'</div>' +
			'</ng-form>';

		var getTemplate = function (contentType, IsMandatory) {
			var template = '';

			switch (contentType) {
				case 1:
					if (IsMandatory == true) {
						template = templateUrl1_withvalidation;
					}
					else {
						template = templateUrl1;
					}
					break;
				case 2:
					template = templateUrl2;
					break;
				case 3:
					template = templateUrl3;
					break;
				case 4:
					template = templateUrl4;
					break;
				case 5:
					template = templateUrl5;
					break;
				case 6:
					template = templateUrl6;
					break;
				case 7:
					if (IsMandatory == true) {
						template = templateUrl7_withvalidation;
					}
					else {
						template = templateUrl7;
					}
					break;
				//case 8:
				//    template = templateUrl8;
				//    break;

				case 8:

					if (IsMandatory == true) {
						template = templateUrl8_withvalidation;
					}
					else {
						template = templateUrl8;
					}
					break;

				case 12:
					template = templateUrl12;
					break;
				case 13:
					template = templateUrl13;
					break;
				case 14:
					template = templateUrl14;
					break;
				case 15:
					if (IsMandatory == true) {
						template = templateUrl15_withvalidation;
					}
					else {
						template = templateUrl15;
					}
					break;
			}

			return template;
		};


		var linker = function (scope, element, attrs) {
			debugger;

			var items = angular.copy(scope.info);

			element.html(getTemplate(items.TypeId, items.IsMandatory));

			$compile(element.contents())(scope);

			scope.defaultDiceSelect = function () {
				debugger;
				var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
					{ "mode": 1 }
				);
				dlg.result.then(function (res) {
					debugger;
					//    scope.dice = res;
					scope.info.Value.DefaultDice.value = res;
				});
			};
			scope.getThumbNail = function () {
				if (scope.file)
					return $scope.file;

				var c = scope.item;
				if (c.id && c.portrait)
					return '/characterdata/' + c.id + '/' + c.portrait;

				return null;
			}
			//scope.uploadFile = function (input) {
			//    debugger;
			//    for (var file = 0; file < input.length; file++) {
			//        scope.info.Value.Image.image = input[file];
			//    }
			//}
			scope.ItemImageUpload = function (input) {
				debugger
				if (input.files && input.files[0]) {
					var reader = new FileReader();
					reader.onload = function (e) {
						$('#GeneralStngImage')
							.attr("Src", e.target.result)
							.width(120)
							.height(120);
						scope.info.Value.Image.image = e.target.result;
					};

					reader.readAsDataURL(input.files[0]);
				}

			}
		};

		return {
			restrict: "E",
			replace: true,
			link: linker,
			scope: {
				info: '='
			}
		}
	}]);


})();
(function () {
	'use strict';

	var app = angular.module('rpgsmith-directives');

	app.directive('rpgsmithtype', ['$compile', 'dialogs', function ($compile, dialogs) {

		var templateUrl1_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.itemname.$invalid">' +
			'</span>' +
			'<input type="text" ng-disabled="DisableField" placeholder="Enter {{info.Name}}" name="itemname" id="itemname" class="form-control text-line" ng-model="info.Value.Text.value" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" > ' +
			'</div>' +
			'</ng-form>';

		var templateUrl1 = ' <input type="text" ng-disabled="DisableField" placeholder="Enter {{info.Name}}" class="form-control" ng-model="info.Value.Text.value" />';
		var templateUrl7 = '<input type="number" min=0 class="form-control inline" ng-model="info.Value.Weight.value" placeholder="Enter {{info.Name}}"  ng-disabled="DisableField"  /> ' +
			'<input type="text"  ng-model="info.Value.Weight.units.selectedUnit " ng-disabled="DisableField" placeholder="Enter {{info.Name}}" class="form-control inline_old" readonly/>';
		var templateUrl7_withvalidation =
			'<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.weight.$invalid">' +
			'</span>' +
			'<input type="number" name="weight" id="weight" min=0 class="form-control inline" ng-disabled="DisableField" ng-model="info.Value.Weight.value" placeholder="Enter {{info.Name}}"  ng-disabled="DisableField" /> ' +
			'<input type="text" placeholder="Enter {{info.Name}}" ng-model="info.Value.Weight.units.selectedUnit" class="form-control inline_old" readonly/>' +
			'</div>' +
			'</ng-form>';
		//var templateUrl7 = '<input type="number" class="form-control inline" ng-model="info.Value.Weight.value" placeholder="Weight"/> ' +
		//    '<select class="form-control inline" ng-options="unit for unit in info.Value.Weight.units.availableUnits" ng-model="info.Value.Weight.units.selectedUnit" >' +
		//    '<option value="">--Select--</option></select>';
		//var templateUrl7_withvalidation = '<ng-form name="form">' +
		//    '<div class="form-group">' +
		//    '<span ng-show="form.input.$invalid">' +
		//    '</span>' +
		//    '<input type="number" class="form-control inline" ng-model="info.Value.Weight.value" placeholder="Weight"/> ' +
		//    '<select class="form-control inline" ng-options="unit for unit in info.Value.Weight.units.availableUnits" ng-model="info.Value.Weight.units.selectedUnit" name="input" >' +
		//    '<option value="">--Select--</option></select>';
		//'</div>' +
		//    '</ng-form>';
		var templateUrl3 = '<div class="btn-group" data-toggle=""><label class="btn btn-primary"><input type= "radio" ng-model="info.Value.OnOrOff.value"" value= "On" />On</label > <label class="btn btn-default"><input type="radio" ng-model="info.Value.OnOrOff.value" value="Off" ng-disabled="DisableField" />Off</label></div >';
		var templateUrl3_withvalidation = '<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<div class="btn-group" data-toggle=""><label class="btn btn-primary"><input type="radio"  name="input" ng-model="info.Value.OnOrOff.value"" value= "On" />On</label > <label class="btn btn-default"><input type="radio" ng-model="info.Value.OnOrOff.value" value="Off" ng-disabled="DisableField" />Off</label></div >';
		'</div>' +
			'</ng-form>';

		//var templateUrl4 = '<ul class="input-list-items" style="height:auto;"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox"><span ng-model="info.Value.YesOrNo.value"><em class="icon icon-with-text icon-visible icon-rsi">{{property.Name}}</em><i class="icon"></i></span></label></li></ul>';

		var templateUrl4 = '<ul class="input-switch-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" ng-model="info.Value.YesOrNo.value" value="Yes" ng-disabled="DisableField"><span>Yes</span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio" ng-model="info.Value.YesOrNo.value" value="No" ng-disabled="DisableField"><span>No</span></label></li></ul>';

		var templateUrl4_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<div class="btn-group" data-toggle=""><label class="btn btn-primary"><input type= "radio" name="input" ng-model="info.Value.YesOrNo.value"" value= "Yes" ng-disabled="DisableField" />Yes</label > <label class="btn btn-default"><input type="radio" name="input"  ng-model="info.Value.YesOrNo.value" value="No" ng-disabled="DisableField"/>No</label></div >';
		'</div>' +
			'</ng-form>';
		var templateUrl12 = '<input type="number" min=0 class="form-control inline" ng-model="info.Value.Height.value" placeholder="Enter {{info.Name}}" ng-disabled="DisableField"/> ' +
			'<select class="form-control inline" ng-options="unit for unit in info.Value.Height.units.availableUnits" ng-model="info.Value.Height.units.selectedUnit" >' +
			'<option value="">--Select--</option></select>';
		var templateUrl12_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<input type="number" min=0 class="form-control inline" name="input" ng-model="info.Value.Height.value" placeholder="Enter {{info.Name}}" ng-disabled="DisableField"/> ' +
			'<select class="form-control inline" ng-options="unit for unit in info.Value.Height.units.availableUnits" ng-model="info.Value.Height.units.selectedUnit" >' +
			'<option value="">--Select--</option></select>';
		'</div>' +
			'</ng-form>';
		var templateUrl5 = '<input type="number" min=0 class="form-control inline" ng-model="info.Value.ValueAndSubValue.value" placeholder="Enter {{info.Name}}" />&nbsp;&nbsp;<input type="number" min=0 class="form-control inline" ng-model="info.Value.ValueAndSubValue.subvalue" placeholder="Enter {{info.Name}}" ng-disabled="DisableField" />';
		var templateUrl5_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<input type="number" min=0 class="form-control inline" name="input" ng-model="info.Value.ValueAndSubValue.value" placeholder="Enter {{info.Name}}" ng-disabled="DisableField"/>&nbsp;&nbsp;<input type="number" min=0 class="form-control inline" ng-model="info.Value.ValueAndSubValue.subvalue" placeholder="Enter {{info.Name}}" />';
		'</div>' +
			'</ng-form>';
		var templateUrl6 = '<input type="number" min=0 ng-model="info.Value.CurrentAndMaxValue.CurrentValue" class="form-control inline" placeholder="Enter {{info.Name}}" />&nbsp;&nbsp;<input class="form-control inline" type="number" min=0 ng-model="info.Value.CurrentAndMaxValue.MaxValue" placeholder="Enter {{info.Name}}" ng-disabled="DisableField" />';
		var templateUrl6_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<input type="number" min=0 name="input" ng-model="info.Value.CurrentAndMaxValue.CurrentValue" class="form-control inline" placeholder="Enter {{info.Name}}" ng-disabled="DisableField" />&nbsp;&nbsp;<input class="form-control inline" type="number" min=0 ng-model="info.Value.CurrentAndMaxValue.MaxValue" placeholder="Enter {{info.Name}}" />';
		'</div>' +
			'</ng-form>';
		var templateUrl8 = '<div class="text edit-character-portrait"><img id="itemImage" ng-src="{{info.Value.Image.image}}" ng-model="info.Value.Image.image" alt="Character Image" ngf-thumbnail="getThumbNail()" ngf-resize="{width: 120, height: 120}" ng-disabled="DisableField" /></div><div class="profile_image"><span>Choose Portrait</span><input type="file" onchange="angular.element(this).scope().ItemImageUpload(this)" accept="x-png,gif,jpeg" ng-disabled="DisableField" /> </div>';
		//var templateUrl8 = '<div class="form-group input-image"><div class="input-image-control-wrapper" style="height:100px;"><div class="input-image-note icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div><input type="file" id="newItemImageFile" class="form-control-file" ng-src="{{info.Value.Image.image}}" ng-model="info.Value.Image.image" alt="" ngf-thumbnail="getThumbNail()" ngf-resize="{width: 120, height: 120}"></div></div>';
		var templateUrl8_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<div class="pull-left edit-character-portrait"><img id="itemImage" ng-src="{{info.Value.Image.image}}" name="input" ng-model="info.Value.Image.image" alt="" ngf-thumbnail="getThumbNail()" ngf-resize="{width: 120, height: 120}" ng-disabled="DisableField" /></div><div class="profile_image"><span></span><input type="file" rpgsmithtype="info.Value.Image.image" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" onchange="angular.element(this).scope().ItemImageUpload(this)" accept="x-png,gif,jpeg" ng-disabled="DisableField" /> </div>';
		'</div>' +
			'</ng-form>';
		//var templateUrl13 = '<div class="col-sm-9 tab_more" style="padding:0px"><input type="number" class="form-control inline" ng-model="info.Value.Volume.lenghtvalue" placeholder="Enter {{info.Name}}"/><input type="number" class="form-control inline" ng-model="info.Value.Volume.heightvalue" placeholder="Enter {{info.Name}}"/><input type="number" class="form-control inline" ng-model="info.Value.Volume.depthvalue" placeholder="Depth"/><select class="form-control" ng-options="unit for unit in info.Value.Volume.units.availableUnits" ng-model="info.Value.Volume.units.selectedUnit"><option value="">--Select--</option></select></div>';
		//var templateUrl3_withvalidation = '<div class="form-group">' +
		//    '<span ng-show="form.input.$invalid">' +
		//    '</span>' +
		//    '<div class="col-sm-9 tab_more" style="padding:0px"><input type="number" class="form-control inline" name="input" ng-model="info.Value.Volume.lenghtvalue" placeholder="Enter {{info.Name}}"/><input type="number" class="form-control inline" ng-model="info.Value.Volume.heightvalue" placeholder="Enter {{info.Name}}"/><input type="number" class="form-control inline" ng-model="info.Value.Volume.depthvalue" placeholder="Depth"/><select class="form-control" ng-options="unit for unit in info.Value.Volume.units.availableUnits" ng-model="info.Value.Volume.units.selectedUnit"><option value="">--Select--</option></select></div>';
		//'</div>' +
		//    '</ng-form>';
		var templateUrl13 = '<div class="form-group"><div class="form-row"><div class="col"><input type="number" min=0 class="form-control" ng-model="info.Value.Volume.lenghtvalue" placeholder="Enter {{info.Name}}" ng-disabled="DisableField"></div><div class="col"><input type="number" min=0 class="form-control" ng-model="info.Value.Volume.heightvalue" placeholder="Enter {{info.Name}}" ng-disabled="DisableField" ></div><div class="col"><input type="number" min=0 class="form-control" ng-model="info.Value.Volume.depthvalue" placeholder="Depth {{info.Name}}" ng-disabled="DisableField" ></div><div class="col"><input type="text" placeholder="Enter {{info.Name}}" ng-model="info.Value.Volume.units.selectedUnit" class="form-control" ng-disabled="DisableField" readonly></div></div></div>';
		var templateUrl3_withvalidation = '<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<div class="" ><input type="number" ng-disabled="DisableField" min=0 class="form-control inline" name="input" ng-model="info.Value.Volume.lenghtvalue" placeholder="Enter {{info.Name}}"/><input type="number" min=0 class="form-control inline" ng-model="info.Value.Volume.heightvalue" placeholder="Enter {{info.Name}}" ng-disabled="DisableField"/><input type="number" min=0 class="form-control inline" ng-model="info.Value.Volume.depthvalue" placeholder="Depth" ng-disabled="DisableField" /><input type="text" placeholder="Enter {{info.Name}}" ng-model="info.Value.Volume.units.selectedUnit" class="form-control inline_old" ng-disabled="DisableField" readonly/></div>';
		'</div>' +
			'</ng-form>';
		var templateUrl14 = '<input type="number" min=0 ng-model="info.Value.Number.value" placeholder="Enter {{info.Name}}" class="form-control inline_width" ng-disabled="DisableField" />';

		var templateUrl14_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.quantityinput.$invalid">' +
			'</span>' +
			'<input type="number" min=0 placeholder="Enter {{info.Name}}" name="quantityinput" class="select_dropdown form-control inline_width" ng-model="info.Value.Number.value" name="input"  ng-required="info" ng-disabled="DisableField"/> ' +
			'</div>' +
			'</ng-form>';

		var templateUrl2 = '<ul class="input-switch-items"><li class="form-check" ng-repeat="choice in info.Value.Choices.choices"><label class="form-check-label"><input class="form-check-input" ng-model="info.Value.Choices.selectedchoice" type="radio" ng-disabled="DisableField" name="newItemRarity" checked="checked"><span>{{choice.ChoiceName}}</span></label></li></ul>'
		var templateUrl2_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<select class="form-control" ng-options="choice.ChoiceName for choice in info.Value.Choices.choices" ng-model="info.Value.Choices.selectedchoice"><option value="">--Select--</option></select>' +
			'</div>' +
			'</ng-form>';

		var templateUrl15 = '<input type="text" ng-disabled="DisableField" placeholder="Enter {{info.Name}}" class="form-control" ng-model="info.Value.DefaultDice.value" /><button type="button" title= "" data-toggle="tooltip" class="select_dice btn icon icon-dice icon-rsi btn-simple-primary" data-original-title="Show Dice" ng-click="defaultDiceSelect()" ng-disabled="DisableField"></button>';

		var templateUrl15_withvalidation =
			'<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<input type="text" ng-disabled="DisableField" placeholder="Enter {{info.Name}}" class="form-control" ng-model="info.Value.DefaultDice.value" /><button type="button" title= "" data-toggle="tooltip" class="select_dice btn icon icon-dice icon-rsi btn-simple-primary" data-original-title="Show Dice" ng-click="defaultDiceSelect()" ng-disabled="DisableField"></button>';
		'</div>' +
			'</ng-form>';
		var templateUrl19_withvalidation = '<ng-form name="form">' +
			'<div class="form-group">' +
			'<span ng-show="form.input.$invalid">' +
			'</span>' +
			'<textarea placeholder="Enter {{info.Name}}" ng-disabled="DisableField" class="form-control text-line" ng-model="info.Value.Text.value" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" ></textarea> ' +
			'</div>' +
			'</ng-form>';

		var templateUrl19 = ' <textarea placeholder="Enter {{info.Name}}" ng-disabled="DisableField" class="form-control" ng-model="info.Value.Text.value"></textarea>';

		var templateUrl20 = ' <textarea placeholder="Enter {{info.Name}}" ng-disabled="DisableField" class="form-control" ng-model="info.Value.Text.value"></textarea>';

		//var templateUrl16 = '<input type="text" ng-model="info.Value.Calculation.formulae" class="form-control" disabled/>' 
		//var templateUrl16_withvalidation = '<ng-form name="form">' +
		//    '<div class="form-group">' +
		//    '<span ng-show="form.input.$invalid">' +
		//    '</span>' +
		//    '<input type="text" class="form-control" ng-model="info.Value.Calculation.formulae" ng-required="info" disabled/> ' +
		//    '</div>' +
		//    '</ng-form>';


		var linker = function (scope, element, attrs) {

			var items = angular.copy(scope.info);
			var mode = angular.copy(attrs.mode);

			if (mode != undefined) {
				if (mode == "'Edit'") {
					if (items.TypeId == 1 && items.Name == "Name") {
						scope.DisableField = true;
					}
				}
				if (mode == "'Copy'") {
					if (items.TypeId == 1 && items.Name == "Name") {
						scope.info.Value.Text.value = "";

					}
					else {
						scope.DisableField = true;
					}

				}
				if (mode == "'Create'") {
					if (items.TypeId == 1 && items.Name == "Name") {
						scope.DisableField = false;
					}
				}
			}

			var Calculation = function (FormulaVal, fullscope) {
				var FormlaForCalculate = FormulaVal;
				var WeightRes = '';
				var QuantityRes = '';
				var ArrayList = [];

				for (var i = 0; i < FormulaVal.length; i++) {

					if (FormulaVal[i] == '[' || FormulaVal[i] == ']');
					{
						var Result = '';
						var Str = FormulaVal.substring(i + 1, FormulaVal.length);

						if (FormulaVal[i] == '[') {
							var Result = '';
							for (var j = 0; j < Str.length; j++) {
								if (Str[j] == ']') {
									ArrayList.push(Result);
									break;
								}
								else {
									Result = Result + Str[j];
									i = i + 1;
								}
							}
						}
					}
				}

				//FormlaForCalculate = FormlaForCalculate.replace('[', '');
				//FormlaForCalculate = FormlaForCalculate.replace(']', '');
				FormlaForCalculate = FormlaForCalculate.replace(/\[/g, '');
				FormlaForCalculate = FormlaForCalculate.replace(/\]/g, '');

				for (var i = 0; i < ArrayList.length; i++) {
					for (var j = 0; j < fullscope.length; j++) {
						if ((ArrayList[i] == fullscope[j].Name || ArrayList[i] == fullscope[j].CorestatName)) {
							if ((ArrayList[i] == fullscope[j].Name || ArrayList[i] == fullscope[j].CorestatName) && fullscope[j].TypeId == 7) {
								FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.Weight.value");
							}
							else if ((ArrayList[i] == fullscope[j].Name || ArrayList[i] == fullscope[j].CorestatName) && fullscope[j].TypeId == 14) {
								FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.Number.value");
								//FormlaForCalculate = parseInt(FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.Number.value"));
							}
							else if ((ArrayList[i] == fullscope[j].Name || ArrayList[i] == fullscope[j].CorestatName) && fullscope[j].TypeId == 5) {
								FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.ValueAndSubValue.value");
								//FormlaForCalculate = parseInt(FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.Number.value"));
							}
							else if ((ArrayList[i] == fullscope[j].Name || ArrayList[i] == fullscope[j].CorestatName) && fullscope[j].TypeId == 6) {
								FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.CurrentAndMaxValue.CurrentValue");
								//FormlaForCalculate = parseInt(FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.Number.value"));
							}
							//else if (ArrayList[i] == fullscope[j].CorestatName && fullscope[j].TypeId == 5) {
							//    if (fullscope[j].CorestatName.indexOf('.Value') > -1) {
							//        FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.ValueAndSubValue.value");
							//    }
							//    else if (fullscope[j].CorestatName.indexOf('.SubValue') > -1) {
							//        FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.ValueAndSubValue.subvalue");
							//    }
							//}
							//else if (ArrayList[i] == fullscope[j].CorestatName && fullscope[j].TypeId == 6) {
							//    if (fullscope[j].CorestatName.indexOf('.CurrentValue') > -1) {
							//        FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.CurrentAndMaxValue.CurrentValue");
							//    }
							//    else if (fullscope[j].CorestatName.indexOf('.MaxValue') > -1) {
							//        FormlaForCalculate = FormlaForCalculate.replace(ArrayList[i], "fullscope[" + j + "].Value.CurrentAndMaxValue.MaxValue");
							//    }
							//}
						}
					}
				}

				return FormlaForCalculate;
			}


			var getTemplate = function (contentType, IsMandatory) {

				var template = '';
				switch (contentType) {
					case 1:
						if (IsMandatory == true) {
							template = templateUrl1_withvalidation;
						}
						else {
							template = templateUrl1;
						}
						break;
					case 2:
						if (IsMandatory == true) {
							template = templateUrl2_withvalidation;
						}
						else {
							template = templateUrl2;
						}
						break;
					case 3:
						if (IsMandatory == true) {
							template = templateUrl3_withvalidation;
						}
						else {
							template = templateUrl3;
						}
						break;

					case 4:

						if (IsMandatory == true) {
							template = templateUrl4_withvalidation;
						}
						else {
							template = templateUrl4;
						}
						break;
					case 5:
						if (IsMandatory == true) {
							template = templateUrl5_withvalidation;
						}
						else {
							template = templateUrl5;
						}
						break;
					case 6:
						if (IsMandatory == true) {
							template = templateUrl6_withvalidation;
						}
						else {
							template = templateUrl6;
						}
						break;
					case 7:
						if (IsMandatory == true) {
							template = templateUrl7_withvalidation;
						}
						else {
							template = templateUrl7;
						}
						break;

					case 8:

						if (IsMandatory == true) {
							template = templateUrl8_withvalidation;
						}
						else {
							template = templateUrl8;
						}
						break;
					case 12:
						if (IsMandatory == true) {
							template = templateUrl12_withvalidation;
						}
						else {
							template = templateUrl12;
						}
						break;
					case 13:
						if (IsMandatory == true) {
							template = templateUrl13_withvalidation;
						}
						else {
							template = templateUrl13;
						}
						break;
					case 14:
						if (IsMandatory == true) {
							template = templateUrl14_withvalidation;
						}
						else {
							template = templateUrl14;
						}
						break;
					case 15:
						if (IsMandatory == true) {
							template = templateUrl15_withvalidation;
						}
						else {
							template = templateUrl15;
						}
						break;
					case 16:
						//    if (IsMandatory == true) {
						//        template = templateUrl16_withvalidation;
						//    }
						//    else {
						//        template = templateUrl16;
						//    }
						//    break;
						var templateUrl16 = '{{' + Calculation(scope.info.Value.Calculation.formulae, scope.fullscope) + '}}';
						var templateUrl16_withvalidation = '{{' + Calculation(scope.info.Value.Calculation.formulae, scope.fullscope) + '}}';

						if (IsMandatory == true) {
							template = templateUrl16_withvalidation;
						}
						else {
							template = templateUrl16;
						}
						break;
					case 19:
						if (IsMandatory == true) {
							template = templateUrl19_withvalidation;
						}
						else {
							template = templateUrl19;
						}
						break;

				}

				return template;
			};



			element.html(getTemplate(items.TypeId, items.IsMandatory));

			$compile(element.contents())(scope);
			scope.getThumbNail = function () {
				if (scope.file)
					return $scope.file;

				var c = scope.item;
				if (c.id && c.portrait)
					return '/characterdata/' + c.id + '/' + c.portrait;

				return null;
			}

			scope.defaultDiceSelect = function () {
				var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
					{ "mode": 1 }
				);
				dlg.result.then(function (res) {
					//    scope.dice = res;
					scope.info.Value.DefaultDice.value = res;
				});
			};
			//scope.uploadFile = function (input) {
			//    debugger;
			//    for (var file = 0; file < input.length; file++) {
			//        scope.info.Value.Image.image = input[file];
			//    }
			//    var file = $('input[type=file]').val(); 
			//    var clientImage =  getBase64(file);
			//    scope.info.Value.Image.clientImage = clientImage;
			//};
			function getBase64(file) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = function () {
					return reader.result;
				};
				reader.onerror = function (error) {
					console.log('Error: ', error);
				};
			}
			scope.ItemImageUpload = function (input) {
				
				if (input.files && input.files[0]) {
					var reader = new FileReader();
					reader.onload = function (e) {
						$('#itemImage')
							.attr("Src", e.target.result)
							.width(120)
							.height(120);
						scope.info.Value.Image.image = e.target.result;
					};

					reader.readAsDataURL(input.files[0]);
				}

			}
		};

		return {
			restrict: "E",
			replace: true,
			link: linker,
			scope: {
				info: '=',
				fullscope: '=',
				mode: '='
			}
		}
	}]);


})();
(function () {
    'use strict';

    var app = angular.module('rpgsmith-directives');

    app.directive('rpgsmithcontenttype', ['$compile', 'dialogs', 'characterService', function ($compile, dialogs, characterService) {
        var templateUrl1 = '<button type="button" class="btn btn-accent btn_align" ng-model="" name="input">{{info.Name}}</button>';
        var templateUrl0 = '<button type="button" class="btn btn-accent btn_align" ng-model="" name="input" ng-click="UpdateEquip()">{{info.Name}}</button>';
        var getTemplate = function (contentType, IsMandatory) {.0
            var template = '';

            switch (contentType) {
                case false:
                        template = templateUrl1;
                    break;
                case true:
                    template = templateUrl0;
                    break;
            }

            return template;
        };


        var linker = function (scope, element, attrs) {

            var items = angular.copy(scope.info);
            if (items.TypeId == 3 || items.TypeId == 4) {
                if (items.IsAction == true) {
                    if (items.Value.YesOrNo.value == "Yes" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {

                        element.html(getTemplate(items.IsAction));
                        $compile(element.contents())(scope);
                        items.Name = "UnEquipped";
                    }
                    else if (items.Value.YesOrNo.value == "No" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {

                        element.html(getTemplate(items.IsAction));
                        $compile(element.contents())(scope);
                        items.Name = "Equipped";
                    }

                }
            }
            scope.UpdateEquip = function () {
                //var CharacterItemValueId = scope.info.CharacterItemValueId;
                if (scope.info.CharacterItemValueId != undefined) {
                    if (scope.info.Value.YesOrNo.value == "Yes" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {
                        scope.info.Value.YesOrNo.value = "No";
                        characterService.UpdateItemEquipContent(scope.info).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                if (items.IsAction == true) {
                                    scope.info.Name = "Equipped";
                                    element.html(getTemplate(items.IsAction));
                                    $compile(element.contents())(scope);
                                }
                            }
                        })
                    }
                    else if (scope.info.Value.YesOrNo.value == "No" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {
                        scope.info.Value.YesOrNo.value = "Yes";
                        characterService.UpdateItemEquipContent(scope.info).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                if (items.IsAction == true) {
                                    scope.info.Name = "UnEquipped";
                                    element.html(getTemplate(items.IsAction));
                                    $compile(element.contents())(scope);
                                }
                            }
                        })
                    }
                }
                else if (scope.info.CharacterSpellValueId != undefined) {
                    if (scope.info.Value.YesOrNo.value == "Yes" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {
                        scope.info.Value.YesOrNo.value = "No";
                        characterService.UpdateSpellMemorizeContent(scope.info).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                if (items.IsAction == true) {
                                    scope.info.Name = "Memorized";
                                    element.html(getTemplate(items.IsAction));
                                    $compile(element.contents())(scope);
                                }
                            }
                        })
                    }
                    else if (scope.info.Value.YesOrNo.value == "No" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {
                        scope.info.Value.YesOrNo.value = "Yes";
                        characterService.UpdateSpellMemorizeContent(scope.info).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                if (items.IsAction == true) {
                                    scope.info.Name = "UnMemorized";
                                    element.html(getTemplate(items.IsAction));
                                    $compile(element.contents())(scope);
                                }
                            }
                        })
                    }
                }
                else if (scope.info.CharacterAbilityValueId != undefined) {
                    if (scope.info.Value.YesOrNo.value == "Yes" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {
                        scope.info.Value.YesOrNo.value = "No";
                        characterService.UpdateAbilityEnabledContent(scope.info).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                if (items.IsAction == true) {
                                    scope.info.Name = "Enabled";
                                    element.html(getTemplate(items.IsAction));
                                    $compile(element.contents())(scope);
                                }
                            }
                        })
                    }
                    else if (scope.info.Value.YesOrNo.value == "No" || items.Value.YesOrNo.value == "False" || items.Value.YesOrNo.value == "" || items.Value.YesOrNo.value === undefined || items.Value.YesOrNo.value === null) {
                        scope.info.Value.YesOrNo.value = "Yes";
                        characterService.UpdateAbilityEnabledContent(scope.info).then(function (data) {
                            if (data.data.StatusCode == 200) {

                                if (items.IsAction == true) {
                                    scope.info.Name = "Disabled";
                                    element.html(getTemplate(items.IsAction));
                                    $compile(element.contents())(scope);
                                }
                            }
                        })
                    }
                }
            }
            //for (var i = 0; i < items.length; i++)
            //{
            //    if (items[i].IsAction == 0)
            //    {
            //        element.html(getTemplate(items[i].IsAction));

            //        $compile(element.contents())(scope);
            //    }
            //    else if (items[i].IsAction == 1)
            //    {
            //        element.html(getTemplate(items[i].IsAction));

            //        $compile(element.contents())(scope);
            //    }
            //}
            //scope.defaultDiceSelect = function () {
            //    debugger;
            //    var dlg = dialogs.create('/views/dialogs/defaultdiceselection.html', 'dialogDefaultDiceSelect',
            //        { "mode": 1 }
            //    );
            //    dlg.result.then(function (res) {
            //        debugger;
            //        //    scope.dice = res;
            //        scope.info.Value.DefaultDice.value = res;
            //    });
            //};
            //scope.getThumbNail = function () {
            //    if (scope.file)
            //        return $scope.file;

            //    var c = scope.item;
            //    if (c.id && c.portrait)
            //        return '/characterdata/' + c.id + '/' + c.portrait;

            //    return null;
            //}
        };

        return {
            restrict: "E",
            replace: true,
            link: linker,
            scope: {
                info: '='
            }
        }
    }]);


})();
angular.module('rpgsmith-templates').run(['$templateCache', function($templateCache) {$templateCache.put('/views/EmailTemplates/EmailConfirmationSuccess.html','<!DOCTYPE html><html><body><div><img src="http://demo.rpgsmith.com/images/logo.png"></div><div style="box-shadow: 1px 1px 1px 1px #ecbaa0;padding:10px;margin-top:20px"><h1 style="margin-bottom:20px;margin-top:20px;color:#d25d23">Success!!</h1><p>Email Confirmed Successfully! Now you can login to your account.</p><p></p><button type="button" style="width: 150px;display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap;vertical-align: middle;-ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent;border-radius: 4px;background-color: #d35e3f"><a href="www.google.com" style="text-decoration:none;color:#fff">Click here to login</a></button></div></body></html>');
$templateCache.put('/views/EmailTemplates/EmailConfirmationTemplate.html','<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RPGSmith Newsletter</title></head><body style="margin: 0;padding: 0;width:100%;color: #000000;background-color:#EBEBEB;font-family: Roboto, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif"><style>@import url(http://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900);</style><div style="max-width: 5in;margin: 0 auto;background-color:#ffffff;margin-top: 1.5em"><table style="padding: 0 20px"><tr><td align="center" style="padding-top: 1em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith"><img width="252" height="127" title="RPGSmith" alt="RPGSmith" src="https://lh3.googleusercontent.com/QEifSn90PEjjSZ-5d3yhXoVp6ixxojV6Jo3P_lKUvvBTqxFsWmLjHllW0HrLji6hM5lgEYv3cCuWE_dDo3hzyevV_RyQZf4fA0JRHr7Y6bV0oX9Mjc3O5ZlLKzkF9sfnjkpM_YmNmLJ2SX2MmjwteXop2spQACXtsQgSOM0Sc0K94F-JFC2NcSTHwqTerHPgG-T2PSG2qINGcSdgn2m7AMkq1tSqKds5x1Ovic9auo7NkNomKTgw2WvCsoR96g9TkJRqi-viX38qbJkl3RJySoqycBoSULmZ8WaIb3gMcBM4CJFEHiVZx9a1qfpxibE_iMARM4PdP8GOiGZkqLt4NNI2rs7ojnvpXIagmS0OuUyZtXt8yw0egJWadSM_K3N_vDFE_fPt4I0RU7CDgPlD-UgjvuZ7om7c-448MOtbR4lVqFyGKyYnxxruPwtr966PpXQ3NpQpHmhfMbqSnseYJ512_aeg1ohlKpUhknsSS2WBRhTcfBo14t1f1VEyNOnd8bPx0jEUQhx4euqH8raDO6W7MxOR666SWFAlLiNJdA=w702-h353-no"></a></td></tr><tr><td align="center"><div style="margin-bottom: 1em;font-size: 1.4em;font-weight: 500" mc:edit="rem_title">Account Verification</div></td></tr><tr><td align="left"><div style="margin-bottom: 1.5em;font-weight: 300" mc:edit="rem_notes"><center>Thank you for Signing Up.<br><br>Please confirm your email address by clicking the button below.</center></div></td></tr><tr><td align="center"><table width="100%"><tr><a href="{#ConfirmationLink}" type="button" style="width: 150px;display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap;vertical-align: middle;-ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent;border-radius: 4px;background-color: #d35e3f;text-decoration:none;color:#fff">Confirm</a><br><br></tr></table></td></tr><tr><td align="center" style="font-weight: 300;font-size: 0.8em;padding-bottom: 1em">Copyright &#169;2018 <a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith" style="text-decoration: none;color: #34AADC"><span class="RPGSmith" style="color: #D2602A;font-weight: 700">RPG<b style="color: #000000;font-weight: 700">&#8226;Smith</b></span></a>, LLC All rights reserved.<br><div style="padding-top: 1.0em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"></a><a href="https://twitter.com/RpgSmith" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"></a><a href="https://plus.google.com/u/2/communities/101062066525142446219" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"></a></div></td></tr></table></div></body></html>');
$templateCache.put('/views/EmailTemplates/ForgotPasswordEmailTemplate.html','<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RPGSmith Newsletter</title></head><body style="margin: 0;padding: 0;width:100%;color: #000000;background-color:#EBEBEB;font-family: Roboto, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif"><style>@import url(http://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900)</style><div style="max-width: 5in;margin: 0 auto;background-color:#ffffff;margin-top: 1.5em"><table width="100%" style="padding: 0 20px"><tr><td align="center" style="padding-top: 1em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith"><img width="252" height="127" title="RPGSmith" alt="RPGSmith" src="https://lh3.googleusercontent.com/QEifSn90PEjjSZ-5d3yhXoVp6ixxojV6Jo3P_lKUvvBTqxFsWmLjHllW0HrLji6hM5lgEYv3cCuWE_dDo3hzyevV_RyQZf4fA0JRHr7Y6bV0oX9Mjc3O5ZlLKzkF9sfnjkpM_YmNmLJ2SX2MmjwteXop2spQACXtsQgSOM0Sc0K94F-JFC2NcSTHwqTerHPgG-T2PSG2qINGcSdgn2m7AMkq1tSqKds5x1Ovic9auo7NkNomKTgw2WvCsoR96g9TkJRqi-viX38qbJkl3RJySoqycBoSULmZ8WaIb3gMcBM4CJFEHiVZx9a1qfpxibE_iMARM4PdP8GOiGZkqLt4NNI2rs7ojnvpXIagmS0OuUyZtXt8yw0egJWadSM_K3N_vDFE_fPt4I0RU7CDgPlD-UgjvuZ7om7c-448MOtbR4lVqFyGKyYnxxruPwtr966PpXQ3NpQpHmhfMbqSnseYJ512_aeg1ohlKpUhknsSS2WBRhTcfBo14t1f1VEyNOnd8bPx0jEUQhx4euqH8raDO6W7MxOR666SWFAlLiNJdA=w702-h353-no"></a></td></tr><tr><td align="center"><div style="margin-bottom: 1em;font-size: 1.4em;font-weight: 500" mc:edit="rem_title">Reset Password</div></td></tr><tr><td align="left"><div style="margin-bottom: 1.5em;font-weight: 300" mc:edit="rem_notes"><center>Click the link below to reset your RPGSmith account password.<br><br>If you did not generate this email you may want to change your password anyways.</center></div></td></tr><tr><td align="center"><table width="100%"><tr><a href="{#ForgotLink}" style="width: 150px;display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap;vertical-align: middle;-ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent;border-radius: 4px;background-color: #d35e3f;color:#fff;text-decoration:none">Change Password</a><br><br></tr></table></td></tr><tr><td align="center" style="font-weight: 300;font-size: 0.8em;padding-bottom: 1em">Copyright &#169;2018 <a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith" style="text-decoration: none;color: #34AADC"><span class="RPGSmith" style="color: #D2602A;font-weight: 700">RPG<b style="color: #000000;font-weight: 700">&#8226;Smith</b></span></a>, LLC All rights reserved.<br><div style="padding-top: 1.0em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"></a><a href="https://twitter.com/RpgSmith" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"></a><a href="https://plus.google.com/u/2/communities/101062066525142446219" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"></a></div></td></tr></table></div></body></html>');
$templateCache.put('/views/EmailTemplates/RegisterEmailConfirmation.html','<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RPGSmith Register</title></head><body style="margin: 0;padding: 0;width:100%;color: #000000;background-color:#EBEBEB;font-family: Roboto, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif"><style>@import url(http://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900)</style><div style="max-width: 5in;margin: 0 auto;background-color:#ffffff;margin-top: 1.5em"><table width="100%" style="padding: 0 20px"><tr><td align="center" style="padding-top: 1em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith"><img width="252" height="127" title="RPGSmith" alt="RPGSmith" src="https://lh3.googleusercontent.com/QEifSn90PEjjSZ-5d3yhXoVp6ixxojV6Jo3P_lKUvvBTqxFsWmLjHllW0HrLji6hM5lgEYv3cCuWE_dDo3hzyevV_RyQZf4fA0JRHr7Y6bV0oX9Mjc3O5ZlLKzkF9sfnjkpM_YmNmLJ2SX2MmjwteXop2spQACXtsQgSOM0Sc0K94F-JFC2NcSTHwqTerHPgG-T2PSG2qINGcSdgn2m7AMkq1tSqKds5x1Ovic9auo7NkNomKTgw2WvCsoR96g9TkJRqi-viX38qbJkl3RJySoqycBoSULmZ8WaIb3gMcBM4CJFEHiVZx9a1qfpxibE_iMARM4PdP8GOiGZkqLt4NNI2rs7ojnvpXIagmS0OuUyZtXt8yw0egJWadSM_K3N_vDFE_fPt4I0RU7CDgPlD-UgjvuZ7om7c-448MOtbR4lVqFyGKyYnxxruPwtr966PpXQ3NpQpHmhfMbqSnseYJ512_aeg1ohlKpUhknsSS2WBRhTcfBo14t1f1VEyNOnd8bPx0jEUQhx4euqH8raDO6W7MxOR666SWFAlLiNJdA=w702-h353-no"></a></td></tr><tr><td align="center"><div style="margin-bottom: 1em;font-size: 1.4em;font-weight: 500" mc:edit="rem_title">Register Successfully Confirmation</div></td></tr><tr><td align="left"><div style="margin-bottom: 1.5em;font-weight: 300" mc:edit="rem_notes"><center>An Email has been sent to <strong>testing@gmail.com</strong><br><br>Please Check your Inbox and Confirm your Account.</center></div></td></tr><tr><td align="center"><table width="100%"><tr><button type="button" style="width: 150px;display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap;vertical-align: middle;-ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent;border-radius: 4px;background-color: #d35e3f"><a href="www.google.com" style="text-decoration:none;color:#fff">What\'s This For?</a></button><br><br></tr></table></td></tr><tr><td align="center" style="font-weight: 300;font-size: 0.8em;padding-bottom: 1em">Copyright &#169;2018 <a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith" style="text-decoration: none;color: #34AADC"><span class="RPGSmith" style="color: #D2602A;font-weight: 700">RPG<b style="color: #000000;font-weight: 700">&#8226;Smith</b></span></a>, LLC All rights reserved.<br><div style="padding-top: 1.0em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"></a><a href="https://twitter.com/RpgSmith" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"></a><a href="https://plus.google.com/u/2/communities/101062066525142446219" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"></a></div></td></tr></table></div></body></html>');
$templateCache.put('/views/EmailTemplates/RegisterSuccess.html','<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RPGSmith Register Confirmation</title></head><body style="margin: 0;padding: 0;width:100%;color: #000000;background-color:#EBEBEB;font-family: Roboto, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif"><style>@import url(http://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900);</style><div style="max-width: 5in;margin: 0 auto;background-color:#ffffff;margin-top: 1.5em"><table width="100%" style="padding: 0 20px"><tr><td align="center" style="padding-top: 1em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith"><img width="252" height="127" title="RPGSmith" alt="RPGSmith" src="https://lh3.googleusercontent.com/QEifSn90PEjjSZ-5d3yhXoVp6ixxojV6Jo3P_lKUvvBTqxFsWmLjHllW0HrLji6hM5lgEYv3cCuWE_dDo3hzyevV_RyQZf4fA0JRHr7Y6bV0oX9Mjc3O5ZlLKzkF9sfnjkpM_YmNmLJ2SX2MmjwteXop2spQACXtsQgSOM0Sc0K94F-JFC2NcSTHwqTerHPgG-T2PSG2qINGcSdgn2m7AMkq1tSqKds5x1Ovic9auo7NkNomKTgw2WvCsoR96g9TkJRqi-viX38qbJkl3RJySoqycBoSULmZ8WaIb3gMcBM4CJFEHiVZx9a1qfpxibE_iMARM4PdP8GOiGZkqLt4NNI2rs7ojnvpXIagmS0OuUyZtXt8yw0egJWadSM_K3N_vDFE_fPt4I0RU7CDgPlD-UgjvuZ7om7c-448MOtbR4lVqFyGKyYnxxruPwtr966PpXQ3NpQpHmhfMbqSnseYJ512_aeg1ohlKpUhknsSS2WBRhTcfBo14t1f1VEyNOnd8bPx0jEUQhx4euqH8raDO6W7MxOR666SWFAlLiNJdA=w702-h353-no"></a></td></tr><tr><td align="center"><div style="margin-bottom: 1em;font-size: 1.4em;font-weight: 500" mc:edit="rem_title">Email Confirmation</div></td></tr><tr><td align="left"><div style="margin-bottom: 1.5em;font-weight: 300" mc:edit="rem_notes">An Email has been sent to <strong>{{data.email}}</strong><br><br>Please Check your Inbox and Confirm your Account.</div></td></tr><tr><td align="center"><table width="100%"><tr><button type="button" style="width: 150px;display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap;vertical-align: middle;-ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent;border-radius: 4px;background-color: #d35e3f"><a href="www.google.com" style="text-decoration:none;color:#fff">What\'s This For?</a></button></tr></table></td></tr><tr><td align="center" style="font-weight: 300;font-size: 0.8em;padding-bottom: 1em">Copyright &#169;2018 <a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith" style="text-decoration: none;color: #34AADC"><span class="RPGSmith" style="color: #D2602A;font-weight: 700">RPG<b style="color: #000000;font-weight: 700">&#8226;Smith</b></span></a>, LLC All rights reserved.<br><div style="padding-top: 1.0em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"></a><a href="https://twitter.com/RpgSmith" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"></a><a href="https://plus.google.com/u/2/communities/101062066525142446219" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"></a></div></td></tr></table></div></body></html>');
$templateCache.put('/views/EmailTemplates/ResetPasswordSuccess.html','<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RPGSmith Newsletter</title></head><body style="margin: 0;padding: 0;width:100%;color: #000000;background-color:#EBEBEB;font-family: Roboto, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif"><style>@import url(http://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900)</style><div style="max-width: 5in;margin: 0 auto;background-color:#ffffff;margin-top: 1.5em"><table width="100%" style="padding: 0 20px"><tr><td align="center" style="padding-top: 1em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith"><img width="252" height="127" title="RPGSmith" alt="RPGSmith" src="https://lh3.googleusercontent.com/QEifSn90PEjjSZ-5d3yhXoVp6ixxojV6Jo3P_lKUvvBTqxFsWmLjHllW0HrLji6hM5lgEYv3cCuWE_dDo3hzyevV_RyQZf4fA0JRHr7Y6bV0oX9Mjc3O5ZlLKzkF9sfnjkpM_YmNmLJ2SX2MmjwteXop2spQACXtsQgSOM0Sc0K94F-JFC2NcSTHwqTerHPgG-T2PSG2qINGcSdgn2m7AMkq1tSqKds5x1Ovic9auo7NkNomKTgw2WvCsoR96g9TkJRqi-viX38qbJkl3RJySoqycBoSULmZ8WaIb3gMcBM4CJFEHiVZx9a1qfpxibE_iMARM4PdP8GOiGZkqLt4NNI2rs7ojnvpXIagmS0OuUyZtXt8yw0egJWadSM_K3N_vDFE_fPt4I0RU7CDgPlD-UgjvuZ7om7c-448MOtbR4lVqFyGKyYnxxruPwtr966PpXQ3NpQpHmhfMbqSnseYJ512_aeg1ohlKpUhknsSS2WBRhTcfBo14t1f1VEyNOnd8bPx0jEUQhx4euqH8raDO6W7MxOR666SWFAlLiNJdA=w702-h353-no"></a></td></tr><tr><td align="center"><div style="margin-bottom: 1em;font-size: 1.4em;font-weight: 500" mc:edit="rem_title">Success!!</div></td></tr><tr><td align="left"><div style="margin-bottom: 1.5em;font-weight: 300" mc:edit="rem_notes"><center>Your password has been changed.<br><br>You can now login to RPGSmith with your new password.</center></div></td></tr><tr><td align="center"><table width="100%"><tr><button type="button" style="width: 150px;display: inline-block;padding: 6px 12px;margin-bottom: 0;font-size: 14px;font-weight: 400;line-height: 1.42857143;text-align: center;white-space: nowrap;vertical-align: middle;-ms-touch-action: manipulation;touch-action: manipulation;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-image: none;border: 1px solid transparent;border-radius: 4px;background-color: #d35e3f"><a href="http://app.rpgsmith.com" style="text-decoration:none;color:#fff">Launch RPGSmith</a></button><br><br><br></tr></table></td></tr><tr><td align="center" style="font-weight: 300;font-size: 0.8em;padding-bottom: 1em">Copyright &#169;2018 <a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith" style="text-decoration: none;color: #34AADC"><span class="RPGSmith" style="color: #D2602A;font-weight: 700">RPG<b style="color: #000000;font-weight: 700">&#8226;Smith</b></span></a>, LLC All rights reserved.<br><div style="padding-top: 1.0em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"></a><a href="https://twitter.com/RpgSmith" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"></a><a href="https://plus.google.com/u/2/communities/101062066525142446219" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"></a></div></td></tr></table></div></body></html>');
$templateCache.put('/views/dialogs/addcorestatvalues.html','<div class="popup-manage-core-stats"><div class="modal-header"><h5 class="modal-title" id="manageCoreStatsPopupTitle">MANAGE CHARARCTER STATS (<span>{{characters.CorestatValues.length}}</span>)</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form><table class="table table-hover"><thead class="thead-dark"><tr><td>Title</td><td>TYPE</td><!--<td>ALLOW PLAYER UPDATE</td>\r\n                        <td>SHOW TO OTHER PLAYERS</td>--></tr></thead><tbody><tr ng-repeat="value in characters.CorestatValues"><td>{{value.Name}}</td><td><rpgsmithtype info="value" fullscope="characters.CorestatValues" class="col-md-8" style="padding-left:0"></rpgsmithtype></td></tr></tbody></table></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveCorestatValues()">Save</button><!--<button type="button" class="btn btn-primary" ><i class="{{characters.CorestatValuesIcon}}" style="color:white;"></i>{{characters.CorestatValuesBtnText}}</button>--></div></div>');
$templateCache.put('/views/dialogs/adddicename.html','<!--https://github.com/m-e-conroy/angular-dialog-service--><div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Dice Name</h4></div><div class="modal-body"><ng-form name="dlg" novalidate role="form"><div class="form-group pb-10"><label class="control-label col-md-4">Name</label><div class="col-md-8 mb-20"><input type="hidden" value="Result.CharacterProfileId" ng-model="Result.CharacterProfileId"> <input name="dicename" type="text" ng-model="Name" class="form-control" required> <span style="color:red" ng-show="dlg.dicename.$dirty && dlg.dicename.$invalid"><span ng-show="dlg.dicename.$error.required">Dice name is required.</span></span></div></div><!--<ng-form name="dlg" novalidate role="form">\r\n            <div class="form-group input-group-lg" ng-class="{true: \'has-error\'}[dlg.name.$dirty && dlg.name.$invalid]">\r\n                <span class="help-block">Enter a name</span>\r\n                <input type="text" class="form-control" name="name" id="name" ng-model="name" ng-keyup="hitEnter($event)" required>\r\n            </div>\r\n        </ng-form>--></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="(dlg.$dirty && dlg.$invalid) || dlg.$pristine">Save</button></div>');
$templateCache.put('/views/dialogs/addnewcorestat.html','<div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>{{tabName}}</span></h4><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><ng-form name="dlg" role="form"><div class="form-group"><!--<label class="control-label col-md-4">\r\n                Name\r\n            </label>\r\n            <div class="col-md-8 mb-20">\r\n                <input name="corestatname" type="text" ng-model="CoreStatProperties.Name" class="form-control" required />\r\n                <span style="color:red" ng-show="dlg.corestatname.$dirty && dlg.corestatname.$invalid">\r\n                    <span ng-show="dlg.corestatname.$error.required">Core Stat name is required.</span>\r\n                </span>\r\n            </div>--><label class="control-label"><span class="help-block">Name <span class="errorColor">*</span></span></label><div class=""><input name="corestatname" placeholder="Enter Name" ng-disabled="DisableNameField" type="text" ng-model="CoreStatProperties.Name" class="form-control" ng-class="{red: dlg.corestatname.$dirty && dlg.corestatname.$error.required}" required></div></div><!--<div class="" ng-show="ShowChoices">\r\n            <input type="text" ng-model="CoreStatProperties.ChoiceName" />\r\n            <div class="form-group pb-10" ng-repeat="choice in CoreStatProperties.Value.Choices.choices">\r\n                <label class="control-label col-md-4">Choice</label>\r\n                <div class="col-md-8" style="margin-bottom:6px;">\r\n                    <input type="text" class="form-control" ng-model="choice.ChoiceName" />\r\n                </div>\r\n            </div>\r\n            <div class="addchoice">\r\n                <button ng-click="addChoice()" class="btn btn-primary">Add Choice</button>\r\n            </div>\r\n\r\n\r\n\r\n        </div>--><!--<div ng-show="ShowValueandSubvalue" class="form-group mr-20 col-md-12">\r\n            <div class="" style="width: 20%;float:left;">\r\n                <label class="radio-inline">\r\n                    <input type="radio" ng-model="ValSub" name="value" value="Value" ng-click="AddValueSubvalue(\'Value\')" />\r\n                    <span>Value</span>\r\n                </label>\r\n            </div>\r\n            <div class="">\r\n                <label class="radio-inline">\r\n                    <input type="radio" ng-model="ValSub" name="value" value="SubValue" ng-click="AddValueSubvalue(\'SubValue\')" />\r\n                    <span>Sub Value</span>\r\n                </label>\r\n            </div>\r\n        </div>\r\n        <div ng-show="ShowCurrentMaxValue" class="form-group ml-10 col-md-12">\r\n            <div class="" style="width: 20%;float:left;">\r\n                <label class="radio-inline">\r\n                    <input type="radio" ng-model="CurrentMaxVal" name="current" value="CurrentValue" ng-change="Addcurrentmax(\'CurrentValue\')" />\r\n                    <span>Current Value</span>\r\n                </label>\r\n            </div>\r\n            <div class="">\r\n                <label class="radio-inline">\r\n                    <input type="radio" ng-model="CurrentMaxVal" name="current" value="MaxValue" ng-change="Addcurrentmax(\'MaxValue\')" />\r\n                    <span>Max Value</span>\r\n                </label>\r\n            </div>\r\n        </div>--><div class="form-group pb-10"><!--<label class="control-label col-md-4">\r\n                Type\r\n            </label>\r\n            <div class="col-md-8 mb-20">\r\n                <select name="corestattype" class="form-control" ng-options="item.TypeId as item.Name for item in Types" ng-model="CoreStatProperties.TypeId" required>\r\n                    <option value="">--Select--</option>\r\n                </select>\r\n                <span style="color:red" ng-show="dlg.corestattype.$dirty && dlg.corestattype.$invalid">\r\n                    <span ng-show="dlg.corestattype.$error.required">Type is required.</span>\r\n                </span>\r\n\r\n            </div>--><!--<label class="control-label col-md-4">\r\n                <span class="help-block">Type <span class="errorColor">*</span></span>\r\n            </label>\r\n            <div class="col-md-8 mb-20">\r\n                <select name="corestattype" ng-disabled="DisablecopyFields" ng-change="CoreStatOnChange()" class="form-control" ng-options="item.TypeId as item.Name for item in Types" ng-model="CoreStatProperties.TypeId" ng-class="{red: dlg.corestattype.$dirty && dlg.corestattype.$error.required}" required>\r\n                    <option value="">--Select--</option>\r\n                </select>\r\n            </div>--></div><div class="form-group form-row"><div class="col-5 col-md-5"><!-- Character ruleset --><fieldset class="form-group input-list"><legend>Type</legend><ul class="input-list-items"><li class="form-check" ng-repeat="item in Types"><label class="form-check-label icon-ca"><!--<input class="form-check-input" type="radio" name="newCharacterRuleset" value="ruleSetItem.Id" ng-model="ruleSetItem.RulesetID">--> <input class="form-check-input" type="radio" ng-disabled="disableAllControls" name="CharacterStat" value="{{item.TypeId}}" ng-model="CoreStatProperties.TypeId"> <span><!--<img ng-src="{{item.image?item.image:\'/wwwroot/images/not-available.jpg\'}}" onerror="this.src=\'/wwwroot/images/not-available.jpg\'" />\r\n\t\t\t\t\t\t\t\t\t<span >\r\n\r\n\t\t\t\t\t\t\t\t\t</span>--> <em class="icon icon-with-text icon-{{item.Name.toLowerCase()==\'command\'?\'dice\':(item.Name.toLowerCase()==\'yes/no\'?\'yes-no\':(item.Name.toLowerCase()==\'value & sub-value\'?\'value-subval\':(item.Name.toLowerCase()==\'current & max value\'?\'slider\':(item.Name.toLowerCase()==\'on/off\'?\'on-off\':item.Name.toLowerCase()))))}} icon-rsi">{{item.Name}}</em> <i class="icon" ng-class="\'ss\'"></i></span></label></li></ul><!--<div class="input-extend">\r\n\t\t\t\t\t\t<a ng-click="manageRuleSets()" class="btn icon icon-with-text icon-external btn-link-primary"><span>Manage Rulesets</span></a>\r\n\t\t\t\t\t</div>--></fieldset><!-- End of character ruleset --></div><div class="stat-type-fields stat-type-text" style="width: 55%;padding-left: 1px"><label class="control-label" ng-show="Types[CoreStatProperties.TypeId-1].Name">{{CoreStatProperties.TypeId==16?\'Calculation\':Types[CoreStatProperties.TypeId-1].Name}}</label><div class="stat-type-desc" ng-show="Types[CoreStatProperties.TypeId-1].Description"><p ng-show="Types[CoreStatProperties.TypeId-1].Description">{{Types[CoreStatProperties.TypeId-1].Description}}</p><p ng-show="Types[CoreStatProperties.TypeId-1].Examples"><em>eg. {{Types[CoreStatProperties.TypeId-1].Examples}}</em></p></div><div><label class="control-label">Description (Optional)</label><div class=""><textarea ng-disabled="DisablecopyFields" placeholder="Enter Description" ng-model="CoreStatProperties.Description" class="form-control"></textarea></div></div><div class="" ng-show="CoreStatProperties.TypeId == 16"><label class="control-label">Add an Existing Character Stat</label><div class=""><select name="ExistCoreStat" class="form-control" ng-options="CoreStatsInGrid.Name for CoreStatsInGrid in CoreStatsInGrid" ng-model="CoreStatsInGrid.Name" ng-change="ExistCoreStatOnChange()" ng-class="{red: dlg.corestattype.$dirty && dlg.corestattype.$error.required}" required><option value="">--Select--</option></select><button type="button" ng-disabled="DisablecopyFields" class="byn btn-primary" ng-click="CreateFormula()">INSERT</button></div><label class="control-label">Formula</label><div><input type="text" ng-disabled="DisablecopyFields" placeholder="Enter Formula" ng-model="Formula" class="form-control"></div></div><div ng-show="Types[CoreStatProperties.TypeId-1].Name == \'Choice\'"><!--<input type="text" ng-model="CoreStatProperties.ChoiceName" />--><label class="control-label">Choice</label><div ng-repeat="choice in CoreStatProperties.Value.Choices.choices"><!--<div class="col-md-8" style="margin-bottom:6px;">\r\n\t\t\t\t<input type="text" class="form-control col-md-6" ng-model="choice.ChoiceName" />\r\n\t\t\t</div>--><!--<input id="ChoiceField" style="width: 70%" ng-disabled="DisablecopyFields" type="text"  placeholder="Enter Choice" class="form-control form-control-sm icon icon-trash icon-rsi" ng-model="choice.ChoiceName">--> <span class="input-group-btn"><button type="button" title="Remove Choice" class="btn icon icon-trash btn-simple-primary" ng-click="RemoveChoice(choice)"></button> </span><input type="text" ng-model="choice.ChoiceName" ng-click="addChoice()" class="form-control" placeholder="Enter Choice"><!--<div ng-disabled="DisablecopyFields" class="btn btn-primary icon icon-with-text icon-trash text-sm-center btn-sm" ng-click="RemoveChoice(choice)"></div>--></div><!--<div class="addchoice">\r\n\t\t\t\t\t\t<button ng-click="addChoice()" ng-disabled="DisablecopyFields" class="btn btn-primary">Add Choice</button>\r\n\t\t\t\t\t</div>--></div></div></div></ng-form></div><div class="modal-footer"><!--<button type="button" class="btn btn-primary" ng-click="NewRuleSet();"><i style="color:#fff;" class="fa fa fa-plus"></i> Add RuleSet</button>--> <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="SaveCorestat()">{{buttontext}}</button><!--<button type="button" class="btn btn-primary" ng-click="SaveCorestat()">Save</button>--></div>');
$templateCache.put('/views/dialogs/addnumericcorestats.html','<div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Numeric Corestats</span></h4></div><div class="modal-body form-horizontal"><!--<div ng-show="ShowNumericCorestats"></div>--><ng-form name="dlg" novalidate role="form"><div class="text-center" ng-show="ShowNonNumericCorestats">No Numeric Corestats For This Character.</div><div class="form-group" ng-show="!ShowNonNumericCorestats"><label class="control-label col-md-4"><span class="help-block">Select Numeric Corestat <span class="errorColor">*</span></span></label><div class="col-md-8"><select name="corestattype" ng-change="ShowCorestatValue()" class="form-control" ng-options="item for item in Result" ng-model="corestatype" ng-class="{red: dlg.corestattype.$dirty && dlg.corestattype.$error.required}" required><option value="">--Select--</option></select></div></div><!--<div ng-show="CurrentMaxValue" class="form-group ml-10">\r\n            <label class="control-label col-md-4">\r\n                <div class="checkbox-inline">\r\n                    <label><input type="checkbox" ng-model="currentvalue" name="current" ng-change="showcurrent()" />Current Value</label>\r\n                </div>\r\n                <div class="checkbox-inline">\r\n                    <label><input type="checkbox" ng-model="checked" name="max" ng-init="checked=true" />Max Value</label>\r\n                </div>\r\n            </label>\r\n\r\n        </div>\r\n        <div ng-show="ValueSubValue" class="form-group mr-20">\r\n            <label class="control-label col-md-4">\r\n                <div class="checkbox-inline">\r\n                    <label><input type="checkbox" ng-model="checked" name="value" ng-init="checked=true" />Value</label>\r\n                </div>\r\n                <div class="checkbox-inline">\r\n                    <label><input type="checkbox" ng-model="subvalue" name="sub" ng-change="showsubvalue()" />Sub Value</label>\r\n                </div>\r\n            </label>\r\n        </div>--><div ng-show="CurrentMaxValue" class="form-group ml-10"><label class="control-label col-md-4"></label><div class="radio-inline"><label><input type="radio" ng-model="CurrentMaxVal" name="current" value="CurrentValue" ng-change="showcurrentmax(\'CurrentValue\')">Current Value</label></div><div class="radio-inline"><label><input type="radio" ng-model="CurrentMaxVal" name="current" value="MaxValue" ng-change="showcurrentmax(\'MaxValue\')">Max Value</label></div><!--</label>--></div><div ng-show="ValueSubValue" class="form-group mr-20"><label class="control-label col-md-4"></label><div class="radio-inline"><label><input type="radio" ng-model="ValSub" name="value" value="Value" ng-change="showValueSubvalue(\'Value\')">Value</label></div><div class="radio-inline"><label><input type="radio" ng-model="ValSub" name="value" value="SubValue" ng-change="showValueSubvalue(\'SubValue\')">Sub Value</label></div><!--</label>--></div><div ng-show="Number"><div class="form-group"><label class="control-label col-md-4"></label><div class="col-md-8"><input type="text" ng-model="number" class="form-control col-md-8" disabled="disabled"></div></div></div><div ng-show="currenttext"><div class="form-group"><label class="control-label col-md-4"></label><div class="col-md-8"><input type="text" ng-model="current" class="form-control col-md-8" disabled="disabled"></div></div></div><div ng-show="maxtext"><div class="form-group"><label class="control-label col-md-4"></label><div class="col-md-8"><input type="text" ng-model="max" class="form-control col-md-8" disabled="disabled"></div></div></div><div ng-show="valtext"><div class="form-group"><label class="control-label col-md-4"></label><div class="col-md-8"><input type="text" ng-model="val" class="form-control col-md-8" disabled="disabled"></div></div></div><div ng-show="subvaltext"><div class="form-group"><label class="control-label col-md-4"></label><div class="col-md-8"><input type="text" class="form-control col-md-8" ng-model="subval" disabled="disabled"></div></div></div></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="SaveCorestatValues()" ng-disabled="(dlg.$dirty && dlg.$invalid)|| dlg.$pristine ">Save</button></div>');
$templateCache.put('/views/dialogs/allabilitycontent.html','<style>.modal-content {\r\n        width: 1100px;\r\n        left: -93px;\r\n    }</style><div class="container item_view item_properties"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{Properties.AbilityProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{Properties.AbilityProperties[0].Value.Text.value}}</button><!--<div class="buttons-align">\r\n                <button class="btn btn-warning">\r\n                    <i class="fa fa-remove" aria-hidden="true"></i>\r\n                    REMOVE\r\n                </button>\r\n                <button class="btn btn-warning">\r\n                    <i class="fa fa-exchange" aria-hidden="true"></i>\r\n                    UNMEMORIZE\r\n                </button>\r\n            </div>--></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{Properties.AbilityProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">CLASS</div><div class="panel-body text-center">{{Properties.AbilityProperties[10].Value.Text.value}}</div></div></div><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">ATTRIBUTES</div><div class="panel-body text-center">{{Properties.AbilityProperties[9].Value.Text.value}}</div></div></div></div><div class="blue"><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">USES ReEMAINING</div><div class="panel-body text-center">{{Properties.AbilityProperties[13].Value.Number.value}}</div></div></div><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">MAX USES</div><div class="panel-body text-center">{{Properties.AbilityProperties[12].Value.Number.value}}</div></div></div></div></div></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Description</h5><p>{{Properties.AbilityProperties[14].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">{{Properties.AbilityProperties[17].Value.Number.value}}</div></div></div><!--<div class="col-md-6">\r\n                            <div class="panel panel-default">\r\n                                <div class="panel-heading text-center" style="background-color: rgba(237, 20, 61, 0.67);">Attributes</div>\r\n                                <div class="panel-body text-center" style="background-color: rgba(237, 20, 61, 0.58);"></div>\r\n                            </div>\r\n                        </div>--></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">REQUIREMENTS</div><div class="panel-body text-center">text</div></div></div></div></div></div></div></div></div>');
$templateCache.put('/views/dialogs/allitemcontent.html','<style>.modal-content {\r\n        width: 1100px;\r\n        left: -93px;\r\n    }</style><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{Properties.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{Properties.ItemProperties[0].Value.Text.value}}</button></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{Properties.ItemProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">WEIGHT</div><div class="panel-body text-center">{{Properties.ItemProperties[4].Value.Weight.value}} {{Properties.ItemProperties[4].Value.Weight.units.selectedUnit}}</div></div></div><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">VOLUME</div><div class="panel-body text-center">{{Properties.ItemProperties[5].Value.Volume.lenghtvalue}} {{Properties.ItemProperties[5].Value.Volume.heightvalue}} {{Properties.ItemProperties[5].Value.Volume.depthvalue}}</div></div></div></div><div class="blue"><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">ATTRIBUTES</div><div class="panel-body text-center">text</div></div></div><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">RARITY</div><div class="panel-body text-center">{{Properties.ItemProperties[6].Value.Choices.selectedchoice}}</div></div></div></div></div></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Visible Description</h5><p>{{Properties.ItemProperties[6].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading text-center">Associated Spell</div><div class="panel-body"><div class="text-center">None</div><!--<div class="text-center" ng-if="RulesetContent.AssociatedSpells.length > 0">\r\n                                     \r\n                                            {{associatedSpell.SpellProperties[0].Value.Text.value}}\r\n                                     \r\n                                        <button ng-repeat="associatedSpell in RulesetContent.AssociatedSpells" class="btn btn-warning" ng-click="ShowAssociatedSpells($index)">\r\n                                            {{associatedSpell.SpellProperties[0].Value.Text.value}}\r\n                                        </button>\r\n                                    </div>--></div></div></div><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading text-center">Associated Ability</div><div class="panel-body text-center">None</div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">{{Properties.ItemProperties[17].Value.Text.value}}</div></div></div></div></div></div></div></div></div>');
$templateCache.put('/views/dialogs/allspellcontent.html','<style>.modal-content {\r\n        width: 1100px;\r\n        left: -93px;\r\n    }</style><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{Properties.SpellProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{Properties.SpellProperties[0].Value.Text.value}}</button></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{Properties.SpellProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">CLASS</div><div class="panel-body text-center">{{Properties.SpellProperties[10].Value.Text.value}}</div></div></div><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">SCHOOL</div><div class="panel-body text-center">{{Properties.SpellProperties[9].Value.Text.value}}</div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel div_green"><div class="panel-heading text-center">Materialized Components</div><div class="panel-body text-center">{{Properties.SpellProperties[9].Value.Text.value}}</div></div></div></div></div></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Description</h5><p>{{Properties.SpellProperties[18].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">CASTING TIME</div><div class="panel-body text-center">{{Properties.SpellProperties[17].Value.Number.value}}</div></div></div><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">Attributes</div><div class="panel-body text-center"></div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">text</div></div></div></div></div></div></div></div><div class="row"><div class="col-md-4"><div class="buttons-align"></div></div><div class="col-md-4"><div class="buttons-align"><div ng-repeat="value in Properties.SpellProperties" class="col-md-6"><rpgsmithcontenttype info="value"></rpgsmithcontenttype></div></div></div><div class="col-md-4"><div class="buttons-align"></div></div></div><div class="row"><div class="col-md-4 col-xs-12"><div class="header-text"><div class="font_icons"><i class="fa fa-cog"></i> <i class="fa fa-circle" aria-hidden="true"></i></div><p>Welcome to the party in hyderabad to become a part of real time applications to be allocated in a creative manner for a while in a association manner. Welcome to the party in hyderabad to become a part of real time applications to be allocated in a creative manner for a while in a association manner.</p></div></div></div></div>');
$templateCache.put('/views/dialogs/AssociatedAbilities.html','<!-- Add item popup --><!--<div class="modal fade popup-add-item" id="addItemPopup" tabindex="-1" role="dialog" aria-labelledby="addItemPopupTitle" aria-hidden="true" data-backdrop="static">\r\n\t<div class="modal-dialog" role="document">--><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="addItemPopupTitle">Add From Ruleset Abilities</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><fieldset class="form-group input-list input-list-wrap items" ng-repeat="ability in Abilities | limitTo : limit"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]" ng-model="ability.Selected"> <span><img ng-src="{{ability.AbilityProperties[1].Value.Image.image}}" alt="{{ability.AbilityProperties[0].Value.Text.value}}"> <em>{{ability.AbilityProperties[0].Value.Text.value}}</em> <em>{{ability.AbilityProperties[0].Value.Number.value}}</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="" class="btn btn-accent">Add</button></div></div><!--</div>\r\n</div>--><!-- End of add item popup -->');
$templateCache.put('/views/dialogs/AssociatedSpells.html','<!-- Add item popup --><!--<div class="modal fade popup-add-item" id="addItemPopup" tabindex="-1" role="dialog" aria-labelledby="addItemPopupTitle" aria-hidden="true" data-backdrop="static">\r\n\t<div class="modal-dialog" role="document">--><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="addItemPopupTitle">Add From Ruleset Spells</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><fieldset class="form-group input-list input-list-wrap items" ng-repeat="spell in RulesetSpells | limitTo : limit"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]" ng-model="spell.Selected"> <span><img ng-src="{{spell.SpellProperties[1].Value.Image.image}}" alt="{{spell.SpellProperties[3].Value.Number.value}}"> <em>{{spell.SpellProperties[3].Value.Number.value}}</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="" class="btn btn-accent">Add</button></div></div><!--</div>\r\n</div>--><!-- End of add item popup -->');
$templateCache.put('/views/dialogs/AssociateRulesetAbilities.html','<!-- Add item popup --><!--<div class="modal fade popup-add-item" id="addItemPopup" tabindex="-1" role="dialog" aria-labelledby="addItemPopupTitle" aria-hidden="true" data-backdrop="static">\r\n\t<div class="modal-dialog" role="document">--><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="addItemPopupTitle">Add From Ruleset Abilities</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><fieldset class="form-group input-list input-list-wrap items" ng-repeat="ability in RulesetAbilities | limitTo : limit"><ul class="input-list-items"><li class="form-check"><label class="form-check-label">{{r.Title}} <input class="form-check-input" type="checkbox" name="addItemItems[]" ng-model="ability.Selected"> <span><img ng-src="{{ability.AbilityProperties[1].Value.Image.image}}" alt="{{ability.AbilityProperties[0].Value.Text.value}}"> <em>{{ability.AbilityProperties[0].Value.Text.value}}</em> <em>{{ability.AbilityProperties[0].Value.Number.value}}</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="SaveAssociatedRulesetAbilities()" class="btn btn-accent">Add</button></div></div><!--</div>\r\n</div>--><!-- End of add item popup -->');
$templateCache.put('/views/dialogs/AssociateRulesetItems.html','<!-- Add item popup --><!--<div class="modal fade popup-add-item" id="addItemPopup" tabindex="-1" role="dialog" aria-labelledby="addItemPopupTitle" aria-hidden="true" data-backdrop="static">\r\n\t<div class="modal-dialog" role="document">--><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="addItemPopupTitle">Add From Ruleset Items</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><fieldset class="form-group input-list input-list-wrap items" ng-repeat="r in RulesetItems | limitTo : limit"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" ng-checked="checkSelected(r,1)" ng-click="addName(r,1)" name="addItemItems[]" ng-model="r.Selected"> <span><img ng-src="{{r.ItemProperties[1].Value.Image.image}}" alt="{{r.ItemProperties[0].Value.Text.value}}"> <em>{{r.ItemProperties[0].Value.Text.value}}</em> <em>{{r.ItemProperties[2].Value.Number.value}}</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="SaveAssociatedRulesetItems()" class="btn btn-accent">Add</button></div></div><!--</div>\r\n</div>--><!-- End of add item popup -->');
$templateCache.put('/views/dialogs/AssociateRulesetSpells.html','<!-- Add item popup --><!--<div class="modal fade popup-add-item" id="addItemPopup" tabindex="-1" role="dialog" aria-labelledby="addItemPopupTitle" aria-hidden="true" data-backdrop="static">\r\n\t<div class="modal-dialog" role="document">--><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="addItemPopupTitle">Add From Ruleset Spells</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><fieldset class="form-group input-list input-list-wrap items" ng-repeat="spell in RulesetSpells | limitTo : limit"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]" ng-model="spell.Selected"> <span><img ng-src="{{spell.SpellProperties[1].Value.Image.image}}" alt="{{spell.SpellProperties[0].Value.Text.value}}"> <em>{{spell.SpellProperties[0].Value.Text.value}}</em> <em>{{spell.SpelsProperties[0].Value.Number.value}}</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="SaveAssociatedRulesetSpells()" class="btn btn-accent">Add</button></div></div><!--</div>\r\n</div>--><!-- End of add item popup -->');
$templateCache.put('/views/dialogs/attributetilecontent.html','<div class="modal-header"><h4 class="modal-title" style="text-align:center">{{Content.Value.Attribute.Title}}</h4></div><div class="modal-body attribute_tile"><div class="row"><div class="col-md-10 table-responsive"><table class="table table-bordered"><thead><tr><th>Name</th><th>Description</th><th>Value</th></tr></thead><tbody><tr><td style="text-align:center">{{Content.Value.Attribute.AttributeContent.Name}}</td><td style="text-align:center">{{Content.Value.Attribute.AttributeContent.Description}}</td><td style="text-align:center">{{Content.Value.Attribute.CorestatValues}}</td></tr></tbody></table></div></div><div ng-show="CurrentMax"><div class="row"><div class="col-md-12 box_design"><div class="form-group col-md-12"><label class="control-label col-md-2">Max Value</label><div class="col-md-2"><input type="text" class="form-control" ng-model="Maxvalue"></div><div class="counter_div col-md-2"><img ng-src="/wwwroot/images/Dice/dice_item.png" class="img-resposive img_center" width="60" height="60" ng-click="DiceRoll(1)"></div><div class="counter_design"><span><i class="fa fa-minus fa-2x" ng-click="Decrement(1)"></i></span> <span><i class="fa fa-plus fa-2x" ng-click="Increment(1)"></i></span> <span><i class="fa fa fa-refresh fa-2x" ng-click="Reset(1)"></i></span></div></div></div></div><div class="row"><div class="col-md-12 box_design"><div class="form-group col-md-12"><label class="control-label col-md-2">Current Value</label><div class="col-md-2"><input type="text" class="form-control" ng-model="Currentvalue"></div><div class="col-md-2 counter_div"><img ng-src="/wwwroot/images/Dice/dice_item.png" class="img-resposive img_center" width="60" height="60" ng-click="DiceRoll(2)"></div><div class="counter_design"><span><i class="fa fa-minus fa-2x" ng-click="Decrement(2)"></i></span> <span><i class="fa fa-plus fa-2x" ng-click="Increment(2)"></i></span> <span><i class="fa fa fa-refresh fa-2x" ng-click="Reset(2)"></i></span></div></div></div></div><!--<label></label>\r\n        <div class="counter"><span><i class="fa fa-minus fa-2x" ng-click="Decrement()"></i></span><span><i class="fa fa fa-refresh fa-2x" ng-click="Reset()"></i></span><span><i class="fa fa-plus fa-2x" ng-click="Increment()"></i></span></div><br />--></div><div ng-show="ValueSubValue"><div class="row"><div class="col-md-12 box_design"><div class="form-group col-md-12"><label class="control-label col-md-2">Value</label><div class="col-md-2"><input type="text" class="form-control" ng-model="Value"></div><div class="col-md-2 counter_div"><img ng-src="/wwwroot/images/Dice/dice_item.png" class="img-resposive img_center" width="60" height="60" ng-click="DiceRoll(3)"></div><div class="counter_design"><span><i class="fa fa-minus fa-2x" ng-click="Decrement(3)"></i></span> <span><i class="fa fa-plus fa-2x" ng-click="Increment(3)"></i></span> <span><i class="fa fa fa-refresh fa-2x" ng-click="Reset(3)"></i></span><br></div><div class="form-group col-md-12"><label class="control-label col-md-2">Sub Value</label><div class="col-md-2"><input type="text" class="form-control" ng-model="Subvalue"></div><div class="col-md-2 counter_div"><img ng-src="/wwwroot/images/Dice/dice_item.png" class="img-resposive img_center" width="60" height="60" ng-click="DiceRoll(4)"></div><div class="counter_design"><span><i class="fa fa-minus fa-2x" ng-click="Decrement(4)"></i></span> <span><i class="fa fa-plus fa-2x" ng-click="Increment(4)"></i></span> <span><i class="fa fa fa-refresh fa-2x" ng-click="Reset(4)"></i></span></div></div></div></div></div><div ng-show="Number"><div class="row"><div class="col-md-12 box_design"><div class="form-group col-md-12"><label class="control-label col-md-2">Number</label><div class="col-md-2"><input type="text" class="form-control" ng-model="Numbers"></div><div class="col-md-2 counter_div"><img ng-src="/wwwroot/images/Dice/dice_item.png" class="img-resposive img_center" width="60" height="60" ng-click="DiceRoll(5)"></div><div class="counter_design"><span><i class="fa fa-minus fa-2x" ng-click="Decrement(5)"></i></span> <span><i class="fa fa-plus fa-2x" ng-click="Increment(5)"></i></span> <span><i class="fa fa fa-refresh fa-2x" ng-click="Reset(5)"></i></span></div><br></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Close</button> <button type="submit" class="btn btn-primary" ng-click="SaveAttributeCorestatValue()" ng-disabled="theForm.$invalid">Update</button></div><toaster-container toaster-options="{\'position-class\': \'toast-top-right\',\'time-out\':\'1000\'}" style="left: 50%; position: fixed"></toaster-container></div>');
$templateCache.put('/views/dialogs/character-addnew.html','<div class="modal-header"><h5 class="modal-title" id="newCharacterPopupTitle">{{pageHeading}}</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body table_align"><form name="characterForm" novalidate><div class="form-row"><div class="col"><!-- Character name --><div class="form-group"><label for="newCharacterName">Name</label><input type="text" name="CharacterName" ng-disabled="disableNameControl" ng-model="character.name" class="form-control" placeholder="Name of the character" required></div><!-- End of character name --></div></div><div class="form-row"><div class="col-12 col-md-6"><!-- Character ruleset --><fieldset class="form-group input-list"><legend>Ruleset</legend><ul class="input-list-items"><li class="form-check" ng-repeat="ruleSetItem in RuleSets"><label class="form-check-label"><!--<input class="form-check-input" type="radio" name="newCharacterRuleset" value="ruleSetItem.Id" ng-model="ruleSetItem.RulesetID">--> <input class="form-check-input" type="radio" ng-disabled="disableAllControls" name="CharacterRuleset" value="{{ruleSetItem.Id}}" ng-model="$parent.character.RulesetID"> <span><img ng-src="{{ruleSetItem.Rulesetproperty[2].Value.Image.image?ruleSetItem.Rulesetproperty[2].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" onerror="this.src=\'/wwwroot/images/not-available.jpg\'"> <em>{{ruleSetItem.Name}}</em> <i class="icon" ng-class="ruleSetItem.Id == character.RulesetID? \'input_selected\':\'ss\'"></i></span></label></li><li><br></li></ul><div class="input-extend"><a ng-click="manageRuleSets()" class="btn icon icon-with-text icon-external btn-link-secondary"><span>Manage Rulesets</span></a></div></fieldset><!-- End of character ruleset --></div><div class="col-12 col-md-6"><!-- Character portrait --><div class="form-group input-image input-image-alt"><label for="newRulesetImage">Portrait (optional)</label><div class="input-image-control input-image-note input-image-trigger" ng-hide="showimagebtns || character.file" ng-click="showimagebtns=true"><div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div></div><div class="input-image-control input-image-buttons" ng-show="showimagebtns" style="display:block;background-size:cover;cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{character.file?character.file:\'\'}}\')"><button type="button" ng-click="OpenBingSearch()" class="btn icon icon-with-text icon-globe btn-primary btn-block input-image-button-web">From Web</button> <button type="button" ng-click="OpenFile()" class="btn icon icon-with-text icon-computer btn-primary btn-block input-image-trigger input-image-button-computer">From Computer</button> <button type="button" ng-show="showimagebtns && character.file" class="btn btn-primary btn-block input-image-button-close" ng-click="character.file = null">Delete</button> <button type="button" ng-click="showimagebtns = false" class="btn btn-outline-primary btn-block input-image-button-close">Cancel</button></div><div ng-click="showimagebtns=true" class="input-image-control input-image-buttons" ng-show="!showimagebtns && character.file" style="background-size:cover; cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{character.file?character.file:\'\'}}\'); padding-top: 100px;padding-left:20px;padding-right: 20px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle"></div><input type="file" id="newCharacterImage" onchange="angular.element(this).scope().characterImageUpload(this)" class="form-control-file"></div><!-- End of ruleset image --></div></div></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="save()" ng-disabled="characterForm.$invalid">Save</button></div><!--<toaster-container toaster-options="{\'position-class\': \'toast-top-right\'}" style=" left: 50%; position: fixed;"></toaster-container>-->');
$templateCache.put('/views/dialogs/CharacterAssociatedAbilities.html','<!DOCTYPE html><html><head><meta charset="utf-8"><title></title></head><body><table class="table table-bordered table-striped" id=""><thead><tr><th>S.No.</th><th>Name</th><th>Quantity</th><th>Image</th><th>Select</th></tr></thead><tbody><tr ng-repeat="ability in Abilities | limitTo : limit"><td>{{$index +1}}</td><td>{{ability.CharacterAbilitiesProperties[0].Value.Text.value}}</td><td>{{ability.CharacterAssociatedAbilities[3].Value.Number.value}}</td><td><img ng-src="{{ability.CharacterAssociatedAbilities[1].Value.Image.image}}" class="img-resposive" width="60" height="60"></td><td><input type="checkbox" ng-model="ability.Selected"></td></tr></tbody></table><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="SaveAssociatedAbilities()">Save</button></div></body></html>');
$templateCache.put('/views/dialogs/CharacterAssociatedSpells.html','<!DOCTYPE html><html><head><meta charset="utf-8"><title></title></head><body><table class="table table-bordered table-striped" id=""><thead><tr><th>S.No.</th><th>Name</th><th>Quantity</th><th>Image</th><th>Select</th></tr></thead><tbody><tr ng-repeat="spell in Spells | limitTo : limit"><td>{{$index +1}}</td><td>{{spell.CharacterSpellsProperties[0].Value.Text.value}}</td><td>{{spell.CharacterSpellsProperties[3].Value.Number.value}}</td><td><img ng-src="{{spell.CharacterSpellsProperties[1].Value.Image.image}}" class="img-resposive" width="60" height="60"></td><td><input type="checkbox" ng-model="spell.Selected"></td></tr></tbody></table><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="SaveAssociatedSpells()">Save</button></div></body></html>');
$templateCache.put('/views/dialogs/countertilecontent.html','<style>.modal-content {\r\n        width: 420px;\r\n        left: 27%;\r\n        top: 108px;\r\n        height: 100%;\r\n    }</style><div class="modal-header"><h4 class="modal-title" style="text-align:center">{{Content.Value.Counter.Name}}</h4></div><div class="modal-body"><div class="row"><div class="col-md-12"><div class="form-group"><label class="control-label col-md-4">Counter Value</label><div class="col-md-4"><input type="number" min="0" placeholder="Value" class="form-control" ng-model="Content.Value.Counter.Value" name="input" ng-class="{red: form.input.$dirty && form.input.$error.required}" ng-required="info" value=""></div></div></div></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Close</button> <button type="submit" class="btn btn-accent" ng-click="SaveCounterUpdatedValue()" ng-disabled="theForm.$invalid">Update</button></div>');
$templateCache.put('/views/dialogs/createabilities.html','<ng-form name="dlg" novalidate role="form"><!--<div class="modal-dialog" role="document">\r\n\t\t<div class="modal-content">--><div class="modal-header"><h5 class="modal-title" id="createItemPopupTitle">{{tabName}}</h5><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><div class="form-row"><div class="col-12 col-md-6" ng-repeat="property in Properties" ng-if="property.Name != \'Tags\' && (property.TypeId == 1 || property.TypeId == 15)"><!-- Item name --><div class="form-group"><label for="newItemName">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div><!-- End of item name --></div><!--<div class="col-12 col-md-6">\r\n\t\t\t\t<!-- Item command --><!--<div class="form-group">\r\n\t\t\t\t<label for="newItemCommand">Command</label>\r\n\t\t\t\t<span class="input-group-btn">\r\n\t\t\t\t\t<button type="button" title="Show Dice" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary"></button>\r\n\t\t\t\t</span>\r\n\t\t\t\t<input type="text" id="newItemCommand" class="form-control" placeholder="Select dice">\r\n\t\t\t</div>--><!-- End of item command --></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item stats --><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name != \'Quantity\' && (property.TypeId == 19 || property.Name == \'Tags\')"><label for="newItemStats">{{property.Name}} {{property.TypeId == 14?"("+property.Value.Text+")":""}} {{property.TypeId == 7?"("+property.Value.Weight.units.selectedUnit+")":""}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div><!-- End of item stats --><!-- Item descriptopn\r\n\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t<label for="newItemDescription">Visible Description</label>\r\n\t\t\t\t\t<textarea id="newItemDescription" class="form-control" placeholder="About the item" rows="5"></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t\t End of item descriptopn --></div><div class="col-12 col-md-6"><!-- Image file --><div class="form-group input-image input-image-alt"><label for="newItemImageFile">Image</label><div class="input-image-control input-image-note input-image-trigger" style="width: 320px;height:320px" ng-hide="showimagebtns || Properties[1].Value.Image.image" ng-click="showimagebtns = true"><div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div></div><div class="input-image-control input-image-buttons" ng-show="showimagebtns" style="display:block;background-size:cover;cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{Properties[1].Value.Image.image?Properties[1].Value.Image.image:\'\'}}\')"><button type="button" ng-click="OpenBingSearch()" class="btn icon icon-with-text icon-globe btn-primary btn-block input-image-button-web">From Web</button> <button type="button" ng-click="OpenFile()" class="btn icon icon-with-text icon-computer btn-primary btn-block input-image-trigger input-image-button-computer">From Computer</button> <button type="button" ng-show="showimagebtns && Properties[1].Value.Image.image" class="btn btn-primary btn-block input-image-button-close" ng-click="Properties[1].Value.Image.image = null">Delete</button> <button type="button" ng-click="showimagebtns = false" class="btn btn-outline-primary btn-block input-image-button-close">Cancel</button></div><div ng-click="showimagebtns=true" class="input-image-control input-image-buttons" ng-show="!showimagebtns && Properties[1].Value.Image.image" style="background-size:cover; cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{Properties[1].Value.Image.image?Properties[1].Value.Image.image:\'\'}}\'); padding-top: 100px;padding-left:20px;padding-right: 20px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle"></div><input type="file" id="newRulesetImage" name="newRulesetImage" onchange="angular.element(this).scope().ItemImageUpload(this)" class="form-control-file"></div><!-- End of image file --></div></div><div class="form-separator"></div><div class="form-row"><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name != \'Quantity\' && (property.TypeId == 7 || property.TypeId == 7 || property.TypeId == 14)"><label for="newItemStats">{{property.Name}} {{property.TypeId == 14?"("+property.Value.Text+")":""}} {{property.TypeId == 7?"("+property.Value.Weight.units.selectedUnit+")":""}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name == \'Rarity\'"><label for="newItemStats">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item bolume --><div class="form-group"><label>Volume</label><div class="form-row"><div class="col"><input type="text" id="newItemHeight" class="form-control" placeholder="Height"></div><div class="col"><input type="text" id="newItemWidth" class="form-control" placeholder="Width"></div><div class="col"><input type="text" id="newItemVolume" class="form-control" placeholder="Volume"></div></div></div><!-- End of item volume --></div><div class="col-12 col-md-6"><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name == \'Container\'"><label for="newItemStats">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div></div></div><div class="form-separator"></div><div class="form-row"><div class="col"><!-- Item indicators --><fieldset class="form-group input-list input-list-wrap indicators"><legend>Indicators</legend><ul class="input-list-items"><!--<li class="form-check">\r\n\t\t\t\t\t\t\t<label class="form-check-label">\r\n\t\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" name="newItemIndicators[]">\r\n\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t<em class="icon icon-with-text icon-visible icon-rsi">Visible</em>\r\n\t\t\t\t\t\t\t\t\t<i class="icon"></i>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t</li>--><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-consumable icon-rsi">Consumable</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-container icon-rsi">Container</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-magical icon-rsi">Magical</em> <i class="icon"></i></span></label></li><!--<li class="form-check">\r\n\t\t\t\t\t\t\t<label class="form-check-label">\r\n\t\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" name="newItemIndicators[]">\r\n\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t<em class="icon icon-with-text icon-equipped icon-rsi">Equipped</em>\r\n\t\t\t\t\t\t\t\t\t<i class="icon"></i>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t</li>--><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-unidentified icon-rsi">Unidentified</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item indicators --></div></div><div class="form-separator"></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="Create()" class="btn btn-accent">{{buttontext}}</button></div><!--</div>\r\n\t</div>--></ng-form>');
$templateCache.put('/views/dialogs/createitems.html','<ng-form name="dlg" novalidate role="form"><!--<div class="modal-dialog" role="document">\r\n\t\t<div class="modal-content">--><div class="modal-header"><h5 class="modal-title" id="createItemPopupTitle">{{tabName}}</h5><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><div class="form-row"><div class="col-12 col-md-6" ng-repeat="property in Properties" ng-if="property.Name != \'Tags\' && (property.TypeId == 1 || property.TypeId == 15)"><!-- Item name --><div class="form-group"><label for="newItemName">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div><!-- End of item name --></div><!--<div class="col-12 col-md-6">\r\n\t\t\t\t\t\t\t<!-- Item command --><!--<div class="form-group">\r\n\t\t\t\t\t\t\t\t<label for="newItemCommand">Command</label>\r\n\t\t\t\t\t\t\t\t<span class="input-group-btn">\r\n\t\t\t\t\t\t\t\t\t<button type="button" title="Show Dice" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary"></button>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t<input type="text" id="newItemCommand" class="form-control" placeholder="Select dice">\r\n\t\t\t\t\t\t\t</div>--><!-- End of item command --></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item stats --><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name != \'Quantity\' && (property.TypeId == 19 || property.Name == \'Tags\')"><label for="newItemStats">{{property.Name}} {{property.TypeId == 14?"("+property.Value.Text+")":""}} {{property.TypeId == 7?"("+property.Value.Weight.units.selectedUnit+")":""}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div><!-- End of item stats --><!-- Item descriptopn \r\n\t\t\t\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t\t\t\t<label for="newItemDescription">Visible Description</label>\r\n\t\t\t\t\t\t\t\t<textarea id="newItemDescription" class="form-control" placeholder="About the item" rows="5"></textarea>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t End of item descriptopn --></div><div class="col-12 col-md-6"><!-- Image file --><div class="form-group input-image input-image-alt"><label for="newItemImageFile">Image</label><div class="input-image-control input-image-note input-image-trigger" style="width: 320px;height:320px" ng-hide="showimagebtns || Properties[1].Value.Image.image" ng-click="showimagebtns = true"><div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div></div><div class="input-image-control input-image-buttons" ng-show="showimagebtns" style="display:block;background-size:cover;cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{Properties[1].Value.Image.image?Properties[1].Value.Image.image:\'\'}}\')"><button type="button" ng-click="OpenBingSearch()" class="btn icon icon-with-text icon-globe btn-primary btn-block input-image-button-web">From Web</button> <button type="button" ng-click="OpenFile()" class="btn icon icon-with-text icon-computer btn-primary btn-block input-image-trigger input-image-button-computer">From Computer</button> <button type="button" ng-show="showimagebtns && Properties[1].Value.Image.image" class="btn btn-primary btn-block input-image-button-close" ng-click="Properties[1].Value.Image.image = null">Delete</button> <button type="button" ng-click="showimagebtns = false" class="btn btn-outline-primary btn-block input-image-button-close">Cancel</button></div><div ng-click="showimagebtns=true" class="input-image-control input-image-buttons" ng-show="!showimagebtns && Properties[1].Value.Image.image" style="background-size:cover; cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{Properties[1].Value.Image.image?Properties[1].Value.Image.image:\'\'}}\'); padding-top: 100px;padding-left:20px;padding-right: 20px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle"></div><input type="file" id="newRulesetImage" name="newRulesetImage" onchange="angular.element(this).scope().ItemImageUpload(this)" class="form-control-file"></div><!-- End of image file --></div></div><div class="form-separator"></div><div class="form-row"><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name != \'Quantity\' && (property.TypeId == 7 || property.TypeId == 7 || property.TypeId == 14)"><label for="newItemStats">{{property.Name}} {{property.TypeId == 14?"("+property.Value.Text+")":""}} {{property.TypeId == 7?"("+property.Value.Weight.units.selectedUnit+")":""}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name == \'Rarity\'"><label for="newItemStats">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item bolume --><div class="form-group"><label>Volume</label><div class="form-row"><div class="col"><input type="text" id="newItemHeight" class="form-control" placeholder="Height"></div><div class="col"><input type="text" id="newItemWidth" class="form-control" placeholder="Width"></div><div class="col"><input type="text" id="newItemVolume" class="form-control" placeholder="Volume"></div></div></div><!-- End of item volume --></div><div class="col-12 col-md-6"><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name == \'Container\'"><label for="newItemStats">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div></div></div><div class="form-separator"></div><div class="form-row"><div class="col"><!-- Item indicators --><fieldset class="form-group input-list input-list-wrap indicators"><legend>Indicators</legend><ul class="input-list-items"><!--<li class="form-check">\r\n\t\t\t\t\t\t\t\t\t\t<label class="form-check-label">\r\n\t\t\t\t\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" name="newItemIndicators[]">\r\n\t\t\t\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<em class="icon icon-with-text icon-visible icon-rsi">Visible</em>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="icon"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</li>--><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-consumable icon-rsi">Consumable</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-container icon-rsi">Container</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-magical icon-rsi">Magical</em> <i class="icon"></i></span></label></li><!--<li class="form-check">\r\n\t\t\t\t\t\t\t\t\t\t<label class="form-check-label">\r\n\t\t\t\t\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" name="newItemIndicators[]">\r\n\t\t\t\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<em class="icon icon-with-text icon-equipped icon-rsi">Equipped</em>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="icon"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</li>--><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-unidentified icon-rsi">Unidentified</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item indicators --></div></div><div class="form-separator"></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item spells --><div class="form-group"><label for="newItemSpells">Associated spell(s)</label><span class="input-group-btn"><button type="button" class="btn icon icon-search btn-simple-primary" ng-click="OpenAssociatedSpells()"></button> </span><input type="text" id="newItemSpells" class="form-control" placeholder="Search spell(s)"></div><!-- End of item spells --></div><div class="col-12 col-md-6"><!-- Item abilities --><div class="form-group"><label for="newItemAbilities">Associated abilit(ies)</label><span class="input-group-btn"><button type="button" class="btn icon icon-search btn-simple-primary" ng-click="OpenAssociatedAbilities()"></button> </span><input type="text" id="newItemAbilities" class="form-control" placeholder="Search abilit(ies)"></div><!-- End of item abilities --></div></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="Create()" class="btn btn-accent">{{buttontext}}</button></div><!--</div>\r\n\t</div>--></ng-form>');
$templateCache.put('/views/dialogs/createspells.html','<ng-form name="dlg" novalidate role="form"><!--<div class="modal-dialog" role="document">\r\n\t\t<div class="modal-content">--><div class="modal-header"><h5 class="modal-title" id="createItemPopupTitle">{{tabName}}</h5><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><div class="form-row"><div class="col-12 col-md-6" ng-repeat="property in Properties" ng-if="property.Name != \'Tags\' && (property.TypeId == 1 || property.TypeId == 15)"><!-- Item name --><div class="form-group"><label for="newItemName">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div><!-- End of item name --></div><!--<div class="col-12 col-md-6">\r\n\t\t\t\t<!-- Item command --><!--<div class="form-group">\r\n\t\t\t\t<label for="newItemCommand">Command</label>\r\n\t\t\t\t<span class="input-group-btn">\r\n\t\t\t\t\t<button type="button" title="Show Dice" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary"></button>\r\n\t\t\t\t</span>\r\n\t\t\t\t<input type="text" id="newItemCommand" class="form-control" placeholder="Select dice">\r\n\t\t\t</div>--><!-- End of item command --></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item stats --><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name != \'Quantity\' && (property.TypeId == 19 || property.Name == \'Tags\')"><label for="newItemStats">{{property.Name}} {{property.TypeId == 14?"("+property.Value.Text+")":""}} {{property.TypeId == 7?"("+property.Value.Weight.units.selectedUnit+")":""}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div><!-- End of item stats --><!-- Item descriptopn\r\n\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t<label for="newItemDescription">Visible Description</label>\r\n\t\t\t\t\t<textarea id="newItemDescription" class="form-control" placeholder="About the item" rows="5"></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t\t End of item descriptopn --></div><div class="col-12 col-md-6"><!-- Image file --><div class="form-group input-image input-image-alt"><label for="newItemImageFile">Image</label><div class="input-image-control input-image-note input-image-trigger" style="width: 320px;height:320px" ng-hide="showimagebtns || Properties[1].Value.Image.image" ng-click="showimagebtns = true"><div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div></div><div class="input-image-control input-image-buttons" ng-show="showimagebtns" style="display:block;background-size:cover;cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{Properties[1].Value.Image.image?Properties[1].Value.Image.image:\'\'}}\')"><button type="button" ng-click="OpenBingSearch()" class="btn icon icon-with-text icon-globe btn-primary btn-block input-image-button-web">From Web</button> <button type="button" ng-click="OpenFile()" class="btn icon icon-with-text icon-computer btn-primary btn-block input-image-trigger input-image-button-computer">From Computer</button> <button type="button" ng-show="showimagebtns && Properties[1].Value.Image.image" class="btn btn-primary btn-block input-image-button-close" ng-click="Properties[1].Value.Image.image = null">Delete</button> <button type="button" ng-click="showimagebtns = false" class="btn btn-outline-primary btn-block input-image-button-close">Cancel</button></div><div ng-click="showimagebtns=true" class="input-image-control input-image-buttons" ng-show="!showimagebtns && Properties[1].Value.Image.image" style="background-size:cover; cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{Properties[1].Value.Image.image?Properties[1].Value.Image.image:\'\'}}\'); padding-top: 100px;padding-left:20px;padding-right: 20px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle"></div><input type="file" id="newRulesetImage" name="newRulesetImage" onchange="angular.element(this).scope().ItemImageUpload(this)" class="form-control-file"></div><!-- End of image file --></div></div><div class="form-separator"></div><div class="form-row"><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name != \'Quantity\' && (property.TypeId == 7 || property.TypeId == 7 || property.TypeId == 14)"><label for="newItemStats">{{property.Name}} {{property.TypeId == 14?"("+property.Value.Text+")":""}} {{property.TypeId == 7?"("+property.Value.Weight.units.selectedUnit+")":""}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name == \'Rarity\'"><label for="newItemStats">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div></div><div class="form-row"><div class="col-12 col-md-6"><!-- Item bolume --><div class="form-group"><label>Volume</label><div class="form-row"><div class="col"><input type="text" id="newItemHeight" class="form-control" placeholder="Height"></div><div class="col"><input type="text" id="newItemWidth" class="form-control" placeholder="Width"></div><div class="col"><input type="text" id="newItemVolume" class="form-control" placeholder="Volume"></div></div></div><!-- End of item volume --></div><div class="col-12 col-md-6"><div class="col-12 col-md-6"><div class="form-group" ng-repeat="property in Properties" ng-if="property.Name == \'Container\'"><label for="newItemStats">{{property.Name}}</label><rpgsmithtype info="property" fullscope="Properties" mode="\'{{OperationTypeMode}}\'"></rpgsmithtype></div></div></div></div><div class="form-separator"></div><div class="form-row"><div class="col"><!-- Item indicators --><fieldset class="form-group input-list input-list-wrap indicators"><legend>Indicators</legend><ul class="input-list-items"><!--<li class="form-check">\r\n\t\t\t\t\t\t\t<label class="form-check-label">\r\n\t\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" name="newItemIndicators[]">\r\n\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t<em class="icon icon-with-text icon-visible icon-rsi">Visible</em>\r\n\t\t\t\t\t\t\t\t\t<i class="icon"></i>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t</li>--><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-consumable icon-rsi">Consumable</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-container icon-rsi">Container</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-magical icon-rsi">Magical</em> <i class="icon"></i></span></label></li><!--<li class="form-check">\r\n\t\t\t\t\t\t\t<label class="form-check-label">\r\n\t\t\t\t\t\t\t\t<input class="form-check-input" type="checkbox" name="newItemIndicators[]">\r\n\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t<em class="icon icon-with-text icon-equipped icon-rsi">Equipped</em>\r\n\t\t\t\t\t\t\t\t\t<i class="icon"></i>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t</li>--><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="newItemIndicators[]"> <span><em class="icon icon-with-text icon-unidentified icon-rsi">Unidentified</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item indicators --></div></div><div class="form-separator"></div><!--<div class="form-row">\r\n\t\t\t<div class="col-12 col-md-6">\r\n\t\t\t\t\r\n\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t<label for="newItemSpells">Associated Items(s)</label>\r\n\t\t\t\t\t<span class="input-group-btn">\r\n\t\t\t\t\t\t<button type="button" class="btn icon icon-search btn-simple-primary" ng-click="OpenAssociatedSpells()"></button>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<input type="text" id="newItemSpells" class="form-control" placeholder="Search spell(s)">\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<div class="col-12 col-md-6">\r\n\t\t\t\t\r\n\t\t\t\t<div class="form-group">\r\n\t\t\t\t\t<label for="newItemAbilities">Associated abilit(ies)</label>\r\n\t\t\t\t\t<span class="input-group-btn">\r\n\t\t\t\t\t\t<button type="button" class="btn icon icon-search btn-simple-primary" ng-click="OpenAssociatedAbilities()"></button>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<input type="text" id="newItemAbilities" class="form-control" placeholder="Search abilit(ies)">\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t</div>--></div><div class="modal-footer"><button type="button" data-dismiss="modal" ng-click="cancel()" class="btn btn-simple-accent">Cancel</button> <button type="button" ng-click="Create()" class="btn btn-accent">{{buttontext}}</button></div><!--</div>\r\n\t</div>--></ng-form>');
$templateCache.put('/views/dialogs/defaultdiceselection.html','<div class="popup-dice"><div class="modal-header"><h5 class="modal-title" id="dicePopupTitle">Dice</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form id="diceareaforselection"><!-- Saved commands --><div id="savedattackoptions" class="form-group saved-commands"><label>Saved Commands</label><div class="command-list"><ul><li ng-repeat="name in DiceList"><button type="button" class="btn" ng-click="ShowCommand(name.Name)">{{name.Name}}</button></li></ul></div></div><!-- End of saved commands --><!-- New command (initial) --><div class="form-group new-command initial"><label>Command*</label><!-- Command console --><div class="command-console form-row"><div class="col-12 col-md-9"><input type="text" id="customset" class="form-control" placeholder="Enter the comand here or click on the dice to generate"></div><div class="d-flex col-12 col-md-3"><button type="button" id="addmod" class="btn btn-primary btn-block" ng-click="AddNumericCorestats()">Add Mod</button></div></div><!-- End of command console --><!-- Dice canvas --><div class="command-canvas"><ul><li><button type="button" class="btn icon icon-rsi icon-d4-thin" onclick="dicecommandsearch(\'d4\')"><span>D4 <em>4</em></span></button></li><li><button type="button" class="btn icon icon-rsi icon-d6-thin" onclick="dicecommandsearch(\'d6\')"><span>D6 <em>6</em></span></button></li><li><button type="button" class="btn icon icon-rsi icon-d8-thin" onclick="dicecommandsearch(\'d8\')"><span>D8 <em>8</em></span></button></li><li><button type="button" class="btn icon icon-rsi icon-d10-thin" onclick="dicecommandsearch(\'d10\')"><span>D10 <em>10</em></span></button></li><li><button type="button" class="btn icon icon-rsi icon-d12-thin" onclick="dicecommandsearch(\'d12\')"><span>D12 <em>12</em></span></button></li><li><button type="button" class="btn icon icon-rsi icon-d20-thin" onclick="dicecommandsearch(\'d20\')"><span>D20 <em>20</em></span></button></li><li><button type="button" class="btn icon icon-rsi icon-d10-thin" onclick="dicecommandsearch(\'d100\')"><span>D100 <em>100</em></span></button></li><li><button type="button" class="btn icon icon-reset" onclick="diceCommandClear()"></button></li></ul></div><!-- End of dice canvas --><!-- Dice actions --><div class="command-actions form-row"><div class="d-flex col-12 col-md-6"><button type="button" id="defaultDiceSelect" class="btn btn-accent btn-block" ng-click="DefaultDiceSelect()">Ok</button></div><div class="d-flex col-12 col-md-6"><button type="button" id="dicesavecommand" class="btn btn-accent btn-block" ng-click="DiceSaveCommand()">Save</button></div><div class="d-flex col-12 col-md-6"><button type="button" id="diceRollTrigger" class="btn btn-accent btn-block" onclick="DiceCommandRoll()">Roll</button></div></div><!-- End of dice actions --></div><!-- End of new command (initial) --><!-- Last rolled result --> <input type="text" id="set" style="background-color: rgba(3, 169, 244, 0.5);display:none"><div id="lastDiceRollResult" class="command-last-result form-group"><label>Last Result</label><p><strong><input id="lastrunresult" type="text" class="form-control" value="Dice not rolled yet..." disabled="disabled"></strong></p></div><!-- End of last rolled result --></form><div id="diceareaforroll" style="display:none"><!--<div id="info_div" style="display: none">\r\n\r\n            <div class="row">\r\n                <div class="col-md-12">\r\n                    <p>Click Ok to Continue (or) Click Roll Again or drag on the dice to roll dice again.</p>\r\n                </div>\r\n            </div>\r\n\r\n\r\n\r\n            <!--<div class="center_field">\r\n                <span id="label"></span>\r\n            </div>--><!--<div class="center_field">\r\n                <div class="bottom_field">\r\n                    <span id="labelhelp">click to continue or tap and drag again</span>\r\n                </div>\r\n            </div>\r\n\r\n        </div>--><!--  <div id="selector_div" style="display: none">\r\n             <div class="center_field">\r\n                 <div id="sethelp">\r\n\r\n                 </div>\r\n             </div>\r\n            <div class="center_field">\r\n                 <input type="text" id="set" value="4d6" style="background-color: rgba(3, 169, 244, 0.5);visibility:hidden;" /><br />\r\n                 <button id="throw">Roll</button>\r\n                 <button id="clear">clear</button>\r\n                 <button id="addmod" ng-click="AddNumericCorestats()">Add Mod</button>\r\n                 <button id="defaultdiceselect" ng-click="DefaultDiceSelect()">Ok</button>\r\n                 <button id="dicesavecommand" ng-click="DiceSaveCommand()">Save</button>\r\n             </div>\r\n         </div>--> <input type="text" id="customsetatroll" class="form-control" placeholder="Enter the comand here or click on the dice to generate" disabled="disabled"><div id="canvas"><canvas width="1365" height="345"></canvas></div><div class="popup-dice"><div class="new-command result"><div id="showdicerollresult" class="command-canvas"><ul><li><button class="btn" type="button"><em id="showdicerollresult_d4">0</em> <span class="icon icon-with-text icon-d6 icon-rsi">d4</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_d6">0</em> <span class="icon icon-with-text icon-d6 icon-rsi">d6</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_d8">0</em> <span class="icon icon-with-text icon-d12 icon-rsi">d8</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_d10">0</em> <span class="icon icon-with-text icon-d20 icon-rsi">d10</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_d12">0</em> <span class="icon icon-with-text icon-d20 icon-rsi">d12</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_d20">0</em> <span class="icon icon-with-text icon-d20 icon-rsi">d20</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_d100">0</em> <span class="icon icon-with-text icon-d20 icon-rsi">d100</span></button></li><li><button class="btn" type="button"><em id="showdicerollresult_Sum">0</em></button></li></ul></div></div></div><div class="row"><div class="col-md-12"><input type="text" id="rollresult" class="form-control" value="12"></div></div><div class="command-actions form-row"><div class="d-flex col-12 col-md-6"><button type="button" id="diceShowDiceTrigger" class="btn btn-accent btn-block" onclick="dicerollcomplete()">Show Dice</button></div><div class="d-flex col-12 col-md-6"><button type="button" id="diceRollAgainTrigger" class="btn btn-accent btn-block" onclick="customrolediceagain()">Roll Again</button></div></div></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-outline-accent" ng-click="cancel()">Close</button></div></div>');
$templateCache.put('/views/dialogs/edit-character.html','<!--https://github.com/m-e-conroy/angular-dialog-service--><div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit">Editing {{item.name}}</span> <span ng-show="!isEdit">New Character</span></h4></div><div class="modal-body"><ng-form name="dlg" novalidate role="form"><div class="form-group input-group-lg" ng-class="{true: \'has-error\'}[dlg.name.$dirty && dlg.name.$invalid]"><span class="help-block">Character Name</span> <input type="text" class="form-control" name="name" id="name" ng-model="item.name" required></div><div class="form-group input-group-lg"><span class="help-block">Character Portrait</span><div class="clearfix"><div class="pull-left edit-character-portrait"><img ngf-thumbnail="getThumbNail()" class="edit-character-portrait" ngf-resize="{width: 120, height: 120}"></div><div class="pull-left btn btn-default edit-character-portrait-button" name="file" ng-model="file" ngf-select ngf-resize="{width: 120, height: 120, quality: 0.8, centerCrop: true}" ngf-fix-orientation="true" ngf-pattern="\'image/*\'" ngf-accept="\'image/*\'">Select</div></div><span class="help-block">120px by 120px</span></div><div class="form-group"><span class="help-block">Select RuleSet</span><div class=""><select class="form-control" style="width:52% !important; display:inline-block;margin-right:10px"><option>RuleSet 1</option><option>RuleSet 2</option><option>RuleSet 3</option></select><span>Or</span><div style="display:inline-block;margin-left:14px"><a href="http://localhost:5000/characters/NewRuleSet" ng-click="cancel()" class="btn btn-primary">Add RuleSet</a></div></div></div></ng-form></div><div class="modal-footer" style="border-top:1px solid #fff"><!--<button type="button" class="btn btn-primary" ng-click="NewRuleSet();"><i style="color:#fff;" class="fa fa fa-plus"></i> Add RuleSet</button>--> <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="(dlg.$dirty && dlg.$invalid) || dlg.$pristine">Save</button></div>');
$templateCache.put('/views/dialogs/ExistingRuleset.html','<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><style>.mt-20 {\r\n            margin-top: 50px; \r\n            margin-bottom: 50px;\r\n        }\r\n        .mb-20 {\r\n            margin-bottom: 20px;\r\n        }\r\n        .mt-20 {\r\n            margin-top: 20px;\r\n        }\r\n        .lead {\r\n            margin-bottom: 0;\r\n        }\r\n        .panel-success {\r\n            box-shadow: 2px 3px 5px rgba(204, 204, 204, 0.55);\r\n        }\r\n        .panel-success > .panel-heading {\r\n            color: #666;\r\n            background-color: rgba(96, 125, 139, 0.38);\r\n            border-color: #d6e9c6;\r\n        }</style></head><body><pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><div class="container mt-20"><div class="row"><div class="panel panel-success"><div class="panel-heading"><h4 class="lead text-center">Existing RuleSet</h4></div><div class="panel-body"><a class="pull-right btn btn-primary btn-md mb-20" ng-href="http://localhost:5000/characters/NewRuleSet">Add Rule Set</a><p id="nodata" class="lead text-center">No RuleSet Available..</p><div id="CoreStateData" style="display:none"><table class="table table-bordered"><thead><tr><th>SNO</th><th>Name</th><th>Type</th></tr></thead><tbody><tr><td>1</td><td>---- No coreset Selected----</td><td>---- No coreset Selected----</td></tr></tbody></table></div></div></div></div></div></body></html>');
$templateCache.put('/views/dialogs/Imagetilecontent.html','<style>.modal-content {\r\n        width: 700px;\r\n        top: 34px;\r\n        left: 72px;\r\n    }</style><div class="notetileView"><div class="modal-header"><h4 class="modal-title" style="text-align:center">{{Content.Value.Imagetile.Name}}</h4></div><div class="modal-body"><div class="row"><div class="col-md-12"><div class="form-horizontal"><img ng-src="{{Content.Value.Imagetile.Imagepath}}" class="img-resposive img_center" width="300" height="500" style="align-content:center"></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-accent" ng-click="cancel()">Close</button><!--<button type="submit" class="btn btn-primary" ng-click="SaveTile()" ng-disabled="theForm.$invalid">Save</button>--></div></div>');
$templateCache.put('/views/dialogs/manageruleset.html','<div class="page-rulesets"><div class="popup-new-ruleset-manage"><div class="modal-header"><h6 class="modal-title" id="newRulesetPopupTitle">Rule Set Properties</h6><span class="modal-title"><!--<img style="width: 40px;height: 30px;" ng-src="{{GeneralSettings[2].Value.Image.image?GeneralSettings[2].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" onerror="this.src=\'/wwwroot/images/not-available.jpg\'" />--><label>{{GeneralSettings[0].RulesetName}}</label></span><button type="button" class="btn icon btn-simple-primary download"><i class="fa fa-download" ng-click="ExportRuleSet()" aria-hidden="true"></i></button> <button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><ul class="list-unstyled"><li><!--<a href="./Corestats" class="btn icon icon-with-text icon-external btn-accent">Manage Core Stats</a>--> <button type="button" class="btn icon icon-with-text icon-external btn-accent" ng-click="ShowAllRulesetContent(\'General\')">General Settings</button></li><li><!--<a href="./Corestats" class="btn icon icon-with-text icon-external btn-accent">Manage Core Stats</a>--> <button type="button" class="btn icon icon-with-text icon-external btn-accent" ng-click="ShowAllRulesetContent(\'Corestat\')">Character Stats</button></li><li><!--<a href="#" class="btn icon icon-with-text icon-external btn-accent" ng-click="ShowAllRulesetContent(\'Items\')">Manage Items</a>--> <button type="button" class="btn icon icon-with-text icon-external btn-accent" ng-click="ShowAllRulesetContent(\'Items\')">Item Templates</button></li><li><button type="button" class="btn icon icon-with-text icon-external btn-accent" ng-click="ShowAllRulesetContent(\'Spells\')">Spells</button></li><li><button type="button" class="btn icon icon-with-text icon-external btn-accent" ng-click="ShowAllRulesetContent(\'Abilities\')">Abilities</button></li></ul></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button><!--<button type="button" class="btn btn-accent" ng-click="save()">Next</button>--></div></div></div><!--<toaster-container toaster-options="{\'position-class\': \'toast-top-right\'}" style=" left: 50%; position: fixed;"></toaster-container>-->');
$templateCache.put('/views/dialogs/notetilecontent.html','<style>.modal-content {\r\n        width: 500px;\r\n        top: 34px;\r\n        left: 72px;\r\n    }\r\n\t.modal-footer {\r\n\t\tpadding-top: 5px;\r\n\t}\r\n\tbutton {\r\n\t\tborder-width: 1px;\r\n\t\tborder-color: #ff6a00;\r\n\t}</style><div class="notetileView"><div class="modal-header"><h4 class="modal-title" style="text-align:center">{{Content.Value.Note.Name}}</h4></div><div class="modal-body"><div class="row" style="background-color: white;margin: 3px"><div class="col-md-12"><div class="form-horizontal"><p ng-bind-html="Content.Value.Note.Text"></p></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default-focus" ng-click="cancel()">Close</button><!--<button type="submit" class="btn btn-primary" ng-click="SaveTile()" ng-disabled="theForm.$invalid">Save</button>--></div></div>');
$templateCache.put('/views/dialogs/ruleset-abilities.html','<div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><!-- End of search query --><!-- Item rulesets --><fieldset class="form-group input-list input-list-wrap items"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/boots.jpg" alt="Boots"> <em>Boots</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/bow.jpg" alt="Bow"> <em>Bow</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/golden-ring.jpg" alt="Golden Ring"> <em>Golden Ring</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/halberd.jpg" alt="Halberd"> <em>Halberd</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/shield.jpg" alt="Shield"> <em>Shield</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/silver-ring.jpg" alt="Silver Ring"> <em>Silver Ring</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent">Cancel</button> <button type="button" class="btn btn-accent">Add</button></div><!--<div class="container body-content item_properties">\r\n\r\n    <div class="row">\r\n        <div class="col-md-8 col-sm-8 table-responsive" style="margin-left:50px;">\r\n            <table class="table">\r\n                <thead>\r\n                    <tr>\r\n                        <th>S.No</th>\r\n                        <th>IMAGE</th>\r\n                        <th>NAME</th>\r\n                        <th>Stats</th>\r\n                        <th>DESCRIPTION</th>\r\n                        <th>Quantity</th>\r\n                        <th>ATTRIBUTES</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr>\r\n                        <td>{{$index + 1}}</td>\r\n                        <td><img ng-src="{{Properties.AbilityProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120" /></td>\r\n                        <td>{{Properties.AbilityProperties[0].Value.Text.value}}</td>\r\n                        <td>{{Properties.AbilityProperties[2].Value.Text.value}}</td>\r\n                        <td>{{Properties.AbilityProperties[9].Value.Text.value}}</td>\r\n                        <td>{{Properties.AbilityProperties[3].Value.Number.value}}</td>\r\n                        <td>\r\n                            <div class="icon_box"><p style="width:104px;"><span>{{Properties.AbilityProperties[13].Name}}</span> <span> {{Properties.AbilityProperties[13].Value.YesOrNo.value}}</span></p></div>\r\n                            <div class="icon_box"><span>{{Properties.AbilityProperties[17].Value.YesOrNo.value}}</span></div>\r\n                            <div class="icon_box"><span>M</span></div>\r\n\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n\r\n        </div>\r\n    </div>\r\n\r\n\r\n\r\n</div>-->');
$templateCache.put('/views/dialogs/ruleset-spells.html','<!-- Add item popup --><!--<div class="modal fade popup-add-item" id="addItemPopup" tabindex="-1" role="dialog" aria-labelledby="addItemPopupTitle" aria-hidden="true" data-backdrop="static">\r\n\t<div class="modal-dialog" role="document">--><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="addItemPopupTitle">Add From Ruleset</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><!-- End of search query --><!-- Item rulesets --><fieldset class="form-group input-list input-list-wrap items"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/boots.jpg" alt="Boots"> <em>Boots</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/bow.jpg" alt="Bow"> <em>Bow</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/golden-ring.jpg" alt="Golden Ring"> <em>Golden Ring</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/halberd.jpg" alt="Halberd"> <em>Halberd</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/shield.jpg" alt="Shield"> <em>Shield</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/silver-ring.jpg" alt="Silver Ring"> <em>Silver Ring</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent">Cancel</button> <button type="button" class="btn btn-accent">Add</button></div></div><!--</div>\r\n</div>--><!-- End of add item popup -->');
$templateCache.put('/views/dialogs/RuleSet.html','<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><script src="~/Scripts/jquery-1.10.2.min.js"></script><script src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.js" type="text/javascript"></script><style>.lead {\r\n            margin-bottom: 0;\r\n            line-height: normal;\r\n        }\r\n\r\n        .mt-20 {\r\n            margin-top: 50px;\r\n            margin-bottom: 50px;\r\n        }\r\n\r\n        .mb-20 {\r\n            margin-bottom: 20px;\r\n        }\r\n\r\n        .mt-20 {\r\n            margin-top: 20px;\r\n        }\r\n\r\n        .mt-40 {\r\n            margin-top: 40px;\r\n        }\r\n\r\n\r\n        h2, p, h4 {\r\n            color: #777 !important;\r\n        }\r\n\r\n        .panel-success {\r\n            box-shadow: 2px 3px 5px rgba(204, 204, 204, 0.55);\r\n        }\r\n\r\n            .panel-success > .panel-heading {\r\n                color: #000;\r\n                background-color: rgba(96, 125, 139, 0.38);\r\n                border-color: #d6e9c6;\r\n            }\r\n\r\n        .panel-default > .panel-heading {\r\n            color: #000;\r\n            background-color: rgba(96, 125, 139, 0.38);\r\n            border-color: #d6e9c6;\r\n        }</style></head><body><pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><div class="container"><div class="row"><div class="panel panel-success mt-20"><div class="panel-heading"><h4 class="lead text-center">Add Rule Set</h4></div><div class="panel-body"><div class=""><div class="form-group"><label class="control-label col-md-4">Default Dice 124</label><div class="col-md-8 mb-20"><select class="form-control"><option>Dice 1</option><option>Dice 2</option></select></div></div></div><div class=""><div class="form-group"><label class="control-label col-md-4">Weight Metric Label</label><div class="col-md-8"><input type="number" min="0" class="form-control"></div></div></div><hr></div><div class="container"><div class="row panel panel-default mt-20"><div class="panel-heading"><h4 class="lead text-center">Character Stats</h4></div><button id="NewCoreState" type="button" style="position: relative;right: 1px;top: -44px" class="pull-right btn btn-primary btn-md" data-toggle="modal" data-target="#myModal"><i style="color:#fff" class="fa fa-plus"></i>&nbsp;Add New Character Stats</button><p id="nodata" class="lead text-center" style="margin-top:10px;margin-bottom:10px">No Character Stats Available..</p><div id="CoreStateData" style="display:none"><table style="width: 93%;margin-top: 2%;margin-left: 4%" class="table table-bordered table-striped" id="tableAttendees"><thead><tr><th width="10%">S.No.</th><th width="30%">Name</th><th width="30%">Type</th><th width="30%">Action</th></tr></thead><tbody><!-- <tr>\r\n                                        <!--<td>1</td>\r\n                                        <td>---- No coreset Selected----</td>\r\n                                        <td>---- No coreset Selected----</td>\r\n                                    </tr>--></tbody></table></div></div></div></div></div></div><div class="modal fade" id="myModal" role="dialog"><div class="modal-dialog"><!-- Modal content--><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title"><i class="fa fa-plus"></i> Add New Character Stat</h4></div><div class="modal-body"><ng-form name="userForm" novalidate role="form"><div class="form-group"><label class="control-label col-md-4">Name</label><div class="col-md-8 mb-20"><input id="Name" type="text" ng-model="name" class="form-control"></div><span style="color:red" ng-show="myForm.user.$dirty && myForm.user.$invalid"><span ng-show="myForm.user.$error.required">Username is required.</span></span><p ng-show="userForm.name.$invalid && !userForm.name.$pristine" class="help-block">name is required.</p><!--<span style="color:red;display:none;" id="errorName"></span>--></div><div class="form-group"><label class="control-label col-md-4">Type</label><div class="col-md-8 mb-20"><input id="type" type="text" ng-model="type" class="form-control"></div><p ng-show="userForm.type.$invalid && !userForm.type.$pristine" class="help-block">Type is required.</p><!--<span style="color:red;display:none;" id="errorType"></span>--></div><div class="modal-footer" style="border-top:1px solid #fff"><button type="button" class="btn btn-primary" ng-disabled="myForm.name.$dirty && myForm.name.$invalid ||myForm.type.$dirty && myForm.type.$invalid" data-dismiss="modal" id="click">Save</button> <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button></div></ng-form></div><!--ng-disabled="(userForm.$dirty && userForm.$invalid) || userForm.$pristine"--></div></div></div></body></html><script id="personsTmpl" type="text/x-jquery-tmpl"><tr>\r\n        <td>${sno}</td>\r\n        <td>${Name}</td>\r\n        <td>${Type}</td>\r\n        <td>\r\n            <button class="btn btn-primary editclick" type="button" id="Edit_${sno}"><i style="color:#fff" class="fa fa-edit"></i> Edit</button>\r\n            <button class="btn btn-danger Deleteclick" type="button" id="Delete_${sno}"><i style="color:#fff" class="fa fa-remove"></i> Delete</button>\r\n        </td>\r\n    </tr></script><script>$(document).ready(function () {\r\n        $("#click").attr("disabled", true);\r\n        var model = sessionStorage.getItem("CoreStatData");\r\n        if (model != "") {\r\n            //alert(model);\r\n        }\r\n    });\r\n    $("#NewCoreState").click(function () {\r\n        $("#click").attr("disabled", true);\r\n        $("#Name").val(\'\');\r\n        $("#type").val(\'\');\r\n    });\r\n    $("#type").keypress(function () {\r\n        $("#click").attr("disabled", false);\r\n    })\r\n    $(\'.editclick\').on(\'click\', \'a\', function () { alert("hit") });\r\n    //$(".editclick").bind("click", function () {\r\n    //  alert("hit")\r\n    //})\r\n    var i = 0; var modelobject = {};\r\n    $(function () {\r\n        $(\'#click\').click(function (e) {\r\n            i = i + 1;\r\n            var model = new Object();\r\n            var array = []; \r\n            // Here you need to get the values using $(\'#id\').val() and fill the model\r\n            if ($("#Name").val() != "" && $("#type").val() != "") {\r\n                model.sno = i;\r\n                model.Name = $("#Name").val();\r\n                model.Type = $("#type").val();\r\n                modelobject.sno = model.sno;\r\n                modelobject.Name = model.Name;\r\n                modelobject.Type = model.Type;\r\n                //sessionStorage.setItem("CoreStatData", array);\r\n                //var model1 = sessionStorage.getItem("CoreStatData");\r\n                //array.push(JSON.stringify(model1));\r\n                $("#Name").val(\'\');\r\n                $("#type").val(\'\');\r\n                $("#nodata").hide();\r\n                $("#CoreStateData").show();\r\n                $("#tableAttendees > tbody").append("<tr><td>" + i + "</td><td>" + model.Name + "</td><td>" + model.Type + "</td><td><button type=\'button\' class=\'btn btn-primary editclick\'><i style=\'color:#fff\' class=\'fa fa-edit\'></i> Edit</button>&nbsp;&nbsp;&nbsp;<button type=\'button\' class=\'btn btn-danger Deleteclick\'><i style=\'color:#fff\' class=\'fa fa-remove\'></i> Delete</button></td></tr>");\r\n              //  $("#personsTmpl").tmpl(model).appendTo("#tableAttendees");\r\n                $("#errorName").hide();\r\n                $("#errorType").hide();\r\n                $("#click").attr("disabled", false);\r\n                return true;\r\n            }\r\n            else if ($("#Name").val() == "") {\r\n                $("#errorName").show();\r\n                $("#errorName").html("Required");\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n            else {\r\n                $("#errorType").show();\r\n                $("#errorType").html("Required");\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n        });\r\n\r\n    });</script>');
$templateCache.put('/views/dialogs/rulesetgeneralsettings.html','<div class="modal-header"><h5 class="modal-title" id="newRulesetPopupTitle">{{pageName}}</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body table_align" style="overflow-y: auto; max-height: 670px;max-width: 600px"><ng-form name="form"><div class="form-row"><div class="col"><!-- RuleSet name --><div class="form-group"><label for="newRulesetCharacterName">Name (required)</label><input type="text" class="form-control" name="name" id="name" ng-model="GeneralSettings[0].RulesetName" ng-class="{red: form.name.$dirty && form.name.$error.required}" ng-disabled="{{DisableName}}" required></div><!-- End of RuleSet name --></div></div><div class="form-row"><div class="col"><div class="form-group"><label for="newRulesetDice">{{GeneralSettings[6].Name}}</label><rpgsmithrulesettype info="GeneralSettings[6]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype></div></div></div><div class="form-row"><div class="col"><div class="form-group"><label for="newRulesetDice">{{GeneralSettings[0].Name}}</label><rpgsmithrulesettype info="GeneralSettings[0]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype></div></div></div><div class="form-row"><div class="col" style="padding-right: 10px"><div class="form-group"><label for="newRulesetDice">{{GeneralSettings[3].Name}}</label><rpgsmithrulesettype info="GeneralSettings[3]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype></div><div class="form-group"><label for="newRulesetDice">{{GeneralSettings[1].Name}}</label><rpgsmithrulesettype info="GeneralSettings[1]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype></div><div class="form-group"><label for="newRulesetDice">{{GeneralSettings[4].Name}}</label><rpgsmithrulesettype info="GeneralSettings[4]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype></div><div class="form-group"><label for="newRulesetDice">{{GeneralSettings[5].Name}}</label><rpgsmithrulesettype info="GeneralSettings[5]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype></div></div><div class="col"><!-- Ruleset image --><div class="form-group input-image input-image-alt"><label for="newRulesetImage">Image</label><div class="input-image-control input-image-note input-image-trigger" ng-hide="showimagebtns || GeneralSettings[2].Value.Image.image" ng-click="showimagebtns=true"><div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div></div><div class="input-image-control input-image-buttons" ng-show="showimagebtns" style="display:block;background-size:cover;cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{GeneralSettings[2].Value.Image.image?GeneralSettings[2].Value.Image.image:\'\'}}\')"><button type="button" ng-click="OpenBingSearch()" class="btn icon icon-with-text icon-globe btn-primary btn-block input-image-button-web">From Web</button> <button type="button" ng-click="OpenFile()" class="btn icon icon-with-text icon-computer btn-primary btn-block input-image-trigger input-image-button-computer">From Computer</button> <button type="button" ng-show="showimagebtns && GeneralSettings[2].Value.Image.image" class="btn btn-primary btn-block input-image-button-close" ng-click="GeneralSettings[2].Value.Image.image = null">Delete</button> <button type="button" ng-click="showimagebtns = false" class="btn btn-outline-primary btn-block input-image-button-close">Cancel</button></div><div ng-click="showimagebtns=true" class="input-image-control input-image-buttons" ng-show="!showimagebtns && GeneralSettings[2].Value.Image.image" style="background-size:cover; cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{GeneralSettings[2].Value.Image.image?GeneralSettings[2].Value.Image.image:\'\'}}\'); padding-top: 100px;padding-left:20px;padding-right: 20px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle"></div><input type="file" id="newRulesetImage" onchange="angular.element(this).scope().ItemImageUpload(this)" class="form-control-file"></div><!-- End of ruleset image --><!-- Ruleset image --><!--<div class=" form-group input-image input-image-alt">\r\n\t\t\t\t\t<label for="newRulesetImage">Image</label>\r\n\t\t\t\t\t<div class="input-image-control input-image-note input-image-trigger" ng-hide="showimagebtns || GeneralSettings[2].Value.Image.image" ng-click="showimagebtns = true" style="padding-top: 60px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle; ">\r\n\t\t\t\t\t\t<div class="icon icon-upload"><span>Click here to upload.</span><small>(320 x 320 px)</small></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="input-image-control" ng-show="showimagebtns"   style="background-size:cover;cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{GeneralSettings[2].Value.Image.image?GeneralSettings[2].Value.Image.image:\'\'}}\'); top:0px;max-height: 320px;max-width:320px;background-color: #d3cfce;">\r\n\t\t\t\t\t\t<button type="button" ng-click="OpenBingSearch()" class="btn icon icon-with-text icon-globe btn-primary btn-block input-image-button-web">From Web</button>\r\n\t\t\t\t\t\t<button type="button" ng-click="OpenFile()" class="btn icon icon-with-text icon-computer btn-primary btn-block input-image-trigger input-image-button-computer">From Computer</button>\r\n\t\t\t\t\t\t<button type="button" ng-show="showimagebtns && GeneralSettings[2].Value.Image.image" class="btn btn-primary btn-block input-image-button-close" ng-click="GeneralSettings[2].Value.Image.image = null">Delete</button>\r\n\t\t\t\t\t\t<button type="button" class="btn btn-outline-primary btn-block input-image-button-close" ng-click="showimagebtns = false">Cancel</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div ng-click="showimagebtns=true" class="input-image-control input-image-buttons" ng-show="!showimagebtns && GeneralSettings[2].Value.Image.image" style="background-size:cover; cursor: pointer ; background-repeat: no-repeat; background-image: url(\'{{GeneralSettings[2].Value.Image.image?GeneralSettings[2].Value.Image.image:\'\'}}\'); padding-top: 100px;padding-left:20px;padding-right: 20px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle">\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<input type="file" id="newRulesetImage" onchange="angular.element(this).scope().ItemImageUpload(this)" class="form-control-file">--><!--<div ng-show="GeneralSettings[2].Value.Image.image" class="input-image-control input-image-buttons" style="padding: 0px;max-height: 320px;max-width:320px;background-color: #d3cfce;vertical-align: middle">\r\n\t\t\t\t\t\t<img class="card-img" ng-src="{{GeneralSettings[2].Value.Image.image?GeneralSettings[2].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" onerror="this.src=\'/wwwroot/images/not-available.jpg\'" alt="{{GeneralSettings[0].RulesetName}}" ng-click="showimagebtns = true" />\r\n\t\t\t\t\t</div>\t\t\t\t\t\r\n\t\t\t\t</div>--><!-- End of ruleset image --><!--<rpgsmithrulesettype info="GeneralSettings[2]" mode="\'{{Disabled}}\'"></rpgsmithrulesettype>--></div></div></ng-form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="ManageRuleset()">{{buttontext}}</button></div><style>.modal-dialog .modal-lg .modal-content {\r\n\t\tmax-width: 600px;\r\n\t\theight: 750px;\r\n\t}\r\n\t.modal-content {\r\n\t\tmax-width: 600px;\r\n\t\theight:780px;\r\n\t}\r\n\t.input-image-control {\r\n\t\twidth: 320px;\r\n\t\theight: 320px;\r\n\t\tbackground-color: #d3cfce;\r\n\t}</style>');
$templateCache.put('/views/dialogs/rulesetimport.html','<div class="modal-header"><h5 class="modal-title ng-binding" id="newCharacterPopupTitle"><i class="fa fa-upload" aria-hidden="true"></i>&nbsp; Ruleset Import</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><form name="RuleSetImportForm" novalidate><div class="form-row"><div class="col"><div class="form-group"><label for="newRulesetCharacterName">Name (required)</label><input type="text" class="form-control ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required" name="name" id="name" ng-model="RuleSetName" ng-class="{red: dlg.name.$dirty &amp;&amp; dlg.name.$error.required}" required="" style=""></div></div></div><div class="form-row"><div class="col"><div class="form-group"><input type="file" class="ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required" onchange="angular.element(this).scope().rulesetFileUpload(this)" accept=".zip"></div></div></div></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="uploadFile()" ng-disabled="RuleSetImportForm.$invalid">Upload</button></div>');
$templateCache.put('/views/dialogs/ruleset_itemproperties.html','<div class="modal-body"><form><!-- Search query --><div class="form-group form-group-unlabelled"><span class="input-group-btn"><button type="button" title="Search" data-toggle="tooltip" class="btn icon icon-search btn-simple-primary"></button> </span><input type="text" id="addItemSearchQuery" class="form-control" placeholder="Search items"></div><!-- End of search query --><!-- Item rulesets --><fieldset class="form-group input-list input-list-wrap items"><ul class="input-list-items"><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/boots.jpg" alt="Boots"> <em>Boots</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/bow.jpg" alt="Bow"> <em>Bow</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/golden-ring.jpg" alt="Golden Ring"> <em>Golden Ring</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/halberd.jpg" alt="Halberd"> <em>Halberd</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/shield.jpg" alt="Shield"> <em>Shield</em> <i class="icon"></i></span></label></li><li class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox" name="addItemItems[]"> <span><img src="./assets/images/items/silver-ring.jpg" alt="Silver Ring"> <em>Silver Ring</em> <i class="icon"></i></span></label></li></ul></fieldset><!-- End of item rulesets --></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent">Cancel</button> <button type="button" class="btn btn-accent">Add</button></div>');
$templateCache.put('/views/dialogs/SelectTileBorder.html','<div class="modal-content_new" id="selectTile"><div class="modal-header"><h5 class="modal-title">Edit Borders</h5><button type="button" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body"><div class="container"><div class="row"><div class="col-md-12 form-horizontal"><div class="form-group"><label class="control-label col-md-4 col-xs-4">Style</label><div class="col-md-8 col-xs-8"><select class="form-control" ng-options="item.Id as item.Name for item in TileBorders.StyleList" ng-model="TileBorders.style"><option value="">--Select--</option><!--<option ng-repeat="x in TileBorders.StyleList">{{x.Name}}</option>--></select></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Color</label><div class="col-md-8 col-xs-8"><div class="input-group"><input type="text" id="bordercolor" color-picker color-picker-model="var" ng-model="TileBorders.color" class="form-control"><!--<input id="email" type="text" value="{{var}}" color-picker color-picker-model="var" class="form-control" name="email" placeholder="" style="z-index:1">\r\n                                <span class="input-group-addon" color-picker color-picker-model="var"><i class="glyphicon glyphicon-user"></i></span>--></div></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Width</label><div class="col-md-8 col-xs-8"><select class="form-control" ng-options="item.Id as item.Name for item in TileBorders.WidthList" ng-model="TileBorders.width"><!--<option ng-repeat="x in TileBorders.WidthList">{{x.Name}}</option>--><option value="">--Select--</option></select></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Radius</label><div class="col-md-8 col-xs-8"><select class="form-control" ng-options="item.Id as item.Name for item in TileBorders.RadiusList" ng-model="TileBorders.radius"><!--<option ng-repeat="x in TileBorders.RadiusList">{{x.Name}}</option>--><option value="">--Select--</option></select></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Shadow</label><div class="col-md-8 col-xs-8"><select class="form-control" ng-options="item.Id as item.Name for item in TileBorders.ShadowList" ng-model="TileBorders.shadow"><!--<option ng-repeat="x in TileBorders.ShadowList">{{x.Name}}</option>--><option value="">--Select--</option></select></div></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="SaveTileBorder()">Ok</button> <button type="button" class="btn btn-default" ng-click="cancel()">Close</button></div></div>');
$templateCache.put('/views/dialogs/SelectTileTitleBackground.html','<script src="/Content/colopicker/lib/color-picker.js"></script><div class="modal-header"><button type="button" class="close" ng-click="cancel()">&times;</button><h4 class="modal-title" style="padding-right: 635px">Edit Border</h4></div><div class="modal-body"><div class="container"><div class="row"><div class="form-group"><label class="control-label col-md-4 col-xs-4">Title Text</label><div class="col-md-8 col-xs-8"><div class="input-group"><input type="text" id="titletextcolor" color-picker color-picker-model="var" ng-model="TileBorders.titletextcolor" class="form-control"><!--<input id="email" type="text" value="{{var}}" color-picker color-picker-model="var" class="form-control" name="email" placeholder="" style="z-index:1">\r\n                <span class="input-group-addon" color-picker color-picker-model="var"><i class="glyphicon glyphicon-user"></i></span>--></div></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Title Background</label><div class="col-md-8 col-xs-8"><div class="input-group"><input type="text" id="titlebackgroundcolor" color-picker color-picker-model="var" ng-model="TileBorders.titlebackgroundcolor" class="form-control"><!--<input id="email" type="text" value="{{var}}" color-picker color-picker-model="var" class="form-control" name="email" placeholder="" style="z-index:1">\r\n                <span class="input-group-addon" color-picker color-picker-model="var"><i class="glyphicon glyphicon-user"></i></span>--></div></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Body Text</label><div class="col-md-8 col-xs-8"><div class="input-group"><input type="text" id="bodytextcolor" color-picker color-picker-model="var" ng-model="TileBorders.bodytextcolor" class="form-control"><!--<input id="email" type="text" value="{{var}}" color-picker color-picker-model="var" class="form-control" name="email" placeholder="" style="z-index:1">\r\n                <span class="input-group-addon" color-picker color-picker-model="var"><i class="glyphicon glyphicon-user"></i></span>--></div></div></div><div class="form-group"><label class="control-label col-md-4 col-xs-4">Body Background</label><div class="col-md-8 col-xs-8"><div class="input-group"><input type="text" id="bodybackgroundColor" color-picker color-picker-model="var" ng-model="TileBorders.bodybackgroundColor" class="form-control"><!--<input id="email" type="text" value="{{var}}" color-picker color-picker-model="var" class="form-control" name="email" placeholder="" style="z-index:1">\r\n                <span class="input-group-addon" color-picker color-picker-model="var"><i class="glyphicon glyphicon-user"></i></span>--></div></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="SaveTileBackgrounds()">Ok</button> <button type="button" class="btn btn-default" ng-click="cancel()">Close</button></div>');
$templateCache.put('/views/dialogs/showalltiles.html','<div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>Select Tile</span></h4></div><div class="modal-body"><ng-form name="dlg" novalidate role="form"><!--<div class="form-group pb-10">\r\n            \r\n            <label class="control-label col-md-4">\r\n                <span class="help-block">Select Tile Type <span class="errorColor">*</span></span>\r\n            </label>\r\n            <div class="col-md-8 mb-20">\r\n                <select name="corestattype" ng-change="" class="form-control" ng-options="item.TileId as item.TileType for item in tileTypes" ng-model="tileTypes.TileId" ng-class="{red: dlg.corestattype.$dirty && dlg.corestattype.$error.required}" required>\r\n                    <option value="">--Select--</option>\r\n                </select>\r\n            </div>\r\n        </div>--><div class="select-tile-tiles select-tile-characters" ng-class="{picker: tilePickerApi.selecting}"><ul><li ng-click="selecttiletype(tiletype)" title="{{tiletype.TileType}}" class="" ng-repeat="tiletype in tileTypes"><img ng-src="{{tiletype.TileType===\'ABILITY\'?\'attribute\':tiletype.TileType}}" ng-style="newstyles(c)" class="img-resposive ng-pristine ng-untouched ng-valid ng-empty"> <span class="name">{{tiletype.TileType}}</span></li></ul></div></ng-form></div>');
$templateCache.put('/views/dialogs/tab-rename.html','<!--https://github.com/m-e-conroy/angular-dialog-service--><div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>{{TabHeading}}</h4></div><div class="modal-body"><ng-form name="dlg" novalidate role="form"><div class="form-group pb-10"><label class="control-label col-md-4">Name</label><div class="col-md-8 mb-20"><input name="tabname" type="text" ng-model="Tab.TabName" class="form-control" required> <span style="color:red" ng-show="dlg.tabname.$dirty && dlg.tabname.$invalid"><span ng-show="dlg.tabname.$error.required">Name is required.</span></span></div></div><!--<ng-form name="dlg" novalidate role="form">\r\n            <div class="form-group input-group-lg" ng-class="{true: \'has-error\'}[dlg.name.$dirty && dlg.name.$invalid]">\r\n                <span class="help-block">Enter a name</span>\r\n                <input type="text" class="form-control" name="name" id="name" ng-model="name" ng-keyup="hitEnter($event)" required>\r\n            </div>\r\n        </ng-form>--></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="(dlg.$dirty && dlg.$invalid) || dlg.$pristine">{{ButtonText}}</button></div>');
$templateCache.put('/views/dialogs/tab-reorder.html','<!--https://github.com/m-e-conroy/angular-dialog-service--><div class="modal-header"><h4 class="modal-title"><i class="fa fa-bars" aria-hidden="true"></i> Reorder</h4></div><div class="modal-body"><ul ui-sortable ng-model="items" class="reorder-tab-list"><li ng-repeat="item in items"><i class="fa fa-bars" aria-hidden="true"></i> {{ item.TabName }}</li></ul></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="save()">Save</button></div>');
$templateCache.put('/views/dialogs/termsAndServices.html','<div class="modal-header"><h5 class="modal-title" id="newCharacterPopupTitle">TERMS AND SERVICES</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close" ng-click="cancel()"></button></div><div class="modal-body table_align" style="overflow-y: auto; max-height: 600px"><form name="characterForm" novalidate><div class="form-row"><div class="col"><!--<object type="application/pdf" data="../../images/TermsConditions-rpgsmith.pdf" width="100%" height="500" style="height: 85vh;">No Support</object>--><h4>RPGSMITH, LLC</h4><hr><h5>Terms and Conditions</h5><h6>Last updated: December 21, 2017</h6><p>Please read these Terms and Conditions ("Terms", "Terms and Conditions") carefully before using the https://app.rpgsmith.com website (the "Service") operated by RPGSMITH, LLC ("us", "we", or "our").</p><p>Your access to and use of the Service is conditioned upon your acceptance of and compliance with these Terms. These Terms apply to all visitors, users and others who wish to access or use the Service.</p><p>By accessing or using the Service you agree to be bound by these Terms. If you disagree with any part of the terms then you do not have permission to access the Service.</p><h5>Communications</h5><p>By creating an Account on our service, you agree to subscribe to newsletters, marketing or promotional materials and other information we may send. However, you may opt out of receiving any, or all, of these communications from us by following the unsubscribe link or instructions provided in any email we send.</p><h5>Purchases</h5><p>If you wish to purchase any product or service made available through the Service ("Purchase"), you may be asked to supply certain information relevant to your Purchase including, without limitation, your credit card number, the expiration date of your credit card, your billing address, and your shipping information.</p><p>You represent and warrant that: (i) you have the legal right to use any credit card(s) or other payment method(s) in connection with any Purchase; and that (ii) the information you supply to us is true, correct and complete.</p><p>The service may employ the use of third party services for the purpose of facilitating payment and the completion of Purchases. By submitting your information, you grant us the right to provide the information to these third parties subject to our Privacy Policy. We reserve the right to refuse or cancel your order at any time for reasons including but not limited to: product or service availability, errors in the description or price of the product or service, error in your order or other reasons. We reserve the right to refuse or cancel your order if fraud or an unauthorized or illegal transaction is suspected.</p><h5>Availability, Errors and Inaccuracies</h5><p>We are constantly updating product and service offerings on the Service. We may experience delays in updating information on the Service and in our advertising on other web sites. The information found on the Service may contain errors or inaccuracies and may not be complete or current. Products or services may be mispriced, described inaccurately, or unavailable on the Service and we cannot guarantee the accuracy or completeness of any information found on the Service.</p><p>We therefore reserve the right to change or update information and to correct errors, inaccuracies, or omissions at any time without prior notice.</p><h5>Contests, Sweepstakes and Promotions</h5><p>Any contests, sweepstakes or other promotions (collectively, "Promotions") made available through the Service may be governed by rules that are separate from these Terms & Conditions. If you participate in any Promotions, please review the applicable rules as well as our Privacy Policy. If the rules for a Promotion conflict with these Terms and Conditions, the Promotion rules will apply.</p><h5>Subscriptions</h5><p>Some parts of the Service are billed on a subscription basis ("Subscription(s)"). You will be billed in advance on a recurring and periodic basis ("Billing Cycle"). Billing cycles are set either on a monthly or annual basis, depending on the type of subscription plan you select when purchasing a Subscription.</p><p>At the end of each Billing Cycle, your Subscription will automatically renew under the exact same conditions unless you cancel it or RPGSMITH, LLC cancels it. You may cancel your Subscription renewal either through your online account management page or by contacting RPGSMITH, LLC customer support team.</p><p>A valid payment method, including credit card or PayPal, is required to process the payment for your Subscription. You shall provide RPGSMITH, LLC with accurate and complete billing information including full name, address, state, zip code, telephone number, and a valid payment method information. By submitting such payment information, you automatically authorize RPGSMITH, LLC to charge all Subscription fees incurred through your account to any such payment instruments.</p><p>Should automatic billing fail to occur for any reason, RPGSMITH, LLC will issue an electronic invoice indicating that you must proceed manually, within a certain deadline date, with the full payment corresponding to the billing period as indicated on the invoice.</p><h5>Should automatic billing fail to occur for any reason, RPGSMITH, LLC will issue an electronic invoice indicating that you must proceed manually, within a certain deadline date, with the full payment corresponding to the billing period as indicated on the invoice.</h5><p>RPGSMITH, LLC may, at its sole discretion, offer a Subscription with a free trial for a limited period of time ("Free Trial"). You may be required to enter your billing information in order to sign up for the Free Trial.</p><p>If you do enter your billing information when signing up for the Free Trial, you will not be charged by RPGSMITH, LLC until the Free Trial has expired. On the last day of the Free Trial period, unless you cancelled your Subscription, you will be automatically charged the applicable Subscription fees for the type of Subscription you have selected. At any time and without notice, RPGSMITH, LLC reserves the right to (i) modify the terms and conditions of the Free Trial offer, or (ii) cancel such Free Trial offer.</p><h5>Fee Changes</h5><p>RPGSMITH, LLC, in its sole discretion and at any time, may modify the Subscription fees for the Subscriptions. Any Subscription fee change will become effective at the end of the then-current Billing Cycle.</p><p>Your continued use of the Service after the Subscription fee change comes into effect constitutes your agreement to pay the modified Subscription fee amount.</p><h5>Refunds</h5><p>Certain refund requests for Subscriptions may be considered by RPGSMITH, LLC on a case-by-case basis and granted in sole discretion of RPGSMITH, LLC.</p><h5>Content</h5><p>Our Service allows you to post, link, store, share and otherwise make available certain information, text, graphics, videos, or other material ("Content"). You are responsible for the Content that you post on or through the Service, including its legality, reliability, and appropriateness.</p><p>By posting Content on or through the Service, You represent and warrant that: (i) the Content is yours (you own it) and/or you have the right to use it and the right to grant us the rights and license as provided in these Terms, and (ii) that the posting of your Content on or through the Service does not violate the privacy rights, publicity rights, copyrights, contract rights or any other rights of any person or entity. We reserve the right to terminate the account of anyone found to be infringing on a copyright.</p><p>You retain any and all of your rights to any Content you submit, post or display on or through the Service and you are responsible for protecting those rights. We take no responsibility and assume no liability for Content you or any third party posts on or through the Service. However, by posting Content using the Service you grant us the right and license to use, modify, publicly perform, publicly display, reproduce, and distribute such Content on and through the Service. You agree that this license includes the right for us to make your Content available to other users of the Service, who may also use your Content subject to these Terms.</p><p>RPGSMITH, LLC has the right but not the obligation to monitor and edit all Content provided by users.</p><p>In addition, Content found on or through this Service are the property of RPGSMITH, LLC or used with permission. You may not distribute, modify, transmit, reuse, download, repost, copy, or use said Content, whether in whole or in part, for commercial purposes or for personal gain, without express advance written permission from us.</p><h5>Accounts</h5><p>When you create an account with us, you guarantee that you are above the age of 18, and that the information you provide us is accurate, complete, and current at all times. Inaccurate, incomplete, or obsolete information may result in the immediate termination of your account on the Service.</p><p>You are responsible for maintaining the confidentiality of your account and password, including but not limited to the restriction of access to your computer and/or account. You agree to accept responsibility for any and all activities or actions that occur under your account and/or password, whether your password is with our Service or a third-party service. You must notify us immediately upon becoming aware of any breach of security or unauthorized use of your account.</p><p>You may not use as a username the name of another person or entity or that is not lawfully available for use, a name or trademark that is subject to any rights of another person or entity other than you, without appropriate authorization. You may not use as a username any name that is offensive, vulgar or obscene.</p><p>We reserve the right to refuse service, terminate accounts, remove or edit content, or cancel orders in our sole discretion.</p><h5>Copyright Policy</h5><p>We respect the intellectual property rights of others. It is our policy to respond to any claim that Content posted on the Service infringes on the copyright or other intellectual property rights ("Infringement") of any person or entity. If you are a copyright owner, or authorized on behalf of one, and you believe that the copyrighted work has been copied in a way that constitutes copyright infringement, please submit your claim via email to Legal@RPGSmith.com, with the subject line: "Copyright Infringement" and include in your claim a detailed description of the alleged Infringement as detailed below, under "DMCA Notice and Procedure for Copyright Infringement Claims"</p><p>You may be held accountable for damages (including costs and attorneys\' fees) for misrepresentation or bad-faith claims on the infringement of any Content found on and/or through the Service on your copyright.</p><h5>DMCA Notice and Procedure for Copyright Infringement Claims</h5><p>You may submit a notification pursuant to the Digital Millennium Copyright Act (DMCA) by providing our Copyright Agent with the following information in writing (see 17 U.S.C 512(c)(3) for further detail):<ul><li>an electronic or physical signature of the person authorized to act on behalf of the owner of the copyright\'s interest;</li><li>a description of the copyrighted work that you claim has been infringed, including the URL (i.e., web page address) of the location where the copyrighted work exists or a copy of the copyrighted work;</li><li>identification of the URL or other specific location on the Service where the material that you claim is infringing is located;</li><li>your address, telephone number, and email address;</li><li>a statement by you that you have a good faith belief that the disputed use is not authorized by the copyright owner, its agent, or the law;</li><li>a statement by you, made under penalty of perjury, that the above information in your notice is accurate and that you are the copyright owner or authorized to act on the copyright owner\'s behalf.</li></ul>You can contact our Copyright Agent via email at Legal@RPGSmith.com</p><h5>Intellectual Property</h5><p>The Service and its original content (excluding Content provided by users), features and functionality are and will remain the exclusive property of RPGSMITH, LLC and its licensors. The Service is protected by copyright, trademark, and other laws of both the United States and foreign countries. Our trademarks and trade dress may not be used in connection with any product or service without the prior written consent of RPGSMITH, LLC.</p><h5>Links To Other Web Sites</h5><p>Our Service may contain links to third party web sites or services that are not owned or controlled by RPGSMITH, LLC RPGSMITH, LLC has no control over, and assumes no responsibility for the content, privacy policies, or practices of any third party web sites or services. We do not warrant the offerings of any of these entities/individuals or their websites.</p><p>You acknowledge and agree that RPGSMITH, LLC shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with use of or reliance on any such content, goods or services available on or through any such third party web sites or services.</p><p>We strongly advise you to read the terms and conditions and privacy policies of any third party web sites or services that you visit.</p><h5>Termination</h5><p>We may terminate or suspend your account and bar access to the Service immediately, without prior notice or liability, under our sole discretion, for any reason whatsoever and without limitation, including but not limited to a breach of the Terms.</p><p>If you wish to terminate your account, you may simply discontinue using the Service.</p><p>All provisions of the Terms which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, warranty disclaimers, indemnity and limitations of liability.</p><h5>Indemnification</h5><p>You agree to defend, indemnify and hold harmless RPGSMITH, LLC and its licensee and licensors, and their employees, contractors, agents, officers and directors, from and against any and all claims, damages, obligations, losses, liabilities, costs or debt, and expenses (including but not limited to attorney\'s fees), resulting from or arising out of a) your use and access of the Service, by you or any person using your account and password; b) a breach of these Terms, or c) Content posted on the Service.</p><h5>Limitation Of Liability</h5><p>In no event shall RPGSMITH, LLC, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from (i) your access to or use of or inability to access or use the Service; (ii) any conduct or content of any third party on the Service; (iii) any content obtained from the Service; and (iv) unauthorized access, use or alteration of your transmissions or content, whether based on warranty, contract, tort (including negligence) or any other legal theory, whether or not we have been informed of the possibility of such damage, and even if a remedy set forth herein is found to have failed of its essential purpose.</p><h5>Disclaimer</h5><p>Your use of the Service is at your sole risk. The Service is provided on an "AS IS" and "AS AVAILABLE" basis. The Service is provided without warranties of any kind, whether express or implied, including, but not limited to, implied warranties of merchantability, fitness for a particular purpose, non-infringement or course of performance. RPGSMITH, LLC its subsidiaries, affiliates, and its licensors do not warrant that a) the Service will function uninterrupted, secure or available at any particular time or location; b) any errors or defects will be corrected; c) the Service is free of viruses or other harmful components; or d) the results of using the Service will meet your requirements.</p><h5>Exclusions</h5><p>Some jurisdictions do not allow the exclusion of certain warranties or the exclusion or limitation of liability for consequential or incidental damages, so the limitations above may not apply to you.</p><h5>Governing Law</h5><p>These Terms shall be governed and construed in accordance with the laws of Texas, United States, without regard to its conflict of law provisions.</p><p>Our failure to enforce any right or provision of these Terms will not be considered a waiver of those rights. If any provision of these Terms is held to be invalid or unenforceable by a court, the remaining provisions of these Terms will remain in effect. These Terms constitute the entire agreement between us regarding our Service, and supersede and replace any prior agreements we might have had between us regarding the Service.</p><h5>Changes</h5><p>We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material we will provide at least 30 days notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion. By continuing to access or use our Service after any revisions become effective, you agree to be bound by the revised terms. If you do not agree to the new terms, you are no longer authorized to use the Service.</p><h5>Contact Us</h5>If you have any questions about these Terms, please contact us.</div></div><div class="form-row"><div class="col-12 col-md-6"></div><div class="col-12 col-md-6"></div></div></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Close</button> <button type="button" class="btn btn-accent" ng-click="cancel()">Accept</button></div><!--<toaster-container toaster-options="{\'position-class\': \'toast-top-right\'}" style=" left: 50%; position: fixed;"></toaster-container>-->');
$templateCache.put('/views/dialogs/tile-editor-1.html','<div class="popup-new-tile"><div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit" class="ng-hide" style="">Edit Note Tile</span> <span ng-show="!isEdit">Note Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><div class="col-md-offset-6 col-md-2"><div class=""><span class="ng-isolate-scope" style="margin-right: 10px"><img src="/wwwroot/images/drop.png" ng-click="TileBorder()"> </span><span id="bckcolor" class="ng-isolate-scope"><img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()"></span></div></div></div><form name="theForm" novalidate><div class="modal-body"><div class="form-horizontal"><!--<textarea rows="4" ui-tinymce="tinyMceOptions" ng-model="NewLayout.LayoutMetaData.Tile.Value.Note.Text" cols="50" style="visibility:visible"></textarea>--><rpgsmithnotetype info="NoteTile" useoredit="1" class="form_inline"></rpgsmithnotetype></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveTile()">Save</button></div></form></div>');
$templateCache.put('/views/dialogs/tile-editor-2.html','<div class="popup-new-counter-tile"><div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit" class="ng-hide" style="">Edit Counter Tile</span> <span ng-show="!isEdit">Counter Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><div class="col-md-offset-6 col-md-2"><div class=""><!--<span class="ng-isolate-scope" style="margin-right: 10px;">\r\n                    <img src="/wwwroot/images/drop.png" ng-click="TileBorder()">\r\n                </span>--> <span id="bckcolor" class="ng-isolate-scope"><img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()"></span></div></div></div></div><div class="form-group input-counter" ng-show="isEdit"><div class="input-group"><button class="btn icon icon-minus btn-primary" type="button"></button> <input class="form-control" id="viewCounterValue" type="number" placeholder="Enter value" value="30"> <button class="btn icon icon-plus btn-primary" type="button"></button></div><div class="input-extend"><button class="btn icon icon-with-text icon-reset btn-link-primary" type="button"><span>Reset to 6</span></button></div></div><form name="theForm" novalidate><div class="modal-body"><div class="form-horizontal"><!--{{tile.TileType}}--><rpgsmithcountertype info="NoteTile" useoredit="1" class="form_inline"></rpgsmithcountertype></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveCounterTile()">Save</button></div></form><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/dialogs/tile-editor-3.html','<div class="popup-new-attribute-tile"><div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit">Edit Attribute Tile</span> <span ng-show="!isEdit">Attribute Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><div class="col-md-offset-6 col-md-2"><div class=""><!--<span class="ng-isolate-scope" style="margin-right: 10px;">\r\n                        <img src="/wwwroot/images/drop.png" ng-click="TileBorder()">\r\n                    </span>--> <span id="bckcolor"><img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()"></span></div></div></div></div><form name="theForm" novalidate><div class="modal-body"><div class="form-horizontal"><!--{{tile.TileType}}--><rpgsmithattributetype info="NoteTile" useoredit="1" class="form_inline"></rpgsmithattributetype></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveAttributeTile()">Save</button></div></form>');
$templateCache.put('/views/dialogs/tile-editor-4.html','<div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit" class="ng-hide" style="">Edit Link Tile</span> <span ng-show="!isEdit">Link Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><div class="col-md-offset-6 col-md-2"><div class=""><!--<span class="ng-isolate-scope" style="margin-right: 10px;">\r\n                <img src="/wwwroot/images/drop.png" ng-click="TileBorder()">\r\n            </span>--> <span id="bckcolor" class="ng-isolate-scope"><img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()"></span></div></div></div><form name="theForm" novalidate><div class="modal-body"><div class="form-horizontal"><!--{{tile.TileType}}--><rpgsmithlinktype info="NoteTile" class="form_inline" useoredit="1" fullscope="LinkExecuteTileContent"></rpgsmithlinktype></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveLinkTile()">Save</button></div></form>');
$templateCache.put('/views/dialogs/tile-editor-5.html','<div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit" class="ng-hide" style="">Edit Execute Tile</span> <span ng-show="!isEdit">Execute Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><div class="col-md-offset-6 col-md-2"><div class=""><!--<span class="ng-isolate-scope" style="margin-right: 10px;">\r\n                <img src="/wwwroot/images/drop.png" ng-click="TileBorder()">\r\n            </span>--> <span id="bckcolor" class="ng-isolate-scope"><img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()"></span></div></div></div><form name="theForm" novalidate><div class="modal-body"><div class="form-horizontal"><!--{{tile.TileType}}--><rpgsmithexecutetype info="NoteTile" class="form_inline" useoredit="1" fullscope="LinkExecuteTileContent"></rpgsmithexecutetype></div></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="submit" class="btn btn-primary" ng-click="SaveExecuteTile()" ng-disabled="theForm.$invalid">Save</button></div></form>');
$templateCache.put('/views/dialogs/tile-editor-6.html','<div class="popup-new-command-tile"><div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit" class="ng-hide" style="">Edit Command Tile</span> <span ng-show="!isEdit">Command Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><!--<div class="col-md-offset-6 col-md-2">\r\n            <div class="">\r\n                <span class="ng-isolate-scope" style="margin-right: 10px;">\r\n                    <img src="/wwwroot/images/drop.png" ng-click="TileBorder()">\r\n                </span>\r\n                <span id="bckcolor" class="ng-isolate-scope">\r\n                    <img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()">\r\n                </span>\r\n            </div>\r\n        </div>--></div></div><form name="theForm" novalidate><div class="modal-body"><div class="form-horizontal"><!--{{tile.TileType}}--><rpgsmithcommandtype info="NoteTile" class="form_inline" useoredit="1"></rpgsmithcommandtype></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveCommandTile()">Save</button></div></form><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/dialogs/tile-editor-7.html','<div class="popup-new-image-tile"><div class="modal-header"><h5 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit" class="ng-hide" style="">Edit Image Tile</span> <span ng-show="!isEdit">Image Tile</span></h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button><div class="col-md-offset-6 col-md-2"><div class=""><!--<span class="ng-isolate-scope" style="margin-right: 10px;">\r\n                    <img src="/wwwroot/images/drop.png" ng-click="TileBorder()">\r\n                </span>--> <span id="bckcolor" class="ng-isolate-scope"><img src="/wwwroot/images/color.png" ng-click="TileTitleBackground()"></span></div></div></div></div><div class="modal-body"><rpgsmithimagetype info="NoteTile" useoredit="1" fullscope="Tablist"></rpgsmithimagetype></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-accent" ng-click="SaveImageTile()">Save</button></div>');
$templateCache.put('/views/dialogs/tile-type-picker.html','<div class="modal-header"><h5 class="modal-title" id="newCharacterPopupTitle">New Tile</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="popup-new-tile"><div class="modal-body"><div class="container-fluid tile-picker-container"><div class="select-tile-tiles select-tile-characters"><ul><li ng-repeat="tile in tileTypes"><button ng-click="choosetile(tile)" type="button" ng-class="\'icon-\' + tile.TileType.toLowerCase()" class="btn icon icon-with-text icon-rsi btn-accent">{{tile.TileType}}</button></li></ul></div></div></div></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button></div>');
$templateCache.put('/views/home/attributeinventory.html','<div class="page-inventory itemproperty" ng-init="onloadFun()"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Back to Inventory</h1></div><button type="button" id="newItemTrigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn icon icon-with-text icon-plus btn-primary dropdown-toggle">New Ability</button><div class="dropdown-menu" aria-labelledby="siteNavigationToggle"><!--<ul class="page-toolbar-actions">\r\n\t\t\t<li class="view-switch">\r\n\t\t\t\t<div class="btn-group" role="group">\r\n\t\t\t\t\t<button type="button" id="gridViewTrigger" class="btn icon icon-grid btn-primary selected" ng-click="GridViewTrigger($event)"></button>\r\n\t\t\t\t\t<button type="button" id="listViewTrigger" class="btn icon icon-list btn-primary" ng-click="ListViewTrigger($event)"></button>\r\n\t\t\t\t</div>\r\n\t\t\t</li>\r\n\t\t\t<li>\r\n\t\t\t\t<button type="button" ng-click="CreateCharacterAbility()" class="btn icon icon-with-text icon-plus btn-primary">New Ability</button>\r\n\t\t\t</li>\r\n\t\t\t<li>\r\n\t\t\t\t<button type="button" ng-click="AddRulesetAbilities()" class="btn icon icon-with-text icon-plus btn-primary">Add Ability From Ruleset</button>\r\n\t\t\t</li>\r\n\t\t\t<li>\r\n\t\t\t\t<button type="button" ng-click="BackToLayout()" class="btn icon icon-with-text glyphicon-backward btn-primary">Back</button>\r\n\t\t\t</li>\r\n\t\t</ul>--><ul class="dropdown-menu-list"><li class="dropdown-menu-item" ng-hide="true"></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" style="width: 100%" data-target="#createItemPopup" ng-click="AddRulesetAbility()" class="btn btn-accent">Add Ability</button></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" style="width: 100%" data-target="#addItemPopup" ng-click="CreateCharacterAbility()" class="btn btn-accent">Create Ability</button></li></ul></div></div></div><!-- End of toolbar --><!-- Inventory cards --><div class="cards cards-inventory"><div class="container"><div ng-show="ShowAbilities"><div class="col-md-12"><h3 class="text-center">No Abilities Added</h3></div></div><div class="card-list" ng-show="ShowAbility"><div class="card-wrapper" ng-repeat="ability in NewAbilityInventory.CharacterAbilities"><div class="card" data-href="#"><div class="card-image"><img class="card-img-top" ng-click="ShowAllAbilityProperties(ability,$index)" ng-src="{{ability.CharacterAbilitiesProperties[1].Value.Image.image}}" alt="{{ability.CharacterItemsProperties[0].Value.Text.value}}"><div class="card-actions"><button type="button" title="Edit" ng-click="EditItem(ability,$index,3)" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary"></button> <button type="button" title="Duplicate" ng-click="CopyItem(ability,$index,3)" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary"></button> <button type="button" title="Delete" ng-click="Removeitem(ability,$index,3)" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary"></button> <button type="button" title="Close" ng-click="hideConteextMenu($event)" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="ShowAllAbilityProperties(ability,$index)">{{ability.CharacterAbilitiesProperties[0].Value.Text.value}}</h4><div class="card-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showContextMenu($event)"></button></div><ul class="item-properties"><li class="item-property item-property-text rarity highlight" ng-if="(ability.CharacterAbilitiesProperties[6].Value.Choices.selectedchoice != undefined) && (ability.CharacterAbilitiesProperties[6].Value.Choices.selectedchoice != null) && (ability.CharacterAbilitiesProperties[6].Value.Choices.selectedchoice != \'\')">{{ability.CharacterAbilitiesProperties[6].Value.Choices.selectedchoice}}</li><li class="item-property item-property-text weight" ng-if="(ability.CharacterAbilitiesProperties[4].Value.Weight.value != undefined) && (ability.CharacterAbilitiesProperties[4].Value.Weight.value != null) && (ability.CharacterAbilitiesProperties[4].Value.Weight.value != \'\')">{{ability.CharacterAbilitiesProperties[4].Value.Weight.value}} {{ability.CharacterAbilitiesProperties[4].Value.Weight.units.selectedUnit}}</li><li ng-repeat="abilityproperty in ability.CharacterAbilitiesProperties" ng-if="(abilityproperty.TypeId==3 && abilityproperty.Value.OnorOff.value == \'Yes\') || ( abilityproperty.TypeId == 4 && abilityproperty.Value.YesOrNo.value == \'Yes\')" class="item-property item-property-icon icon icon-rsi" ng-class="\'icon-\' + abilityproperty.Name.toLowerCase()" title="{{abilityproperty.Name}}" data-toggle="tooltip"></li><!--<li class="item-property item-property-icon icon icon-magical icon-rsi" title="Magical" data-toggle="tooltip"></li>\r\n                                <li class="item-property item-property-icon icon icon-consumable icon-rsi" title="Consumable" data-toggle="tooltip"></li>--></ul><div class="item-stats">{{ability.CharacterAbilitiesProperties[2].Value.Text.value}}</div><div class="item-actions"><button type="button" class="btn btn-accent" ng-click="Removeitem(item,$index,1)">Drop</button> <button type="button" class="btn btn-accent">Use</button><rpgsmithcontenttype info="value" ng-repeat="value in ability.CharacterAbilitiesProperties"></rpgsmithcontenttype></div></div></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container></div>');
$templateCache.put('/views/home/character-addnew.html','<div class="container character_new"><div class="panel panel-primary"><div class="panel-heading"><div class="row"><div class="col-md-12"><h4 class=""><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span>{{character.Heading}}</span></h4></div></div></div><div class="panel-body"><div class="col-md-offset-3"><ng-form name="dlg" novalidate role="form"><!--<div class="form-group input-group-lg">\r\n                        <span class="help-block">Character Name</span>\r\n                        <input type="hidden" value="character.id" ng-model="character.id" />\r\n                        <input type="text" class="form-control" name="name" id="name" ng-model="character.name" required maxlength="20">\r\n                    </div>--><div class="form-group"><span class="help-block">Character Name <span class="errorColor">*</span></span> <input type="text" class="form-control" name="name" id="name" ng-disabled="character.DisableCharacterName" ng-model="character.name" ng-class="{red: dlg.name.$dirty && dlg.name.$error.required}" required></div><div class="form-group input-group-lg"><span class="help-block">Character Portrait</span><div class="clearfix"><div class="pull-left edit-character-portrait"><img id="characterImage" ng-src="{{character.file}}" ng-model="character.file" alt="Character Image" ngf-thumbnail="getThumbNail()" ngf-resize="{width: 120, height: 120}"></div><div class="profile_image"><span>Select</span><input type="file" onchange="angular.element(this).scope().characterImageUpload(this)" accept="x-png,gif,jpeg" ng-disabled="character.DisableImage"></div><!--<div class="profile_image">\r\n                                <span>Select</span>\r\n                                <input type="file" onchange="angular.element(this).scope().characterImageUpload(this)" ngf-pattern="\'image/*\'"  ngf-select   ngf-resize="{width: 120, height: 120, quality: 0.8, centerCrop: true}" ngf-fix-orientation="true" accept="x-png,gif,jpeg"  ng-model="file" />\r\n                            </div>--><!--<div class="pull-left btn btn-default edit-character-portrait-button"\r\n                            name="file"\r\n                            ng-model="file"\r\n                            ngf-select\r\n                            ngf-resize="{width: 120, height: 120, quality: 0.8, centerCrop: true}"\r\n                            ngf-fix-orientation="true"\r\n                            ngf-pattern="\'image/*\'"\r\n                            ngf-accept="\'image/*\'">Select</div>--></div><span class="help-block">120px by 120px</span></div><!--<div class="form-group">\r\n                        <span class="help-block">Select RuleSet</span>\r\n                        <div class="character_add">\r\n                            <select class="form-control" ng-model="character.RulesetID" ng-options="item.Id as item.Name for item in RuleSets">\r\n                                <option value="">Select RuleSet</option>\r\n                            </select>\r\n                            <span>Or</span>\r\n                            <div class="add">\r\n                                <a ng-click="addNewRuleSet()" ng-disabled="character.Button" class="btn btn-primary">Add RuleSet</a>\r\n                            </div>\r\n                        </div>\r\n                    </div>--><div class="form-group"><span class="help-block">Select RuleSet <span class="errorColor">*</span></span><div class="character_add"><select name="ruleset" class="form-control" ng-disabled="character.DisableRulesetDdl" ng-model="character.RulesetID" ng-options="item.Id as item.Name for item in RuleSets" ng-class="{red: dlg.ruleset.$dirty && dlg.ruleset.$error.required}" required><option value="">Select RuleSet</option></select><span>Or</span><div class="add"><a ng-click="addNewRuleSet()" ng-disabled="character.Button" class="btn btn-primary">Add RuleSet</a></div></div></div></ng-form></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button><!--<button type="button" class="btn btn-primary" ng-click="save()">Save</button>--> <button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="(dlg.$dirty && dlg.$invalid) || dlg.$pristine">Save</button></div><toaster-container toaster-options="{\'position-class\': \'toast-top-right\'}" style="left: 50%; position: fixed"></toaster-container>');
$templateCache.put('/views/home/character-attributes.html','<pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><pageslide ps-open="menuCharacter.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuCharacter.menus" menu-click="menuCharacter.menuClick"></pageslide-menu></pageslide><div class="container-fluid"><ul><li ng-repeat="stat in data.corestats">{{stat.name}}</li></ul></div>');
$templateCache.put('/views/home/character-commands.html','<pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><pageslide ps-open="menuCharacter.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuCharacter.menus" menu-click="menuCharacter.menuClick"></pageslide-menu></pageslide><div class="container-fluid"><ul><li ng-repeat="n in data.commands">{{n.Name}}</li></ul></div>');
$templateCache.put('/views/home/character-counters.html','<pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><pageslide ps-open="menuCharacter.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuCharacter.menus" menu-click="menuCharacter.menuClick"></pageslide-menu></pageslide><div class="container-fluid"><ul><li ng-repeat="c in data.counters">{{c.Name}}</li></ul></div>');
$templateCache.put('/views/home/character-executes.html','<pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><pageslide ps-open="menuCharacter.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuCharacter.menus" menu-click="menuCharacter.menuClick"></pageslide-menu></pageslide><div class="container-fluid"><ul><li ng-repeat="n in data.executes">{{n.Name}}</li></ul></div>');
$templateCache.put('/views/home/character-layout.html','<div class="page-character-dashboard" data-ng-init="onloadFun()"><div class="page-toolbar"><div class="container"><div ng-class="{\'page-toolbar-wrapper-toggle-trigger\' : true, \'d-none\' : state.useOrEditMode}"><button type="button" id="showAction" class="btn icon icon-with-text icon-arrow-down btn-accent" ng-click="ToggleMenu($event)">Show actions</button></div><div ng-class="{\'page-toolbar-wrapper\' : true,\'initial\':true,\'hide\':true, \'d-none\' : state.useOrEditMode}"><div class="page-toolbar-dropdowns"><!-- Layout dropdown --><div class="dropdown"><div class="dropdown-toggle" id="pageLayoutNavigationToggle" data-toggle="dropdown"><span>Layout <em>{{selectedLayoutName}}</em></span></div><div class="dropdown-menu" aria-labelledby="pageLayoutNavigationToggle"><div class="dropdown-menu-add-item-trigger"><button type="button" class="btn btn-accent btn-block" ng-click="layoutAdd()">New Layout</button></div><ul class="dropdown-menu-list dropdown-menu-item-contain-actions"><li class="dropdown-menu-item active" ng-repeat="layout in Layouts"><span class="dropdown-menu-item-title" ng-click="layoutLoad(layout)">{{layout.Name}}</span><div class="dropdown-menu-item-actions"><button type="button" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary" ng-click="layoutRename($index,layout)"></button> <button type="button" title="Duplicate" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary" ng-click="layoutCopy($index,layout)"></button> <button type="button" title="Delete" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary" ng-click="layoutDelete($index,layout)"></button> <button type="button" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button></div><div class="dropdown-menu-item-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showContextMenu($event)"></button></div></li></ul></div></div><!-- End of layout dropdown --><!-- Page dropdown --><div class="dropdown"><div class="dropdown-toggle" id="pageLayoutNavigationToggle" data-toggle="dropdown"><span>Page <em>{{selectedPageName}}</em></span></div><div class="dropdown-menu" aria-labelledby="pageLayoutNavigationToggle"><div class="dropdown-menu-add-item-trigger"><button type="button" class="btn btn-accent btn-block" ng-click="AddNewtab()">New Page</button></div><ul class="dropdown-menu-list dropdown-menu-item-contain-actions"><li class="dropdown-menu-item" ng-repeat="tab in NewLayout.TabList track by $index" index="$index" ng-click="onTabSelected(tab,$index)"><span class="dropdown-menu-item-title">{{tab.TabName}}</span><div class="dropdown-menu-item-actions"><button type="button" title="Edit" data-toggle="tooltip" ng-click="EditTab(tab)" class="btn icon icon-pencil btn-simple-primary"></button> <button type="button" title="Duplicate" data-toggle="tooltip" ng-click="CopyTab(tab)" class="btn icon icon-copy icon-rsi btn-simple-primary"></button> <button type="button" title="Delete" data-toggle="tooltip" ng-click="DeleteTab(tab)" class="btn icon icon-trash btn-simple-primary"></button> <button type="button" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button></div><div class="dropdown-menu-item-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showContextMenu($event)"></button></div></li></ul></div></div><!-- End of page dropdown --></div><!-- Toolbar links --><ul class="page-toolbar-links"><li><a href="#" class="btn btn-link-primary" ng-click="ItemInventory()">Items</a></li><li><a href="#" class="btn btn-link-primary" ng-click="SpellInventory()">Spells</a></li><li><a href="#" class="btn btn-link-primary" ng-click="AbilityInventory()">Abilities</a></li></ul><!-- End of toolbar links --><!-- Toolbar actions --><ul class="page-toolbar-actions"><li><button type="button" id="manageTilesTrigger" class="btn btn-outline-primary" ng-click="ManageTiles()">Manage Tiles</button></li><li><button type="button" data-toggle="modal" data-target="#manageCoreStatsPopup" class="btn btn-outline-primary" ng-click="AddCorestatvalues()">Manage Core Stats</button></li><li><button type="button" data-toggle="modal" data-target="#dicePopup" class="btn icon icon-with-text icon-dice icon-rsi btn-primary" ng-click="ShowDice()">Dice</button></li></ul><!-- End of toolbar actions --></div><div ng-class="{\'page-toolbar-wrapper\' : true, \'manage\' : true,\'d-flex\' : state.useOrEditMode}"><div class="page-toolbar-title"><h1>Manage Tiles</h1></div><ul class="page-toolbar-actions"><li class="popup-new-tile-trigger tile-bubble-add" title="Add a new tile" ng-class="{\'show-bubble\': state.tilesEditing && !state.tileDragging}" ng-click="ShowTiles()"><i class="btn icon icon-plus btn-primary" aria-hidden="true"></i></li><li class="popup-edit-ruleset remove tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"><button type="button" data-toggle="modal" class="btn btn-primary" ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"></button> <i class="fa fa-trash-o fa-2x"></i></li><!--<li class="tile-bubble-save" title="Save changes"\r\n                         ng-class="{\'show-bubble\': state.tilesEditing}" ng-click="SaveLayout(NewLayout)">\r\n                        <i class="fa fa-floppy-o" aria-hidden="true"></i>\r\n                    </li>--><!--    <li class="popup-new-tile-trigger">\r\n                           <button type="button" data-toggle="modal" class="btn icon icon-plus btn-primary" ng-class="{\'show-bubble\': state.tilesEditing && !state.tileDragging}" ng-click="ShowTiles()"></button>\r\n                       </li>\r\n                    <li class="popup-new-tile-trigger save">\r\n                           <button type="button" data-toggle="modal" class="btn btn-primary" ng-class="{\'show-bubble\': state.tilesEditing && !state.tileDragging}" ng-click="SaveLayout(NewLayout)">\r\n                               <i class="fa fa-floppy-o fa-2x"></i>\r\n                           </button>\r\n                       </li>\r\n                       \r\n                       <<li class="popup-new-tile-trigger remove">\r\n                           <button type="button" data-toggle="modal" class="btn btn-primary" ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"></button>\r\n                           <i class="fa fa-trash-o fa-2x"></i>\r\n\r\n                       </li>--><li><button type="button" id="manageTilesDoneTrigger" class="btn btn-accent" ng-click="ManageTilesCompleted();SaveLayout(NewLayout);">Done</button></li></ul></div></div></div><!--<div gridstack class="grid-stack">\r\n\t\t<div gridstack-item class="grid-stack-item"\r\n\t\t\t data-gs-x="0" data-gs-y="0"\r\n\t\t\t data-gs-width="4" data-gs-height="2">\r\n\t\t\t<div gridstack-item-content class="grid-stack-item-content"></div>\r\n\t\t</div>\r\n\t\t<div gridstack-item class="grid-stack-item"\r\n\t\t\t data-gs-x="4" data-gs-y="0"\r\n\t\t\t data-gs-width="4" data-gs-height="4">\r\n\t\t\t<div gridstack-item-content class="grid-stack-item-content"></div>\r\n\t\t</div>\r\n\t</div>--><div class="container-fluid" tile-picker="tilePickerApi"><!--<div ng-repeat="tabs in NewLayout.TabList track by $index" ng-show="tabSet.index === $index">--><div gridstack class="grid-stack" gs-lock-tiles="true" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item style="overflow-y: hidden" ng-repeat="tab in NewLayout.TabList[selectedPageIndex].TileList track by $index" ng-switch on="tab.TileTypeName" gs-item-id="tab.ClientObjectId" class="grid-stack-item" gs-item-x="tab.X" gs-item-y="tab.Y" gs-item-width="tab.Width" gs-item-height="tab.Height"><div gridstack-item-content class="grid-stack-item-content" style="overflow-y: hidden"><!--<div  ng-click="EditNoteTile()"  ng-switch="Note" style="background-color: {{tab.Styles.titlebackgroundcolor}}; color:{{tab.Styles.titletextcolor}};">\r\n\t\t\t\t\t<span class="text_design"> \r\n\t\t\t\t\t<span style="color:{{tab.Styles.titletextcolor}};">{{ tab.Value.Note.Name }}</span>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style="color:black;" ng-switch="Note"  ng-bind-html="tab.Value.Note.Text" ng-click="ShowContent()">\r\n\t\t\t\t</div>\r\n\t\t\t\t\r\n\t\t\t\t<div ng-click="EditCounterTile()"  ng-switch="Counter" style="background-color: {{tab.Styles.titlebackgroundcolor}}; color:{{tab.Styles.titletextcolor}};">\r\n\t\t\t\t\t<span class="text_design">\r\n\t\t\t\t\t\t<span style="color:{{tab.Styles.titletextcolor}};">{{tab.Value.Counter.Name}}</span>\r\n\t\t\t\t\t\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div> \r\n\t\t\t\t<div class="text_align" ng-switch="Counter">\r\n\t\t\t\t\t<p ng-click="ShowCounterValue()">{{ tab.Value.Counter.Value }}</p> \r\n\t\t\t\t\t<div class="counter">\r\n\t\t\t\t\t\t<span><i class="fa fa-minus fa-2x" ng-click="Decrement()"></i></span>\r\n\t\t\t\t\t\t<span><i class="fa fa fa-refresh fa-2x" ng-click="Reset()"></i></span>\r\n\t\t\t\t\t\t<span><i class="fa fa-plus fa-2x" ng-click="Increment()"></i></span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t\t<div class="btn"  ng-click="EditLinkTile()" ng-switch="Link" style="background-color: {{tab.Styles.titlebackgroundcolor}}"> \r\n\t\t\t\t\t<span style="color:{{tab.Styles.titletextcolor}};">{{tab.Value.Link.Title}}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="text_align" style="text-align:center" ng-switch="Link"> \r\n\t\t\t\t\t<img src="{{tab.Value.Link.SelectedPropertyValueImage}}" ng-style="newstyles()" class="img-resposive ng-pristine ng-untouched ng-valid ng-empty" ng-click="ShowAllContent()">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<div ng-click="EditNoteTile()" class="NoteTile" ng-switch="Command" style="background-color: {{tab.Styles.titlebackgroundcolor}}; color:{{tab.Styles.titletextcolor}};">\r\n\t\t\t\t\t\t<span class="text_design">\r\n\t\t\t\t\t\t\t<span style="color:{{tab.Styles.titletextcolor}};">{{ tab.Value.Command.Name }}</span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style="color:black;" ng-switch="Command" ng-bind-html="tab.Value.Command.Text" ng-click="ShowContent()">\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div ng-click="EditNoteTile()" class="NoteTile" ng-switch="Image" style="background-color: {{tab.Styles.titlebackgroundcolor}}; color:{{tab.Styles.titletextcolor}};">\r\n\t\t\t\t\t\t<span class="text_design">\r\n\t\t\t\t\t\t\t<span style="color:{{tab.Styles.titletextcolor}};">{{ tab.Value.Image.Name }}</span>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style="color:black;" ng-switch="Image" ng-bind-html="tab.Value.Image.Text" ng-click="ShowContent()">\r\n\t\t\t\t\t</div>--><rpgsmithnotetype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: gray;color: white;box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Note" data-method="ctrlFn"></rpgsmithnotetype><rpgsmithcountertype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}};border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.bodybackgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Counter"></rpgsmithcountertype><rpgsmithattributetype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.bodybackgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Attribute"></rpgsmithattributetype><rpgsmithlinktype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.bodybackgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Link" fullscope="LinkExecuteTileContent"></rpgsmithlinktype><rpgsmithexecutetype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.bodybackgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Execute" fullscope="LinkExecuteTileContent"></rpgsmithexecutetype><rpgsmithcommandtype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.bodybackgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Command"></rpgsmithcommandtype><rpgsmithimagetype gridstack-item-content ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.bodybackgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Image" fullscope="tabs.TileList"></rpgsmithimagetype></div></div></div><!--<div class="tile-bubble-remove" title="Remove Page" droppable\r\n\t\t\t ng-class="{\'show-bubble\': state.tileDragging && state.tilesEditing}"\r\n\t\t\t on-droppable-drop="onDeleteDrop(event,ui)"\r\n\t\t\t on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)">\r\n\t\t\t<i class="btn icon icon-trash btn-primary" aria-hidden="true"></i>\r\n\t\t</div>--></div><!-- End of tiles --></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':5000}"></toaster-container>');
$templateCache.put('/views/home/character-links.html','<pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><pageslide ps-open="menuCharacter.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuCharacter.menus" menu-click="menuCharacter.menuClick"></pageslide-menu></pageslide><div class="container-fluid"><ul><li ng-repeat="n in data.links">{{n.Name}}</li></ul></div>');
$templateCache.put('/views/home/character-notes.html','<pageslide ps-open="menuHamburger.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuHamburger.menus" menu-click="menuHamburger.menuClick"></pageslide-menu></pageslide><pageslide ps-open="menuCharacter.opened" ps-side="left" ps-key-listener="true" ps-zindex="2000" ps-size="200px" ps-auto-close="true" ps-body-class="true"><pageslide-menu menus="menuCharacter.menus" menu-click="menuCharacter.menuClick"></pageslide-menu></pageslide><div class="container-fluid"><ul><li ng-repeat="n in data.notes">{{n.Name}}</li></ul></div>');
$templateCache.put('/views/home/characterabilitycontent.html','<div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><button type="button" class="btn btn-primary back" ng-click="BackAbilityProperties()">Back</button> <button type="button" class="btn btn-accent" ng-click="SaveInventoryTiles(CharacterContent,3)">Save Tile</button></div></div></div><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{CharacterContent.CharacterAbilitiesProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{CharacterContent.CharacterAbilitiesProperties[0].Value.Text.value}}</button><!--<div class="buttons-align">\r\n                <button class="btn btn-warning">\r\n                    <i class="fa fa-remove" aria-hidden="true"></i>\r\n                    REMOVE\r\n                </button>\r\n                <button class="btn btn-warning">\r\n                    <i class="fa fa-exchange" aria-hidden="true"></i>\r\n                    UNMEMORIZE\r\n                </button>\r\n            </div>--></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{CharacterContent.CharacterAbilitiesProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">CLASS</div><div class="panel-body text-center">{{CharacterContent.CharacterAbilitiesProperties[10].Value.Text.value}}</div></div></div><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">ATTRIBUTES</div><div class="panel-body text-center">{{CharacterContent.CharacterAbilitiesProperties[9].Value.Text.value}}</div></div></div></div><div class="blue"><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">USES ReEMAINING</div><div class="panel-body text-center">{{CharacterContent.CharacterAbilitiesProperties[13].Value.Number.value}}</div></div></div><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">MAX USES</div><div class="panel-body text-center">{{CharacterContent.CharacterAbilitiesProperties[12].Value.Number.value}}</div></div></div></div></div></div><div class="buttons-align"><button class="btn btn_red" ng-click="Removeitems(CharacterContent,3)"><i class="fa fa-remove" aria-hidden="true"></i> REMOVE</button> <button class="btn uneqp" ng-click="EditItems(CharacterContent,3)"><i class="fa fa-edit" aria-hidden="true"></i> EDIT</button></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Description</h5><p>{{CharacterContent.CharacterAbilitiesProperties[14].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">{{CharacterContent.CharacterAbilitiesProperties[17].Value.Number.value}}</div></div></div><!--<div class="col-md-6">\r\n                            <div class="panel panel-default">\r\n                                <div class="panel-heading text-center" style="background-color: rgba(237, 20, 61, 0.67);">Attributes</div>\r\n                                <div class="panel-body text-center" style="background-color: rgba(237, 20, 61, 0.58);"></div>\r\n                            </div>\r\n                        </div>--></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">REQUIREMENTS</div><div class="panel-body text-center">text</div></div></div></div></div></div><div class="buttons-align"><button class="btn btn-warning" style="width:100%" ng-click="ShowTilesforInventory(CharacterContent.CharacterAbilitiesProperties)"><i class="fa fa-plus" aria-hidden="true"></i> ADD TILE</button></div></div></div><div gridstack class="grid-stack" options="stackOptions" on-change="onChange(event,ui)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item ng-repeat="tab in CharacterContent.CharacterAbilitiesProperties" ng-click="tileSelect(tab.tile)" ng-class="getTileClass(tab.tile)" ng-switch on="tab.tile.TileTypeName" class="grid-stack-item" gs-item="tile" gs-item-id="tab.tile.ClientObjectId" gs-item-x="tab.tile.X" gs-item-y="tab.tile.Y" gs-item-width="tab.tile.Width" gs-item-height="tab.tile.Height" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)" data-gs-width="4" data-gs-height="2"><rpgsmithnotetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Note"></rpgsmithnotetype><rpgsmithcountertype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Counter"></rpgsmithcountertype><rpgsmithattributetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Attribute"></rpgsmithattributetype><rpgsmithlinktype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Link" fullscope="LinkExecuteTileContent"></rpgsmithlinktype><rpgsmithexecutetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Execute" fullscope="LinkExecuteTileContent"></rpgsmithexecutetype><rpgsmithcommandtype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Command"></rpgsmithcommandtype><rpgsmithimagetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Image"></rpgsmithimagetype></div></div><div class="tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDropCharacterTiles(event,ui)" on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)"><i class="fa fa-trash-o" aria-hidden="true"></i></div><div class="tile-bubble-add" title="Add a new tile" ng-click="ShowTiles()"><i class="fa fa-plus" aria-hidden="true"></i></div><div class="tile-bubble-save" title="Save changes" ng-click="SaveLayout(NewLayout)"><i class="fa fa-floppy-o" aria-hidden="true"></i></div><!--<div class="tile-bubble-remove" title="Remove Page" droppable\r\n         on-droppable-drop="onDeleteDropCharacterItem(event,ui)"\r\n         on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)">\r\n        <i class="fa fa-trash-o" aria-hidden="true"></i>\r\n    </div>\r\n    <div class="tile-bubble-add" title="Add a new tile"\r\n         ng-click="ShowTiles()">\r\n        <i class="fa fa-plus" aria-hidden="true"></i>\r\n    </div>\r\n    <div class="tile-bubble-save" title="Save changes"\r\n         ng-click="SaveLayout(NewLayout)">\r\n        <i class="fa fa-floppy-o" aria-hidden="true"></i>\r\n    </div>--></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/characteritemcontent.html','<div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><button type="button" class="btn btn-primary back" ng-click="BackItemProperties()">Back</button> <button type="button" class="btn btn-accent" ng-click="SaveInventoryTiles(CharacterContent,1)">Save Tile</button></div></div></div><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{CharacterContent.CharacterItemsProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{CharacterContent.CharacterItemsProperties[0].Value.Text.value}}</button><div class="buttons-align mt-30"><button class="btn btn-warning" ng-click="Removeitems(CharacterContent,1)"><i class="fa fa-download" aria-hidden="true"></i> DROP</button> <button class="btn btn-warning" ng-click="EditItems(CharacterContent,1)"><i class="fa fa-exchange" aria-hidden="true"></i> Edit</button></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{CharacterContent.CharacterItemsProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">WEIGHT</div><div class="panel-body text-center">{{CharacterContent.CharacterItemsProperties[4].Value.Weight.value}} {{CharacterContent.CharacterItemsProperties[4].Value.Weight.units.selectedUnit}}</div></div></div><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">VOLUME</div><div class="panel-body text-center">{{CharacterContent.CharacterItemsProperties[5].Value.Volume.lenghtvalue}} {{CharacterContent.CharacterItemsProperties[5].Value.Volume.heightvalue}} {{CharacterContent.CharacterItemsProperties[5].Value.Volume.depthvalue}}</div></div></div></div><div class="blue"><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">ATTRIBUTES</div><div class="panel-body text-center">text</div></div></div><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">RARITY</div><div class="panel-body text-center">{{CharacterContent.CharacterItemsProperties[6].Value.Choices.selectedchoice}}</div></div></div></div></div></div><div style="margin-top:0px"><div class="buttons-align"><!--<button class="btn uneqp">\r\n                <i class="fa fa-hand-paper-o" aria-hidden="true"></i>\r\n                UNEQUIP\r\n            </button>--><div ng-repeat="value in CharacterContent.CharacterItemsProperties" class="equip"><rpgsmithcontenttype info="value"></rpgsmithcontenttype></div><button class="btn btn-warning" ng-click="CopyItems(CharacterContent,1)"><i class="fa fa-external-link" aria-hidden="true"></i> Duplicate</button></div></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Visible Description</h5><p>{{CharacterContent.CharacterItemsProperties[6].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading text-center">Associated Spell</div><div class="panel-body"><div class="text-center" ng-if="RulesetContent.AssociatedSpells.length <= 0">None</div><div class="text-center" ng-if="RulesetContent.AssociatedSpells.length > 0"><!--<button class="btn btn-warning" ng-click="ShowAllSpellsContent(RulesetContent.AssociatedSpells,$index)">\r\n                                            {{associatedSpell.SpellProperties[0].Value.Text.value}}\r\n                                        </button>--> <button ng-repeat="associatedSpell in RulesetContent.AssociatedSpells" class="btn btn-warning" ng-click="ShowAssociatedSpells($index)">{{associatedSpell.SpellProperties[0].Value.Text.value}}</button></div></div></div></div><div class="col-md-6"><div class="panel panel-default"><div class="panel-heading text-center">Associated Ability</div><div class="panel-body text-center">None</div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center"><p>{{CharacterContent.CharacterItemsProperties[17].Value.Text.value}}</p></div></div></div></div></div></div><div class="buttons-align"><button class="btn btn-warning" style="width:100%" ng-click="ShowTilesforInventory(CharacterContent.CharacterItemsProperties)"><i class="fa fa-plus" aria-hidden="true"></i> ADD TILE</button></div></div></div><div gridstack class="grid-stack grid1" options="options" on-change="onChange(event,items)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item class="grid-stack-item" gs-item-x="w.x" gs-item-y="w.y" gs-item-width="w.width" gs-item-height="w.height" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)"><div class="grid-stack-item-content"><a class="btn btn-primary" ng-click="removeWidget(w)" href="#">remove</a></div></div></div><div class="tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDropCharacterTiles(event,ui)" on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)"><i class="fa fa-trash-o" aria-hidden="true"></i></div><div class="tile-bubble-add" title="Add a new tile" ng-click="ShowTiles()"><i class="fa fa-plus" aria-hidden="true"></i></div><div class="tile-bubble-save" title="Save changes" ng-click="SaveLayout(NewLayout)"><i class="fa fa-floppy-o" aria-hidden="true"></i></div><!--<div class="popup-new-tile-trigger remove_new tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}"\r\n        on-droppable-drop="onDeleteDropCharacterItem(event,ui,1,CharacterContent)"\r\n        on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)">\r\n        <button type="button" data-toggle="modal" class="btn btn-primary" ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"></button>\r\n        <i class="fa fa-trash-o fa-2x" style="color:#fff;"></i>\r\n\r\n    </div>--><!--<div class="tile-bubble-remove" title="Remove Page" droppable\r\n         ng-class="{\'show-bubble\': true}"\r\n         on-droppable-drop="onDeleteDropCharacterItem(event,ui)"\r\n         on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)">\r\n        <i class="fa fa-trash-o" aria-hidden="true"></i>\r\n    </div>--><!--<div class="tile-bubble-add" title="Add a new tile"\r\n         ng-click="ShowTiles()">\r\n        <i class="fa fa-plus" aria-hidden="true"></i>\r\n    </div>\r\n    <div class="tile-bubble-save" title="Save changes"\r\n         ng-click="SaveLayout(NewLayout)">\r\n        <i class="fa fa-floppy-o" aria-hidden="true"></i>\r\n    </div>--></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/CharacterRulesetAbilities.html','<div class="container item_properties invenroty"><div class="row"><div class="well well-sm"><div class="col-md-12"><h4>Ruleset Abilities</h4></div><div class="col-md-offset-4 col-md-4"><button type="button" class="btn btn-primary back" ng-click="BackAbility()">Back</button></div></div></div><div class="row" ng-show="ShowAbilities"><div class="col-md-12"><h3 class="text-center">No Ruleset Abilities</h3></div></div><div class="row" id="listview" ng-show="ShowAbility"><div class="col-md-12 col-sm-12 table-responsive"><table class="table table-bordered"><thead><tr><th></th><th>S.No</th><th>Image</th><th>Name</th><th>Stats</th><th>Description</th><th>Quantity</th><th>Attributes</th></tr></thead><tbody><tr ng-repeat="ability in RulesetAbilities"><td><input type="checkbox" class="input-sm" ng-checked="checkSelected(ability,3)" ng-click="addName(ability,3)"></td><td ng-click="ShowAllItemProperties(item,$index)">{{$index + 1}}</td><td ng-click="ShowAllItemProperties(item,$index)"><img ng-src="{{ability.AbilityProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></td><td ng-click="ShowAllItemProperties(item,$index)">{{ability.AbilityProperties[0].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{ability.AbilityProperties[2].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{ability.AbilityProperties[9].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{ability.AbilityProperties[3].Value.Number.value}}</td><td ng-click="ShowAllItemProperties(item,$index)"><div><div><div class="icon_box"><span>{{ability.AbilityProperties[11].Name | limitTo : 1}}</span></div></div></div></td><!--<td>\r\n                            <div class="row items_button">\r\n                                <button type="button" class="btn btn-primary" ng-click="EditItem(item,$index)"><i class="fa fa-edit"></i> EDIT</button>\r\n                                <button type="button" class="btn btn-info" ng-click="CopyItem(item,$index)"><i class="fa fa-copy"></i>COPY</button>\r\n\r\n                                <button type="button" class="btn btn-danger" ng-click="Removeitem(item)"><i class="fa fa-remove"></i>REMOVE</button>\r\n                            </div>\r\n                        </td>--></tr></tbody></table></div></div><div class="row mb-20"><div class="col-md-12"><button type="button" class="btn btn-primary pull-right" ng-click="SaveRulesetAbility()">OK</button></div></div></div>');
$templateCache.put('/views/home/CharacterRulesetItems.html','<div class="container item_properties invenroty"><div class="row"><div class="well well-sm"><div class="col-md-12"><h4>Ruleset Items</h4></div><div class="col-md-offset-4 col-md-4"><button type="button" class="btn btn-primary back" ng-click="BackItem()">Back</button></div></div></div><div class="row" ng-show="ShowItems"><div class="col-md-12"><h3 class="text-center">No Ruleset Items</h3></div></div><div class="row" id="listview" ng-show="ShowItem"><div class="col-md-12 col-sm-12 table-responsive"><table class="table table-bordered"><thead><tr><th></th><th>S.No</th><th>Image</th><th>Name</th><th>Stats</th><th>Description</th><th>Quantity</th><th>Attributes</th></tr></thead><tbody><tr ng-repeat="item in RulesetItems"><td><input type="checkbox" class="input-sm" ng-checked="checkSelected(item,1)" ng-click="addName(item,1)"></td><td ng-click="ShowAllItemProperties(item,$index)">{{$index + 1}}</td><td ng-click="ShowAllItemProperties(item,$index)"><img ng-src="{{item.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></td><td ng-click="ShowAllItemProperties(item,$index)">{{item.ItemProperties[0].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{item.ItemProperties[2].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{item.ItemProperties[9].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{item.ItemProperties[3].Value.Number.value}}</td><td ng-click="ShowAllItemProperties(item,$index)"><div><div><div class="icon_box"><span>{{item.ItemProperties[13].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{item.ItemProperties[17].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{item.ItemProperties[18].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{item.ItemProperties[19].Name | limitTo : 2}}</span></div><div class="icon_box"><span>{{item.ItemProperties[20].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{item.ItemProperties[21].Name | limitTo : 1}}</span></div></div></div></td><!--<td>\r\n                            <div class="row items_button">\r\n                                <button type="button" class="btn btn-primary" ng-click="EditItem(item,$index)"><i class="fa fa-edit"></i> EDIT</button>\r\n                                <button type="button" class="btn btn-info" ng-click="CopyItem(item,$index)"><i class="fa fa-copy"></i>COPY</button>\r\n\r\n                                <button type="button" class="btn btn-danger" ng-click="Removeitem(item)"><i class="fa fa-remove"></i>REMOVE</button>\r\n                            </div>\r\n                        </td>--></tr></tbody></table></div></div><div class="row mb-20"><div class="col-md-12"><button type="button" class="btn btn-primary pull-right" ng-click="SaveRulesetItem()">OK</button></div></div></div>');
$templateCache.put('/views/home/CharacterRulesetSpells.html','<div class="container item_properties invenroty"><div class="row"><div class="well well-sm"><div class="col-md-12"><h4>Ruleset Spells</h4></div><div class="col-md-offset-4 col-md-4"><button type="button" class="btn btn-primary back" ng-click="BackSpell()">Back</button></div></div></div><div class="row" ng-show="ShowSpells"><div class="col-md-12"><h3 class="text-center">No Ruleset Spells</h3></div></div><div class="row" id="listview" ng-show="ShowSpell"><div class="col-md-12 col-sm-12 table-responsive"><table class="table table-bordered"><thead><tr><th></th><th>S.No</th><th>Image</th><th>Name</th><th>Stats</th><th>Description</th><th>Quantity</th><th>Attributes</th></tr></thead><tbody><tr ng-repeat="spell in RulesetSpells"><td><input type="checkbox" class="input-sm" ng-checked="checkSelected(spell,2)" ng-click="addName(spell,2)"></td><td ng-click="ShowAllItemProperties(item,$index)">{{$index + 1}}</td><td ng-click="ShowAllItemProperties(item,$index)"><img ng-src="{{spell.SpellProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></td><td ng-click="ShowAllItemProperties(item,$index)">{{spell.SpellProperties[0].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{spell.SpellProperties[2].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{spell.SpellProperties[9].Value.Text.value}}</td><td ng-click="ShowAllItemProperties(item,$index)">{{spell.SpellProperties[3].Value.Number.value}}</td><td ng-click="ShowAllItemProperties(item,$index)"><div><div><div class="icon_box"><span>{{spell.SpellProperties[13].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{spell.SpellProperties[14].Name | limitTo : 2}}</span></div><div class="icon_box"><span>{{spell.SpellProperties[15].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{spell.SpellProperties[16].Name | limitTo : 2}}</span></div><div class="icon_box"><span>{{spell.SpellProperties[20].Name | limitTo : 1}}</span></div><div class="icon_box"><span>{{spell.SpellProperties[22].Name | limitTo : 2}}</span></div></div></div></td><!--<td>\r\n                            <div class="row items_button">\r\n                                <button type="button" class="btn btn-primary" ng-click="EditItem(item,$index)"><i class="fa fa-edit"></i> EDIT</button>\r\n                                <button type="button" class="btn btn-info" ng-click="CopyItem(item,$index)"><i class="fa fa-copy"></i>COPY</button>\r\n\r\n                                <button type="button" class="btn btn-danger" ng-click="Removeitem(item)"><i class="fa fa-remove"></i>REMOVE</button>\r\n                            </div>\r\n                        </td>--></tr></tbody></table></div></div><div class="row mb-20"><div class="col-md-12"><button type="button" class="btn btn-primary pull-right" ng-click="SaveRulesetSpell()">OK</button></div></div></div>');
$templateCache.put('/views/home/characters.html','<div class="page-characters"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Characters</h1></div><ul class="page-toolbar-actions"><li><button type="button" class="btn icon icon-with-text icon-plus btn-primary" ng-click="newCharacter()">New Character</button></li></ul></div></div></div><!-- End of toolbar --><div class="characters"><!-- Character cards --><div class="cards"><div class="container"><div class="row"><div class="col-6 col-md-4 col-lg-2" ng-repeat="c in characters | orderBy: \'Name\' track by $index"><div class="card-wrapper"><div class="card"><div class="card-image"><img class="card-img-top" ng-src="{{c.Portrait?c.Portrait:\'/wwwroot/images/not-available.jpg\'}}" onerror="this.src=\'/wwwroot/images/not-available.jpg\'" alt="{{c.Name}}" ng-click="selectCharacter(c)"><div class="card-actions hide"><button type="button" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary" ng-click="editCharacter(c)"></button> <button type="button" title="Duplicate" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary" ng-click="copyCharacter(c)"></button> <button type="button" title="Delete" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary" ng-click="characterDelete(c)"></button> <button type="button" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary" ng-click="hideContextMenu($event)"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="selectCharacter(c)">{{c.Name}}</h4><div class="card-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary hide" ng-click="showContextMenu($event)"></button></div></div></div></div></div></div></div></div><!-- End of character cards --></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/characterspellcontent.html','<div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><button type="button" class="btn btn-primary back" ng-click="BackSpellProperties()">Back</button> <button type="button" class="btn btn-accent" ng-click="SaveInventoryTiles(CharacterContent,2)">Save Tile</button></div></div></div><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{CharacterContent.CharacterSpellsProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{CharacterContent.CharacterSpellsProperties[0].Value.Text.value}}</button></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{CharacterContent.CharacterSpellsProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">CLASS</div><div class="panel-body text-center">{{CharacterContent.CharacterSpellsProperties[10].Value.Text.value}}</div></div></div><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">SCHOOL</div><div class="panel-body text-center">{{CharacterContent.CharacterSpellsProperties[9].Value.Text.value}}</div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel div_green"><div class="panel-heading text-center">Materialized Components</div><div class="panel-body text-center">{{CharacterContent.CharacterSpellsProperties[9].Value.Text.value}}</div></div></div></div></div></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Description</h5><p>{{CharacterContent.CharacterSpellsProperties[18].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">CASTING TIME</div><div class="panel-body text-center">{{CharacterContent.CharacterSpellsProperties[17].Value.Number.value}}</div></div></div><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">Attributes</div><div class="panel-body text-center"></div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">{{CharacterContent.CharacterSpellsProperties[10].Value.Text.value}}</div></div></div></div></div></div></div></div><div class="row"><div class="col-md-4"><div class="buttons-align"><button class="btn btn_red" ng-click="Removeitems(CharacterContent,2)"><i class="fa fa-remove" aria-hidden="true"></i> REMOVE</button> <button class="btn btn_red" ng-click="EditItems(CharacterContent,2)"><i class="fa fa-exchange" aria-hidden="true"></i> Edit</button></div></div><div class="col-md-4"><div class="buttons-align"><div ng-repeat="value in CharacterContent.CharacterSpellsProperties" class="equip"><rpgsmithcontenttype info="value"></rpgsmithcontenttype></div><button class="btn uneqp" ng-click="CopyItems(CharacterContent,2)"><i class="fa fa-edit" aria-hidden="true"></i> Copy</button></div></div><div class="col-md-4"><div class="buttons-align"><button class="btn btn-warning" style="width:100%" ng-click="ShowTilesforInventory(CharacterContent.CharacterSpellsProperties)"><i class="fa fa-plus" aria-hidden="true"></i> ADD TILE</button></div></div></div><div gridstack class="grid-stack" options="stackOptions" on-change="onChange(event,ui)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item ng-repeat="tab in CharacterContent.CharacterSpellsProperties" ng-click="tileSelect(tab.tile)" ng-class="getTileClass(tab.tile)" ng-switch on="tab.tile.TileTypeName" class="grid-stack-item" gs-item="tile" gs-item-id="tab.tile.ClientObjectId" gs-item-x="tab.tile.X" gs-item-y="tab.tile.Y" gs-item-width="tab.tile.Width" gs-item-height="tab.tile.Height" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)" data-gs-width="4" data-gs-height="2"><rpgsmithnotetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Note"></rpgsmithnotetype><rpgsmithcountertype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Counter"></rpgsmithcountertype><rpgsmithattributetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Attribute"></rpgsmithattributetype><rpgsmithlinktype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Link" fullscope="LinkExecuteTileContent"></rpgsmithlinktype><rpgsmithexecutetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Execute" fullscope="LinkExecuteTileContent"></rpgsmithexecutetype><rpgsmithcommandtype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Command"></rpgsmithcommandtype><rpgsmithimagetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Image"></rpgsmithimagetype></div></div><div class="tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDropCharacterTiles(event,ui)" on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)"><i class="fa fa-trash-o" aria-hidden="true"></i></div><div class="tile-bubble-add" title="Add a new tile" ng-click="ShowTiles()"><i class="fa fa-plus" aria-hidden="true"></i></div><div class="tile-bubble-save" title="Save changes" ng-click="SaveLayout(NewLayout)"><i class="fa fa-floppy-o" aria-hidden="true"></i></div><!--<div class="tile-bubble-remove" title="Remove Page" droppable\r\n         on-droppable-drop="onDeleteDropCharacterItem(event,ui)"\r\n         on-droppable-over="onDeleteOverCharacterItem(event,ui)" on-droppable-out="onDeleteOutCharacterItem(event)">\r\n        <i class="fa fa-trash-o" aria-hidden="true"></i>\r\n    </div>\r\n    <div class="tile-bubble-add" title="Add a new tile"\r\n         ng-click="ShowTiles()">\r\n        <i class="fa fa-plus" aria-hidden="true"></i>\r\n    </div>\r\n    <div class="tile-bubble-save" title="Save changes"\r\n         ng-click="SaveLayout(NewLayout)">\r\n        <i class="fa fa-floppy-o" aria-hidden="true"></i>\r\n    </div>--></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/edit-character.html','<div class="modal-header"><h4 class="modal-title"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> <span ng-show="isEdit">Editing {{item.name}}</span> <span ng-show="!isEdit">New Character</span></h4></div><div class="modal-body"><ng-form name="dlg" novalidate role="form"><div class="form-group input-group-lg" ng-class="{true: \'has-error\'}[dlg.name.$dirty && dlg.name.$invalid]"><span class="help-block">Character Name</span> <input type="text" class="form-control" name="name" id="name" ng-model="item.name" required></div><div class="form-group input-group-lg"><span class="help-block">Character Portrait</span><div class="clearfix"><div class="pull-left edit-character-portrait"><img ngf-thumbnail="getThumbNail()" class="edit-character-portrait" ngf-resize="{width: 120, height: 120}"></div><div class="pull-left btn btn-default edit-character-portrait-button" name="file" ng-model="file" ngf-select ngf-resize="{width: 120, height: 120, quality: 0.8, centerCrop: true}" ngf-fix-orientation="true" ngf-pattern="\'image/*\'" ngf-accept="\'image/*\'">Select</div></div><span class="help-block">120px by 120px</span></div><div class="form-group"><span class="help-block">Select RuleSet</span><div class=""><select class="form-control"><option>RuleSet 1</option><option>RuleSet 2</option><option>RuleSet 3</option></select></div></div></ng-form></div><div class="modal-footer"><!--<a ng-href="http://localhost:5000/characters/NewRuleSet" class="btn btn-primary"><i style="color:#fff;" class="fa fa fa-plus"></i> Add Rule Set</a>--> <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="(dlg.$dirty && dlg.$invalid) || dlg.$pristine">Save</button></div>');
$templateCache.put('/views/home/editprofile.html','<div class="container edit_profile"><div class="panel panel-primary"><div class="panel-heading"><h4><i class="fa fa-edit"></i> Edit Profile <a href="/characters" class="btn btn-default back_new"><i class="fa fa-angle-double-left"></i>&nbsp;<span>Back</span></a></h4></div><div class="panel-body"><div class="col-md-offset-2 col-md-10"><div class="form-horizontal"><form name="EditForm" novalidate class="form-horizontal"><div class="form-group"><label class="control-label col-sm-2" for="email">User Name:</label><div class="col-sm-3"><input type="text" class="form-control" id="email" placeholder="Enter Username" ng-model="data.Name" disabled="disabled"></div></div><div class="form-group"><label class="control-label col-sm-2" for="email">Email</label><div class="col-sm-3"><input type="email" class="form-control" id="email" placeholder="Enter email" name="email" ng-model="data.Email" disabled="disabled"></div></div><!--<div class="form-group">\r\n                            <label class="control-label col-sm-2" for="pwd">Password:</label>\r\n                            <div class="col-sm-3">\r\n                                <input type="password" class="form-control" id="pwd" placeholder="Enter password" name="pwd" ng-model="data.PasswordHash">\r\n                            </div>\r\n                        </div>\r\n                        <div class="form-group">\r\n                            <label class="control-label col-sm-2" for="pwd">Confirm Password:</label>\r\n                            <div class="col-sm-3">\r\n                                <input type="password" class="form-control" id="pwd" placeholder="Enter password" name="pwd" ng-model="password" ng-change="checkpass()">\r\n                            </div>\r\n                        </div>--><div class="form-group"><label class="control-label col-sm-2" for="pwd">Profile Image:</label><div class="col-sm-4"><div class="clearfix"><div class="pull-left edit-character-portrait"><img id="profileImage" ng-src="{{data.ProfileImage}}" ng-model="data.ProfileImage" alt="Profile Image" ngf-resize="{width: 120, height: 120}"></div><div class="profile_image"><span>Select</span><input type="file" onchange="angular.element(this).scope().ProfileImageUpload(this)" accept="x-png,gif,jpeg"></div></div><span class="help-block">120px by 120px</span></div></div></form></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="button" class="btn btn-primary" ng-click="Update()"><i class="fa fa-edit"></i><span>Update</span></button> <button type="button" class="btn btn-default" ng-click="cancel()"><i class="fa fa-times"></i><span>Cancel</span></button></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/ExistingRuleset.html','<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><style>.mt-20 {\r\n            margin-top: 50px; \r\n            margin-bottom: 50px;\r\n        }\r\n        .mb-20 {\r\n            margin-bottom: 20px;\r\n        }\r\n        .mt-20 {\r\n            margin-top: 20px;\r\n        }</style></head><body><div class="container"><div class="row"><div class="panel panel-default"><div class="panel-heading"><h4 class="lead">Existing RuleSet</h4></div><div class="panel-body"><a ng-href="http://localhost:5000/NewRuleSet" class="pull-right btn btn-primary btn-md">Add Rule Set</a><!--<button type="button" class="pull-right btn btn-primary btn-md" data-toggle="modal" data-target="#myModal"><i style="color:#fff;" class="fa fa-plus" ></i>&nbsp;Add RuleSet</button>--><div class="mt-20"><table class="table table-bordered"><thead><tr><th>SNO</th><th>Name</th><th>Type</th></tr></thead><tbody><tr><td>1</td><td>---- No coreset Selected----</td><td>---- No coreset Selected----</td></tr></tbody></table><button type="button" class="btn btn-default pull-right" ng-click="cancel()">Cancel</button></div></div></div></div></div><div class="modal fade" id="myModal" role="dialog"><div class="modal-dialog"><!-- Modal content--><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Add New RuleSet</h4></div><div class="modal-body"><div class="form-group"><div class="row"><div class="col-md-12"><h2 class="text-center mt-20">Add RuleSet</h2><div class=""><div class="form-group"><label class="control-label col-md-4">Default Dice</label><div class="col-md-8 mb-20"><select class="form-control"><option>Dice 1</option><option>Dice 2</option></select></div></div></div><div class=""><div class="form-group"><label class="control-label col-md-4">Weight Metric Label</label><div class="col-md-8"><input type="number" min="0" class="form-control"></div></div></div></div></div><hr><div class="row"><div class="col-md-12"><h2 class="text-center">Core Stats</h2><button type="button" class="col-md-offset-8 btn btn-primary btn-md" data-toggle="modal" data-target="#myModal"><i style="color:#fff" class="fa fa-plus"></i>&nbsp;Add New CoreStats</button><div class="col-md-12 mt-20"><p class="lead text-center">No CoreStats Available..</p><table class="table table-bordered" style="display:none"><thead><tr><th>SNO</th><th>Name</th><th>Type</th></tr></thead><tbody><tr><td>1</td><td>---- No coreset Selected----</td><td>---- No coreset Selected----</td></tr></tbody></table><button type="button" class="btn btn-default pull-right" ng-click="cancel()">Cancel</button></div></div></div></div><div class="modal fade" id="myModal" role="dialog"><div class="modal-dialog"><!-- Modal content--><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Add New CoreState</h4></div><div class="modal-body"><div class="form-group"><label class="control-label col-md-4">Name</label><div class="col-md-8 mb-20"><input type="text" class="form-control"></div></div><div class="form-group"><label class="control-label col-md-4">Type</label><div class="col-md-8 mb-20"><input type="text" class="form-control"></div></div></div><div class="modal-footer" style="border-top:1px solid #fff"><button type="button" class="btn btn-primary" data-dismiss="modal">Save</button> <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button></div></div></div></div><!--<div class="form-group">\r\n                            <label class="control-label col-md-4">\r\n                                Name\r\n                            </label>\r\n                            <div class="col-md-8 mb-20">\r\n                                <input type="text" class="form-control" />\r\n                            </div>\r\n                        </div>--><div class="form-group"><label class="control-label col-md-4">Type</label><div class="col-md-8 mb-20"><input type="text" class="form-control"></div></div></div><div class="modal-footer" style="border-top:1px solid #fff"><button type="button" class="btn btn-primary" data-dismiss="modal">Save</button> <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button></div></div></div></div></body></html>');
$templateCache.put('/views/home/itemcontent.html','<div gridstack class="grid-stack" options="stackOptions" on-change="onChange(event,ui)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item ng-repeat="item in RulesetContent" ng-click="tileSelect(tab)" ng-class="getTileClass(tab)" ng-switch on="item.Name" class="grid-stack-item" gs-item="tile" gs-item-id="item.Id" gs-item-x="5" gs-item-y="5" data-gs-x="1" data-gs-y="1" gs-item-autopos="1" data-gs-width="4" data-gs-height="2" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)"><img ng-src="{{RulesetContent[1].Value.Image.image}}" class="img-resposive grid-stack-item-content" width="120" height="120" ng-switch-when="Image"><p class="form_inline grid-stack-item-content" ng-switch-when="Name">{{item.Value.Text.value}}</p><p class="form_inline grid-stack-item-content" ng-switch-when="Stats">Stats :{{item.Value.Text.value}}</p><p class="form_inline grid-stack-item-content" ng-switch-when="Visible Description">Discription:{{item.Value.Text.value}}</p><p class="form_inline grid-stack-item-content" ng-switch-when="Weight">Weight:{{item.Value.Weight.value}}</p><p class="form_inline grid-stack-item-content" ng-switch-when="Volume">Volume:{{item.Value.Volume.depthvalue}} {{item.Value.Volume.heightvalue}} {{item.Value.Volume.lenghtvalue}}</p><p class="form_inline grid-stack-item-content" ng-switch-when="Rarity">Rarity:{{item.Value.Choices.selectedchoice}}</p><p class="form_inline grid-stack-item-content" ng-switch-when="Tags">Tags:{{item.Value.Text.value}}</p></div><!--<div class="grid-stack-item" ng-repeat="item in RulesetContent" gs-item-x="5" gs-item-y="5" data-gs-x="5" data-gs-y="5"data-gs-width="5" data-gs-height="5" gs-item-width="7" gs-item-height="7" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)">\r\n\r\n                        <p class="form_inline grid-stack-item-content">{{item.Value.Text.value}}</p>\r\n                </div>--></div><div class="buttons-align"><button class="btn btn-warning" style="width:100%" ng-click="ShowTiles(RulesetContent)"><i class="fa fa-plus" aria-hidden="true"></i> ADD TILE</button></div><div gridstack class="grid-stack" options="stackOptions" on-change="onChange(event,ui)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item ng-repeat="tab in RulesetContent" ng-click="tileSelect(tab)" ng-class="getTileClass(tab)" ng-switch on="tab.TileTypeName" class="grid-stack-item" gs-item="tile" gs-item-id="tab.TileId" gs-item-x="tab.X" gs-item-y="tab.Y" gs-item-width="tab.Width" gs-item-height="tab.Height" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)" data-gs-width="4" data-gs-height="2"><rpgsmithnotetype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Note" fullscope="tabs.TileList"></rpgsmithnotetype><rpgsmithcountertype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}};border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Counter"></rpgsmithcountertype><rpgsmithattributetype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Attribute"></rpgsmithattributetype><rpgsmithlinktype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Link"></rpgsmithlinktype><rpgsmithexecutetype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Execute" fullscope="tabs.TileList"></rpgsmithexecutetype><rpgsmithcommandtype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Command"></rpgsmithcommandtype><rpgsmithimagetype ng-style="" style="border: {{tab.Styles.width}} {{tab.Styles.style}} {{tab.Styles.color}}; border-radius: {{tab.Styles.radius}};background-color: {{tab.Styles.backgroundColor}};box-shadow:{{tab.Styles.shadow}}" info="tab" class="form_inline grid-stack-item-content" ng-switch-when="Image"></rpgsmithimagetype></div></div><div class="tile-bubble-remove" title="Remove Page" droppable on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"><i class="fa fa-trash-o" aria-hidden="true"></i></div><div class="tile-bubble-add" title="Add a new tile" ng-click="ShowTiles()"><i class="fa fa-plus" aria-hidden="true"></i></div><div class="tile-bubble-save" title="Save changes" ng-click="SaveLayout(NewLayout)"><i class="fa fa-floppy-o" aria-hidden="true"></i></div><!--<script type="text/javascript">\r\n                $(function () {\r\n                    $(\'.grid-stack\').gridstack();\r\n                });\r\n            </script>-->');
$templateCache.put('/views/home/iteminventory.html','<div class="page-inventory itemproperty" ng-init="onloadFun()"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Character Inventory</h1></div><button type="button" id="newItemTrigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn icon icon-with-text icon-plus btn-primary dropdown-toggle">New Item</button><div class="dropdown-menu" aria-labelledby="siteNavigationToggle"><!--<div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger">\r\n\t\t\t\t<ul class="dropdown-menu-list">\r\n\t\t\t\t\t<li class="dropdown-menu-item">\r\n\t\t\t\t\t\t<button type="button" data-toggle="modal" data-target="#addItemPopup" class="btn btn-accent">Add Item</button>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class="dropdown-menu-item">\r\n\t\t\t\t\t\t<button type="button" data-toggle="modal" data-target="#createItemPopup" class="btn btn-accent">Create Item</button>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</div>--><ul class="dropdown-menu-list"><li class="dropdown-menu-item" ng-hide="true"></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" style="width: 100%" data-target="#createItemPopup" ng-click="AddRulesetItems()" class="btn btn-accent">Add Item</button></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" style="width: 100%" data-target="#addItemPopup" ng-click="CreateCharacterItem()" class="btn btn-accent">Create Item</button></li></ul></div></div></div></div><!-- End of toolbar --><!-- Inventory cards --><div class="cards cards-inventory"><div class="container"><div ng-show="ShowItems"><div class="col-md-12"><h3 class="text-center">No Items Added</h3></div></div><div class="card-list" ng-show="ShowItem"><div class="card-wrapper" ng-repeat="item in NewItemInventory.CharacterItems"><div class="card" data-href="#"><div class="card-image"><img class="card-img-top" ng-click="ShowAllItemProperties(item,$index)" ng-src="{{item.CharacterItemsProperties[1].Value.Image.image?item.CharacterItemsProperties[1].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" alt="{{item.CharacterItemsProperties[0].Value.Text.value}}"><div class="card-actions"><button type="button" title="Edit" ng-click="EditItem(item,$index,1)" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary"></button> <button type="button" title="Duplicate" ng-click="CopyItem(item,$index,1)" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary"></button> <button type="button" title="Delete" ng-click="Removeitem(item,$index,1)" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary"></button> <button type="button" title="Close" ng-click="hideConteextMenu($event)" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="ShowAllItemProperties(item,$index)">{{item.CharacterItemsProperties[0].Value.Text.value}}</h4><div class="card-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showContextMenu($event)"></button></div><ul class="item-properties"><li class="item-property item-property-text rarity highlight" ng-if="(item.CharacterItemsProperties[6].Value.Choices.selectedchoice != undefined) && (item.CharacterItemsProperties[6].Value.Choices.selectedchoice != null) && (item.CharacterItemsProperties[6].Value.Choices.selectedchoice != \'\')">{{item.CharacterItemsProperties[6].Value.Choices.selectedchoice}}</li><li class="item-property item-property-text weight" ng-if="(item.CharacterItemsProperties[4].Value.Weight.value != undefined) && (item.CharacterItemsProperties[4].Value.Weight.value != null) && (item.CharacterItemsProperties[4].Value.Weight.value != \'\')">{{item.CharacterItemsProperties[4].Value.Weight.value}} {{item.CharacterItemsProperties[4].Value.Weight.units.selectedUnit}}</li><li ng-repeat="item in item.CharacterItemsProperties" ng-if="(item.TypeId==3 && item.Value.OnorOff.value == \'Yes\') || ( item.TypeId == 4 && item.Value.YesOrNo.value == \'Yes\')" class="item-property item-property-icon icon icon-rsi" ng-class="\'icon-\' + item.Name.toLowerCase()" title="{{item.Name}}" data-toggle="tooltip"></li><!--<li class="item-property item-property-icon icon icon-magical icon-rsi" title="Magical" data-toggle="tooltip"></li>\r\n                                <li class="item-property item-property-icon icon icon-consumable icon-rsi" title="Consumable" data-toggle="tooltip"></li>--></ul><div class="item-stats">{{item.CharacterItemsProperties[2].Value.Text.value}}</div><div class="item-actions"><!--<button type="button" class="btn btn-accent" ng-click="Removeitem(item,$index,1)">Drop</button>\r\n\r\n                                <button type="button" class="btn btn-accent">Use</button>\r\n\r\n                                <rpgsmithcontenttype info="value" ng-repeat="value in item.CharacterItemsProperties"></rpgsmithcontenttype>--></div></div></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/login.html','<div class="container-fluid login_page"><div class="text-center rpgs-login" ng-hide="registersuccess"><div class="logo"></div><div class="login-form-1"><form id="login-form" class="text-left"><div class="login-form-main-message"></div><div class="main-login-form"><div class="login-group state-{{mode}}"><div class="form-group register" ng-class="{\'open\': mode==2}"><label for="lg_username" class="sr-only">Username</label><input type="text" class="form-control" name="lg_username" placeholder="username" ng-model="data.username"></div><div class="form-group register" ng-class="{\'open\': mode==2 || mode==1 || mode==3}"><label for="lg_email" class="sr-only">Email</label><input type="email" class="form-control" name="lg_email" placeholder="email address" ng-model="data.email"></div><div class="form-group register" ng-class="{\'open\': mode != 3}"><label for="lg_password1" class="sr-only">Password</label><input type="password" class="form-control" name="lg_password1" placeholder="password" ng-model="data.password" ng-keypress="passwordKeyPress($event)"></div><div class="form-group register" ng-class="{\'open\': mode == 2}"><label for="lg_password2" class="sr-only">Confirm Password</label><input type="password" class="form-control" name="lg_password2" placeholder="confirm password" ng-model="data.confirmPassword"></div><div class="register account_image" ng-class="{\'open\': mode == 2}"><div class="profile_image profile_image_new"><span>Choose Profile Picture</span> <input type="file" onchange="angular.element(this).scope().profileImageUpload(this)" accept="x-png,gif,jpeg"></div><img style="margin-top: 20px" id="profileImage" ng-src="{{profileimagesrc}}" ng-model="data.profileimagesrc" alt="Account Image"></div><div class="form-group login-group-checkbox register" ng-class="{\'open\': mode != 3}"><input type="checkbox" name="lg_remember" ng-model="data.rememberMe"> <span ng-click="data.rememberMe = !data.rememberMe" ng-keypress="rememberKeyPress($event)"><label for="lg_remember">remember</label></span></div></div><button type="button" class="login-button" ng-click="action()"><i class="fa fa-chevron-right"></i></button></div><div class="etc-login-form"><p class="register" ng-class="{\'open\': mode != 3}">forgot your password? <a href="#" ng-click="setMode(3)">click here</a></p><p class="register" ng-class="{\'open\': mode != 2}">new user? <a href="#" ng-click="setMode(2)">create new account</a></p><p class="register" ng-class="{\'open\': mode != 1}">have an account? <a href="#" ng-click="setMode(1)">sign in!</a></p></div><div class="col-md-12 divide_socilalicons"><table><tr style="width:100%"><td style="width:50%"><hr class="divider_line"></td><td>or</td><td style="width:50%"><hr class="divider_line"></td></tr><tr><td colspan="3"><br></td></tr></table></div><div style="text-align: center"><!--<div id="my-signin2" data-longtitle="true" data-onfailure="onSignInFailure" data-onsuccess="onSignIn" data-theme="light" data-width="200">\r\n\r\n\t\t\t\t\t</div>--><script>var googleUser = {};\r\n\t\t\t\t\t\t//Signout of google account\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tsignOut();\r\n\t\t\t\t\t\tvar startApp = function () {\r\n\t\t\t\t\t\t\tgapi.load(\'auth2\', function () {\r\n\t\t\t\t\t\t\t\t// Retrieve the singleton for the GoogleAuth library and set up the client.\r\n\t\t\t\t\t\t\t\tauth2 = gapi.auth2.init({\r\n\t\t\t\t\t\t\t\t\tclient_id: \'648640285849-0scq8gjc86o3tavrrks8ri78210q6hmq.apps.googleusercontent.com\',\r\n\t\t\t\t\t\t\t\t\tcookiepolicy: \'single_host_origin\',\r\n\t\t\t\t\t\t\t\t\t// Request scopes in addition to \'profile\' and \'email\'\r\n\t\t\t\t\t\t\t\t\t//scope: \'additional_scope\'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tattachSignin(document.getElementById(\'customBtn\'));\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tfunction attachSignin(element) {\r\n\t\t\t\t\t\t\tconsole.log(element.id);\r\n\t\t\t\t\t\t\tauth2.attachClickHandler(element, {},\r\n\t\t\t\t\t\t\t\tfunction (googleUser) {\r\n\t\t\t\t\t\t\t\t\tconsole.log("GoogleUser: ", googleUser);\r\n\t\t\t\t\t\t\t\t\tonSignIn(googleUser);\r\n\t\t\t\t\t\t\t\t\t//window.location.href = "/characters";\r\n\t\t\t\t\t\t\t\t\t//document.getElementById(\'name\').innerText = "Signed in: " +\r\n\t\t\t\t\t\t\t\t\t//\tgoogleUser.getBasicProfile().getName();\r\n\t\t\t\t\t\t\t\t}, function (error) {\r\n\t\t\t\t\t\t\t\t\talert(JSON.stringify(error, undefined, 2));\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfunction signOut() {\r\n\t\t\t\t\t\t\tif (gapi.auth2 == null)\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\tgapi.auth2.getAuthInstance().disconnect();\r\n\t\t\t\t\t\t\tgoogleUser = null;\r\n\r\n\t\t\t\t\t\t}</script><style type="text/css">#gSignInWrapper {\r\n\t\t\t\t\t\t\t/*align-content: center;*/\r\n\t\t\t\t\t\t\t/*margin-left: 30px;*/\r\n\t\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t#customBtn:hover {\r\n\t\t\t\t\t\t\t\tcursor: pointer;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tspan.label {\r\n\t\t\t\t\t\t\t\tfont-family: serif;\r\n\t\t\t\t\t\t\t\tfont-weight: normal;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tspan.icon {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tspan.buttonText {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}</style><!-- In the callback, you would hide the gSignInWrapper element osuccessful sign in --><div id="gSignInWrapper"><div id="customBtn" class="loginBtn loginBtn--google"><span class="buttonText">Log in with Google</span></div></div><div id="name"></div><script>startApp();</script><button onclick="SubmitLogin()" class="loginBtn loginBtn--facebook">Log in with Facebook</button><!--<button name="signInGoogle" id="signInGoogle" value="Google SignIn">Google SignIn</button>\r\n\r\n                    <fb:login-button data-size="xlarge" data-button-type="continue_with" autologoutlink="true" perms="read_friendlists, create_event, email, publish_stream"></fb:login-button>--></div><div class="etc-login-form"></div></form></div><div>By logging in you agree to the <a ng-click="showTerms();">Terms of Service</a></div></div><div style="max-width: 5in;margin: 0 auto;background-color:#ffffff;margin-top: 1.5em" ng-show="registersuccess"><table width="100%" style="padding: 0 20px"><tr><td align="center" style="padding-top: 1em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith"><img width="252" height="127" title="RPGSmith" alt="RPGSmith" src="https://lh3.googleusercontent.com/QEifSn90PEjjSZ-5d3yhXoVp6ixxojV6Jo3P_lKUvvBTqxFsWmLjHllW0HrLji6hM5lgEYv3cCuWE_dDo3hzyevV_RyQZf4fA0JRHr7Y6bV0oX9Mjc3O5ZlLKzkF9sfnjkpM_YmNmLJ2SX2MmjwteXop2spQACXtsQgSOM0Sc0K94F-JFC2NcSTHwqTerHPgG-T2PSG2qINGcSdgn2m7AMkq1tSqKds5x1Ovic9auo7NkNomKTgw2WvCsoR96g9TkJRqi-viX38qbJkl3RJySoqycBoSULmZ8WaIb3gMcBM4CJFEHiVZx9a1qfpxibE_iMARM4PdP8GOiGZkqLt4NNI2rs7ojnvpXIagmS0OuUyZtXt8yw0egJWadSM_K3N_vDFE_fPt4I0RU7CDgPlD-UgjvuZ7om7c-448MOtbR4lVqFyGKyYnxxruPwtr966PpXQ3NpQpHmhfMbqSnseYJ512_aeg1ohlKpUhknsSS2WBRhTcfBo14t1f1VEyNOnd8bPx0jEUQhx4euqH8raDO6W7MxOR666SWFAlLiNJdA=w702-h353-no"></a></td></tr><tr><td align="center"><div style="margin-bottom: 1em;font-size: 1.4em;font-weight: 500" mc:edit="rem_title">Email Confirmation ({{name}})</div></td></tr><tr><td align="center"><div style="margin-bottom: 1.5em;font-weight: 300" mc:edit="rem_notes">An Email has been sent to <strong>{{useremail}}</strong><br><br>Please check your inbox and confirm your account.</div></td></tr><tr><td align="center"></td></tr><tr><td align="center" style="font-weight: 300;font-size: 0.8em;padding-bottom: 1em">Copyright &#169;2018 <a href="https://www.facebook.com/RPG-Smith-1625592264372389" title="RPGSmith" style="text-decoration: none;color: #34AADC"><span class="RPGSmith" style="color: #D2602A;font-weight: 700">RPG<b style="color: #000000;font-weight: 700">&#8226;Smith</b></span></a>, LLC All rights reserved.<br><div style="padding-top: 1.0em"><a href="https://www.facebook.com/RPG-Smith-1625592264372389" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"></a><a href="https://twitter.com/RpgSmith" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"></a><a href="https://plus.google.com/u/2/communities/101062066525142446219" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"></a></div></td></tr></table></div><toaster-container class="toaster_align" style="opacity: 1.0" toaster-options="{\'time-out\':6000}"></toaster-container><script>var appId = "315312135648885";\r\n\t\t\twindow.fbAsyncInit = function () {\r\n\t\t\t\t\r\n                FB.init({\r\n                    appId: appId,\r\n                    status: true,\r\n                    cookie: true,\r\n                    xfbml: true\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t//FB.Event.subscribe(\'auth.login\', function (response) {\r\n\t\t\t\t//\tvar credentials = { uid: response.authResponse.userID, accessToken: response.authResponse.accessToken };\r\n\t\t\t\t//\tSubmitLogin(credentials);\r\n\t\t\t\t//});\r\n\t\t\t\t\r\n            };\r\n\r\n            (function (d) {\r\n                var js, id = \'facebook-jssdk\', ref = d.getElementsByTagName(\'script\')[0];\r\n                if (d.getElementById(id)) {\r\n                    return;\r\n                }\r\n                js = d.createElement(\'script\');\r\n                js.id = id;\r\n                js.async = true;\r\n                js.src = "//connect.facebook.net/en_US/all.js";\r\n                ref.parentNode.insertBefore(js, ref);\r\n            }(document));\r\n\t\t\r\n\t\t\tif (angular.isUndefined(FB) != true) {\r\n\t\t\t\tvar status = FB.getLoginStatus();\r\n\t\t\t\tconsole.log("Status: ", status);\r\n\t\t\t\tif (status != null && status.indexOf("connected") == 0) {\r\n\t\t\t\t\tFBlogout();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t//FB.getLoginStatus(function (response) {\r\n                //    debugger;\r\n                //    if (response.status === \'connected\') {\r\n                //        alert("user is logged into fb");\r\n                //    }\r\n                //    else if (response.status === \'not_authorized\') { alert("user is not authorised"); }\r\n                //    else { alert("user is not conntected to facebook"); }\r\n\r\n                //});\r\n\t\tfunction FBlogout() {\r\n\t\t\tFB.logout(function (response) {\r\n\t\t\t\t// user is now logged out\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction SubmitLogin() {\r\n\t\t\tFB.login(function (response) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tif (response.authResponse) {\r\n\t\t\t\t\tconsole.log(\'Welcome!  Fetching your information.... \');\r\n\t\t\t\t\tvar credentials = { uid: response.authResponse.userID, accessToken: response.authResponse.accessToken };\r\n\t\t\t\t\tFB.api(\'/me\', function (response) {\r\n\t\t\t\t\t\tconsole.log(response);\r\n\t\t\t\t\t\tangular.element(\'#profileImage\').scope().isFBUserRegistered(credentials);\r\n\t\t\t\t\t\t//SubmitLogin(credentials);\r\n\t\t\t\t\t\t//alert(response.name);\r\n\t\t\t\t\t\t//  console.log(\'Good to see you, \' + response.name + \'.\');\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log(\'User cancelled login or did not fully authorize.\');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t}</script><script>function onSignIn(googleUser) {\r\n\t\t\tvar profile = googleUser.getBasicProfile();\r\n\t\t\tconsole.log(\'ID: \' + profile.getId()); // Do not send to your backend! Use an ID token instead.\r\n\t\t\tconsole.log(\'Name: \' + profile.getName());\r\n\t\t\tconsole.log(\'Image URL: \' + profile.getImageUrl());\r\n\t\t\tconsole.log(\'Email: \' + profile.getEmail()); // This is null if\r\n\t\t\tconsole.log(\'Access\' + googleUser.getAuthResponse().id_token);\r\n\t\t\tangular.element(\'#profileImage\').scope().isUserRegistered(profile.getEmail(), profile.getId(), googleUser.getAuthResponse().id_token);\r\n\t\t}\r\n\t\tsetTimeout(function () {\r\n            $("#loading").css("display", "none");\r\n        }, 1000);</script></div>');
$templateCache.put('/views/home/resetpassword.html','<div class="container reset_password" data-ng-init="loadResetPage()"><div class="panel panel-primary"><div class="panel-heading"><h4><i class="fa fa-edit"></i> Reset Password <a href="/characters" class="btn btn-default back_new"><i class="fa fa-angle-double-left"></i>&nbsp;<span>Back</span></a></h4></div><div class="panel-body"><div class="col-md-offset-2 col-md-10"><div class="form-horizontal"><div class="form-group"><label class="control-label col-sm-2" for="emailold">Old Password</label><div class="col-sm-3"><input type="password" class="form-control" id="emailold" placeholder="Enter Old Password" name="emailold" ng-model="resetModel.oldpassword"></div></div><div class="form-group"><label class="control-label col-sm-2" for="emailnew">New Password</label><div class="col-sm-3"><input type="password" class="form-control" id="emailnew" placeholder="Enter New Password" name="emailnew" ng-model="resetModel.newpassword"></div></div><div class="form-group"><label class="control-label col-sm-2" for="pwd">Confirm Password:</label><div class="col-sm-3"><input type="password" class="form-control" id="pwd" placeholder="Enter Confirm password" name="pwd" ng-model="resetModel.confirmpassword" ng-change="checkpass()"></div></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="button" class="btn btn-primary" ng-click="ResetProfilePassword(resetModel)"><i class="fa fa-edit"></i><span>Update</span></button> <button type="button" class="btn btn-default" ng-click="cancel()"><i class="fa fa-times"></i><span>Cancel</span></button></div></div></div></div></div></div><toaster-container toaster-options="{\'position-class\': \'toast-top-right\', \'time-out\':6000}" style="left: 50%; position: fixed"></toaster-container>');
$templateCache.put('/views/home/ruleset-abilities.html','<!--<div class="container item_properties">\r\n    <div class="row">\r\n        <div class="well well-sm">\r\n            <div class="">\r\n\r\n                <button type="button" class="glyphicon glyphicon-th-list btn btn-default btn-sm" ng-click="showlist()">List</button>\r\n\r\n                <button type="button" class="glyphicon glyphicon-th btn btn-default btn-sm" ng-click="showgrid()">Grid</button>\r\n                <button type="button" class="btn btn-primary back" ng-click="BackItem()">Back</button>\r\n                <button type="button" class="btn btn-primary" ng-click="CreateItem()">Create Item</button>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div ng-show="Itemlist">\r\n        <div class="col-md-12">\r\n            <h3 class="text-center">No Items Added</h3>\r\n        </div>\r\n    </div>--><!--<div class="row" id="listview" ng-show="list">\r\n    <div class="col-md-12 col-sm-12 table-responsive">\r\n        <table class="table table-bordered">\r\n            <thead>\r\n                <tr>\r\n                    <th>S.No</th>\r\n                    <th>IMAGE</th>\r\n                    <th>NAME</th>\r\n                    <th>Stats</th>\r\n                    <th>DESCRIPTION</th>\r\n                    <th>Quantity</th>\r\n                    <th>ATTRIBUTES</th>\r\n                    <th>ACTIONS</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr ng-repeat="item in RulesetItems">\r\n                    <td ng-click="ShowAllItemProperties($index)">{{$index + 1}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)"><img ng-src="{{item.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120" /></td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[0].Value.Text.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[2].Value.Text.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[9].Value.Text.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[3].Value.Number.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">\r\n                        <div class="icon_box">\r\n                            <p style="width:104px;">\r\n                                <span>{{item.ItemProperties[13].Name | limitTo: 2}}</span>\r\n                                <span> {{item.ItemProperties[13].Value.YesOrNo.value | limitTo: 3}}</span>\r\n                            </p>\r\n                        </div>\r\n                        <div class="icon_box"><span>{{item.ItemProperties[17].Value.YesOrNo.value | limitTo: 1}}</span></div>\r\n                        <div class="icon_box"><span>M</span></div>\r\n\r\n                    </td>\r\n\r\n                    <td>\r\n                        <div class="row items_button">\r\n                            <button type="button" class="btn btn-primary" ng-click="EditItem(item,$index)"><i class="fa fa-edit"></i> EDIT</button>\r\n                            <button type="button" class="btn btn-info" ng-click="CopyItem(item,$index)"><i class="fa fa-copy"></i>COPY</button>\r\n\r\n                            <!--<img src="/wwwroot/images/brain.png" class="img_inline" />\r\n                            <img src="/wwwroot/images/hand.png" class="img_inline" />--><!--<button type="button" class="btn btn-danger" ng-click="Removeitem(item)"><i class="fa fa-remove"></i>REMOVE</button>\r\n                        </div>\r\n                    </td>\r\n\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n    </div>\r\n</div>--><!--<div class="row" id="gridview" ng-show="grid">\r\n    <div class="col-md-3 col-sm-6" ng-repeat="item in NewRuleSet.Items" ng-click="ShowAllItemProperties(item,$index)">\r\n        <div class="card hovercard">\r\n            <div class="" ng-click="ShowAllItemProperties(item,$index)">\r\n                <img ng-src="{{item.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="240" height="240" />\r\n            </div>\r\n\r\n            <div class="info">\r\n                <div class="title">\r\n                    <a target="_blank" href="#">{{item.ItemProperties[0].Value.Text.value}}</a>\r\n                </div>\r\n                <div class="desc">\r\n                    {{item.ItemProperties[9].Value.Text.value}}\r\n                </div>\r\n            </div>\r\n\r\n            <div class="bottom">\r\n\r\n                    {{item.ItemProperties[13].Value.YesOrNo.value}}\r\n\r\n                <a class="btn btn-danger btn-sm" rel="publisher"\r\n                   href="#">\r\n                    <i class="fa fa-google-plus"></i>\r\n                    {{item.ItemProperties[17].Value.YesOrNo.value}}\r\n                </a>\r\n                <a class="btn btn-primary btn-sm" rel="publisher"\r\n                   href="#">\r\n                    <i class="fa fa-facebook"></i>\r\n                    {{item.ItemProperties[13].Value.YesOrNo.value}}\r\n                </a>--><!--<a class="btn btn-primary btn-xs" ng-click="EditItem(item,$index)">\r\n                <i class="fa fa-edit"></i>\r\n                <i class="fa fa-edit"></i>\r\n                Edit\r\n            </a>\r\n            <a class="btn btn-info  btn-xs" ng-click="CopyItem(item,$index)">\r\n                <i class="fa fa-copy"></i>\r\n                Copy\r\n            </a>\r\n            <a class="btn btn-danger  btn-xs" ng-click="Removeitem(item)">\r\n                <i class="fa fa-remove"></i>\r\n                Remove\r\n            </a>\r\n\r\n        </div>\r\n    </div>\r\n</div>--><!--</div>--><toaster-container></toaster-container><div class="page-inventory"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Ruleset Abilities</h1></div><ul class="page-toolbar-actions"><li class="view-switch"><div class="btn-group" role="group"><button type="button" id="gridViewTrigger" class="btn icon icon-grid btn-primary selected" ng-click="GridViewTrigger($event)"></button> <button type="button" id="listViewTrigger" class="btn icon icon-list btn-primary" ng-click="ListViewTrigger($event)"></button></div></li><!--<li>\r\n                        <button type="button" ng-click="BackAbility()" class="btn icon icon-with-text btn-primary">Back</button>\r\n                    </li>--><li><button type="button" ng-click="CreateAbility()" class="btn icon icon-with-text icon-plus btn-primary">Create Ability</button></li></ul></div></div></div><div ng-show="Itemlist"><div class="col-md-12"><h3 class="text-center">No Abilities Added</h3></div></div><div class="cards cards-inventory" ng-show="list"><div class="container"><div class="card-list"><div class="card-wrapper" ng-repeat="ability in RulesetAbilities"><div class="card" data-href="#"><div class="card-image"><img class="card-img-top" ng-click="ShowAllAbilityContent($index)" ng-src="{{ability.AbilityProperties[1].Value.Image.image}}?ability.AbilityProperties[1].Value.Image.image:\'/wwwroot/images/not-available.jpg\'" alt="{{ability.AbilityProperties[0].Value.Text.Value}}"><div class="card-actions hide"><button type="button" title="" data-toggle="tooltip" ng-click="EditAbility(ability,$index)" class="btn icon icon-pencil btn-simple-primary" data-original-title="Edit"></button> <button type="button" title="" data-toggle="tooltip" ng-click="CopyAbility(ability,$index)" class="btn icon icon-copy icon-rsi btn-simple-primary" data-original-title="Duplicate"></button> <button type="button" title="" data-toggle="tooltip" ng-click="RemoveAbility(ability,$index)" class="btn icon icon-trash btn-simple-primary" data-original-title="Delete"></button> <button type="button" title="" data-toggle="tooltip" class="btn icon icon-cross btn-simple-primary" data-original-title="Close" ng-click="hideConteextMenu($event)"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="ShowAllAbilityContent($index)">{{ability.AbilityProperties[0].Value.Text.value}}</h4><div class="card-actions-trigger"><button type="button" title="" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" data-original-title="Manage" ng-click="showContextMenu($event)"></button></div><ul class="item-properties"><li class="item-property item-property-text rarity highlight">{{ability.AbilityProperties[2].Value.Text.value}}</li><li class="item-property item-property-text weight">{{ability.AbilityProperties[3].Value.Number.value}}</li><li class="item-property item-property-icon icon icon-magical icon-rsi" title="" data-toggle="tooltip" data-original-title="Magical"></li><li class="item-property item-property-icon icon icon-consumable icon-rsi" title="" data-toggle="tooltip" data-original-title="Consumable"></li></ul><div class="item-stats">{{ability.AbilityProperties[18].Value.Text.value}}</div></div></div></div></div></div></div></div>');
$templateCache.put('/views/home/ruleset-addnew.html','<div class="container ruleset"><div class="row"><div class=""><div class="panel panel-primary"><div class="panel-heading"><h4><i class="{{NewRuleSet.ActionIcon}}"></i> {{NewRuleSet.Heading}}</h4></div><div class="panel-body"><ng-form name="dlg" id="rulesetForm" novalidate role="form"><!--<div class="col-md-offset-2 col-md-8 mbr-20">\r\n                            <div class="form-group">\r\n                                <label class="control-label col-md-4">Name <span class="errorColor">*</span></label>\r\n                                <div class="col-md-8">\r\n                                    <input type="text" class="form-control" name="name" id="name" ng-model="NewRuleSet.Name" ng-class="{red: dlg.name.$dirty && dlg.name.$error.required}" required>\r\n                                </div>\r\n                                <button type="button" class="btn btn-primary" ng-click="ImportRuleSet()">Import Ruleset</button>\r\n                            </div>\r\n                        </div>--><div class="col-md-offset-2 col-md-8 mbr-20"><div class="form-group"><label class="control-label col-md-2">Name <span class="errorColor">*</span></label><div class="col-md-7"><input type="text" class="form-control" name="name" id="name" ng-model="NewRuleSet.Name" ng-class="{red: dlg.name.$dirty && dlg.name.$error.required}" required></div><div class="col-md-3"><button type="button" class="btn btn-primary pull-right" ng-click="ImportRuleSet()" ng-show="NewRuleSet.ImportRquired">Import Ruleset</button></div></div></div><div class="col-md-offset-2 col-md-8"><uib-accordion close-others="oneAtATime"><uib-accordion-group is-open="status.open"><uib-accordion-heading>General Settings <i class="pull-left fa" ng-class="{\'fa fa-minus\': status.open, \'fa fa-plus\': !status.open}"></i></uib-accordion-heading><div class="pb-10" ng-repeat="t in NewRuleSet.Rulesetproperty"><rulesetproperty info="t"></rulesetproperty></div></uib-accordion-group></uib-accordion><uib-accordion close-others="oneAtATime"><uib-accordion-group is-open="status.open"><uib-accordion-heading>Core Stats : {{NewRuleSet.Corestats.length}} <i class="pull-left fa" ng-class="{\'fa fa-minus\': status.open, \'fa fa-plus\': !status.open}"></i></uib-accordion-heading><h4 class="text-center" ng-show="!(iscorestatsadded)">No Core Stats Added</h4><div class="col-md-12 mobileview_addnew"><button type="button" class="btn btn-success col-md-offset-4 col-md-4" ng-click="showallCorestats()">Show All</button> <button class="btn btn-primary mb-20 ng-scope pull-right" ng-click="addNewCoreStat()">Add New Corestats</button></div><table ng-show="(iscorestatsadded)" class="table table-bordered table-striped" id="tableAttendees"><thead><tr><th>S.No.</th><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr ng-repeat="corestat in NewRuleSet.Corestats | limitTo : limit"><td>{{$index +1}}</td><td>{{corestat.Name}}</td><td>{{corestat.TypeName}}</td><td>{{corestat.Description}}</td></tr></tbody></table></uib-accordion-group></uib-accordion><uib-accordion close-others="oneAtATime"><uib-accordion-group is-open="status.open"><uib-accordion-heading>Content <i class="pull-left fa" ng-class="{\'fa fa-minus\': status.open, \'fa fa-plus\': !status.open}"></i></uib-accordion-heading><div class="col-md-12 items_tabs"><ul class="nav nav-pills"><li ng-class="{ active: isSet(1) }"><a href="#items" ng-click="setTab(1)">Items: {{NewRuleSet.Items.length}}</a></li><li ng-class="{ active: isSet(2) }"><a href="#spells" ng-click="setTab(2)">Spells: {{NewRuleSet.Spells.length}}</a></li><li ng-class="{ active: isSet(3) }"><a href="#abilities" ng-click="setTab(3)">Abilities: {{NewRuleSet.Abilities.length}}</a></li></ul><div class="tab-content"><div id="items" ng-show="isSet(1)"><div class="row"><h4 class="text-center" ng-show="!(isitemsadded)">No Items Added</h4></div><button type="button" ng-click="createitems()" class="create btn btn-default col-md-4">Create Items</button> <button type="button" class="create btn btn-success col-md-4" ng-click="showallitems()">Show All</button><table ng-show="isitemsadded" class="table table-bordered table-striped" id="tableAttendees"><thead><tr><th>S.No.</th><th>Name</th><th>Quantity</th><th>Image</th></tr></thead><tbody><tr ng-repeat="item in NewRuleSet.Items | limitTo : limit"><td>{{$index +1}}</td><td>{{item.ItemProperties[0].Value.Text.value}}</td><td>{{item.ItemProperties[3].Value.Number.value}}</td><!--<td width="30%">{{item.ItemProperties[1].Value.Image.image}}</td>--><td><img ng-src="{{item.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="60" height="60"></td></tr></tbody></table></div><div id="spells" ng-show="isSet(2)"><div class="row"><h4 class="text-center" ng-show="!(isspellsadded)">No Spells Added</h4></div><button type="button" ng-click="createspells()" class="create btn btn-default col-md-4">Create Spells</button> <button type="button" class="create btn btn-success col-md-4" ng-click="ShowallSpells()">Show All</button><table ng-show="isspellsadded" class="table table-bordered table-striped" id="tableAttendees"><thead><tr><th>S.No.</th><th>Name</th><th>Quantity</th><th>Image</th></tr></thead><tbody><tr ng-repeat="spell in NewRuleSet.Spells | limitTo : limit"><td>{{$index +1}}</td><td>{{spell.SpellProperties[0].Value.Text.value}}</td><td>{{spell.SpellProperties[3].Value.Number.value}}</td><td><img ng-src="{{spell.SpellProperties[1].Value.Image.image}}" class="img-resposive" width="60" height="60"></td></tr></tbody></table></div><div id="abilities" ng-show="isSet(3)"><div class="row"><h4 class="text-center" ng-show="!(isabilitiesadded)">No Abilities Added</h4></div><button type="button" ng-click="createabilities()" class="create btn btn-default col-md-4">Create Abilities:</button> <button type="button" class="create btn btn-success col-md-4" ng-click="ShowallAbilities()">Show All</button><table ng-show="isabilitiesadded" class="table table-bordered table-striped" id="tableAttendees"><thead><tr><th>S.No.</th><th>Name</th><th>Quantity</th><th>Image</th></tr></thead><tbody><tr ng-repeat="ability in NewRuleSet.Abilities | limitTo : limit"><td>{{$index +1}}</td><td>{{ability.AbilityProperties[0].Value.Text.value}}</td><td>{{ability.AbilityProperties[3].Value.Number.value}}</td><td><img ng-src="{{ability.AbilityProperties[1].Value.Image.image}}" class="img-resposive" width="60" height="60"></td></tr></tbody></table></div></div></div></uib-accordion-group></uib-accordion><div class="pull-right"><button type="button" class="btn btn-default" ng-click="cancel()"><i class="fa fa-times"></i> Cancel</button><!--<button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="(dlg.$dirty && dlg.$invalid) || dlg.$pristine"><i style="color:white;padding-top: 3px;" class="{{NewRuleSet.ActionIcon}}"></i>{{NewRuleSet.Action}}</button>--> <button type="button" class="btn btn-primary" ng-click="save()"><i style="color:white;padding-top: 3px" class="{{NewRuleSet.ActionIcon}}"></i>{{NewRuleSet.Action}}</button></div></div></ng-form></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/ruleset-corestats.html','<div class=""><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Character Stats</h1></div><button type="button" ng-click="addNewCoreStat()" class="btn icon icon-with-text icon-plus btn-primary">Add Character Stat</button></div></div></div><div ng-show="lists"><div class="col-md-12"><h3 class="text-center">No Character Stats added</h3></div></div><!-- Character stat cards --><div class="cards cards-inventory"><div class="container"><div class="card-list" ng-repeat="corestat in Corestats"><div class="card-wrapper"><div class="card" style="flex-direction: row;padding: 20px;align-content: flex-start"><div class="card-icon icon icon-{{corestat.TypeName.toLowerCase()==\'command\'?\'dice\':(corestat.TypeName.toLowerCase()==\'yes/no\'?\'yes-no\':(corestat.TypeName.toLowerCase()==\'value & sub-value\'?\'value-subval\':(corestat.TypeName.toLowerCase()==\'current & max value\'?\'slider\':(corestat.TypeName.toLowerCase()==\'on/off\'?\'on-off\':corestat.TypeName.toLowerCase()))))}} icon-rsi"></div><div class="card-order-trigger icon icon-list" ng-hide="true"></div><div class="card-body"><h4 class="card-title">{{corestat.Name}}</h4><div class="item-desc">{{corestat.Description}}</div><div class="item-type"><span>{{corestat.TypeName}}</span></div><div class="card-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showActionBtns=true"></button></div><div ng-show="showActionBtns" style="flex-direction: row;padding: 20px;align-content: flex-start"><button type="button" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary"></button> <button type="button" title="Duplicate" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary"></button> <button type="button" title="Delete" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary"></button> <button type="button" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary" ng-click="showActionBtns=false"></button></div></div></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/ruleset-spells.html','<!--<div class="container item_properties">\r\n    <div class="row">\r\n        <div class="well well-sm">\r\n            <div class="">\r\n\r\n                <button type="button" class="glyphicon glyphicon-th-list btn btn-default btn-sm" ng-click="showlist()">List</button>\r\n\r\n                <button type="button" class="glyphicon glyphicon-th btn btn-default btn-sm" ng-click="showgrid()">Grid</button>\r\n                <button type="button" class="btn btn-primary back" ng-click="BackItem()">Back</button>\r\n                <button type="button" class="btn btn-primary" ng-click="CreateItem()">Create Item</button>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div ng-show="Itemlist">\r\n        <div class="col-md-12">\r\n            <h3 class="text-center">No Items Added</h3>\r\n        </div>\r\n    </div>--><!--<div class="row" id="listview" ng-show="list">\r\n    <div class="col-md-12 col-sm-12 table-responsive">\r\n        <table class="table table-bordered">\r\n            <thead>\r\n                <tr>\r\n                    <th>S.No</th>\r\n                    <th>IMAGE</th>\r\n                    <th>NAME</th>\r\n                    <th>Stats</th>\r\n                    <th>DESCRIPTION</th>\r\n                    <th>Quantity</th>\r\n                    <th>ATTRIBUTES</th>\r\n                    <th>ACTIONS</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr ng-repeat="item in RulesetItems">\r\n                    <td ng-click="ShowAllItemProperties($index)">{{$index + 1}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)"><img ng-src="{{item.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120" /></td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[0].Value.Text.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[2].Value.Text.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[9].Value.Text.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[3].Value.Number.value}}</td>\r\n                    <td ng-click="ShowAllItemProperties($index)">\r\n                        <div class="icon_box">\r\n                            <p style="width:104px;">\r\n                                <span>{{item.ItemProperties[13].Name | limitTo: 2}}</span>\r\n                                <span> {{item.ItemProperties[13].Value.YesOrNo.value | limitTo: 3}}</span>\r\n                            </p>\r\n                        </div>\r\n                        <div class="icon_box"><span>{{item.ItemProperties[17].Value.YesOrNo.value | limitTo: 1}}</span></div>\r\n                        <div class="icon_box"><span>M</span></div>\r\n\r\n                    </td>\r\n\r\n                    <td>\r\n                        <div class="row items_button">\r\n                            <button type="button" class="btn btn-primary" ng-click="EditItem(item,$index)"><i class="fa fa-edit"></i> EDIT</button>\r\n                            <button type="button" class="btn btn-info" ng-click="CopyItem(item,$index)"><i class="fa fa-copy"></i>COPY</button>\r\n\r\n                            <!--<img src="/wwwroot/images/brain.png" class="img_inline" />\r\n                            <img src="/wwwroot/images/hand.png" class="img_inline" />--><!--<button type="button" class="btn btn-danger" ng-click="Removeitem(item)"><i class="fa fa-remove"></i>REMOVE</button>\r\n                        </div>\r\n                    </td>\r\n\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n    </div>\r\n</div>--><!--<div class="row" id="gridview" ng-show="grid">\r\n    <div class="col-md-3 col-sm-6" ng-repeat="item in NewRuleSet.Items" ng-click="ShowAllItemProperties(item,$index)">\r\n        <div class="card hovercard">\r\n            <div class="" ng-click="ShowAllItemProperties(item,$index)">\r\n                <img ng-src="{{item.ItemProperties[1].Value.Image.image}}" class="img-resposive" width="240" height="240" />\r\n            </div>\r\n\r\n            <div class="info">\r\n                <div class="title">\r\n                    <a target="_blank" href="#">{{item.ItemProperties[0].Value.Text.value}}</a>\r\n                </div>\r\n                <div class="desc">\r\n                    {{item.ItemProperties[9].Value.Text.value}}\r\n                </div>\r\n            </div>\r\n\r\n            <div class="bottom">\r\n\r\n                    {{item.ItemProperties[13].Value.YesOrNo.value}}\r\n\r\n                <a class="btn btn-danger btn-sm" rel="publisher"\r\n                   href="#">\r\n                    <i class="fa fa-google-plus"></i>\r\n                    {{item.ItemProperties[17].Value.YesOrNo.value}}\r\n                </a>\r\n                <a class="btn btn-primary btn-sm" rel="publisher"\r\n                   href="#">\r\n                    <i class="fa fa-facebook"></i>\r\n                    {{item.ItemProperties[13].Value.YesOrNo.value}}\r\n                </a>--><!--<a class="btn btn-primary btn-xs" ng-click="EditItem(item,$index)">\r\n                <i class="fa fa-edit"></i>\r\n                <i class="fa fa-edit"></i>\r\n                Edit\r\n            </a>\r\n            <a class="btn btn-info  btn-xs" ng-click="CopyItem(item,$index)">\r\n                <i class="fa fa-copy"></i>\r\n                Copy\r\n            </a>\r\n            <a class="btn btn-danger  btn-xs" ng-click="Removeitem(item)">\r\n                <i class="fa fa-remove"></i>\r\n                Remove\r\n            </a>\r\n\r\n        </div>\r\n    </div>\r\n</div>--><!--</div>--><!--<toaster-container></toaster-container>--><div class="page-inventory"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Ruleset Spells</h1></div><ul class="page-toolbar-actions"><li class="view-switch"><div class="btn-group" role="group"><button type="button" id="gridViewTrigger" class="btn icon icon-grid btn-primary selected" ng-click="GridViewTrigger($event)"></button> <button type="button" id="listViewTrigger" class="btn icon icon-list btn-primary" ng-click="ListViewTrigger($event)"></button></div></li><!--<li>\r\n                        <button type="button" ng-click="BackSpell()" class="btn icon icon-with-text btn-primary">Back</button>\r\n                    </li>--><li><button type="button" ng-click="CreateSpell()" class="btn icon icon-with-text icon-plus btn-primary">CREATE SPELL</button></li></ul></div></div></div><div ng-show="Itemlist"><div class="col-md-12"><h3 class="text-center">No Spells Added</h3></div></div><div class="cards cards-inventory" ng-show="list"><div class="container"><div class="card-list"><div class="card-wrapper" ng-repeat="spell in RulesetSpells"><div class="card" data-href="#"><div class="card-image"><img class="card-img-top" ng-click="ShowAllSpellsContent($index)" ng-src="{{spell.SpellProperties[1].Value.Image.image?spell.SpellProperties[1].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" alt="{{spell.SpellProperties[0].Value.Text.Value}}"><div class="card-actions hide"><button type="button" title="" data-toggle="tooltip" ng-click="EditSpell(spell,$index)" class="btn icon icon-pencil btn-simple-primary" data-original-title="Edit"></button> <button type="button" title="" data-toggle="tooltip" ng-click="CopySpell(spell,$index)" class="btn icon icon-copy icon-rsi btn-simple-primary" data-original-title="Duplicate"></button> <button type="button" title="" data-toggle="tooltip" ng-click="RemoveSpell(spell,$index)" class="btn icon icon-trash btn-simple-primary" data-original-title="Delete"></button> <button type="button" title="" data-toggle="tooltip" class="btn icon icon-cross btn-simple-primary" data-original-title="Close" ng-click="hideConteextMenu($event)"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="ShowAllSpellsContent($index)">{{spell.SpellProperties[0].Value.Text.value}}</h4><div class="card-actions-trigger"><button type="button" title="" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" data-original-title="Manage" ng-click="showContextMenu($event)"></button></div><ul class="item-properties"><li class="item-property item-property-text rarity highlight">{{spell.SpellProperties[2].Value.Text.value}}</li><li class="item-property item-property-text weight">{{spell.SpellProperties[3].Value.Number.value}}</li><li class="item-property item-property-icon icon icon-magical icon-rsi" title="" data-toggle="tooltip" data-original-title="Magical"></li><li class="item-property item-property-icon icon icon-consumable icon-rsi" title="" data-toggle="tooltip" data-original-title="Consumable"></li></ul><div class="item-stats">{{spell.SpellProperties[18].Value.Text.value}}</div></div></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/RuleSet.html','<div class="page-rulesets"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Rulesets</h1></div><ul class="page-toolbar-actions"><!--<li>\r\n                        <button type="button"  class="btn btn-primary pull-right" ng-click="ImportRuleSet()"><i class="fa fa-upload" aria-hidden="true"></i>&nbsp;   Import Ruleset</button>\r\n                    </li>--><li><div class="dropdown dropdown-buttons show" ng-click="siteNavigationMenuToggle($event)"><div class="dropdown-toggle btn btn-primary" id="siteNavigationToggle" data-toggle="dropdown" style="width:100%"><span class="icon icon-with-text icon-plus">NEW RULE SET</span></div><div class="dropdown-menu" aria-labelledby="siteNavigationToggle"><!--<div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger">\r\n\t\t\t\t\t\t\t\t\t<ul class="dropdown-menu-list">\r\n\t\t\t\t\t\t\t\t\t\t<li class="dropdown-menu-item">\r\n\t\t\t\t\t\t\t\t\t\t\t<button type="button" data-toggle="modal" data-target="#addItemPopup" class="btn btn-accent">Add Item</button>\r\n\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t<li class="dropdown-menu-item">\r\n\t\t\t\t\t\t\t\t\t\t\t<button type="button" data-toggle="modal" data-target="#createItemPopup" class="btn btn-accent">Create Item</button>\r\n\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t</div>--><ul class="dropdown-menu-list"><li class="dropdown-menu-item" ng-hide="true"></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" data-target="#createItemPopup" class="btn btn-accent">Add Rule Set</button></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" data-target="#addItemPopup" ng-click="RulesetGeneralSettings()" class="btn btn-accent">Create Rule Set</button></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" data-target="#createItemPopup" class="btn btn-accent">Import Rule Set</button></li><!--<li class="dropdown-menu-item" ng-click="RulesetGeneralSettings()">\r\n\t\t\t\t\t\t\t\t\t\t<a class="dropdown-menu-item-link"  id="AddRuleSet" >\r\n\t\t\t\t\t\t\t\t\t\t\t<span class="dropdown-menu-item-title">Create Rule Set</span>\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t<li class="dropdown-menu-item" style="margin-left:0px">\r\n\t\t\t\t\t\t\t\t\t\t<a class="dropdown-menu-item-link" id="CopyRuleSet" href="./RuleSets">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class="dropdown-menu-item-title">Copy Rule Set</span>\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t<li class="dropdown-menu-item" style="margin-left:0px">\r\n\t\t\t\t\t\t\t\t\t\t<a class="dropdown-menu-item-link" id="ImportRuleSet" href="./RuleSets">\r\n\t\t\t\t\t\t\t\t\t\t\t<span class="dropdown-menu-item-title">Import Rule Set</span>\r\n\t\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t</li>--></ul></div></div></li></ul></div></div></div><!-- End of toolbar --><div class="rulesets"><!-- Ruleset cards --><div class="cards"><div class="container"><div class="row"><div class="col-6 col-md-4 col-lg-2" ng-repeat="ruleset in RuleSets"><div class="card-wrapper"><div class="card" data-href="#"><div class="card-image" style="vertical-align: central; height: 80%"><img style="display: block" class="card-img-top" ng-src="{{ruleset.Rulesetproperty[2].Value.Image.image?ruleset.Rulesetproperty[2].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" onerror="this.src=\'/wwwroot/images/not-available.jpg\'" alt="{{ruleset.Name}}" ng-click="ManageRuleset(ruleset.Id)"><div class="card-actions"><button type="button" title="Edit" data-toggle="tooltip" ng-click="EditGeneralSettings(ruleset.Id)" class="btn icon icon-pencil btn-simple-primary"></button> <button type="button" title="Duplicate" data-toggle="tooltip" ng-click="CopyRuleSet(ruleset)" class="btn icon icon-copy icon-rsi btn-simple-primary"></button> <button type="button" title="Delete" data-toggle="tooltip" ng-click="deleteRuleSet(ruleset,$index);" class="btn icon icon-trash btn-simple-primary"></button> <button type="button" title="Close" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary" ng-click="hideConteextMenu($event)"></button></div></div><div class="card-body"><h4 class="card-title">{{ruleset.Name}}</h4><div class="card-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showContextMenu($event)"></button></div></div></div></div></div></div></div></div><!-- End of ruleset cards --></div><!-- New ruleset popup --><!-- End of new ruleset popup --><!-- New ruleset manage popup --><div class="modal fade popup-new-ruleset-manage" id="newRulesetManagePopup" tabindex="-1" role="dialog" aria-labelledby="newRulesetManagePopupTitle" aria-hidden="true" data-backdrop="static"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="newRulesetManagePopupTitle">New Ruleset</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><ul class="list-unstyled"><li><a href="#" class="btn icon icon-with-text icon-external btn-accent">Manage Character Stats</a></li><li><a href="#" class="btn icon icon-with-text icon-external btn-accent">Manage Items</a></li><li><a href="#" class="btn icon icon-with-text icon-external btn-accent">Manage Spells</a></li><li><a href="#" class="btn icon icon-with-text icon-external btn-accent">Manage Abilities</a></li></ul></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-outline-accent">Close</button></div></div></div></div><!-- End of new ruleset manage popup --><!-- Edit ruleset popup --><div class="modal fade popup-edit-ruleset" id="editRulesetPopup" tabindex="-1" role="dialog" aria-labelledby="editRulesetPopupTitle" aria-hidden="true" data-backdrop="static"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="editRulesetPopupTitle">Edit Ruleset</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><form><div class="form-row"><div class="col"><!-- Character name --><div class="form-group"><label for="editRulesetCharacterName">Name (required)</label><input type="text" id="editRulesetCharacterName" class="form-control" placeholder="Name of the ruleset" value="Apocalypse World"></div><!-- End of character name --></div></div><div class="form-row"><div class="col"><!-- Ruleset description --><div class="form-group"><label for="editRulesetCharacterName">Description</label><input type="text" id="editRulesetCharacterName" class="form-control" placeholder="Description" value="rulesetDesc"></div><!-- End of character name --></div></div><div class="form-row"><div class="col"><!-- Ruleset dice --><div class="form-group"><label for="editRulesetDice">Default Dice</label><span class="input-group-btn"><button type="button" title="Show dice" data-toggle="tooltip" class="btn icon icon-dice icon-rsi btn-simple-primary"></button> </span><input type="text" id="editRulesetDice" class="form-control" placeholder="Select dice" value="4d6"></div><!-- End of ruleset dice --></div></div><div class="form-row"><div class="col-12 col-md-6"><!-- Ruleset currency --><div class="form-group"><label for="editRulesetCurrency">Currency Label</label><input type="text" id="editRulesetCurrency" class="form-control" placeholder="Enter currency value"></div><!-- End of ruleset currency --><!-- Ruleset weight --><div class="form-group"><label for="editRulesetWeightMetric">Weight Metric Label</label><input type="text" id="editRulesetWeightMetric" class="form-control" placeholder="Enter metric value"></div><!-- End of ruleset weight --><!-- Ruleset distance --><div class="form-group"><label for="editRulesetDistanceMetric">Distance Metric Label</label><input type="text" id="editRulesetDistanceMetric" class="form-control" placeholder="Enter metric value"></div><!-- End of ruleset distance --></div><div class="col-12 col-md-6"><!-- Ruleset image --><div class="form-group input-image input-image-edit"><label for="editRulesetImage">Image</label><div class="input-image-control-wrapper"><div class="input-image-view"><img src="./assets/images/rulesets/apocalypse-world.jpg"> <i class="icon icon-pencil"></i></div><input type="file" id="editRulesetImage" class="form-control-file"></div></div><!-- End of ruleset image --></div></div><div class="form-row"><div class="col"><div class="form-group"><div class="icon icon-with-text icon-external">Manage <a href="#">Character Stats</a>, <a href="#">Items</a>, <a href="#">Spells</a> and <a href="#">Abilities</a>.</div></div></div></div></form></div><div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-simple-accent">Cancel</button> <button type="button" class="btn btn-accent">Save</button></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'position-class\': \'toast-top-center\',\'time-out\':\'5000\'}" style="top: 5%;left: -5%;opacity: 100 ;position: fixed"></toaster-container>');
$templateCache.put('/views/home/rulesetabilitycontent.html','<div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><button type="button" class="btn btn-primary back" ng-click="BackContent(3)">Back</button> <button type="button" class="btn btn-accent" ng-click="SaveTilesForRuleset(RulesetContent.AbilityProperties,3)">Save Tile</button></div></div></div><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{RulesetContent.AbilityProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{RulesetContent.AbilityProperties[0].Value.Text.value}}</button><div class="buttons-align"><button class="btn btn-warning" ng-click="CopyAbility(RulesetContent)"><i class="fa fa-remove" aria-hidden="true"></i> Copy</button><!--<button class="btn btn-warning">\r\n                    <i class="fa fa-exchange" aria-hidden="true"></i>\r\n                    UNMEMORIZE\r\n                </button>--></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{RulesetContent.AbilityProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">CLASS</div><div class="panel-body text-center">{{RulesetContent.AbilityProperties[10].Value.Text.value}}</div></div></div><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">ATTRIBUTES</div><div class="panel-body text-center">{{RulesetContent.AbilityProperties[9].Value.Text.value}}</div></div></div></div><div class="blue"><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">USES ReEMAINING</div><div class="panel-body text-center">{{RulesetContent.AbilityProperties[13].Value.Number.value}}</div></div></div><div class="col-md-6"><div class="panel div_green"><div class="panel-heading text-center">MAX USES</div><div class="panel-body text-center">{{RulesetContent.AbilityProperties[12].Value.Number.value}}</div></div></div></div></div></div><div class="buttons-align"><button class="btn btn_red" ng-click="RemoveAbility(RulesetContent)"><i class="fa fa-remove" aria-hidden="true"></i> REMOVE</button> <button class="btn uneqp" ng-click="EditAbility(RulesetContent)"><i class="fa fa-edit" aria-hidden="true"></i> EDIT</button></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Description</h5><p>{{RulesetContent.AbilityProperties[14].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">{{RulesetContent.AbilityProperties[17].Value.Number.value}}</div></div></div><!--<div class="col-md-6">\r\n                            <div class="panel panel-default">\r\n                                <div class="panel-heading text-center" style="background-color: rgba(237, 20, 61, 0.67);">Attributes</div>\r\n                                <div class="panel-body text-center" style="background-color: rgba(237, 20, 61, 0.58);"></div>\r\n                            </div>\r\n                        </div>--></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">REQUIREMENTS</div><div class="panel-body text-center">text</div></div></div></div></div></div><div class="buttons-align"><button class="btn btn-warning" style="width:100%" ng-click="ShowTiles(RulesetContent.AbilityProperties)"><i class="fa fa-plus" aria-hidden="true"></i> ADD TILE</button></div></div></div><div gridstack class="grid-stack" options="stackOptions" on-change="onChange(event,ui)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item ng-repeat="tab in RulesetContent.AbilityProperties" ng-click="tileSelect(tab.tile)" ng-class="getTileClass(tab.tile)" ng-switch on="tab.tile.TileTypeName" class="grid-stack-item" gs-item="tile" gs-item-id="tab.tile.ClientObjectId" gs-item-x="tab.tile.X" gs-item-y="tab.tile.Y" gs-item-width="tab.tile.Width" gs-item-height="tab.tile.Height" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)" data-gs-width="4" data-gs-height="2"><rpgsmithnotetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Note"></rpgsmithnotetype><rpgsmithcountertype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Counter"></rpgsmithcountertype><rpgsmithattributetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Attribute"></rpgsmithattributetype><rpgsmithlinktype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Link" fullscope="RuleSetContentForLinkExecuteTile"></rpgsmithlinktype><rpgsmithexecutetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Execute" fullscope="RuleSetContentForLinkExecuteTile"></rpgsmithexecutetype><rpgsmithcommandtype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Command"></rpgsmithcommandtype><rpgsmithimagetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Image"></rpgsmithimagetype></div></div><div class="tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"><i class="fa fa-trash-o" aria-hidden="true"></i></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/rulesetitemcontent.html','<!-- Mobile Search --><div class="container-fluid"><form class="site-phone-search" action="./search-result.html"><i class="icon icon-search"></i> <input type="search" placeholder="Search"></form></div><!-- End of mobile Search --><!-- Toolbar --><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><a href="./Items?RuleSetId={{RulesetContent.ItemProperties[1].Id}}" class="icon icon-back"></a><h1>Item Details</h1></div><!-- Toolbar actions --><ul class="page-toolbar-actions"><li><button type="button" id="manageTilesTrigger" class="btn btn-outline-primary">Manage Tiles</button></li><li><!-- Manage item --><div class="dropdown dropdown-buttons"><button type="button" id="manageItemTrigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-primary dropdown-toggle">Manage Item</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="newItemTrigger"><ul class="dropdown-menu-list"><li class="dropdown-menu-item"><button type="button" ng-click="EditItem(RulesetContent)" class="btn icon icon-with-text icon-pencil btn-accent">Edit</button></li><li class="dropdown-menu-item"><button type="button" ng-click="CopyItem(RulesetContent)" class="btn icon icon-with-text icon-copy icon-rsi btn-accent">Duplicate</button></li><li class="dropdown-menu-item"><button type="button" ng-click="Removeitem(RulesetContent)" class="btn icon icon-with-text icon-trash btn-accent">Delete</button></li></ul></div></div><!-- Manage item --></li></ul><!-- End of toolbar actions --></div></div></div><!-- End of toolbar --><!-- Item info --><div class="page-item-details"><div class="container"><div class="item-info-wrapper"><div class="item-info-top-section"><div class="row"><div class="col"><div class="item-info-banner"><!-- Item image --><div class="item-info-image"><img ng-src="{{RulesetContent.ItemProperties[1].Value.Image.image}}"></div><!-- End of item image --><!-- Item name --><h2 class="item-info-name">{{RulesetContent.ItemProperties[0].Value.Text.value}}</h2><!-- End of item name --><div class="item-info-props-indics"><!-- Item properties --><ul class="item-info-props"><li></li><li>{{RulesetContent.ItemProperties[9].Value.Number.value}}</li><li>{{RulesetContent.ItemProperties[4].Value.Weight.value + " "+RulesetContent.ItemProperties[4].Value.Weight.units.selectedUnit}}</li><li>1.75 x 0.5 x 0.6 feet</li></ul><!-- End of item properties --><!-- Item indicators --><ul class="item-info-indics"><li><i class="icon icon-rsi icon-visible"></i></li><li><i class="icon icon-rsi icon-magical"></i></li><li><i class="icon icon-rsi icon-consumable"></i></li></ul><!-- End of item indicators --></div></div><!-- Item actions --><ul class="item-info-actions"><li><button type="button" class="btn btn-accent">Equip</button></li><li><button type="button" class="btn btn-accent">Drop</button></li><li><button type="button" class="btn btn-accent">Use</button></li></ul><!-- End of item actions --></div></div></div><div class="item-info-bottom-section"><div class="row"><div class="col-12 col-md-6"><!-- Item command --><div class="item-info-command"><h3>Command</h3><p>{{RulesetContent.ItemProperties[8].Value.DefaultDice.value}}</p></div><!-- End of item command --></div><div class="col-12 col-md-6"><!-- Item stats --><div class="item-info-stats"><h3>Stats</h3><p>{{RulesetContent.ItemProperties[2].Value.Text.value}}</p></div><!-- End of item stats --></div></div><div class="row"><div class="col-12 col-md-6"><!-- Item description --><div class="item-info-desc"><h3>Description</h3><p>{{RulesetContent.ItemProperties[7].Value.Text.value}}</p></div><!-- End of item description --></div><div class="col-12 col-md-6"><!-- Item tags --><div class="item-info-tags"><h3>Tags</h3><p>{{RulesetContent.ItemProperties[16].Value.Text.value}}</p></div><!-- End of item tags --></div></div><div class="row"><div class="col-12 col-md-6"><!-- Item spells --><div class="item-info-spells"><h3>Spells</h3><div class="form-group output-list output-list-wrap"><ul class="output-list-items" ng-repeat="associatedSpell in RulesetContent.AssociatedSpells"><li class="output-list-item"><div><img src="wwwroot/css/assets/images/spells/command.jpg" alt="Command"> <span>{{associatedSpell.SpellProperties[0].Value.Text.value}}</span></div></li></ul><div class="input-extend" ng-show="RulesetContent.AssociatedSpells.length > 10"><button type="button" class="btn icon icon-with-text icon-arrow-down btn-link-primary"><span>Show more</span></button></div></div></div><!-- End of item spells --></div><div class="col-12 col-md-6"><!-- Item abilities --><div class="item-info-abils"><h3>Abilities</h3><div class="form-group output-list output-list-wrap"><ul class="output-list-items" ng-repeat="associatedAbility in RulesetContent.AssociatedAbilities"><li class="output-list-item"><div><img src="{{associatedAbility.AbilityProperties[0].Value.Image.image}}" alt="{{associatedAbility.AbilityProperties[0].Value.Text.value}}"> <span>{{associatedAbility.AbilityProperties[0].Value.Text.value}}</span></div></li></ul><div class="input-extend" ng-show="RulesetContent.AssociatedAbilities.length > 10"><button type="button" class="btn icon icon-with-text icon-arrow-down btn-link-primary"><span>Show more</span></button></div></div></div><!-- End of item abilities --></div></div></div></div></div></div><!-- End of item info --><!-- Item tiles --><div class="item-tiles"><div class="container"><div class="tiles"><!-- Apperance tile --><div class="tile-group tile-group-apperance"><div class="tile tile-type-note tile-color-3"><h5 class="tile-title">Apperance</h5><div class="tile-body"><div><p>Design is not just what it looks like and feels like. Design is how it works.</p><p>Good design is making something intelligible and memorable. Great design is making something memorable and meaningful.</p><p>Pictures, abstract symbols, materials, and colors are among the ingredients with which a designer or engineer works. To design is to discover relationships and to make arrangements and rearrangements among these ingredients.</p><p>Design must be functional, and functionality must be translated into visual aesthetics without any reliance on gimmicks that have to be explained.</p></div></div><div class="tile-actions"><button type="button" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-primary"></button> <button type="button" title="Resize" data-toggle="tooltip" data-action="resize-left" class="btn icon icon-arrow-resize btn-primary"></button> <button type="button" title="Resize" data-toggle="tooltip" data-action="resize-right" class="btn icon icon-arrow-resize btn-primary"></button></div></div></div><!-- End of apperance tile --><!-- Background Story tile --><div class="tile-group tile-group-bg_story"><div class="tile tile-type-note tile-color-6"><h5 class="tile-title">Background Story</h5><div class="tile-body"><div><p>Design is a way of life, a point of view. It involves the whole complex of visual communications: talent, creative ability, manual skill, and technical knowledge. Aesthetics and economics, technology and psychology are intrinsically related to the process.</p><p>The critical thing in developing software is not the program, it\'s the design. It is translating understanding of user needs into something that can be realized as a computer program.</p><p>To design is much more than simply to assemble, to order, or even to edit: it is to add value and meaning, to illuminate, to simplify, to clarify, to modify, to dignify, to dramatize, to persuade, and perhaps even to amuse.</p></div></div><div class="tile-actions"><button type="button" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-primary"></button> <button type="button" title="Resize" data-toggle="tooltip" data-action="resize-left" class="btn icon icon-arrow-resize btn-primary"></button> <button type="button" title="Resize" data-toggle="tooltip" data-action="resize-right" class="btn icon icon-arrow-resize btn-primary"></button></div></div></div><!-- End of background Story tile --><!-- Hints tile --><div class="tile-group tile-group-seen_in_game"><div class="tile tile-type-image tile-color-4"><h5 class="tile-title">Seen in the game</h5><div class="tile-body"><img src="wwwroot/css/assets/images/tiles/clue.jpg" alt="Seen in the game"></div><div class="tile-actions"><button type="button" title="Edit" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-primary"></button> <button type="button" title="Resize" data-toggle="tooltip" data-action="resize-left" class="btn icon icon-arrow-resize btn-primary"></button> <button type="button" title="Resize" data-toggle="tooltip" data-action="resize-right" class="btn icon icon-arrow-resize btn-primary"></button></div></div></div><!-- End of hints tile --></div></div></div><!-- End of item tiles --><!-- External JavaScript files --><script src="wwwroot/css/assets/js/jquery.js"></script><script src="wwwroot/css/assets/js/popper.js"></script><script src="wwwroot/css/assets/js/bootstrap.js"></script><script src="wwwroot/css/assets/js/script.js"></script><!-- End of external JavaScript files -->');
$templateCache.put('/views/home/rulesetspellcontent.html','<div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><button type="button" class="btn btn-primary back" ng-click="BackContent(2)">Back</button> <button type="button" class="btn btn-accent" ng-click="SaveTilesForRuleset(RulesetContent.SpellProperties,2)">Save Tile</button></div></div></div><div class="container item_view"><div class="row"><div class="col-md-4 image"><div class="image"><img ng-src="{{RulesetContent.SpellProperties[1].Value.Image.image}}" class="img-resposive" width="120" height="120"></div><button class="btn btn-primary">{{RulesetContent.SpellProperties[0].Value.Text.value}}</button><div class="buttons-align mt-30"><button class="btn btn_red" ng-click="RemoveSpell(RulesetContent)"><i class="fa fa-remove" aria-hidden="true"></i> REMOVE</button><!--<button class="btn btn_red">\r\n                    <i class="fa fa-exchange" aria-hidden="true"></i>\r\n                    UNMEMORIZE\r\n                </button>--></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>STATS</h5><p>{{RulesetContent.SpellProperties[2].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">CLASS</div><div class="panel-body text-center">{{RulesetContent.SpellProperties[10].Value.Text.value}}</div></div></div><div class="col-md-6"><div class="panel div_blue"><div class="panel-heading text-center">SCHOOL</div><div class="panel-body text-center">{{RulesetContent.SpellProperties[9].Value.Text.value}}</div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel div_green"><div class="panel-heading text-center">Materialized Components</div><div class="panel-body text-center">{{RulesetContent.SpellProperties[9].Value.Text.value}}</div></div></div></div></div></div><div class="buttons-align"><button class="btn uneqp" ng-click="EditSpell(RulesetContent)"><i class="fa fa-edit" aria-hidden="true"></i> EDIT</button> <button class="btn btn-warning" ng-click="CopySpell(RulesetContent)"><i class="fa fa-external-link" aria-hidden="true"></i> CAST</button></div></div><div class="col-md-4"><div class="text-design"><div class="text"><h5>Description</h5><p>{{RulesetContent.SpellProperties[18].Value.Text.value}}</p></div><div class="panels row"><div class="blue"><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">CASTING TIME</div><div class="panel-body text-center">{{RulesetContent.SpellProperties[17].Value.Number.value}}</div></div></div><div class="col-md-6"><div class="panel div_red"><div class="panel-heading text-center">Attributes</div><div class="panel-body text-center"></div></div></div></div><div class="blue"><div class="col-md-12"><div class="panel panel-danger"><div class="panel-heading text-center">TAGS</div><div class="panel-body text-center">text</div></div></div></div></div></div><div class="buttons-align"><button class="btn btn-warning" style="width:100%" ng-click="ShowTiles(RulesetContent.SpellProperties)"><i class="fa fa-plus" aria-hidden="true"></i> ADD TILE</button></div></div></div><div gridstack class="grid-stack" options="stackOptions" on-change="onChange(event,ui)" on-drag-start="onDragStart(event,ui)" on-drag-stop="onDragStop(event,ui)" on-resize-start="onResizeStart(event,ui)" on-resize-stop="onResizeStop(event,ui)"><div gridstack-item ng-repeat="tab in RulesetContent.SpellProperties" ng-click="tileSelect(tab.tile)" ng-class="getTileClass(tab.tile)" ng-switch on="tab.tile.TileTypeName" class="grid-stack-item" gs-item="tile" gs-item-id="tab.tile.ClientObjectId" gs-item-x="tab.tile.X" gs-item-y="tab.tile.Y" gs-item-width="tab.tile.Width" gs-item-height="tab.tile.Height" gs-item-autopos="1" on-item-added="onItemAdded(item)" on-item-removed="onItemRemoved(item)" data-gs-width="4" data-gs-height="2"><rpgsmithnotetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Note"></rpgsmithnotetype><rpgsmithcountertype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Counter"></rpgsmithcountertype><rpgsmithattributetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Attribute"></rpgsmithattributetype><rpgsmithlinktype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Link" fullscope="RuleSetContentForLinkExecuteTile"></rpgsmithlinktype><rpgsmithexecutetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Execute" fullscope="RuleSetContentForLinkExecuteTile"></rpgsmithexecutetype><rpgsmithcommandtype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Command"></rpgsmithcommandtype><rpgsmithimagetype info="tab.tile" ng-style="" style="border: {{tab.tile.Styles.width}} {{tab.tile.Styles.style}} {{tab.tile.Styles.color}}; border-radius: {{tab.tile.Styles.radius}};background-color: {{tab.tile.Styles.bodybackgroundColor}};box-shadow:{{tab.tile.Styles.shadow}}" useoredit="0" class="form_inline grid-stack-item-content" ng-switch-when="Image"></rpgsmithimagetype></div></div><div class="tile-bubble-remove" title="Remove Page" droppable ng-class="{\'show-bubble\': state.tileDragging}" on-droppable-drop="onDeleteDrop(event,ui)" on-droppable-over="onDeleteOver(event,ui)" on-droppable-out="onDeleteOut(event)"><i class="fa fa-trash-o" aria-hidden="true"></i></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/ruleset_itemproperties.html','<div class="page-inventory"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Ruleset Items</h1></div><ul class="page-toolbar-actions"><li class="view-switch"><div class="btn-group" role="group"><button type="button" id="gridViewTrigger" class="btn icon icon-grid btn-primary selected" ng-click="GridViewTrigger($event)"></button> <button type="button" id="listViewTrigger" class="btn icon icon-list btn-primary" ng-click="ListViewTrigger($event)"></button></div></li><!--<li>\r\n                        <button type="button" ng-click="BackItem()" class="btn icon icon-with-text btn-primary">Back</button>\r\n                    </li>--><li><!--<div class="dropdown dropdown-buttons show" ng-click="CreateItem($event)">\r\n\t\t\t\t\t\t\t<div class="dropdown-toggle btn  btn-primary" id="siteNavigationToggle" data-toggle="dropdown" style="width:100%">\r\n\t\t\t\t\t\t\t\t<span class="icon icon-with-text icon-plus">CREATE ITEM</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t</div>--> <button type="button" ng-click="CreateItem()" class="btn icon icon-with-text icon-plus btn-primary">Create Item</button><!--<button type="button" ng-click="CreateItem()" class="btn icon icon-with-text icon-plus btn-primary">New Item</button>--></li></ul></div></div></div><div ng-show="Itemlist"><div class="col-md-12"><h3 class="text-center">No Items Added</h3></div></div><div class="cards cards-inventory" ng-show="list"><div class="container"><div class="card-list"><div class="card-wrapper" ng-repeat="item in RulesetItems"><div class="card" data-href="#"><div class="card-image"><img style="display: block" class="card-img-top" ng-click="ShowAllItemProperties($index)" ng-src="{{item.ItemProperties[1].Value.Image.image?item.ItemProperties[1].Value.Image.image:\'/wwwroot/images/not-available.jpg\'}}" alt="{{item.ItemProperties[0].Value.Text.Value}}"><div class="card-actions hide"><button type="button" title="" data-toggle="tooltip" ng-click="EditItem(item,$index)" class="btn icon icon-pencil btn-simple-primary" data-original-title="Edit"></button> <button type="button" title="" data-toggle="tooltip" ng-click="CopyItem(item,$index)" class="btn icon icon-copy icon-rsi btn-simple-primary" data-original-title="Duplicate"></button> <button type="button" title="" data-toggle="tooltip" ng-click="Removeitem(item,$index)" class="btn icon icon-trash btn-simple-primary" data-original-title="Delete"></button> <button type="button" title="" data-toggle="tooltip" class="btn icon icon-cross btn-simple-primary" data-original-title="Close" ng-click="hideConteextMenu($event)"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="ShowAllItemProperties($index)">{{item.ItemProperties[0].Value.Text.value}}</h4><div class="card-actions-trigger"><button type="button" title="" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" data-original-title="Manage" ng-click="showContextMenu($event)"></button></div><ul class="item-properties"><li class="item-property item-property-text rarity highlight">{{item.ItemProperties[2].Value.Text.value}}</li><li class="item-property item-property-text weight">{{item.ItemProperties[3].Value.Number.value}}</li><li class="item-property item-property-icon icon icon-magical icon-rsi" title="" data-toggle="tooltip" data-original-title="Magical"></li><li class="item-property item-property-icon icon icon-consumable icon-rsi" title="" data-toggle="tooltip" data-original-title="Consumable"></li></ul><div class="item-stats">{{item.ItemProperties[6].Value.Text.value}}</div></div></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container>');
$templateCache.put('/views/home/spellinventory.html','<div class="page-inventory itemproperty" ng-init="onloadFun()"><div class="page-toolbar"><div class="container"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Back to Inventory</h1></div><button type="button" id="newItemTrigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn icon icon-with-text icon-plus btn-primary dropdown-toggle">New Spell</button><div class="dropdown-menu" aria-labelledby="siteNavigationToggle"><!--<ul class="page-toolbar-actions">\r\n\t\t\t<li class="view-switch">\r\n\t\t\t\t<div class="btn-group" role="group">\r\n\t\t\t\t\t<button type="button" id="gridViewTrigger" class="btn icon icon-grid btn-primary selected" ng-click="GridViewTrigger($event)"></button>\r\n\t\t\t\t\t<button type="button" id="listViewTrigger" class="btn icon icon-list btn-primary" ng-click="ListViewTrigger($event)"></button>\r\n\t\t\t\t</div>\r\n\t\t\t</li>\r\n\t\t\t<li>\r\n\t\t\t\t<button type="button" ng-click="CreateCharacterSpell()" class="btn icon icon-with-text icon-plus btn-primary">New Spell</button>\r\n\t\t\t</li>\r\n\t\t\t<li>\r\n\t\t\t\t<button type="button" ng-click="AddRulesetSpells()" class="btn icon icon-with-text icon-plus btn-primary">Add Spell From Ruleset</button>\r\n\t\t\t</li>\r\n\t\t\t<li>\r\n\t\t\t\t<button type="button" ng-click="BackToLayout()" class="btn icon icon-with-text glyphicon-backward btn-primary">Back</button>\r\n\t\t\t</li>\r\n\t\t</ul>--><ul class="dropdown-menu-list"><li class="dropdown-menu-item" ng-hide="true"></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" style="width: 100%" data-target="#createItemPopup" ng-click="AddRulesetSpell()" class="btn btn-accent">Add Spell</button></li><li class="dropdown-menu-item"><button type="button" data-toggle="modal" style="width: 100%" data-target="#addItemPopup" ng-click="CreateCharacterSpell()" class="btn btn-accent">Create Spell</button></li></ul></div></div></div><!-- End of toolbar --><!-- Inventory cards --><div class="cards cards-inventory"><div class="container"><div ng-show="ShowSpells"><div class="col-md-12"><h3 class="text-center">No Spells Added</h3></div></div><div class="card-list" ng-show="ShowSpell"><div class="card-wrapper" ng-repeat="spell in NewSpellInventory.CharacterSpells"><div class="card" data-href="#"><div class="card-image"><img class="card-img-top" ng-click="ShowAllSpellProperties(spell,$index)" ng-src="{{spell.CharacterSpellsProperties[1].Value.Image.image?spell.CharacterSpellsProperties[1].Value.Image.image :\'/wwwroot/images/not-available.jpg\'}}" alt="{{spell.CharacterSpellsProperties[0].Value.Text.value}}"><div class="card-actions"><button type="button" title="Edit" ng-click="EditItem(spell,$index,2)" data-toggle="tooltip" data-action="edit" class="btn icon icon-pencil btn-simple-primary"></button> <button type="button" title="Duplicate" ng-click="CopyItem(spell,$index,2)" data-toggle="tooltip" data-action="duplicate" class="btn icon icon-copy icon-rsi btn-simple-primary"></button> <button type="button" title="Delete" ng-click="Removeitem(spell,$index,2)" data-toggle="tooltip" data-action="delete" class="btn icon icon-trash btn-simple-primary"></button> <button type="button" title="Close" ng-click="hideConteextMenu($event)" data-toggle="tooltip" data-action="close" class="btn icon icon-cross btn-simple-primary"></button></div></div><div class="card-body"><h4 class="card-title" ng-click="ShowAllItemProperties(item,$index)">{{spell.CharacterSpellsProperties[0].Value.Text.value}}</h4><div class="card-actions-trigger"><button type="button" title="Manage" data-toggle="tooltip" class="btn icon icon-more btn-simple-primary" ng-click="showContextMenu($event)"></button></div><ul class="item-properties"><li class="item-property item-property-text rarity highlight" ng-if="(spell.CharacterSpellsProperties[6].Value.Choices.selectedchoice != undefined) && (spell.CharacterSpellsProperties[6].Value.Choices.selectedchoice != null) && (spell.CharacterSpellsProperties[6].Value.Choices.selectedchoice != \'\')">{{spell.CharacterSpellsProperties[6].Value.Choices.selectedchoice}}</li><li class="item-property item-property-text weight" ng-if="(spell.CharacterSpellsProperties[4].Value.Weight.value != undefined) && (spell.CharacterSpellsProperties[4].Value.Weight.value != null) && (spell.CharacterSpellsProperties[4].Value.Weight.value != \'\')">{{spell.CharacterSpellsProperties[4].Value.Weight.value}} {{spell.CharacterSpellsProperties[4].Value.Weight.units.selectedUnit}}</li><li ng-repeat="spell in spell.CharacterSpellsProperties" ng-if="(spell.TypeId==3 && spell.Value.OnorOff.value == \'Yes\') || ( spell.TypeId == 4 && spell.Value.YesOrNo.value == \'Yes\')" class="item-property item-property-icon icon icon-rsi" ng-class="\'icon-\' + spell.Name.toLowerCase()" title="Magical" data-toggle="tooltip"></li><!--<li class="item-property item-property-icon icon icon-magical icon-rsi" title="Magical" data-toggle="tooltip"></li>\r\n                                <li class="item-property item-property-icon icon icon-consumable icon-rsi" title="Consumable" data-toggle="tooltip"></li>--></ul><div class="item-stats">{{spell.CharacterSpellsProperties[2].Value.Text.value}}</div><div class="item-actions"><button type="button" class="btn btn-accent" ng-click="Removeitem(item,$index,2)">Drop</button> <button type="button" class="btn btn-accent">Use</button><rpgsmithcontenttype info="value" ng-repeat="value in spell.CharacterSpellsProperties"></rpgsmithcontenttype></div></div></div></div></div></div></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':1000}"></toaster-container></div>');
$templateCache.put('/views/search/BingSearch.html','<!--<!DOCTYPE html>\r\n<!-- saved from url=(0014)about:internet --><!-- the above Mark of the Web lets IE run this page in the Internet security zone,\r\n\t avoiding the permission prompt for running active content such as JavaScript --><!--\r\n<html>\r\n<head>\r\n\t<meta charset="UTF-8">\r\n\t<title>Bing Web Search API Demo</title>\r\n\t--><base target="_blank"><style type="text/css">html, body, div, p, h1, h2 {\r\n\t\tfont-family: Verdana, "Lucida Sans", sans-serif;\r\n\t\tcolor: #000;\r\n\t}\r\n\r\n\thtml, body, div, p {\r\n\t\tfont-weight: normal;\r\n\t}\r\n\r\n\tbody {\r\n\t\tbackground-color: #fff;\r\n\t}\r\n\r\n\th1, h2, h3 {\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #087;\r\n\t}\r\n\r\n\tsup {\r\n\t\tfont-weight: normal;\r\n\t}\r\n\r\n\thtml, body, div, p {\r\n\t\tfont-size: 12px;\r\n\t}\r\n\r\n\th1 {\r\n\t\tfont-size: 20px;\r\n\t\tmargin-top: 30px;\r\n\t}\r\n\r\n\th2 {\r\n\t\tfont-size: 16px;\r\n\t\tclear: left;\r\n\t}\r\n\r\n\th3 {\r\n\t\tfont-size: 14px;\r\n\t\tclear: left;\r\n\t}\r\n\r\n\t#sidebar {\r\n\t\tfont-size: 10px;\r\n\t\ttext-align: right;\r\n\t\tdisplay: flex;\r\n\t\tpadding: 0px 10px;\r\n\t\tfloat: right;\r\n\t\tmargin-left: 15px;\r\n\t\tmargin-right: 0px;\r\n\t}\r\n\r\n\t\t#sidebar p {\r\n\t\t\tmargin-top: 0px;\r\n\t\t\tfont-size: 10px;\r\n\t\t}\r\n\r\n\t\t#sidebar img {\r\n\t\t\tdisplay: inline-block;\r\n\t\t\tfloat: none;\r\n\t\t\tpadding-right: 0px;\r\n\t\t}\r\n\r\n\t#pole p {\r\n\t\tfont-size: 14px;\r\n\t}\r\n\r\n\t#pole, #mainline, #json, #http, #sidebar, #error, #paging1, #paging2 {\r\n\t\tdisplay: none;\r\n\t}\r\n\r\n\t#term {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t#logo {\r\n\t\tpadding: 15px;\r\n\t\tfloat: right;\r\n\t\tborder-left: 2px solid #ccc;\r\n\t}\r\n\r\n\t#query {\r\n\t\tfloat: left;\r\n\t}\r\n\r\n\timg {\r\n\t\tvertical-align: top;\r\n\t\tfloat: left;\r\n\t\tmargin-right: 10px;\r\n\t\tmargin-bottom: 10px;\r\n\t}\r\n\r\n\tp.images img {\r\n\t\tfloat: none;\r\n\t}\r\n\r\n\tp.relatedSearches {\r\n\t\tclear: none;\r\n\t}\r\n\r\n\t#logo p, p.news, p.webPages, p.images {\r\n\t\tclear: left;\r\n\t}\r\n\r\n\ta[href="#"]:link {\r\n\t\tcolor: blue;\r\n\t}\r\n\r\n\ta[href="#"]:visited {\r\n\t\tcolor: blue;\r\n\t}\r\n\r\n\th3 a:visited {\r\n\t\tcolor: #087 !important;\r\n\t}\r\n\r\n\th3 a:link {\r\n\t\tcolor: #087 !important;\r\n\t}</style><script type="text/javascript">// cookie names for data we store\r\n\t// YOUR API KEY DOES NOT GO IN THIS CODE; don\'t paste it in.\r\n\tAPI_KEY_COOKIE = "49e31e6efd1e47b1ab65035a3e22f613";\r\n\tCLIENT_ID_COOKIE = "bing-search-client-id";\r\n\r\n\t// Various browsers differ in their support for persistent storage by local\r\n\t// HTML files (IE won\'t use localStorage, but Chrome won\'t use cookies). So\r\n\t// use localStorage if we can, otherwise use cookies.\r\n\r\n\ttry {\r\n\t\tlocalStorage.getItem;   // try localStorage\r\n\r\n\t\twindow.retrieveValue = function (name) {\r\n\t\t\treturn localStorage.getItem(name) || "";\r\n\t\t}\r\n\t\twindow.storeValue = function (name, value) {\r\n\t\t\tlocalStorage.setItem(name, value);\r\n\t\t}\r\n\t} catch (e) {\r\n\t\twindow.retrieveValue = function (name) {\r\n\t\t\tvar cookies = document.cookie.split(";");\r\n\t\t\tfor (var i = 0; i < cookies.length; i++) {\r\n\t\t\t\tvar keyvalue = cookies[i].split("=");\r\n\t\t\t\tif (keyvalue[0].trim() === name) return keyvalue[1];\r\n\t\t\t}\r\n\t\t\treturn "";\r\n\t\t}\r\n\t\twindow.storeValue = function (name, value) {\r\n\t\t\tvar expiry = new Date();\r\n\t\t\texpiry.setFullYear(expiry.getFullYear() + 1);\r\n\t\t\tdocument.cookie = name + "=" + value.trim() + "; expires=" + expiry.toUTCString();\r\n\t\t}\r\n\t}\r\n\r\n\t// get stored API subscription key, or prompt if it\'s not found\r\n\tfunction getSubscriptionKey() {\r\n\t\tvar key = retrieveValue(API_KEY_COOKIE);\r\n\t\twhile (key.length !== 32) {\r\n\t\t\tkey = prompt("Enter Bing Search API subscription key:", "").trim();\r\n\t\t}\r\n\t\t// always set the cookie in order to update the expiration date\r\n\t\tstoreValue(API_KEY_COOKIE, key);\r\n\t\treturn key;\r\n\t}\r\n\r\n\t// invalidate stored API subscription key so user will be prompted again\r\n\tfunction invalidateSubscriptionKey() {\r\n\t\tstoreValue(API_KEY_COOKIE, "");\r\n\t}\r\n\r\n\t// escape quotes to HTML entities for use in HTML tag attributes\r\n\tfunction escapeQuotes(text) {\r\n\t\treturn text.replace(/\'/g, "&apos;").replace(/"/g, "&quot;");\r\n\t}\r\n\r\n\t// get the host portion of a URL, strpping out search result formatting and www too\r\n\tfunction getHost(url) {\r\n\t\treturn url.replace(/<\\/?b>/g, "").replace(/^https?:\\/\\//, "").split("/")[0].replace(/^www\\./, "");\r\n\t}\r\n\r\n\t// format plain text for display as an HTML <pre> element\r\n\tfunction preFormat(text) {\r\n\t\ttext = "" + text;\r\n\t\treturn "<pre>" + text.replace(/&/g, "&amp;").replace(/</g, "&lt;") + "</pre>"\r\n\t}\r\n\r\n\t// put HTML markup into a <div> and reveal it\r\n\tfunction showDiv(id, html) {\r\n\t\tvar content = document.getElementById("_" + id)\r\n\t\tif (content) content.innerHTML = html;\r\n\t\tvar wrapper = document.getElementById(id);\r\n\t\tif (wrapper) wrapper.style.display = html.trim() ? "block" : "none";\r\n\t}\r\n\r\n\t// hides the specified <div>s\r\n\tfunction hideDivs() {\r\n\t\tfor (var i = 0; i < arguments.length; i++) {\r\n\t\t\tvar element = document.getElementById(arguments[i])\r\n\t\t\tif (element) element.style.display = "none";\r\n\t\t}\r\n\t}\r\n\r\n\t// render functions for various types of search results\r\n\tsearchItemRenderers = {\r\n\t\t// render Web page result\r\n\t\twebPages: function (item) {\r\n\t\t\tvar html = [];\r\n\t\t\t//html.push("<p class=\'webPages\'><a href=\'" + item.url + "\'>" + item.name + "</a>");\r\n\t\t\t//html.push(" (" + getHost(item.displayUrl) + ")");\r\n\t\t\t//html.push("<br>" + item.snippet);\r\n\t\t\t//if ("deepLinks" in item) {\r\n\t\t\t//    var links = [];\r\n\t\t\t//    for (var i = 0; i < item.deepLinks.length; i++) {\r\n\t\t\t//        links.push("<a href=\'" + item.deepLinks[i].url + "\'>" +\r\n\t\t\t//            item.deepLinks[i].name + "</a>");\r\n\t\t\t//    }\r\n\t\t\t//    html.push("<br>" + links.join(" - "));\r\n\t\t\t//}\r\n\t\t\treturn html.join("");\r\n\t\t},\r\n\t\t// render news story\r\n\t\tnews: function (item) {\r\n\t\t\tvar html = [];\r\n\t\t\t//html.push("<p class=\'news\'>");\r\n\t\t\t//if (item.image) {\r\n\t\t\t//    width = 60;\r\n\t\t\t//    height = Math.round(width * item.image.thumbnail.height / item.image.thumbnail.width);\r\n\t\t\t//    html.push("<img src=\'" +  item.image.thumbnail.contentUrl +\r\n\t\t\t//        "&h=" + height + "&w=" + width + "\' width=" + width + " height=" + height+  ">");\r\n\t\t\t//}\r\n\t\t\t//html.push("<a href=\'" + item.url + "\'>" + item.name + "</a>");\r\n\t\t\t//if (item.category) html.push(" - " + item.category);\r\n\t\t\t//if (item.contractualRules) {    // MUST display source attributions\r\n\t\t\t//    html.push(" (");\r\n\t\t\t//    var rules = [];\r\n\t\t\t//    for (var i = 0; i < item.contractualRules.length; i++)\r\n\t\t\t//        rules.push(item.contractualRules[i].text);\r\n\t\t\t//    html.push(rules.join(", "));\r\n\t\t\t//    html.push(")");\r\n\t\t\t//}\r\n\t\t\t// html.push(" (" + getHost(item.url) + ")");\r\n\t\t\t//html.push("<br>" + item.description);\r\n\t\t\treturn html.join("");\r\n\t\t},\r\n\t\t// render image result using thumbnail\r\n\t\timages: function (item, section, index, count) {\r\n\t\t\tvar height = 100;\r\n\t\t\tvar width = 100; //Math.round(height * item.thumbnail.width / item.thumbnail.height);\r\n\t\t\tvar html = [];\r\n\t\t\tif (section === "sidebar") {\r\n\t\t\t\tif (index) html.push("<br>");\r\n\t\t\t} else {\r\n\t\t\t\tif (!index) html.push("<p class=\'images\'>");\r\n\t\t\t}\r\n\t\t\t//html.push("<a href=\'" + item.hostPageUrl + "\'>");\r\n\t\t\tvar title = escapeQuotes(item.name) + "\\n" + getHost(item.hostPageDisplayUrl);\r\n\t\t\thtml.push("<img src=\'" + item.thumbnailUrl + "&h=320&w=320" +\r\n\t\t\t\t"\' height=" + height + " width=" + width + " title=\'" + title + "\' alt=\'" + title + "\'>");\r\n\t\t\t//html.push("</a>");\r\n\t\t\treturn html.join("");\r\n\t\t},\r\n\r\n\t\trelatedSearches: function (item, section, index, count) {\r\n\t\t\tvar html = [];\r\n\t\t\t//if (section !== "sidebar") html.push(index === 0 ? "<h2>Related</h2>": " - ");\r\n\t\t\t//else html.push("<p class=\'relatedSearches\'>");\r\n\t\t\t//html.push("<a href=\'#\' onclick=\'return doRelatedSearch(&quot;" +\r\n\t\t\t//    escapeQuotes(item.text) + "&quot;)\'>");\r\n\t\t\t//html.push(item.displayText + "</a>");\r\n\t\t\treturn html.join("");\r\n\t\t}\r\n\t}\r\n\r\n\t// render search results from rankingResponse object in specified order\r\n\tfunction renderResultsItems(section, results) {\r\n\r\n\t\tvar items = results.rankingResponse[section].items;\r\n\t\tvar html = [];\r\n\t\tfor (var i = 0; i < items.length; i++) {\r\n\t\t\tvar item = items[i];\r\n\t\t\t// collection name has lowercase first letter while answerType has uppercase\r\n\t\t\t// e.g. `WebPages` rankingResult type is in the `webPages` top-level collection\r\n\t\t\tvar type = item.answerType[0].toLowerCase() + item.answerType.slice(1);\r\n\t\t\t// must have results of the given type AND a renderer for it\r\n\t\t\tif (type in results && type in searchItemRenderers) {\r\n\t\t\t\tvar render = searchItemRenderers[type];\r\n\t\t\t\t// this ranking item refers to ONE result of the specified type\r\n\t\t\t\tif ("resultIndex" in item) {\r\n\t\t\t\t\thtml.push(render(results[type].value[item.resultIndex], section));\r\n\t\t\t\t\t// this ranking item refers to ALL results of the specified type\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar len = results[type].value.length;\r\n\t\t\t\t\tfor (var j = 0; j < len; j++) {\r\n\t\t\t\t\t\thtml.push(render(results[type].value[j], section, j, len));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn html.join("\\n\\n");\r\n\t}\r\n\r\n\t// render the search results given the parsed JSON response\r\n\tfunction renderSearchResults(results) {\r\n\r\n\t\t// if spelling was corrected, update search field\r\n\t\tif (results.queryContext.alteredQuery)\r\n\t\t\tdocument.forms.bing.query.value = results.queryContext.alteredQuery;\r\n\r\n\t\t// add Prev / Next links with result count\r\n\t\tvar pagingLinks = renderPagingLinks(results);\r\n\t\tshowDiv("paging1", pagingLinks);\r\n\t\tshowDiv("paging2", pagingLinks);\r\n\r\n\t\t// for each possible section, render the resuts from that section\r\n\t\tfor (section in { pole: 0, mainline: 0, sidebar: 0 }) {\r\n\t\t\tif (results.rankingResponse[section])\r\n\t\t\t\tshowDiv(section, renderResultsItems(section, results));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction renderErrorMessage(message) {\r\n\t\tshowDiv("error", preFormat(message));\r\n\t\tshowDiv("noresults", "No results.");\r\n\t}\r\n\r\n\t// handle Bing search request results\r\n\tfunction handleOnLoad() {\r\n\t\thideDivs("noresults");\r\n\r\n\t\tvar json = this.responseText.trim();\r\n\t\tvar jsobj = {};\r\n\r\n\t\t// try to parse JSON results\r\n\t\ttry {\r\n\t\t\tif (json.length) jsobj = JSON.parse(json);\r\n\t\t} catch (e) {\r\n\t\t\trenderErrorMessage("Invalid JSON response");\r\n\t\t}\r\n\r\n\t\t// show raw JSON and headers\r\n\t\tshowDiv("json", preFormat(JSON.stringify(jsobj, null, 2)));\r\n\t\tshowDiv("http", preFormat("GET " + this.responseURL + "\\n\\nStatus: " + this.status + " " +\r\n\t\t\tthis.statusText + "\\n" + this.getAllResponseHeaders()));\r\n\r\n\t\t// if HTTP response is 200 OK, try to render search results\r\n\t\tif (this.status === 200) {\r\n\t\t\tvar clientid = this.getResponseHeader("X-MSEdge-ClientID");\r\n\t\t\tif (clientid) retrieveValue(CLIENT_ID_COOKIE, clientid);\r\n\t\t\tif (json.length) {\r\n\t\t\t\tif (jsobj._type === "SearchResponse" && "rankingResponse" in jsobj) {\r\n\t\t\t\t\trenderSearchResults(jsobj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderErrorMessage("No search results in JSON response");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trenderErrorMessage("Empty response (are you sending too many requests too quickly?)");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Any other HTTP response is an error\r\n\t\telse {\r\n\t\t\t// 401 is unauthorized; force re-prompt for API key for next request\r\n\t\t\tif (this.status === 401) invalidateSubscriptionKey();\r\n\r\n\t\t\t// some error responses don\'t have a top-level errors object, so gin one up\r\n\t\t\tvar errors = jsobj.errors || [jsobj];\r\n\t\t\tvar errmsg = [];\r\n\r\n\t\t\t// display HTTP status code\r\n\t\t\terrmsg.push("HTTP Status " + this.status + " " + this.statusText + "\\n");\r\n\r\n\t\t\t// add all fields from all error responses\r\n\t\t\tfor (var i = 0; i < errors.length; i++) {\r\n\t\t\t\tif (i) errmsg.push("\\n");\r\n\t\t\t\tfor (var k in errors[i]) errmsg.push(k + ": " + errors[i][k]);\r\n\t\t\t}\r\n\r\n\t\t\t// also display Bing Trace ID if it isn\'t blocked by CORS\r\n\t\t\tvar traceid = this.getResponseHeader("BingAPIs-TraceId");\r\n\t\t\tif (traceid) errmsg.push("\\nTrace ID " + traceid);\r\n\r\n\t\t\t// and display the error message\r\n\t\t\trenderErrorMessage(errmsg.join("\\n"));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bingWebSearch(query, options, key) {\r\n\r\n\t\t// scroll to top of window\r\n\t\twindow.scrollTo(0, 0);\r\n\t\tif (!query.trim().length) return false;     // empty query, do nothing\r\n\r\n\t\tshowDiv("noresults", "Working. Please wait.");\r\n\t\thideDivs("pole", "mainline", "sidebar", "_json", "_headers", "paging1", "paging2", "error");\r\n\r\n\t\tvar endpoint = "https://api.cognitive.microsoft.com/bing/v7.0/search";\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\tvar queryurl = endpoint + "?q=" + encodeURIComponent(query) + "&" + options;\r\n\r\n\t\t//\r\n\t\ttry {\r\n\t\t\trequest.open("GET", queryurl);\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\trenderErrorMessage("Bad request (invalid URL)\\n" + queryurl);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// add request headers\r\n\t\trequest.setRequestHeader("Ocp-Apim-Subscription-Key", key);\r\n\t\trequest.setRequestHeader("Accept", "application/json");\r\n\t\tvar clientid = retrieveValue(CLIENT_ID_COOKIE);\r\n\t\tif (clientid) request.setRequestHeader("X-MSEdge-ClientID", clientid);\r\n\r\n\t\t// event handler for successful response\r\n\t\trequest.addEventListener("load", handleOnLoad);\r\n\r\n\t\t// event handler for erorrs\r\n\t\trequest.addEventListener("error", function () {\r\n\t\t\trenderErrorMessage("Error completing request");\r\n\t\t});\r\n\r\n\t\t// event handler for aborted request\r\n\t\trequest.addEventListener("abort", function () {\r\n\t\t\trenderErrorMessage("Request aborted");\r\n\t\t});\r\n\r\n\t\t// send the request\r\n\t\trequest.send();\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// build query options from the HTML form\r\n\tfunction bingSearchOptions(form) {\r\n\r\n\t\tvar options = [];\r\n\t\toptions.push("mkt=" + form.where.value);\r\n\t\toptions.push("SafeSearch=" + (form.safe.checked ? "strict" : "off"));\r\n\t\tif (form.when.value.length) options.push("freshness=" + form.when.value);\r\n\t\tvar what = [];\r\n\t\tfor (var i = 0; i < form.what.length; i++)\r\n\t\t\tif (form.what[i].checked) what.push(form.what[i].value);\r\n\t\tif (what.length) {\r\n\t\t\toptions.push("promote=" + what.join(","));\r\n\t\t\toptions.push("answerCount=9");\r\n\t\t}\r\n\t\toptions.push("count=" + form.count.value);\r\n\t\toptions.push("offset=" + form.offset.value);\r\n\t\toptions.push("textDecorations=true");\r\n\t\toptions.push("textFormat=HTML");\r\n\t\treturn options.join("&");\r\n\t}\r\n\r\n\t// toggle display of a div (used by JSON/HTTP expandos)\r\n\tfunction toggleDisplay(id) {\r\n\r\n\t\tvar element = document.getElementById(id);\r\n\t\tif (element) {\r\n\t\t\tvar display = element.style.display;\r\n\t\t\tif (display === "none") {\r\n\t\t\t\telement.style.display = "block";\r\n\t\t\t\twindow.scrollBy(0, 200);\r\n\t\t\t} else {\r\n\t\t\t\telement.style.display = "none";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// perform a related search (used by related search links)\r\n\tfunction doRelatedSearch(query) {\r\n\r\n\t\tvar bing = document.forms.bing;\r\n\t\tbing.query.value = query;\r\n\t\tbing.offset.value = 0;\r\n\t\treturn bingWebSearch(query, bingSearchOptions(bing), getSubscriptionKey());\r\n\t}\r\n\r\n\t// generate the HTML for paging links (prev/next)\r\n\tfunction renderPagingLinks(results) {\r\n\r\n\t\tvar html = [];\r\n\t\tvar bing = document.forms.bing;\r\n\t\tvar offset = parseInt(bing.offset.value, 10);\r\n\t\tvar count = parseInt(bing.count.value, 10);\r\n\t\thtml.push("<p class=\'paging\'><i>Results " + (offset + 1) + " to " + (offset + count));\r\n\t\thtml.push(" of about " + results.webPages.totalEstimatedMatches + ".</i> ");\r\n\t\thtml.push("<a href=\'#\' onclick=\'return doPrevSearchPage()\'>Prev</a> | ");\r\n\t\thtml.push("<a href=\'#\' onclick=\'return doNextSearchPage()\'>Next</a>");\r\n\t\treturn html.join("");\r\n\t}\r\n\r\n\t// go to the next page (used by next page link)\r\n\tfunction doNextSearchPage() {\r\n\r\n\t\tvar bing = document.forms.bing;\r\n\t\tvar query = bing.query.value;\r\n\t\tvar offset = parseInt(bing.offset.value, 10);\r\n\t\tvar count = parseInt(bing.count.value, 10);\r\n\t\toffset += count;\r\n\t\tbing.offset.value = offset;\r\n\t\treturn bingWebSearch(query, bingSearchOptions(bing), getSubscriptionKey());\r\n\t}\r\n\r\n\t// go to the previous page (used by previous page link)\r\n\tfunction doPrevSearchPage() {\r\n\r\n\t\tvar bing = document.forms.bing;\r\n\t\tvar query = bing.query.value;\r\n\t\tvar offset = parseInt(bing.offset.value, 10);\r\n\t\tvar count = parseInt(bing.count.value, 10);\r\n\t\tif (offset) {\r\n\t\t\toffset -= count;\r\n\t\t\tif (offset < 0) offset = 0;\r\n\t\t\tbing.offset.value = offset;\r\n\t\t\treturn bingWebSearch(query, bingSearchOptions(bing), getSubscriptionKey());\r\n\t\t}\r\n\t\talert("You\'re already at the beginning!");\r\n\t\treturn false;\r\n\t}\r\n\r\n// --></script><!--</head>\r\n<body onload="document.forms.bing.query.focus();">--><div class="modal-full-screen popup-image-search" id="searchImagePopup" tabindex="-1" role="dialog" aria-labelledby="searchImagePopupTitle" data-backdrop="static"><div class="" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="searchImagePopupTitle">Search Image</h5><button type="button" data-dismiss="modal" class="btn icon icon-cross btn-simple-primary close"></button></div><div class="modal-body"><form name="bing" onsubmit="this.offset.value = 0; return bingWebSearch(this.query.value,bingSearchOptions(this), getSubscriptionKey())"><div id="logo" style="display: none"><!-- logo block including search market/language --> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAyCAIAAAAYxYiPAAAAA3NCSVQICAjb4U/gAAARMElEQVR42u2bCVRUV5rHi8VxaeNuOumYTs706aTTZrp7TqbTk5g+9kn3OZN0pjudpZM5SfdJzEzPyZmO1gbIJhmNmijy6hUFsisCgsqigoCt7IoKgoDgUgXILntR+/aWzHfvfQUFFEURsU8cKe/hFFL16r3f++53/9//uyXSWUwjZgPDshzHcy4PnuMXHvP4EJ1qufpPyRHby3Iv93XqbDY7y7IC9QU48wr6RMtVEb1NpJAvoeQvpVF7L5c0jQ6ZHAwJcH6B+HyBzm6pEymkIlomouUiWiqiJCvpwDdOxCdfr+nV6x0Mwy+gnqeIJqAxa3iikJDhEyX5fmx4eZcGJ+yFxz2DPg6pQwA9eQBuSnJC3bCQPe4/6ChxjqbxAVQgnHM8OKBzW5s4lucfsOSxAHoWPh4eggRy/ubprQzL6a1Wo83KfZuWl5lBU39v0CDeQcDbGQa0PB7jT4RfHawDJD562bTzERiznI1l4xurX0yNfCVdcUbTAtAXQE+PSnbEYgkoyfmkOGNL8dEtxZkwPhFGFjz/tCR7b+35su5WrcXCuq1gOa5ZO7Q6eruIBuEk/WH8zj6LaQH0dNB8t8X03dgIqJ6cQyainENBhmSJQvxi2v4j12tMqIydFN3wy8XuO0sOSNEVUZI1ypA23cgCaDegewTQAlYfGNTEQCWVQkrO1l8h+eu5E2M2m+u5AfRBq+Xf0unFlHSxUv5BQZqRcSyAdg/60dgd+NPFf8hPiaotPQCjpnR/bWnExcI/5h96KmmXHyqsUGbwo+S7Lp2zu0Y0immuR6/NbLqSc7NhxGb59qyGXoMm6/59Bt0rgEYcY+svsOz4IscxHJhdXK/REFRZsISENiX9fkx4q0E3nqnRKxFrbIux5I3fnhL8Rp038o77u2iluxbjo7Fh+HwkqmvVnBt1wVoZ9rPibB8KQCPc6Tfr3cmQb6HX4QH0gW0ENATIHe2gwW5lp4rb+wZaKVE2uAWNgraqp2OJkqRsyb7qc+OgJ+tuMhG5mWS6kGsEhc4730TeJ/zXN1X9bh4zg4bhAlpSfPS149Gqa1U3RgeMdlCraCqji55f0GZIHeEkoqMbqqdXd/j3r2/ptd+JDhQpUbLec6GYnQyaQY46KlsQLpfcgZx2koI4IScRSQ6vtzIM1DhjVovJbnOgtCOkHo+qH+t+JPAdAERvMessZrPdzuBqYNLxcQ3lFWh4Y2mnelmU2EcpWR8T+ubJ5JTmq61jWjPjmF683V/QuLRuHBlcCuKPkvlFSVKba3ERw5HbAJjKutU5rU25msbmgT7X0zE5HPmtzdmaxhx1Y59eR25Jl24sqeHynwozXj2m2pRJv5EXF1p++lJfp4VhZpy1+H/hzzqrtayrNbQ8/628xFcyqV8di34vL2XfxfMtw/1WtEywl3o7cjXXc2431fZ2zgI6D0CjIzN6u+Pl1AOiaCJRpb5Rkqfid/65MCNPfb3PqIeIwPGN/t1X0CwSFmx6S70f0nmyNcqgOu0AClyeJbcB5N4v0ykQLT6UJLAkx/XG95j0j0YH+dAS36itJ243WR3M0VsNG5N2+0fB2itGKzC6amQRr1WGhFadGXWmymmzioPbWdvf87vchOWwTlBEO4iJePc/INkQu2NfXaXWbn8//7A/RGfU1vdPHvYiR+NrA4TK2gofdE5SYVDoUpdQsueS9nx2LqeoUz1oNjkmUp3zHOcS4wh0TBj6aFos5Ghn4hyXH0MW8+ajKpESncCHpw+bWXbcQoKX2Xl+UzqNL14mKz3leqf6TMY1qmBku1PSDE1LXGP1CmUgfNBSZdDag2HrEnYsVwX7oO4HYu2nkMkr8i244J/EGOeBgjs3fwDqCODSYh+FZDEtWx0Xsi4+fFVsqD/S+6DiAyKqz76ZfwSzEr99MsV71cG3G8Y2KENmeLH0HxTyfzkSGVZRcLm/e8RqsXNCIuTnEuMToBXi6GsX4RAkF+I0x9gYpkOv/a+io35Yb/woYdeN0UHXOTQBGleV8tLTrrf5rsm4WhUqUqKc82llwbrokOWqoP84lZrb2nxTO3xbO1za2fY/f8tZARU8hVg/ogqq7G3nJh0f3erL/T1PxGMNSotXKuXv5iZmqa9dG+7XjI1cHehVNFx4IfUrP1oMq8iTyXuQNIoSv33q0BxA2zn+o4K08RbMVNHtHMupgM2Z0V9eKasbHtDjxUGIbS8y+ARoShJaWdQ42Nc4dBdGzWBPQduNiPL8jSl7ICf4KmQ/Obyvqq+DZSZNbSdoBS4spVNA942DVsgXK4NXKrar6qvN0KzDEUFuJ8wPmPX+6D6hc9hSmM4IRxDEyIjd/uusGHL5cCdgWpggm7NkEWZYIvbNxo+L0v1pMu9hAs0FNClwSzo0i5D/MA309GKHkq5WhbyRHR/TVN0yNmxxMDy+HC9ydBj5dF80S2TwcfDTn4ZyHB0TjrwiNuSvZSdbdVrWqTRcNYmD419GoNFpTAVtNq6OCcUdO7kvJf+8stjuTj6OOeybM5RI0lDSpxMjhm2WcdAwwY6pGxZRuC6NkkEj2za9IsJhNWKzvpYdR+63iNqGQHtfggMmncPxC7TUSGZcP52ZxCWVi9fHhqU11xA95Lky7DOb1seEjTfShA8i6wEl9DOXx4a8mBUdWJHfMNhnZ1mSOcePgEFTbkFDoK2CiEaBIn8maQ/86o4SylWx1y6SD11Gy5tGB3mnoALP8LUTsZAxRIptL6Tu19ps7pZKYm+xF+92LaUDviFohuWpq5U+ZIWlvRwSiI4vLhWxszU9poB+LH7Hjw/t2XgYjR8f3vtM8u7vxUcsiw7wxdB9FNLvxobtq6swOBysU4WR/PaSZ9BoMZT/pSTP4b6DgIRNZW+XPw5GX4WkrLtdKGdYWKX064gHS23df7V0XFa6uRaWNzGO51O/whEzR9A8TmQdxrEnY7ejrSA0SdbSWaDDcWjJ/yLQnLeg8WIYWVeutVl1eIzZrANm4y3tUEFry2fnsx9H6QVlEsgquy+ft7HjAofzDrQs4doV99INS0W1VrtcQZZEcWH7bcFA4fjiDo0/jvQlCnnt3V52ZluCw5XRv+cl4fOcK2j8gGSf39b825yDsBQIU5uaLY3Q4p3VxcxsK6EAOpbIO/A6LroDwQPWqr7O51O/JLllrTK4bqCHuEcYNOdNRB+7dV2out3V1R163Qoa6yuFrABA4xBBKaX+IhYbEjjJuxYT5wk0AvUuknffFDS+V5yesZ9tu/H2ycQ1McHI3yEbQmYGHVF1ZlYjzQk6nLxRVe8WNC6KGK6oS71MEUCytuR8HsPNDfTx280zgQamnQb9CkWwK2icotmIC8UkCDYk7hxjHZzniL5H0K4PC+Oo6Gr94HTq2pgInCJmUC9KcXhlgbegY8KRCqYDYuovcDP7OeDo/zyDxp0X6c9TI01kVfQKNMJ3XO0eNEnTnQbDSnegA8vz8TQSb0jepWMZT6BR9ci/A3zvETQp1Yjz22XQv1+UOWMCwWUeFDLzChrCif0APhQJXulTcRGDWITdb9AhVWeItH0iaaeWZXjeU0QD6LfuHTTyHBge1qjsWw3/mha1iPKoOmhxSPnpeQXNQzj9qTiLOAxPqXYMWO87aIiqqKsVeOLKVsUEt5uNgsU1Q0ffxrC/PBbrBWgXP5qfcG+FB1TD0AZ9Oy8FSUWicGlPqWOOoJHXPA56igNOfoC7tjlLRZTP88l7DbAZc55BT10MQUWcarvpRxHnSFrUcduDJQ9/6TEbNhyMQAeJ2uaxMnSxSZ06mif7LpqH+z89l7UGFKU3ahqBlgaVnfamrzRRGSpnAo1+wA7XCwPdyJTAH/FBcRrjtEkB9MsZHitD5Wygeb4LQE9RHfzX8KPVMLaWXDUl/c/CLDszY2cH/pDUUoM9OPlsJTgBrUGgBeeM5bqNui8vnXs64XNn8pXMUqqgiYPCM6jkFHo/z3kFGt0bDHpyyJBzgHHHoP01hDPKMNKlUcDiBjfvoKdEND46dNF+n5uAPVXpquiQ8p521nUL+cSM59v12o2p+5CjNLvXgWTQVrDPOfZriEWt1XL0Vv2LR/b5Ib5yvJ96tljGCzRYFhtT9ua1thAnzlvQtCy6rhJtVuIY55Ylxuiwdxp02eqGTWlf+eJ7DObyWydTDA77PIM2ugON5/Sp9pYlZH8zJXvh8L5rQ30OVqhMBeXJsBrd2FvHE8Fi9AcbFoXaLKaSFIFWN5oZpry37XcnExfjHh02ZWQzTgLFRCz7UrLH4nbIq/LbdKN2jmO96O66gJb+4ij1cdHRj2AUZ3xUnP7novQ38hKhFl+KDg5fUQAjWPxyepR6bBRH+f2PaDyloE3zyek03yjIvChUn0v8gq6/0KIdvGs29JkMLaODKc01L6RGwrX/85EDm7LjiaZ496Rn904h/qquYuvfclepQmYvtSdAo5TySHTQR6fTa/u6ie8zt+bsLHYVampAWP0hL1E9OuzK6n6DJqkBZtWrmSpftB8KprXMlw54ND7i+SORG9P3PRYf7od9tGcTdp/rvfMucZUp6R9PEtXh1vbE9d4jkPsPiEVkzwo9exSjDgAdAAk0v+2G2e4g/S3vd9v2mQ2Px4SCI+qDD+XjHOQ5Mk6VAWsPhv8qMzq5uWYU9ouyk5YjojpeSaewZy0JmKY61qlCUCuLkp5QX/cAGlTHWjoEKl5olxS033IBzZNivF2n/fhMBvjAvmT/FOrUkG09kqXKwM2ZdHVfh53l3hHse+l70MqaEbT3w+mI+lGynxzaf7DxEtkiNNd9IPB6vc2WUFd1oKZkP4xa9DPS+RyexNRXZd5qqOnvhq6z20YwKXyzmmr3X4HXl5Z0ql1fAuZUXF0FHCfySol6eNCDJaS1WmPqKiOvnFddKVOPDLJT9DJ+IzSmS+/cEp89vintwLOHdj+TvOtnafuhSE5vrh1CBixr4djf5qaIsFP6l+Jj9wxaIYT/92I/D68s6tCNMUQZzL0jzjlVhXMXAEeesWjvAM8KXQy84szcnhb+LpwEy03Z1yE0xkgPwlNdR97KsRN7B9z5c1D+cTqHrc+k7zca4PbYUO9b2PxiYB0/OxxJhEPEpXOQo6/OxVyell4o2UrV9g8L0+sGerGuXPi6i3AfNHrtatQLloKaPt7aJDoOoF0y7BzsfFq6TBH0m2Oxhe03jQ7H+D65/9/4xrv8vIfZgIP9YGM14bmG3t6uHREVaZqXxwSTnpPXGRl148EzS2+uG7ZZ2YcmiklqwptXZmzLkZ1KHTrtT1P2koj8fU4SLIwivcN+XNO0KUu5SCFzU+y5qjqcx2Hp/8eEXbsvl/QYdQ6U7tiHCDTLDZlMpe23YdFmOX6y/SJ42WArdul17+cl+0RB4Mq/QwcWYt0iIq32IbNJ1XjhuSN7facsjIg+3nmPt9KuPxj+2fnc5qF+Zr533T0gEc226rVPqkJfP6E61HwFPJ8xixn2ITqQrGShcG0b02bcqAMd4ov31oCm3lKUacaGl8hpY7CQZVv1o6GVZzbERfhMtLFxHUhJQR7CFKjoarM6l9WHEjRa4lZEQ+Rt81OIn0gIe/WY8r0zR7aczfywMO313LgfHvpiGSKG2uR+tOSdnCQQJKSQEE3xnEA5XBvs/e+zWetiQnD5KFlES186sj/9Rp0ef6HsYf4WLVx9p1H304TP/Wix8+vcrpWEICggnB+PCwsuPz1oMo7zEk1N9nhYHI6yLs2bOXHPJu0E8Q/77HGGYR/yL+DjvgkLGUNRV/F6TsIzh75cHxe+IjpouTJwOR24Mib46cRdsPkm/ELR1f5uG+l1OS0ekYeDQinVOTbqmP9t0A98XEM2MDNsr17X0N9T1aWBErSkSwNlt2Z0SG+DpOCm8fJ/b7k8gBQkHh4AAAAASUVORK5CYII="><i>api</i><p><select name="where"><option value="es-AR">Argentina (Spanish)</option><option value="en-AU">Australia (English)</option><option value="de-AT">Austria (German)</option><option value="nl-BE">Belgium (Dutch)</option><option value="fr-BE">Belgium (French)</option><option value="pt-BR">Brazil (Portuguese)</option><option value="en-CA">Canada (English)</option><option value="fr-CA">Canada (French)</option><option value="es-CL">Chile (Spanish)</option><option value="da-DK">Denmark (Danish)</option><option value="fi-FI">Finland (Finnish)</option><option value="fr-FR">France (French)</option><option value="de-DE">Germany (German)</option><option value="zh-HK">Hong Kong (Traditional Chinese)</option><option value="en-IN">India (English)</option><option value="en-ID">Indonesia (English)</option><option value="it-IT">Italy (Italian)</option><option value="ja-JP">Japan (Japanese)</option><option value="ko-KR">Korea (Korean)</option><option value="en-MY">Malaysia (English)</option><option value="es-MX">Mexico (Spanish)</option><option value="nl-NL">Netherlands (Dutch)</option><option value="en-NZ">New Zealand (English)</option><option value="no-NO">Norway (Norwegian)</option><option value="zh-CN">People\'s Republic of China (Chinese)</option><option value="pl-PL">Poland (Polish)</option><option value="pt-PT">Portugal (Portuguese)</option><option value="en-PH">Philippines (English)</option><option value="ru-RU">Russia (Russian)</option><option value="ar-SA">Saudi Arabia (Arabic)</option><option value="en-ZA">South Africa (English)</option><option value="es-ES">Spain (Spanish)</option><option value="sv-SE">Sweden (Swedish)</option><option value="fr-CH">Switzerland (French)</option><option value="de-CH">Switzerland (German)</option><option value="zh-TW">Taiwan (Traditional Chinese)</option><option value="tr-TR">Turkey (Turkish)</option><option value="en-GB">United Kingdom (English)</option><option value="en-US" selected="selected">United States (English)</option><option value="es-US">United States (Spanish)</option></select></p><p>from Microsoft Cognitive Services</p></div><div id="query"><!-- query controls including search field and options --> <input type="text" name="query" id="term" placeholder="Search the Web" autocomplete="on"><p style="display: none">Promote <input type="checkbox" name="what" id="webpages" value="webpages"><label for="webpages">Web pages</label><input type="checkbox" name="what" id="news" value="news"><label for="news">News</label><input type="checkbox" name="what" checked="checked" id="images" value="images"><label for="images">Images</label><input type="checkbox" name="what" id="videos" value="videos"><label for="videos">Videos</label>&nbsp;&nbsp;&nbsp;From<select name="when"><option value="" selected="selected">All time</option><option value="month">Past month</option><option value="week">Past week</option><option value="day">Last 24 hours</option></select>&nbsp;&nbsp;&nbsp;<input type="checkbox" id="safe" name="safe" value="on" checked="checked"><label for="safe">SafeSearch</label><!-- these hidden fields control paging --> <input type="hidden" name="count" value="15"> <input type="hidden" name="offset" value="0"></p></div></form><div id="error"><h2>Error</h2><div id="_error"></div></div><h2>Results</h2><div id="paging1"><div id="_paging1"></div></div><div id="noresults"><div id="_noresults">None yet.</div></div><div style="display: none" id="sidebar"><div id="_sidebar"></div></div><div style="display: none" id="pole"><div id="_pole"></div></div><div id="mainline"><div id="_mainline"></div></div><div id="paging2"><div id="_paging2"></div></div><!--<div id="json" style="display: none">\r\n\t\t\t\t\t<h3><a href="#" onclick="return toggleDisplay(\'_json\')">JSON</a></h3>\r\n\t\t\t\t\t<div id="_json" style="display: none"></div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div id="http" style="display: none">\r\n\t\t\t\t\t<h3><a href="#" onclick="return toggleDisplay(\'_http\')">HTTP</a></h3>\r\n\t\t\t\t\t<div id="_http" style="display: none"></div>\r\n\t\t\t\t</div>--></div><div class="modal-footer"><!--<button type="button" class="btn btn-primary" ng-click="NewRuleSet();"><i style="color:#fff;" class="fa fa fa-plus"></i> Add RuleSet</button>--> <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-primary" ng-click="SelectImage()">{{buttontext}}</button><!--<button type="button" class="btn btn-primary" ng-click="SaveCorestat()">Save</button>--></div></div></div></div>');
$templateCache.put('/views/shared/AccountSettings.html','<div class="container" data-ng-init="onloadFun()"><div class="account_setting"><uib-tabset active="active"><uib-tab><uib-tab-heading><i class="glyphicon glyphicon-bell"></i> Edit Profile</uib-tab-heading><div class="container edit_profile"><div class="panel panel-primary"><div class="panel-heading"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Edit Profile</h1></div><button type="button" class="btn btn-primary back" ng-click="Cancel()">Back</button></div></div><div class="panel-body"><div class="col-md-offset-2 col-md-10"><div class="form-horizontal"><form name="EditForm" novalidate class="form-horizontal header"><div class="form-row"><div class="col-12 col-md-12"><!-- Item name --><div class="form-group col-md-6"><label for="newItemName">User Name</label><input type="text" class="form-control" id="username" placeholder="Enter Username" ng-model="data.Name" disabled="disabled"></div><!-- End of item name --></div><div class="col-12 col-md-12"><!-- Item name --><div class="form-group col-md-6"><label for="newItemName">Email</label><input type="text" class="form-control" id="email" placeholder="Enter email" name="email" ng-model="data.Email" disabled="disabled"></div><!-- End of item name --></div></div><div class="form-group"><!--<label class="control-label col-sm-2" for="pwd">Profile Image:</label>--><div class="col-sm-4"><div class="clearfix"><div class="pull-left edit-character-portrait"><img id="profileImage" ng-src="{{data.ProfileImage}}" ng-model="data.ProfileImage" alt="" ngf-resize="{width: 120, height: 120}"></div><div class="profile_image"><span>Choose file</span><input type="file" onchange="angular.element(this).scope().ProfileImageUpload(this)" accept="x-png,gif,jpeg"></div></div><span class="help-block">120px by 120px</span></div></div></form></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="button" class="btn btn-accent pull-left" ng-click="Update()">Update</button><!--<button type="button" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button>--></div></div></div></div></div></div></uib-tab><uib-tab><uib-tab-heading>Reset Profile</uib-tab-heading><div class="container reset_password"><div class="panel panel-primary"><div class="panel-heading"><div class="page-toolbar-wrapper"><div class="page-toolbar-title"><h1>Reset Profile</h1></div><button type="button" class="btn btn-primary back" ng-click="Cancel()">Back</button></div></div><div class="panel-body"><div class="col-md-offset-2 col-md-10"><div class="form-horizontal"><!--<form name="EditForm1" novalidate class="form-horizontal">--><div class="form-row"><div class="col-12 col-md-12"><!-- Item name --><div class="form-group col-md-6"><label for="newItemName">Old Password</label><input type="password" class="form-control" id="emailold" placeholder="Enter Old Password" name="emailold" ng-model="resetModel.oldpassword"></div><!-- End of item name --></div><div class="col-12 col-md-12"><!-- Item name --><div class="form-group col-md-6"><label for="newItemName">New Password</label><input type="password" class="form-control" id="emailnew" placeholder="Enter New Password" name="emailnew" ng-model="resetModel.newpassword"></div><!-- End of item name --></div><div class="col-12 col-md-12"><!-- Item name --><div class="form-group col-md-6"><label for="newItemName">Confirm Password</label><input type="password" class="form-control" id="pwd" placeholder="Enter Confirm password" name="pwd" ng-model="resetModel.confirmpassword" ng-change="checkpass()"></div><!-- End of item name --></div></div><!--</form>--></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="button" class="btn btn-accent pull-left" ng-click="ResetProfilePassword(resetModel)">Update</button><!--<button type="button" class="btn btn-simple-accent" ng-click="cancel()">Cancel</button>--></div></div></div></div></div></div></uib-tab></uib-tabset></div></div><toaster-container class="toaster_align" toaster-options="{\'time-out\':7000}"></toaster-container>');
$templateCache.put('/views/shared/home-topNav.html','<div class="page-characters"><header class="site-header"><div class="container-fluid"><div class="site-header-wrapper"><div class="site-header-left-section"><!-- Logo --><div class="site-header-logo"><div class="site-header-logo-small"><img src="/wwwroot/css/assets/images/logo-small.svg" ng-click="gohome()" alt="Logo"></div><div class="site-header-logo-full"><img src="/wwwroot/css/assets/images/logo-full.svg" ng-click="gohome()" alt="Logo"></div></div><!-- End of logo --></div><div class="site-header-right-section"><div class="site-header-user"><!-- Search --><form class="site-header-search" action="./search-result.html"><i class="icon icon-search"></i> <input type="search" placeholder="Search items"></form><!-- User --><div class="site-header-user"><div class="site-header-user-avatar"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 102 102"><path d="M0,0V102H102V0ZM95,76,51,101,7,76V26L51,1,95,26Z"></path></svg> <img style="border: none" ng-src="{{data.ProfileImage?data.ProfileImage:\'http://www.advacto.com/images/user.jpg\'}}" onerror="this.src=\'http://www.advacto.com/images/user.jpg\'"></div><div ng-bind="data.UserName" class="site-header-user-name"></div></div><!--class="site-header-user-name"--><!-- End of user --><!-- Site navigation --><nav class="site-header-navigation"><div class="dropdown hide" ng-click="siteNavigationMenuToggle($event)"><div class="dropdown-toggle" id="siteNavigationToggle" data-toggle="dropdown" ng-click="CharacterRulesetCount()"><div class="icon"></div></div><div class="dropdown-menu dropdown-menu-right hide" aria-labelledby="siteNavigationToggle"><ul class="dropdown-menu-list dropdown-menu-item-contain-links"><li class="dropdown-menu-item" ng-class="{active : activeMenu === \'Characters\'}"><a class="dropdown-menu-item-link" href="./characters.html"><span class="dropdown-menu-item-title">Characters</span> <span class="dropdown-menu-item-count">{{HeaderContents.TotalCharactersCount}}</span></a></li><li class="dropdown-menu-item" ng-class="{active : activeMenu === \'Rulesets\'}"><a class="dropdown-menu-item-link" id="GetAllRuleSet" href="./RuleSets"><span class="dropdown-menu-item-title">Rulesets</span> <span class="dropdown-menu-item-count">{{HeaderContents.TotalRuleSetCount}}</span></a></li><li class="dropdown-menu-item" ng-class="{active : activeMenu === \'AccountSettings\'}" ng-click="AccountSettings()"><a class="dropdown-menu-item-link" href="#"><span class="dropdown-menu-item-title">Account Settings</span></a></li><li class="dropdown-menu-item" ng-click="signout()"><a class="dropdown-menu-item-link" href="#"><span class="dropdown-menu-item-title">Logout</span></a></li></ul></div></div></nav></div></div></div></div></header></div>');
$templateCache.put('/views/shared/home-topNav_addnewruleset.html','<nav role="navigation" class="navbar navbar-default navbar-fixed-top navbar-1 addnewruleset_menu"><div class="navbar-header pull-left"><a class="navbar-brand" ng-click="noop()" title="RPGSmith"><span ng-click="gohome()" class="rpgs-navbar-brand"></span></a></div><div class="navbar-header pull-right"><span>{{navService.topNav.header}}</span><div class="btn-group" uib-dropdown is-open="status.isopen"><button id="single-button" type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="disabled">Account Settings <span class="fa fa-cog"></span></button><ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button"><li role="menuitem"><a href="#"><img ng-src="{{data.ProfileImage}}" ng-style="newstyles(data)" class="img-resposive ng-pristine ng-untouched ng-valid ng-empty" ng-click="EditData()"> <span class="name" ng-click="EditData()"><i class="fa fa-user"></i> {{data.Email}}</span><!--<div class="pull-left edit-character-portrait"><img id="characterImage" ng-model="character.file" alt="Character Image" ngf-thumbnail="getThumbNail()" ngf-resize="{width: 120, height: 120}" class="ng-pristine ng-untouched ng-valid ng-empty"></div>--></a></li><!--<li><a><div class="btn-group" data-toggle=""><label class="btn btn-primary"><input type="radio" ng-model="" value="On" />On</label> <label class="btn btn-default"><input type="radio" ng-model="" value="Off" />Off</label></div></a></li>--><li class="divider"></li><li role="menuitem"><a href="#" ng-click="ReSetPassword()"><i class="fa fa-key"></i> Change Password</a></li><li role="menuitem"><a href="#"><i class="fa fa-cc-diners-club"></i>Show Virtual Dice</a></li><li class="divider"></li><li role="menuitem"><a href="#" ng-click="signout()"><i class="fa fa-sign-out"></i>Sign Out</a></li></ul></div></div><!--<p class="text-center email"><span class="">{{data.Email}}</span></p>--></nav>');
$templateCache.put('/views/shared/pageslide-menu.html','<script type="text/ng-template" id="pageslide-menu-item.html"><span ng-if="!menu.divider && menu.header" style="color: white;"><!--\r\n        --><i class="fa {{menu.icon}}" aria-hidden="true"></i>{{menu.name}}</span>\r\n\r\n    <a ng-if="!menu.divider && !menu.header && !hasMenus(menu)" ng-click="onItemClick(menu)"><!--\r\n        --><i class="fa {{menu.icon}}" aria-hidden="true"></i>{{menu.name}}</a>\r\n\r\n    <a ng-if="!menu.divider && !menu.header && hasMenus(menu)" class="dropdown-toggle" uib-dropdown-toggle><!--\r\n        --><i class="fa {{menu.icon}}" aria-hidden="true"></i>{{menu.name}} <b class="caret"></b></a>\r\n    <ul class="dropdown-menu" uib-dropdown-menu ng-if="hasMenus(menu)"><!--\r\n        --><li ng-repeat="menu in menu.menus" uib-dropdown ng-include="\'pageslide-menu-item.html\'"></li>\r\n    </ul></script><div class="pageslide-left"><div class="navbar navbar-default"><ul class="nav navbar-nav"><li ng-repeat="menu in menus" uib-dropdown ng-class="{\'dropdown-header\': menu.header, \'divider\': menu.divider}" ng-include="\'pageslide-menu-item.html\'"></li></ul></div></div>');
$templateCache.put('/views/shared/rulesetproperty.html','<div class="form-group"><label class="control-label col-md-4">{{ info.Name }}</label><div class="col-md-8 mb-20"><rpgsmithrulesettype info="info"></rpgsmithrulesettype><!--<select class="form-control" ng-init="RulesetProperties()" ng-options="item.PropertyId as item.Name for item in properties" ng-model="propertyid">\r\n            <option value="">Select Option</option>\r\n        </select>--></div></div>');
$templateCache.put('/views/shared/validation-messages.html','<p ng-message="required">This field is required.</p><p ng-message="minlength">This field is too short.</p><p ng-message="maxlength">This field is too long.</p><p ng-message="required">This field is required.</p><p ng-message="email">This needs to be a valid email.</p>');
$templateCache.put('/views/tiles/tile-property-editor.html','<div class="form-horizontal"><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><div class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Shadow</label><div class="col-sm-10"><input type="checkbox" ng-model="style.borderShadow"></div></div><div class="form-group"><label class="col-sm-2 control-label">Corner Radius</label><div class="col-sm-10"><input type="number" min="0" ng-model="style.borderRadius"></div></div><div class="form-group"><label class="col-sm-2 control-label">Background</label><div class="col-sm-10"><spectrum-colorpicker ng-model="style.backgroundColor" options="colorOptions.background"></spectrum-colorpicker></div></div><div class="form-group"><label class="col-sm-2 control-label">Text</label><div class="col-sm-10"><spectrum-colorpicker ng-model="style.color" options="colorOptions.text"></spectrum-colorpicker></div></div><div class="form-group"><label class="col-sm-2 control-label">Border</label><div class="col-sm-10"><spectrum-colorpicker class="pull-left" ng-model="style.borderColor" options="colorOptions.border"></spectrum-colorpicker><ui-select ng-model="borderStyleSelected.value" class="pull-left" style="width: 100px;margin-left: 10px; margin-right: 10px"><ui-select-match><span ng-bind="$select.selected.name"></span></ui-select-match><ui-select-choices repeat="item in borderStyles track by item.id"><span ng-bind="item.name"></span></ui-select-choices></ui-select><ui-select ng-model="borderWidthSelected.value" class="pull-left" style="width: 60px"><ui-select-match><span ng-bind="$select.selected.name"></span></ui-select-match><ui-select-choices repeat="item in borderWidths track by item.id"><span ng-bind="item.name"></span></ui-select-choices></ui-select></div></div></div></div></div></div>');
$templateCache.put('/views/tiles/tile-template-1.html','<div class="tile-content"><div ng-bind-html-compile="tile.entity.content | trusted"></div></div>');
$templateCache.put('/views/tiles/tile-template-2.html','<div class="tile-container"><div class="tile-title" ng-bind="tile.entity.name"></div><div class="tile-content {{tile.parseStyle().content.classes}}" ng-style="tile.parseStyle().content.styles" ng-bind="tile.entity.displayValue"></div><div class="clearfix tile-counter-icons"><a ng-click="decrement()"><i class="fa fa-arrow-circle-down" aria-hidden="true"></i></a> <a ng-click="reset()"><i class="fa fa-refresh" aria-hidden="true"></i></a> <a ng-click="increment()"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></a></div></div>');
$templateCache.put('/views/tiles/tile-template-3.html','<div class="tile-container"><div class="tile-title" ng-bind="tile.entity.name"></div><div class="tile-content"></div></div>');}]);